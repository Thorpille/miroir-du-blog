<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Sam &#38; Max &#187; closure</title>
	<atom:link href="http://sametmax.com/tag/closure/feed/" rel="self" type="application/rss+xml" />
	<link>http://sametmax.com</link>
	<description>Du code, du cul</description>
	<lastBuildDate>Sat, 07 Nov 2015 10:56:13 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=4.1</generator>
	<item>
		<title>Réécriture de l’article sur les closures 5</title>
		<link>http://sametmax.com/reecriture-de-larticle-sur-les-closures/</link>
		<comments>http://sametmax.com/reecriture-de-larticle-sur-les-closures/#comments</comments>
		<pubDate>Fri, 28 Aug 2015 17:53:44 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[closure]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=16835</guid>
		<description><![CDATA[Autant quelques articles précédents n’ont pas demandé de gros efforts de concentration, autant celui-ci a été une refonte totale.
]]></description>
				<content:encoded><![CDATA[<p>Autant quelques articles précédents n’ont pas demandé de gros efforts de concentration, autant celui-ci a été une refonte totale.</p>
<p>En fait, un lecteur m’avait signalé en commentaire que je disais connerie sur connerie. </p>
<p>Vous pouvez croire que je suis têtu, mais mine de rien j’écoute ce qu’on me dit, et j’ai donc réécrit l’intégralité du billet.</p>
<p>Ce n’est pas une notion super importante en Python, mais si la curiosité vous pique, allez lire l’<a href="http://sametmax.com/closure-en-python-et-javascript/">article</a>.</p>
<p>Passons maintenant du coq à l’âne, ou devrais-je dire aux cocks à taille d’ânes avec une petite chubby et son partenaire portant un cock-ring :</p>
<p><iframe src=" http://www.youjizz.com/videos/embed/2173135 » frameborder=" 0" width="704" height="550" scrolling="no" allowtransparency="true"></iframe></p>
<p>Le cock ring, c’est le machin bleu en fin de vidéo, c’est un anneau, qui peut exister en modèle vibrant ou non, qui permet de varier les plaisirs. Je déteste ça, je trouve que ça fait mal à la teub, mais tous les gouts sont dans la nature.</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/reecriture-de-larticle-sur-les-closures/feed/</wfw:commentRss>
		<slash:comments>5</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2015/08/a6x59Sd.jpg" length="21396" type="image/jpg" />	</item>
		<item>
		<title>Qu&#8217;est-ce qu&#8217;une closure en Python et Javascript ? 15</title>
		<link>http://sametmax.com/closure-en-python-et-javascript/</link>
		<comments>http://sametmax.com/closure-en-python-et-javascript/#comments</comments>
		<pubDate>Sun, 06 May 2012 18:19:04 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[closure]]></category>
		<category><![CDATA[javascript]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=561</guid>
		<description><![CDATA[Impossible de trouver une explication simple des closures sur le Net. Pourtant c'est un concept simple qui peut se comprendre en quelques minutes.]]></description>
				<content:encoded><![CDATA[<aside style="text-align:center; font-size:60%"><em>Cet article a été mis à jour et contient maintenant du code Python en version 3</em></aside>
<p>Impossible de trouver une explication simple des closures sur le Net. Pourtant c’est un concept qui peut se comprendre en quelques minutes.</p>
<h2>Diableries en Python</h2>
<p>Si vous avez lu <a href="http://sametmax.com/comprendre-les-decorateurs-python-pas-a-pas-partie-1/">l’article sur les décorateurs</a>, vous vous souvenez peut être qu’en Python, on peut faire des trucs chelous avec les fonctions.</p>
<p>Par exemple, on peut définir une fonction, dans une fonction :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">def</span> une_fonction<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
...    <span style="color: #ff7700;font-weight:bold;">def</span> une_autre_fonction<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
...        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #483d8b;">&quot;hello !&quot;</span>
...    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>une_autre_fonction<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
...    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'salut !'</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> une_fonction<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
hello <span style="color: #66cc66;">!</span>
salut <span style="color: #66cc66;">!</span></pre></td></tr></table></div>

<p>Comme cette fonction est définie dans une autre fonction, <strong>elle n’est pas accessible en dehors de cette fonction</strong> :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> une_autre_fonction<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
---------------------------------------------------------------------------
<span style="color: #008000;">NameError</span>                                 Traceback <span style="color: black;">&#40;</span>most recent call last<span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&lt;</span>ipython-input-<span style="color: #ff4500;">14</span>-6955138255cd<span style="color: #66cc66;">&gt;</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #66cc66;">&lt;</span>module<span style="color: #66cc66;">&gt;</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
----<span style="color: #66cc66;">&gt;</span> <span style="color: #ff4500;">1</span> une_autre_fonction<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #008000;">NameError</span>: name <span style="color: #483d8b;">'une_autre_fonction'</span> <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #ff7700;font-weight:bold;">not</span> defined</pre></td></tr></table></div>

<p>Mais on peut faire encore plus zarb. On peut définir une fonction, et &#8230; retourner la fonction.</p>
<p>Attention, <strong>pas le résultat de la fonction, la fonction elle-même !</strong></p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">def</span> faire_une_fonction<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
...    <span style="color: #ff7700;font-weight:bold;">def</span> une_fonction_toute_fraiche<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
...        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #483d8b;">&quot;so fresh !&quot;</span>
...
...    <span style="color: #808080; font-style: italic;"># et la c'est magic time !</span>
...    <span style="color: #ff7700;font-weight:bold;">return</span> une_fonction_toute_fraiche 
...    <span style="color: #808080; font-style: italic;"># pas de parenthèse à la fin. On n’appelle pas la fonction,</span>
...    <span style="color: #808080; font-style: italic;"># on retourne l'objet fonction.</span>
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> fonction <span style="color: #66cc66;">=</span> faire_une_fonction<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> fonction<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
           <span style="color: #483d8b;">'so fresh !'</span></pre></td></tr></table></div>

<p>Donc en Python on peut créer une fonction à la volée, et la retourner. Pour les curieux, ça s’appelle une factory (une usine quoi).</p>
<p>C’est notamment, comme je le disais plus haut, le truc donc on se sert pour les décorateurs, mais ça permet aussi de créer du code qui contient des données préexistantes, au moment où l’on reçoit ces données.</p>
<p>C’est là qu’interviennent les closures.</p>
<h2>Définition formelle et super sérieuse d’une closure</h2>
<p>Si vous créez cette fonction :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">def</span> faire_une_fonction<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
...    <span style="color: #ff7700;font-weight:bold;">def</span> une_fonction_toute_fraiche<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
...        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #483d8b;">&quot;so fresh !&quot;</span>
...    <span style="color: #ff7700;font-weight:bold;">return</span> une_fonction_toute_fraiche</pre></td></tr></table></div>

<p>Mais qu’au lieu de faire ça, vous définissez le message dans une variable dans la fonction <code>faire_une_fonction()</code> :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">def</span> faire_une_fonction<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
...    <span style="color: black;">fraichitude</span> <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">&quot;so fresh !&quot;</span>
...    <span style="color: #ff7700;font-weight:bold;">def</span> une_fonction_toute_fraiche<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
...        <span style="color: #ff7700;font-weight:bold;">return</span> fraichitude
...    <span style="color: #ff7700;font-weight:bold;">return</span> une_fonction_toute_fraiche</pre></td></tr></table></div>

<p>Pour que ça marche, <code>une_fonction_toute_fraiche()</code> doit avoir accès à la variable définie dans la fonction du dessus afin de pouvoir l’afficher. Mais comme on retourne la fonction, on sort de la portée de cette variable.</p>
<p>Pour pallier ce problème, un espace mémoire spécial est créé automatiquement par Python qui va stocker une référence à cette valeur DANS <code>une_fonction_toute_fraiche()</code>. </p>
<p>Cet espace mémoire est appelé la closure. </p>
<p>Python donne accès à cet espace mémoire :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> fonction <span style="color: #66cc66;">=</span> faire_une_fonction<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> fonction
           <span style="color: #66cc66;">&lt;</span>function <span style="color: #dc143c;">__main__</span>.<span style="color: black;">une_fonction_toute_fraiche</span><span style="color: #66cc66;">&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> fonction.__closure__
           <span style="color: black;">&#40;</span><span style="color: #66cc66;">&lt;</span>cell at <span style="color: #ff4500;">0x7f2052fb3f18</span>: <span style="color: #008000;">str</span> <span style="color: #008000;">object</span> at <span style="color: #ff4500;">0x7f204f2265f0</span><span style="color: #66cc66;">&gt;,</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> fonction.__closure__<span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#93;</span>.<span style="color: black;">cell_contents</span>
           <span style="color: #483d8b;">'so fresh !'</span></pre></td></tr></table></div>

<p>Comme vous le voyez, la valeur de la variable <code>fraichitude</code> est attachée à la fonction <code>une_fonction_toute_fraiche</code>.</p>
<h2>Expliquons aussi à quoi ça sert</h2>
<p>Parce que là, tout de suite, je suis certain que vous vous demandez pourquoi on voudrait un truc aussi tordu.</p>
<p>Et bien la raison principale, c’est que ça permet d’attacher un état à la fonction. Cet état peut être créé au niveau de la fonction factory, donc il n’a pas besoin d’être hard codé dans l’autre.</p>
<p>Ouai, je sens que ce n’est toujours pas clair. Un petit exemple ?</p>
<p>J’ai un sondage d’un candidat à la présidentielle. Je sauvegarde son nom et le pourcentage d’intentions de vote, puis je veux pouvoir afficher l’évolution de ces intentions de vote.</p>
<p>Puisqu’on a des états (le nom du candidat et le % d’intentions de vote), on pourrait très bien utiliser une classe et faire un objet (si ça ne vous parle pas, on a un <a href="http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-1/"> guide POO</a> :)) :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Sondage:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> candidat<span style="color: black;">&#41;</span>:
        <span style="color: #808080; font-style: italic;"># ici notre état est explicitement attaché</span>
        <span style="color: #808080; font-style: italic;"># à self</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">candidat</span> <span style="color: #66cc66;">=</span> candidat
        <span style="color: #008000;">self</span>.<span style="color: black;">intentions_de_vote</span> <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">0</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> sonder<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> valeur<span style="color: black;">&#41;</span>:
        msg <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">&quot;{} a {}% d'intentions de vote&quot;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">intentions_de_vote</span> +<span style="color: #66cc66;">=</span> valeur
        <span style="color: #ff7700;font-weight:bold;">return</span> msg.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">candidat</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span>.<span style="color: black;">intentions_de_vote</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> sondage <span style="color: #66cc66;">=</span> Sondage<span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Schwarzenegger&quot;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> sondage.<span style="color: black;">sonder</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">5</span><span style="color: black;">&#41;</span>
           <span style="color: #483d8b;">&quot;Schwarzenegger a 5% d'intentions de vote&quot;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> sondage.<span style="color: black;">sonder</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">10</span><span style="color: black;">&#41;</span>
           <span style="color: #483d8b;">&quot;Schwarzenegger a 15% d'intentions de vote&quot;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> sondage.<span style="color: black;">sonder</span><span style="color: black;">&#40;</span>-<span style="color: #ff4500;">3</span><span style="color: black;">&#41;</span>
           <span style="color: #483d8b;">&quot;Schwarzenegger a 12% d'intentions de vote&quot;</span></pre></td></tr></table></div>

<p>Et ça marche parfaitement. </p>
<p>En fait, les closures nous permettent d’obtenir le même effet, mais avec une fonction :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">def</span> creer_sondage<span style="color: black;">&#40;</span>candidat<span style="color: black;">&#41;</span>:
...    <span style="color: black;">intentions_de_vote</span> <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">0</span>
...
...    <span style="color: #ff7700;font-weight:bold;">def</span> sonder<span style="color: black;">&#40;</span>valeur<span style="color: black;">&#41;</span>:
...        <span style="color: #808080; font-style: italic;"># ici notre état est automatiquement </span>
...        <span style="color: #808080; font-style: italic;"># stocké dans une closure</span>
...        <span style="color: #ff7700;font-weight:bold;">nonlocal</span> intentions_de_vote 
...        <span style="color: black;">intentions_de_vote</span>  +<span style="color: #66cc66;">=</span> valeur
...        <span style="color: black;">msg</span> <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">&quot;{} a {}% d'intentions de vote&quot;</span>
...        <span style="color: #ff7700;font-weight:bold;">return</span> msg.<span style="color: black;">format</span><span style="color: black;">&#40;</span>candidat<span style="color: #66cc66;">,</span> intentions_de_vote<span style="color: black;">&#41;</span>
...
...    <span style="color: #ff7700;font-weight:bold;">return</span> sonder
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> sonder <span style="color: #66cc66;">=</span> creer_sondage<span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Schwarzenegger&quot;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> sonder<span style="color: black;">&#40;</span><span style="color: #ff4500;">5</span><span style="color: black;">&#41;</span>
          <span style="color: #483d8b;">'Schwarzenegger a 5% intentions de vote'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> sonder<span style="color: black;">&#40;</span><span style="color: #ff4500;">10</span><span style="color: black;">&#41;</span>
          <span style="color: #483d8b;">'Schwarzenegger a 15% intentions de vote'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> sonder<span style="color: black;">&#40;</span>-<span style="color: #ff4500;">2</span><span style="color: black;">&#41;</span>
          <span style="color: #483d8b;">'Schwarzenegger a 13% intentions de vote'</span></pre></td></tr></table></div>

<p>Comment ce snippet marche-t-il ?</p>
<p>D’abord, nous avons <code>creer_sondage</code> qui est une factory, et qui nous fabrique puis retourne la fonction <code>sonder</code>. Mais cette dernière accède aux variables <code>candidat</code> et <code>intentions_de_vote</code> qui sont définies au-dessus. Un espace mémoire spécial est donc créé par Python pour donner accès à ces variables.</p>
<p>A chaque fois qu’on appelle <code>sonder()</code>, <code>candidat</code> et <code>intentions_de_vote</code> sont à leur valeur précédente, car elles sont stockées dans cet espace mémoire, et réaccédées :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> sonder.__closure__
           <span style="color: black;">&#40;</span><span style="color: #66cc66;">&lt;</span>cell at <span style="color: #ff4500;">0x7f2052fc5fa8</span>: <span style="color: #008000;">str</span> <span style="color: #008000;">object</span> at <span style="color: #ff4500;">0x7f204f212d30</span><span style="color: #66cc66;">&gt;,</span>
 <span style="color: #66cc66;">&lt;</span>cell at <span style="color: #ff4500;">0x7f2052fb37f8</span>: <span style="color: #008000;">int</span> <span style="color: #008000;">object</span> at <span style="color: #ff4500;">0x9f8980</span><span style="color: #66cc66;">&gt;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> sonder.__closure__<span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#93;</span>.<span style="color: black;">cell_contents</span>
           <span style="color: #483d8b;">'Schwarzenegger'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> sonder.__closure__<span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span>.<span style="color: black;">cell_contents</span>
           <span style="color: #ff4500;">13</span></pre></td></tr></table></div>

<p>Ce qui explique que quand on rajoute des pourcents aux intention de vote via le passage de paramètre à chaque appel, ils se cumulent dans la variable <code>intentions_de_vote</code> : c&#8217;est toujours la même variable qui est modifiée, car elle est piégée dans la closure.</p>
<p>Vous avez dû noter un mot-clé assez rarement utilisé :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">nonlocal</span> intentions_de_vote</pre></td></tr></table></div>

<p>Pour faire simple, disons que les closures en Python sont en lectures seules, à moins qu’on précise explicitement avec <code>nonlocal</code> qu’on va utiliser une variable qui n’est pas locale et qu’on va la modifier.</p>
<p>C’est une contrainte spécifique à Python liée à la manière dont il gère la portée des variables, et c’est un peu relou. Bref, si vous voulez modifier la valeur d’une closure, il faut marquer la variable avec <code>nonlocal</code>.</p>
<h2>En JavaScript</h2>
<p>Les closures en JavaScript marchent de la même manière qu’en Python :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #000066; font-weight: bold;">function</span> creerSondage<span style="color: #009900;">&#40;</span>candidat<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #000066; font-weight: bold;">var</span> intentions_de_vote <span style="color: #339933;">=</span> <span style="color: #CC0000;">0</span><span style="color: #339933;">;</span>
&nbsp;
    <span style="color: #006600; font-style: italic;">// JS a des fonctions anonymes donc on peut </span>
    <span style="color: #006600; font-style: italic;">// la retourner cash</span>
    <span style="color: #000066; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>valeur<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
&nbsp;
        <span style="color: #006600; font-style: italic;">// poof, toutes les variables ici </span>
        <span style="color: #006600; font-style: italic;">// sont dans une closures</span>
        intentions_de_vote  <span style="color: #339933;">+=</span> valeur
        <span style="color: #000066; font-weight: bold;">return</span> candidat <span style="color: #339933;">+</span> <span style="color: #3366CC;">&quot;a &quot;</span> <span style="color: #339933;">+</span>intentions_de_vote  <span style="color: #339933;">+</span> <span style="color: #3366CC;">&quot;% d'intentions de vote&quot;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #000066; font-weight: bold;">var</span> sonder <span style="color: #339933;">=</span> creerSondage<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;Schwarzenegger&quot;</span><span style="color: #009900;">&#41;</span>
console.<span style="color: #660066;">log</span><span style="color: #009900;">&#40;</span>sonder<span style="color: #009900;">&#40;</span><span style="color: #CC0000;">5</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
          <span style="color: #3366CC;">'Schwarzenegger a 5% intentions de vote'</span>
console.<span style="color: #660066;">log</span><span style="color: #009900;">&#40;</span>sonder<span style="color: #009900;">&#40;</span><span style="color: #CC0000;">10</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
          <span style="color: #3366CC;">'Schwarzenegger a 15% intentions de vote'</span>
console.<span style="color: #660066;">log</span><span style="color: #009900;">&#40;</span>sonder<span style="color: #009900;">&#40;</span><span style="color: #339933;">-</span><span style="color: #CC0000;">2</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
          <span style="color: #3366CC;">'Schwarzenegger a 13% intentions de vote'</span></pre></td></tr></table></div>

<p>Et pas besoin de spécifier <code>nonlocal</code>. </p>
<p>On utilise beaucoup plus souvent les closures en JS qu’en Python. En Python, c’est surtout pour les décorateurs, mais en JS, comme on a des <a href="http://sametmax.com/quest-ce-quun-callback/">callbacks</a> partout, il faut trouver un moyen de passer l’état du programme aux callbacks, et généralement on le fait via des closures.</p>
<h2>Petit résumé ?</h2>
<p>Une closure est un espace mémoire créé quand une fonction B est définie dans une fonction A, et que B accède à des variables définies dans A. </p>
<p>Il n’y a qu’un espace mémoire, attaché à B, qui est réutilisé à chaque appel de B, donc si les valeurs des variables changent, B aura accès aux nouvelles valeurs à chaque appel.</p>
<p>Cela est utile quand on veut partager un état entre plusieurs fonctions, sans utiliser la POO, des variables globales ou modifier les paramètres qu’une fonction attend. Cela permet par ailleurs d’initialiser cet état dynamiquement.</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/closure-en-python-et-javascript/feed/</wfw:commentRss>
		<slash:comments>15</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2012/05/tumblr_lzytbvh3Tg1qe1bhdo1_500.jpg" length="43436" type="image/jpg" />	</item>
	</channel>
</rss>
