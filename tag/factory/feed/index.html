<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Sam &#38; Max &#187; factory</title>
	<atom:link href="http://sametmax.com/tag/factory/feed/" rel="self" type="application/rss+xml" />
	<link>http://sametmax.com</link>
	<description>Du code, du cul</description>
	<lastBuildDate>Sat, 07 Nov 2015 10:56:13 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=4.1</generator>
	<item>
		<title>Service, factory et provider dans AngularJS 28</title>
		<link>http://sametmax.com/service-factory-et-provider-dans-angularjs/</link>
		<comments>http://sametmax.com/service-factory-et-provider-dans-angularjs/#comments</comments>
		<pubDate>Tue, 29 Apr 2014 09:07:41 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[angularjs]]></category>
		<category><![CDATA[factory]]></category>
		<category><![CDATA[javascript]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=10095</guid>
		<description><![CDATA[Tuto long et chiant sur un concept de base d'angularjs.]]></description>
				<content:encoded><![CDATA[<p>AngularJS est un framework difficile à prendre en main. Pas parce qu&#8217;il est particulièrement compliqué, mais parce que ses concepts sont vraiment différents de ceux qu&#8217;on a l&#8217;habitude de rencontrer dans les frameworks habituels. Le pire, c&#8217;est quand on vient de jQuery, car Angular est un peu l&#8217;anti-jQuery et il faut littéralement désapprendre ses habitudes.</p>
<p>Généralement, les gens s&#8217;en sortent avec les contrôleurs. Ils ne mettent pas le bon code dedans, ils ne savent pas comment rendre les bouts de code indépendants et réutilisables, mais ils arrivent à en faire quelque chose. Les directives, ils n&#8217;y touchent pas, mais ils peuvent s&#8217;en passer pendant un certain temps et juste réutiliser du code trouvé sur Github.</p>
<p>Par contre le côté service/factory/provider, ça c&#8217;est un gros problème. On ne peut pas faire sans, mais peu de gens savent faire avec. En codant <a href="http://allthatcounts.net">All that counts</a>, j&#8217;ai réalisé que c&#8217;était un bon tuto à faire. Donc en avant.</p>
<p>Article long = musique, évidement.</p>

<!-- iframe plugin v.2.9 wordpress.org/plugins/iframe/ -->
<iframe width="420" height="315" src="//www.youtube.com/embed/lMLnDuzgkjo" frameborder="0" scrolling="no" class="iframe-class"></iframe>

<p>On m&#8217;a très justement demandé les prérequis pour suivre cet article : il faut avoir fait des tutos de base sur Angular et notamment comprendre l&#8217;injection de dépendance et le data binding.</p>
<h2>Que font ces trucs là ?</h2>
<p>Techniquement, un service, une factory ou un provider, dans AngularJS, <strong>ça sert à la même chose</strong>. Un service est juste une manière plus facile d&#8217;écrire une factory, qui est juste une manière plus simple d&#8217;écrire un provider.</p>
<p><strong>Les 3 servent à créer un objet Javascript ordinaire, c&#8217;est tout.</strong></p>
<p>Oui, oui, c&#8217;est vraiment tout. C&#8217;est le seul et unique but de cela. Vous allez me dire, mais alors pourquoi se faire chier à les utiliser alors qu&#8217;on peut écrire un objet à la main ? Tout simplement parce qu&#8217;ils permettent d&#8217;encapsuler cette création, l&#8217;isoler du reste du code, un problème toujours difficile en Javascript.</p>
<p>Ils sont là pour éviter de pourrir le namespace global, tout en n&#8217;utilisant pas la technique bien connu de &#8220;je met un gros conteneur avec tout dedans et tout le monde y accède&#8221;, qu&#8217;on a tendance à voir dans la plupart des projets JS. Le code est ainsi plus maintenable et testable.</p>
<p>Chaque service/factory/provider permet d&#8217;avoir un groupe de fonctionnalités séparé du reste. On peut utiliser celui-ci facilement partout ailleurs en utilisant l&#8217;injection de dépendance. <strong>Si vous ne savez pas ce que c&#8217;est, arrêtez-vous tout de suite, c&#8217;est le principe de fonctionnement de base d&#8217;Angular, il faut quitter cet article et prendre un tuto pour débutant.</strong> Revenez ensuite.</p>
<p>Dans un service/factory/provider, on va donc mettre du code métier et/ou des données de l&#8217;app, mais groupés par thème.</p>
<p>Par exemple, sur une app video, on peut en faire un qui va contenir le code pour gérer le profile utilisateur et un pour gérer la playlist.</p>
<p>On aura donc deux services/factories/providers, qui vont créer au final deux objets. Chaque objet va contenir des méthodes et des données. Pour le profile, on peut imaginer qu&#8217;il va contenir le nom d&#8217;utilisateur, son ID, et une méthode de login et de logout :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #009900;">&#123;</span>
    <span style="color: #3366CC;">&quot;name&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;Hodor&quot;</span><span style="color: #339933;">,</span>
    <span style="color: #3366CC;">&quot;Id&quot;</span><span style="color: #339933;">:</span> <span style="color: #CC0000;">7898</span><span style="color: #339933;">,</span>
    <span style="color: #3366CC;">&quot;login&quot;</span><span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
        <span style="color: #006600; font-style: italic;">// faire un truc pour se loger</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span>
    <span style="color: #3366CC;">&quot;logout&quot;</span><span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
        <span style="color: #006600; font-style: italic;">// faire un truc pour se deco</span>
    <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span></pre></td></tr></table></div>

<p>Pour la playlist, on peut imaginer que ça va contenir la liste des videos, la video en cours de lecture et de quoi passer à la suivante et précédente :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #009900;">&#123;</span>
    <span style="color: #3366CC;">&quot;name&quot;</span> <span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;Super playlist&quot;</span>
    <span style="color: #3366CC;">&quot;videos&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span>
        <span style="color: #009900;">&#123;</span><span style="color: #3366CC;">&quot;title&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;video 1&quot;</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">&quot;url&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;http://...&quot;</span><span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span>
        <span style="color: #009900;">&#123;</span><span style="color: #3366CC;">&quot;title&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;video 2&quot;</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">&quot;url&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;http://...&quot;</span><span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
    <span style="color: #3366CC;">&quot;currentVideo&quot;</span><span style="color: #339933;">:</span> <span style="color: #CC0000;">1</span><span style="color: #339933;">,</span>
    <span style="color: #3366CC;">&quot;next&quot;</span><span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
        <span style="color: #006600; font-style: italic;">// passer à la vid suivante</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span>
    <span style="color: #3366CC;">&quot;previous&quot;</span><span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
        <span style="color: #006600; font-style: italic;">// passer à la vid précédente</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #009900;">&#125;</span></pre></td></tr></table></div>

<p>Et c&#8217;est tout. Ce n&#8217;est ni plus ni moins que ça, des objets normaux dans lesquels ont va mettre nos données et nos méthodes. <strong>Ce qui est &#8220;special&#8221;, c&#8217;est comment ils sont créés et utilisés.</strong> Et c&#8217;est ça qu&#8217;on va voir tout de suite.</p>
<h2>Créer un objet via un service/factory/provider</h2>
<p>Voyons le plus compliqué d&#8217;abord : le provider. Les deux autres ne sont que des raccourcis pour écrire un provider, de toute façon.</p>
<p>Le rôle du provider, c&#8217;est de créer et mettre à disposition un objet. C&#8217;est tout. Il n&#8217;y a rien de plus. Je répète, ça ne sert qu&#8217;à ça. &#8220;provider&#8221;, ça veut dire &#8220;fournisseur&#8221; en anglais. Et c&#8217;est ce que ça fait : ça fournit un objet. Supposons que vous avez déjà créé une app &#8220;monApp&#8221;. Écrire un provider pour créer l&#8217;objet &#8220;profile&#8221; ressemble à ça :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #006600; font-style: italic;">// On appelle notre objet qui sera créé &quot;profile&quot;. Ce qui signifie que l'on</span>
<span style="color: #006600; font-style: italic;">// pourra ensuite utiliser le nom &quot;profile&quot; pour annoncer quand</span>
<span style="color: #006600; font-style: italic;">// on souhaite utiliser l'objet issu de ce provider.</span>
monApp.<span style="color: #660066;">provider</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;profile&quot;</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
&nbsp;
    <span style="color: #006600; font-style: italic;">// Un provider, au final, c'est juste une fonction anonyme qu'on relie</span>
    <span style="color: #006600; font-style: italic;">// à un nom :)</span>
&nbsp;
    <span style="color: #006600; font-style: italic;">// Cette fonction DOIT avoir une méthode nommé &quot;$get&quot; attachée à son &quot;this&quot;</span>
    <span style="color: #000066; font-weight: bold;">this</span>.$get <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
&nbsp;
        <span style="color: #006600; font-style: italic;">// Et la méthode &quot;$get&quot; DOIT retourner l'objet qu'on veut créer.</span>
        <span style="color: #000066; font-weight: bold;">return</span> <span style="color: #009900;">&#123;</span>
            <span style="color: #3366CC;">&quot;name&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;Anonymous&quot;</span><span style="color: #339933;">,</span>
            <span style="color: #3366CC;">&quot;Id&quot;</span><span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">null</span><span style="color: #339933;">,</span>
            <span style="color: #3366CC;">&quot;login&quot;</span><span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
                <span style="color: #006600; font-style: italic;">// faire un truc pour se loger</span>
            <span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span>
            <span style="color: #3366CC;">&quot;logout&quot;</span><span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
                <span style="color: #006600; font-style: italic;">// faire un truc pour se deco</span>
            <span style="color: #009900;">&#125;</span>
        <span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr></table></div>

<p>C&#8217;est tout. Je vous jure que c&#8217;est tout. C&#8217;est juste une boîte qu&#8217;Angular va prendre, et appeler la méthode <code>$get</code> pour obtenir un objet. En plus, un seul objet, car la méthode ne sera appelée qu&#8217;une fois : l&#8217;objet sera un singleton.</p>
<p>Plus tard dans le code, quand vous ferez un controller :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;">mymonAppApp.<span style="color: #660066;">controller</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'UnControlleurCommeUnAutre'</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>$scope<span style="color: #339933;">,</span> profile<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    $scope.<span style="color: #660066;">profile</span> <span style="color: #339933;">=</span> profile<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr></table></div>

<p>Vous utiliserez <code>profile</code> en paramètre, il va donc être injecté automatiquement. C&#8217;est tout le principe d&#8217;angular, des tas de boîtes qui déclarent quelles autres boîtes elles utilisent via l&#8217;injection de dépendance.</p>
<p>Ici, l&#8217;objet va être créé (si ce n&#8217;est pas déjà fait ailleurs), et c&#8217;est tout. Le boulot d&#8217;un controller, c&#8217;est essentiellement de mettre des objets issus des providers dans le scope pour que le HTML puisse les utiliser. Je vous promet, c&#8217;est 90% des use cases.</p>
<p>Votre objet sera le conteneur que l&#8217;on va manipuler pour changer le nom du profile, se logger, etc. C&#8217;est juste une boîte qui rend un service. D&#8217;ailleurs on appelle souvent les objets issus des providers des &#8220;services&#8221;.</p>
<p>Utiliser des providers évite de créer tout une logique de classes, de gérer des namespaces, des instanciations : on est obligé de faire de l&#8217;encapsulation et de la composition. Ca rend le code (javascript) plus propre et plus testable, bien décomposé et découplé. <strong>Avoir un code propre est le but principal des providers, ils ne fournissent rien comme fonctionnalités qu&#8217;on ne puisse faire autrement</strong>.</p>
<p>Maintenant voyons ce qu&#8217;est une factory. En fait, c&#8217;est juste un raccourci pour écrire un provider :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;">monApp.<span style="color: #660066;">factory</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'profile'</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #000066; font-weight: bold;">return</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #3366CC;">&quot;name&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;Anonymous&quot;</span><span style="color: #339933;">,</span>
        <span style="color: #3366CC;">&quot;Id&quot;</span><span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">null</span><span style="color: #339933;">,</span>
        <span style="color: #3366CC;">&quot;login&quot;</span><span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
            <span style="color: #006600; font-style: italic;">// faire un truc pour se loger</span>
        <span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span>
        <span style="color: #3366CC;">&quot;logout&quot;</span><span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
            <span style="color: #006600; font-style: italic;">// faire un truc pour se deco</span>
        <span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr></table></div>

<p>Ça fait exactement la même chose, et on l&#8217;utilise exactement pareil. C&#8217;est juste plus court. Pas de méthode <code>$get</code> à écrire, on retourne l&#8217;objet cash pistache.</p>
<p>Pourquoi on utilise un provider alors ? Parce que c&#8217;est plus pratique à configurer, comme on le verra plus bas. Mais la factory est suffisante la plupart du temps. Ce qui est marrant, c&#8217;est qu&#8217;en terme informatique, un provider est un design pattern &#8220;factory&#8221;, ce qui m&#8217;a vachement rendu confus au début&#8230;</p>
<p>Et le service alors ? C&#8217;est une syntaxe alternative :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;">monApp.<span style="color: #660066;">service</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'profile'</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">name</span> <span style="color: #339933;">=</span> <span style="color: #3366CC;">&quot;Anonymous&quot;</span><span style="color: #339933;">;</span>
    <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">id</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">null</span><span style="color: #339933;">;</span>
    <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">login</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
        <span style="color: #006600; font-style: italic;">// faire un truc pour se loger</span>
    <span style="color: #009900;">&#125;</span>
    <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">logout</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
        <span style="color: #006600; font-style: italic;">// faire un truc pour se deco</span>
    <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr></table></div>

<p>La fonction va être utilisée directement (avec <code>new</code>) pour créer l&#8217;objet, donc pas besoin de <code>return</code> : on attache tout à <code>this</code>. Mais le résultat est strictement le même. Le choix entre une factory et un service est vraiment une question de goût. Personnellement je vous conseille d&#8217;utiliser des factories car ça vous évite le casse-tête de la portée de <code>this</code>, grande cause d&#8217;erreurs en JS.</p>
<h2>Dépendances et injections</h2>
<p>Souvenez-vous qu&#8217;on peut faire ça :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;">mymonAppApp.<span style="color: #660066;">controller</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'UnControlleurCommeUnAutre'</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>$scope<span style="color: #339933;">,</span> profile<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    $scope.<span style="color: #660066;">profile</span> <span style="color: #339933;">=</span> profile<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr></table></div>

<p>Pour dire &#8220;mon controller dépend de profile, donc s&#8217;il te plait Angular, crée l&#8217;objet et passe le moi&#8221;.</p>
<p>Et bien ça marche aussi entre les providers/factories/services. Par exemple, si je fais un provider pour ma playlist, mais que la playlist dépend du profile :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;">monApp.<span style="color: #660066;">provider</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;playlist&quot;</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
&nbsp;
    <span style="color: #006600; font-style: italic;">// En utilisant le nom de l'autre provider ici, je demande à ce qu'il</span>
    <span style="color: #006600; font-style: italic;">// soit injecté ici, et donc disponible ici. Je dis &quot;ce provider</span>
    <span style="color: #006600; font-style: italic;">// est dépendant de l'objet fournit par cet autre provider.&quot;</span>
    <span style="color: #000066; font-weight: bold;">this</span>.$get <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>profile<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
&nbsp;
        <span style="color: #000066; font-weight: bold;">return</span> <span style="color: #009900;">&#123;</span>
            <span style="color: #006600; font-style: italic;">// Et du coup je peux accéder aux attributs de l'objet.</span>
            <span style="color: #3366CC;">&quot;name&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;Playlist de &quot;</span> <span style="color: #339933;">+</span> profile.<span style="color: #660066;">name</span>
            <span style="color: #3366CC;">&quot;videos&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
            <span style="color: #3366CC;">&quot;currentVideo&quot;</span><span style="color: #339933;">:</span> <span style="color: #CC0000;">1</span><span style="color: #339933;">,</span>
            <span style="color: #3366CC;">&quot;next&quot;</span><span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
                <span style="color: #006600; font-style: italic;">// passer à la vid suivante</span>
            <span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span>
            <span style="color: #3366CC;">&quot;previous&quot;</span><span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
                <span style="color: #006600; font-style: italic;">// passer à la vid précédente</span>
            <span style="color: #009900;">&#125;</span>
        <span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr></table></div>

<p>Si je le faisais avec une factory, se serait pareil, mais en plus simple :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #006600; font-style: italic;">// l'injection de dépendance se fait au niveau de la fonction anonyme</span>
<span style="color: #006600; font-style: italic;">// car il n'y a pas de méthode &quot;$get&quot;</span>
monApp.<span style="color: #660066;">factory</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;playlist&quot;</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>profile<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    <span style="color: #000066; font-weight: bold;">return</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #3366CC;">&quot;name&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;Playlist de &quot;</span> <span style="color: #339933;">+</span> profile.<span style="color: #660066;">name</span>
        <span style="color: #3366CC;">&quot;videos&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
        <span style="color: #3366CC;">&quot;currentVideo&quot;</span><span style="color: #339933;">:</span> <span style="color: #CC0000;">1</span><span style="color: #339933;">,</span>
        <span style="color: #3366CC;">&quot;next&quot;</span><span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
            <span style="color: #006600; font-style: italic;">// passer à la vid suivante</span>
        <span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span>
        <span style="color: #3366CC;">&quot;previous&quot;</span><span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
            <span style="color: #006600; font-style: italic;">// passer à la vid précédente</span>
        <span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr></table></div>

<h2>L&#8217;interêt des providers</h2>
<p>L&#8217;interêt principal d&#8217;utiliser un provider plutôt qu&#8217;une factory, c&#8217;est qu&#8217;on peut le rendre configurable.</p>
<p>Par exemple, je veux que ma playlist ne soit jamais vide, alors si elle l&#8217;en, on met deux vidéos par défaut dedans :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;">monApp.<span style="color: #660066;">factory</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;playlist&quot;</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>profile<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
&nbsp;
    <span style="color: #006600; font-style: italic;">// je ne retourne pas l'objet tout de suite, je vais le modifier</span>
    <span style="color: #000066; font-weight: bold;">var</span> playlist <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #3366CC;">&quot;name&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;Playlist de &quot;</span> <span style="color: #339933;">+</span> profile.<span style="color: #660066;">name</span>
        <span style="color: #3366CC;">&quot;videos&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
        <span style="color: #3366CC;">&quot;currentVideo&quot;</span><span style="color: #339933;">:</span> <span style="color: #CC0000;">1</span><span style="color: #339933;">,</span>
        <span style="color: #3366CC;">&quot;next&quot;</span><span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
            <span style="color: #006600; font-style: italic;">// passer à la vid suivante</span>
        <span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span>
        <span style="color: #3366CC;">&quot;previous&quot;</span><span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
            <span style="color: #006600; font-style: italic;">// passer à la vid précédente</span>
        <span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
&nbsp;
    <span style="color: #006600; font-style: italic;">// hop, je m'assure que la playlist n'est jamais vide en modifiant</span>
    <span style="color: #006600; font-style: italic;">// l'objet</span>
    <span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>playlist.<span style="color: #660066;">videos</span>.<span style="color: #660066;">length</span> <span style="color: #339933;">===</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
        playlist.<span style="color: #660066;">videos</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#91;</span>
            <span style="color: #009900;">&#123;</span><span style="color: #3366CC;">&quot;title&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;video 1&quot;</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">&quot;url&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;http://...&quot;</span><span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span>
            <span style="color: #009900;">&#123;</span><span style="color: #3366CC;">&quot;title&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;video 2&quot;</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">&quot;url&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;http://...&quot;</span><span style="color: #009900;">&#125;</span>
        <span style="color: #009900;">&#93;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #006600; font-style: italic;">// ne pas oublier de retourner l'objet à la fin quand même :)</span>
    <span style="color: #000066; font-weight: bold;">return</span> playlist<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr></table></div>

<p>Tout ça sera largement suffisant dans la plupart des cas. Mais dans le rare cas où je veux faire une lib réutilisable, je veux que ces vidéos par défaut soient configurables. Comment alors permettre que l&#8217;utilisateur de ma lib les choisisse ?</p>
<p>En utilisant un provider :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;">monApp.<span style="color: #660066;">provider</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;playlist&quot;</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
&nbsp;
    <span style="color: #006600; font-style: italic;">// On déclare des données attachée sur le provider. PAS sur l'objet que</span>
    <span style="color: #006600; font-style: italic;">// le provider va créer, attention. Sur le provider lui-même.</span>
    <span style="color: #006600; font-style: italic;">// Le provider, je le rappelle, c'est cette fonction anonyme qui retourne</span>
    <span style="color: #006600; font-style: italic;">// un objet via sa méthode &quot;$get&quot; (oui, les fonctions sont des objets</span>
    <span style="color: #006600; font-style: italic;">// en JS, et peuvent avoir des méthodes. Ce langage est très clair.)</span>
    <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">defaultVideos</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#91;</span>
            <span style="color: #009900;">&#123;</span><span style="color: #3366CC;">&quot;title&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;video 1&quot;</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">&quot;url&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;http://...&quot;</span><span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span>
            <span style="color: #009900;">&#123;</span><span style="color: #3366CC;">&quot;title&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;video 2&quot;</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">&quot;url&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;http://...&quot;</span><span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#93;</span>
&nbsp;
    <span style="color: #006600; font-style: italic;">// ensuite je fais ma méthode &quot;$get&quot; qui va retourner l'objet voulu,</span>
    <span style="color: #006600; font-style: italic;">// comme d'hab</span>
    <span style="color: #000066; font-weight: bold;">this</span>.$get <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>profile<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
&nbsp;
        <span style="color: #000066; font-weight: bold;">var</span> playlist <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span>
            <span style="color: #3366CC;">&quot;name&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;Playlist de &quot;</span> <span style="color: #339933;">+</span> profile.<span style="color: #660066;">name</span>
            <span style="color: #3366CC;">&quot;videos&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
            <span style="color: #3366CC;">&quot;currentVideo&quot;</span><span style="color: #339933;">:</span> <span style="color: #CC0000;">1</span><span style="color: #339933;">,</span>
            <span style="color: #3366CC;">&quot;next&quot;</span><span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
                <span style="color: #006600; font-style: italic;">// passer à la vid suivante</span>
            <span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span>
            <span style="color: #3366CC;">&quot;previous&quot;</span><span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
                <span style="color: #006600; font-style: italic;">// passer à la vid précédente</span>
            <span style="color: #009900;">&#125;</span>
        <span style="color: #009900;">&#125;</span>
&nbsp;
        <span style="color: #006600; font-style: italic;">// Au moment de la création de l'objet, j'utilise les données</span>
        <span style="color: #006600; font-style: italic;">// attachées au provider pour fournir la valeur par défaut.</span>
        <span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>playlist.<span style="color: #660066;">videos</span>.<span style="color: #660066;">length</span> <span style="color: #339933;">===</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
            playlist.<span style="color: #660066;">videos</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">this</span>.<span style="color: #660066;">defaultVideos</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
&nbsp;
        <span style="color: #000066; font-weight: bold;">return</span> playlist<span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr></table></div>

<p>Jusqu&#8217;ici, vous allez me dire, mais quelle est la différence avec le précédent ? Et bien il se trouve qu&#8217;Angular met à votre disposition automatiquement <code>playlist</code>, <strong>mais également <code>playlistProvider</code></strong>, une référence sur le provider qui va créer l&#8217;objet <code>playlist</code>.</p>
<p>ATTENTION : quand vous déclarez ici &#8220;playlist&#8221;, &#8220;playlist&#8221; est le nom de l&#8217;objet créé par le provider. Angular, lui, va automagiquement attacher le nom &#8220;playlistProvider&#8221; au provider qui a créé l&#8217;objet. Vous n&#8217;avez rien à faire pour cela, il va automatiquement s&#8217;appeler &#8220;nomDeVotreObjetProvider&#8221; et sera mis à votre disposition.</p>
<p>Du coup :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #006600; font-style: italic;">// On peut utiliser &quot;config&quot; pour lancer du code avant la création des objets</span>
<span style="color: #006600; font-style: italic;">// par les providers. Tout le code dans des blocs &quot;config&quot; est toujours lancé en premier,</span>
<span style="color: #006600; font-style: italic;">// avant tous les providers/factories/services de cette app.</span>
monApp.<span style="color: #660066;">config</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>playlistProvider<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    <span style="color: #006600; font-style: italic;">// ici l'utilisateur de votre lib a accès au provider avant la création de</span>
    <span style="color: #006600; font-style: italic;">// l'objet, et à donc le loisir de changer les valeurs par défaut</span>
    playlistProvider.<span style="color: #660066;">defaultVideos</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#91;</span>
            <span style="color: #009900;">&#123;</span><span style="color: #3366CC;">&quot;title&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;Autre video&quot;</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">&quot;url&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;http://...&quot;</span><span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span>
    <span style="color: #009900;">&#93;</span>
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr></table></div>

<p>Ce n&#8217;est pas un cas courant, et la plupart du temps, utiliser une factory marchera très bien.</p>
<h2>Et tout ça, je m&#8217;en sers pour quoi ?</h2>
<p>On met dans les providers/services/factories, tout le code qui n&#8217;est pas lié à la navigation ou à la manipulation de DOM. Bref, tout le code de la logique de votre app. Le code qui n&#8217;est pas lié au Web. Un profile n&#8217;a rien à avoir avec le Web. Une playlist n&#8217;a rien à voir avec le Web. Mais il faut un code pour les gérer, et des variables vont devoir êtres mises quelque part.</p>
<p>Généralement, ces providers/services/factories sont utilisés :</p>
<ul>
<li>Par un controller.</li>
<li>Par une directive.</li>
<li>Par d&#8217;autres providers/services/factories.</li>
</ul>
<p>Mais aussi, directement dans le HTML.</p>
<p>En effet, quand vous allez faire ça :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #006600; font-style: italic;">// le boulot du controller, c'est essentiellement d'attacher les bons</span>
<span style="color: #006600; font-style: italic;">// services au scope, je vous dis !</span>
mymonAppApp.<span style="color: #660066;">controller</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'VideoCtrl'</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>$scope<span style="color: #339933;">,</span> playlist<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    $scope.<span style="color: #660066;">playlist</span> <span style="color: #339933;">=</span> playlist<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr></table></div>

<p>Vous allez ensuite pouvoir déclarer votre controller dans votre HTML. Dans un<br />
bloc de HTML couvert par un controller, vous avez accès à toutes les attributs<br />
du scope, donc à votre service &#8220;playlist&#8221;. Et du coup, paf, à tout son code :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="html" style="font-family:monospace;">&lt;div ng-controller=&quot;VideoCtrl&quot;&gt;
    ...
    &lt;p&gt;Playlist :&lt;/p&gt;
    &lt;ul&gt;
       &lt;li ng-repeat=&quot;vid for playlist.videos&quot;&gt;{{ vid.title }}&lt;/li&gt;
    &lt;/ul&gt;
    &lt;p&gt;
    &lt;button ng-click=&quot;playlist.next()&quot;&gt;Next&lt;/button&gt;
    &lt;/p&gt;
&lt;/div&gt;</pre></td></tr></table></div>

<p>Et c&#8217;est ça la beauté d&#8217;Angular : tout est bien séparé, et bien rangé. Votre code métier dans les providers, votre code d&#8217;interface dans le HTML, votre liaison entre le HTML et les providers à travers les controllers&#8230; Enfin du code JS qui ne ressemble pas à des spaghetti trop cuites par un enfant de 6 ans scatoman.</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/service-factory-et-provider-dans-angularjs/feed/</wfw:commentRss>
		<slash:comments>28</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2014/04/o3eChX7.jpg" length="69390" type="image/jpg" />	</item>
	</channel>
</rss>
