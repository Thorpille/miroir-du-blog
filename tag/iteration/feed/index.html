<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Sam &#38; Max &#187; iteration</title>
	<atom:link href="http://sametmax.com/tag/iteration/feed/" rel="self" type="application/rss+xml" />
	<link>http://sametmax.com</link>
	<description>Du code, du cul</description>
	<lastBuildDate>Sat, 07 Nov 2015 10:56:13 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=4.1</generator>
	<item>
		<title>itertools.product fait sauter des boucles imbriquées 13 &#160; Recently updated !</title>
		<link>http://sametmax.com/itertools-product-fait-sauter-des-boucles-imbriquees/</link>
		<comments>http://sametmax.com/itertools-product-fait-sauter-des-boucles-imbriquees/#comments</comments>
		<pubDate>Tue, 03 Nov 2015 06:52:45 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[iterable]]></category>
		<category><![CDATA[iteration]]></category>
		<category><![CDATA[itertools]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=16986</guid>
		<description><![CDATA[Je connais <code>product()</code> depuis bel lurette, et je n'avais jamais réalisé son utilité. Des fois on a le truc sous les yeux, comme ça, et on voit rien.
]]></description>
				<content:encoded><![CDATA[<p>Je connais <code>product()</code> depuis bel lurette, et je n&#8217;avais jamais réalisé son utilité. Des fois on a le truc sous les yeux, comme ça, et on voit rien.</p>
<p>Vous savez, on veut parfois parcourir tous les trucs, et leur appliquer tous les machins. Ca donne une boucle imbriquée :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">res <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span><span style="color: black;">&#93;</span>
<span style="color: #ff7700;font-weight:bold;">for</span> truc <span style="color: #ff7700;font-weight:bold;">in</span> trucs:
    <span style="color: #ff7700;font-weight:bold;">for</span> machin <span style="color: #ff7700;font-weight:bold;">in</span> machins:
        res.<span style="color: black;">append</span><span style="color: black;">&#40;</span>bidule<span style="color: black;">&#40;</span>machin<span style="color: #66cc66;">,</span> truc<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>Un code parfaitement légitime, clair, lisible. Mais l&#8217;envie de faire une liste en intension est si forte !</p>
<p>C&#8217;est là que <code>product()</code> intervient, avec ses petits bras musclés :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">itertools</span> <span style="color: #ff7700;font-weight:bold;">import</span> product
res  <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span> bidule<span style="color: black;">&#40;</span>machin<span style="color: #66cc66;">,</span> truc<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">for</span> truc<span style="color: #66cc66;">,</span> machin <span style="color: #ff7700;font-weight:bold;">in</span> product<span style="color: black;">&#40;</span>trucs<span style="color: #66cc66;">,</span> machins<span style="color: black;">&#41;</span><span style="color: black;">&#93;</span></pre></td></tr></table></div>

<p>Python va magiquement créer autant de tuples <code>(machin, truc)</code> qu&#8217;il y en a besoin.</p>
<p>Et parce que ça fait un mois que j&#8217;ai pas mis d&#8217;article, faut prendre tout de suite les bonnes habitudes : </p>
<div id="attachment_16988" style="width: 510px" class="wp-caption aligncenter"><a href="http://sametmax.com/wp-content/uploads/2015/11/tumblr_nx598dMRu71r539hzo1_500.jpg" class="grouped_elements" rel="tc-fancybox-group16986"><img src="http://sametmax.com/wp-content/uploads/2015/11/tumblr_nx598dMRu71r539hzo1_500.jpg" alt="Hommes nus assis sur un homme nus" width="500" height="397" class="size-full wp-image-16988" /></a><p class="wp-caption-text">for but in buts</p></div>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/itertools-product-fait-sauter-des-boucles-imbriquees/feed/</wfw:commentRss>
		<slash:comments>13</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2015/11/tumblr_nwwba5teaD1r539hzo1_500.jpg" length="46188" type="image/jpg" />	</item>
		<item>
		<title>Une boucle while de moins 5</title>
		<link>http://sametmax.com/une-boucle-while-de-moins/</link>
		<comments>http://sametmax.com/une-boucle-while-de-moins/#comments</comments>
		<pubDate>Tue, 23 Jun 2015 10:04:55 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[for]]></category>
		<category><![CDATA[iter]]></category>
		<category><![CDATA[iterable]]></category>
		<category><![CDATA[iteration]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[while]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=16427</guid>
		<description><![CDATA[Si vous devez retenir un truc de la partie Python de ce blog, c'est qu'en Python, l'itération est tout.]]></description>
				<content:encoded><![CDATA[<p>Si vous devez retenir un truc de la partie Python de ce blog, c&#8217;est qu&#8217;en Python, l&#8217;itération est tout.</p>
<p>Du coup, on utilise pas beaucoup <code>while</code>, à part dans quelques cas particuliers.</p>
<p>Le cas d&#8217;école, c&#8217;est la lecture d&#8217;un fichier octet par octet.</p>
<p>Imaginez, vous créez un petit array de float écrits en 64 bits :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">import</span> numpy <span style="color: #ff7700;font-weight:bold;">as</span> np
<span style="color: #66cc66;">&gt;&gt;&gt;</span> a <span style="color: #66cc66;">=</span> np.<span style="color: black;">sin</span><span style="color: black;">&#40;</span>np.<span style="color: black;">linspace</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">2.0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">3.0</span><span style="color: #66cc66;">,</span> num<span style="color: #66cc66;">=</span><span style="color: #ff4500;">100</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> a.<span style="color: black;">dtype</span>
dtype<span style="color: black;">&#40;</span><span style="color: #483d8b;">'float64'</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>Vous sauvegardez tout ça dans un fichier :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> a.<span style="color: black;">tofile</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'/tmp/data'</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>Si vous voulez lire le fichier <strong>hors de numpy</strong>, il faut le charger float par float, donc le lire 64 bits par 64 bits soit par groupes de 8 octets.</p>
<p>La méthode canonique :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">with</span> <span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'/tmp/data'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'rb'</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> f:
    <span style="color: #ff7700;font-weight:bold;">while</span> <span style="color: #008000;">True</span>:
        nombre <span style="color: #66cc66;">=</span> f.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">8</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> nombre:
            <span style="color: #ff7700;font-weight:bold;">break</span>
        <span style="color: #808080; font-style: italic;"># faire un truc avec le nombre</span></pre></td></tr></table></div>

<p>Mais il existe une autre manière de faire cela, moins connue : utiliser <code>iter()</code>.</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">with</span> <span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'/tmp/data'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'rb'</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> f:
    <span style="color: #ff7700;font-weight:bold;">for</span> nombre <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">iter</span><span style="color: black;">&#40;</span><span style="color: #ff7700;font-weight:bold;">lambda</span>: f.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">8</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> b<span style="color: #483d8b;">''</span><span style="color: black;">&#41;</span>:
        <span style="color: #808080; font-style: italic;"># faire un truc avec nombre</span></pre></td></tr></table></div>

<p>Cela marche car <code>iter()</code>, parmi ses nombreuses fonctionnalités, accepte un <a href="http://sametmax.com/les-trucmuchables-en-python/">callable</a> en paramètre (ici notre <a href="http://sametmax.com/fonctions-anonymes-en-python-ou-lambda/">lambda</a>), et va l&#8217;appeler jusqu&#8217;à ce que celui-ci retourne une valeur dite &#8220;sentinelle&#8221; (ici notre second paramètre).</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/une-boucle-while-de-moins/feed/</wfw:commentRss>
		<slash:comments>5</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2015/06/GgghUeo.jpg" length="232071" type="image/jpg" />	</item>
		<item>
		<title>Les exceptions sont itérables 6</title>
		<link>http://sametmax.com/les-exceptions-sont-iterables/</link>
		<comments>http://sametmax.com/les-exceptions-sont-iterables/#comments</comments>
		<pubDate>Sun, 02 Mar 2014 23:49:55 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[exception]]></category>
		<category><![CDATA[iteration]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=9656</guid>
		<description><![CDATA[Ok, c'est une bizarrerie, mais je tenais à la partager car ça m'a bien niqué : une exception est itérable en Python]]></description>
				<content:encoded><![CDATA[<p>Ok, c&#8217;est une bizarrerie, mais je tenais à la partager car ça m&#8217;a bien niqué : une exception est itérable en Python</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">Exception</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'Doh !'</span><span style="color: black;">&#41;</span>:
...     <span style="color: #ff7700;font-weight:bold;">print</span> x
...
<span style="color: black;">Doh</span> <span style="color: #66cc66;">!</span></pre></td></tr></table></div>

<p>Pourquoi ? J&#8217;en ai aucune idée. Mais j&#8217;ai voulu faire un algo récursif sur des structures imbriquées contenant des exceptions. Et ça buggait. Parce que ça parcourait aussi les exceptions.</p>
<p>Le piège vicieux dans lequel peu de gens risquent de tomber vu qu&#8217;on programme pas ça tous les jours. Mais tout de même, une étrangetée de Python. Peut être un héritage de l&#8217;époque où on pouvait faire un <code>raise</code> sur une string.</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/les-exceptions-sont-iterables/feed/</wfw:commentRss>
		<slash:comments>6</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2014/03/tumblr_n1t6dwlUwv1r539hzo1_500.jpg" length="42536" type="image/jpg" />	</item>
		<item>
		<title>Parcourir un itérable par morceaux en Python 19</title>
		<link>http://sametmax.com/parcourir-un-iterable-par-morceaux-en-python/</link>
		<comments>http://sametmax.com/parcourir-un-iterable-par-morceaux-en-python/#comments</comments>
		<pubDate>Wed, 30 May 2012 17:09:24 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[iteration]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=809</guid>
		<description><![CDATA[Voici une solution d'une rare élégance, car elle tient en quelques lignes, et assure une gigantesque flexibilité, sans manger beaucoup de mémoire vive.]]></description>
				<content:encoded><![CDATA[<aside style="text-align:center; font-size:60%"><em>Cet article a été mis à jour et contient maintenant du code Python en version 3</em></aside>
<p>Parcourir un itérable par morceaux signifie qu’on le traite petit bout par petit bout. On parle aussi de fenêtre glissante.</p>
<p>Par exemple, on a une liste, et on veut traiter les éléments par lot de 3 :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: black;">&#91;</span><span style="color: #483d8b;">&quot;a&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;b&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;c&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;d&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;e&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;f&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;g&quot;</span><span style="color: black;">&#93;</span>
<span style="color: black;">&#91;</span><span style="color: #483d8b;">&quot;a&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;b&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;c&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;d&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;e&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;f&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;g&quot;</span><span style="color: black;">&#93;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;a&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;b&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;c&quot;</span><span style="color: black;">&#41;</span>
<span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;a&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;b&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;c&quot;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;d&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;e&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;f&quot;</span><span style="color: black;">&#41;</span>
<span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;d&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;e&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;f&quot;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;g&quot;</span><span style="color: #66cc66;">,</span><span style="color: black;">&#41;</span>
<span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;g&quot;</span><span style="color: #66cc66;">,</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span></pre></td></tr></table></div>

<h2>Pour les gens pressés</h2>
<p>Il n’y a pas de fonction dans la bibliothèque standard de Python qui permette de le faire, mais on peut créer une très jolie solution à base de générateurs :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">itertools</span> <span style="color: #ff7700;font-weight:bold;">import</span> chain<span style="color: #66cc66;">,</span> islice
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> morceaux<span style="color: black;">&#40;</span>iterable<span style="color: #66cc66;">,</span> taille<span style="color: #66cc66;">,</span> format<span style="color: #66cc66;">=</span><span style="color: #008000;">tuple</span><span style="color: black;">&#41;</span>:
    it <span style="color: #66cc66;">=</span> <span style="color: #008000;">iter</span><span style="color: black;">&#40;</span>iterable<span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">while</span> <span style="color: #008000;">True</span>:
        <span style="color: #ff7700;font-weight:bold;">yield</span> format<span style="color: black;">&#40;</span>chain<span style="color: black;">&#40;</span><span style="color: black;">&#40;</span>next<span style="color: black;">&#40;</span>it<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> islice<span style="color: black;">&#40;</span>it<span style="color: #66cc66;">,</span> taille - <span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>Et on l’utilise ainsi :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> l <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span><span style="color: #483d8b;">&quot;a&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;b&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;c&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;d&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;e&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;f&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;g&quot;</span><span style="color: black;">&#93;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">for</span> morceau <span style="color: #ff7700;font-weight:bold;">in</span> morceaux<span style="color: black;">&#40;</span>l<span style="color: #66cc66;">,</span> <span style="color: #ff4500;">3</span><span style="color: black;">&#41;</span>:
...         <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>morceau<span style="color: black;">&#41;</span>
...
<span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;a&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;b&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;c&quot;</span><span style="color: black;">&#41;</span>
<span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;d&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;e&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;f&quot;</span><span style="color: black;">&#41;</span>
<span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;g&quot;</span><span style="color: #66cc66;">,</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<h2>Usage avancé</h2>
<p>Grâce au troisième paramètre, on peut récupérer une sortie sous un format différent, par exemple une chaine de caractères :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">for</span> morceau <span style="color: #ff7700;font-weight:bold;">in</span> morceaux<span style="color: black;">&#40;</span>l<span style="color: #66cc66;">,</span> <span style="color: #ff4500;">3</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">''</span>.<span style="color: black;">join</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>morceau<span style="color: black;">&#41;</span>
...
<span style="color: black;">abc</span>
<span style="color: #ff7700;font-weight:bold;">def</span>
g</pre></td></tr></table></div>

<p>Le résultat retourné par <code> morceaux()</code> est un générateur :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> morceaux<span style="color: black;">&#40;</span>l<span style="color: #66cc66;">,</span> <span style="color: #ff4500;">3</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&lt;</span>generator <span style="color: #008000;">object</span> morceaux at <span style="color: #ff4500;">0x9e31414</span><span style="color: #66cc66;">&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">list</span><span style="color: black;">&#40;</span>morceaux<span style="color: black;">&#40;</span>l<span style="color: #66cc66;">,</span> <span style="color: #ff4500;">3</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: black;">&#91;</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'a'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'b'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'c'</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">'d'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'e'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'f'</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">'g'</span><span style="color: #66cc66;">,</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span></pre></td></tr></table></div>

<p>Et la fonction accepte n’importe quel itérable en paramètre, pas uniquement des listes. Par exemple une chaine de caractères :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">list</span><span style="color: black;">&#40;</span>morceaux<span style="color: black;">&#40;</span><span style="color: #483d8b;">'123456789'</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">3</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">tuple</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: black;">&#91;</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'1'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'2'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'3'</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">'4'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'5'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'6'</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">'7'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'8'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'9'</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span></pre></td></tr></table></div>

<p>Ou un fichier :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> f <span style="color: #66cc66;">=</span> <span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'/tmp/test'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'w'</span><span style="color: #66cc66;">,</span> encoding<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'ascii'</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> f.<span style="color: black;">write</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'1<span style="color: #000099; font-weight: bold;">\n</span>2<span style="color: #000099; font-weight: bold;">\n</span>3<span style="color: #000099; font-weight: bold;">\n</span>4<span style="color: #000099; font-weight: bold;">\n</span>5<span style="color: #000099; font-weight: bold;">\n</span>6<span style="color: #000099; font-weight: bold;">\n</span>7<span style="color: #000099; font-weight: bold;">\n</span>8<span style="color: #000099; font-weight: bold;">\n</span>9<span style="color: #000099; font-weight: bold;">\n</span>10'</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> f.<span style="color: black;">close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">list</span><span style="color: black;">&#40;</span>morceaux<span style="color: black;">&#40;</span><span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'/tmp/test'</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">3</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: black;">&#91;</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'1<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'2<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'3<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">'4<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'5<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'6<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">'7<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'8<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'9<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">'10'</span><span style="color: #66cc66;">,</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span></pre></td></tr></table></div>

<h2>Comment ça marche ?</h2>
<p>Cette fonction est un concentré d’astuces propres à Python : module <code>itertools</code>, mot-clé <a href="http://sametmax.com/comment-utiliser-yield-et-les-generateurs-en-python/">yield</a>, iterable, passage de fonction en paramètre&#8230;</p>
<p>D’abord, on utilise la fonction built-in <code>iter()</code> :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">it <span style="color: #66cc66;">=</span> <span style="color: #008000;">iter</span><span style="color: black;">&#40;</span>iterable<span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>Sur l’itérable passé en paramètre. Elle retourne un itérateur, c’est à dire un objet qui peut être passé à la fonction <code>next()</code>. <code>next()</code> permet d’accéder à la prochaine valeur de l’itérable jusqu’à épuisement de ce dernier :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> l <span style="color: #66cc66;">=</span> <span style="color: black;">&#40;</span><span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">2</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">3</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">4</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">5</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> iterateur <span style="color: #66cc66;">=</span> <span style="color: #008000;">iter</span><span style="color: black;">&#40;</span>l<span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> next<span style="color: black;">&#40;</span>iterateur<span style="color: black;">&#41;</span>
<span style="color: #ff4500;">1</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> next<span style="color: black;">&#40;</span>iterateur<span style="color: black;">&#41;</span>
<span style="color: #ff4500;">2</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> next<span style="color: black;">&#40;</span>iterateur<span style="color: black;">&#41;</span>
<span style="color: #ff4500;">3</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> next<span style="color: black;">&#40;</span>iterateur<span style="color: black;">&#41;</span>
<span style="color: #ff4500;">4</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> next<span style="color: black;">&#40;</span>iterateur<span style="color: black;">&#41;</span>
<span style="color: #ff4500;">5</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> next<span style="color: black;">&#40;</span>iterateur<span style="color: black;">&#41;</span>
Traceback <span style="color: black;">&#40;</span>most recent call last<span style="color: black;">&#41;</span>:
  File <span style="color: #483d8b;">&quot;&lt;ipython-input-64-56409f08fc48&gt;&quot;</span><span style="color: #66cc66;">,</span> line <span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #66cc66;">&lt;</span>module<span style="color: #66cc66;">&gt;</span>
    next<span style="color: black;">&#40;</span>iterateur<span style="color: black;">&#41;</span>
<span style="color: #008000;">StopIteration</span></pre></td></tr></table></div>

<p>On crée ensuite une boucle infinie :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">while</span> <span style="color: #008000;">True</span>:</pre></td></tr></table></div>

<p>Cela permet de ne pas se soucier de la taille de l’itérable. Quand un itérateur arrive au bout d’un itérable, il lève l’exception <code>StopIteration</code> (c’est le mécanisme standard par lequel les boucles <code>for</code> itèrent, ce qui prouve une fois de plus que les exceptions s’utilisent partout en Python, et non juste dans la gestion des erreurs). Cette exception cassera la boucle infinie au moment opportun.</p>
<p>Ensuite on utilise deux fonctions du module <code>itertools</code> (un module spécialisé dans la manipulation des itérables) :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">chain<span style="color: black;">&#40;</span><span style="color: black;">&#40;</span>next<span style="color: black;">&#40;</span>it<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> islice<span style="color: black;">&#40;</span>it<span style="color: #66cc66;">,</span> taille - <span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p><code>chain()</code> prend deux itérables et retourne un générateur qui permet d’itérer sur l’un puis l’autre. Par exemple :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> l1 <span style="color: #66cc66;">=</span> <span style="color: black;">&#40;</span><span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">2</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">3</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> l2 <span style="color: #66cc66;">=</span> <span style="color: black;">&#40;</span><span style="color: #ff4500;">4</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">5</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">6</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> chain<span style="color: black;">&#40;</span>l1<span style="color: #66cc66;">,</span> l2<span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&lt;</span><span style="color: #dc143c;">itertools</span>.<span style="color: black;">chain</span> <span style="color: #008000;">object</span> at <span style="color: #ff4500;">0x9e7c72c</span><span style="color: #66cc66;">&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">list</span><span style="color: black;">&#40;</span>chain<span style="color: black;">&#40;</span>l1<span style="color: #66cc66;">,</span> l2<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">2</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">3</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">4</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">5</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">6</span><span style="color: black;">&#93;</span></pre></td></tr></table></div>

<p><code>islice()</code> est comme la syntaxe <code>[:]</code>, mais applicable à un itérable dont on ne connait pas la taille :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> l3 <span style="color: #66cc66;">=</span> <span style="color: black;">&#40;</span><span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">2</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">3</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">4</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">5</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">6</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> islice<span style="color: black;">&#40;</span>l3<span style="color: #66cc66;">,</span> <span style="color: #ff4500;">2</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&lt;</span><span style="color: #dc143c;">itertools</span>.<span style="color: black;">islice</span> <span style="color: #008000;">object</span> at <span style="color: #ff4500;">0x9e822ac</span><span style="color: #66cc66;">&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">list</span><span style="color: black;">&#40;</span>islice<span style="color: black;">&#40;</span>l3<span style="color: #66cc66;">,</span> <span style="color: #ff4500;">2</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">2</span><span style="color: black;">&#93;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">list</span><span style="color: black;">&#40;</span>islice<span style="color: black;">&#40;</span>l3<span style="color: #66cc66;">,</span> <span style="color: #ff4500;">2</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">4</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: black;">&#91;</span><span style="color: #ff4500;">3</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">4</span><span style="color: black;">&#93;</span></pre></td></tr></table></div>

<p><code>chain((next(it),), islice(it, taille - 1))</code> signifie donc &#8220;<q>chainer un tuple qui contient la valeur suivante de l’itérable avec un autre itérable qui lui récupèrera la slice du reste du morceau extrait de l’itérable</q>&#8220;.</p>
<p>Ouf.</p>
<p>Puis on applique :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">format<span style="color: black;">&#40;</span>...<span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>Sur le résultat. Ce qui permet de choisir dans quel format on souhaite avoir les morceaux (chaine, tuple, etc). Le comportement par défaut est de retourner des tuples.</p>
<p>Et enfin on utilise <a href="http://sametmax.com/comment-utiliser-yield-et-les-generateurs-en-python/">yield</a> :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">yield</span> format<span style="color: black;">&#40;</span>...<span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>Cela assure que <code>morceaux()</code> retourne un générateur qui créera chaque morceau à la volée, et non tout d’un coup en mémoire. Très utile si vous avez une grande liste :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> une_grande_liste <span style="color: #66cc66;">=</span> <span style="color: #008000;">range</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">100000000</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> par_morceaux <span style="color: #66cc66;">=</span> morceaux<span style="color: black;">&#40;</span>une_grande_liste<span style="color: #66cc66;">,</span> <span style="color: #ff4500;">3</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> next<span style="color: black;">&#40;</span>par_morceaux<span style="color: black;">&#41;</span>
<span style="color: black;">&#40;</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">2</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> next<span style="color: black;">&#40;</span>par_morceaux<span style="color: black;">&#41;</span>
<span style="color: black;">&#40;</span><span style="color: #ff4500;">3</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">4</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">5</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> next<span style="color: black;">&#40;</span>par_morceaux<span style="color: black;">&#41;</span>
<span style="color: black;">&#40;</span><span style="color: #ff4500;">6</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">7</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">8</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> next<span style="color: black;">&#40;</span>par_morceaux<span style="color: black;">&#41;</span>
<span style="color: black;">&#40;</span><span style="color: #ff4500;">9</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">10</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">11</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>Malgré la taille de la liste, le résultat est presque instantané. Ce n’est pas parce que votre ordinateur est une bête de course. C’est parce que <code>(3, 4, 5)</code> n’est pas généré juste après <code>(0, 1, 2)</code>. Il est généré au second appel de <code>next()</code>, à la volée.</p>
<h2>Mais pourquoi faire si compliqué ?</h2>
<p>Les bénéfices de cette approche sont :</p>
<ul>
<li>La possibilité de parcourir par morceaux n’importe quel itérable : des chaines, des tuples, des listes, des dictionnaires, des querysets Django, des fichiers, etc.</li>
<li>La fonction accepte un itérable de n’importe quelle taille. En fait, elle accepte même un itérable de taille inconnu, par exemple un flux de données issu d’internet.</li>
<li>Cela consomme très peu de mémoire : on utilise des générateurs partout (merci à <code>yield</code> et au module <code>itertools</code>), donc toutes les valeurs sont générées uniquement quand on les demande, et jamais stockées pour rien.</li>
<li>Et d’ailleurs, comme on retourne un générateur, on peut passer le résultat à un processus utilisant des générateurs sans casser son empreinte mémoire. Faire des pipes d’un générateur à un autre est en effet un point fort de Python.</li>
<li>Mais comme le générateur est itérable, toute fonction qui accepte un itérable pourra utiliser le résultat : les fonctions de tri, les fonctions max, etc. La boucle <code>for</code> et les <a href="http://sametmax.com/python-love-les-listes-en-intention-partie/">listes en intension</a> l’acceptent aussi.</li>
<li>Le troisième paramètre garantit que chaque morceau est dans le format que l’on souhaite, pas quelque chose de figé qu’on devra caster : c’est un bonheur pour les one-liners.</li>
</ul>
<p>C’est une solution d’une rare élégance car elle tient en quelques lignes et assure une gigantesque flexibilité, sans manger beaucoup de mémoire vive. Le seul défaut étant que la lecture enclenche le mécanisme de génération, qui est plus lent que de lire une structure de données, donc la lecture complète de toute la séquence est globalement plus lente que dans la plupart des autres approches.</p>
<p>Dans 90 % des cas, vous pouvez utiliser <code>morceaux()</code> sans souffrir de sa vitesse. Ceux qui bossent sur les 10 % restant ont un niveau tel qu’ils savent avec certitude s’ils peuvent utiliser cette approche ou non, donc si vous vous posez la question, c’est que vous n’en faites pas partie.</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/parcourir-un-iterable-par-morceaux-en-python/feed/</wfw:commentRss>
		<slash:comments>19</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2012/05/bucheron_marne.jpg" length="58193" type="image/jpg" />	</item>
	</channel>
</rss>
