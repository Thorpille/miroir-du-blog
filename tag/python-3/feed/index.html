<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Sam &#38; Max &#187; python 3</title>
	<atom:link href="http://sametmax.com/tag/python-3/feed/" rel="self" type="application/rss+xml" />
	<link>http://sametmax.com</link>
	<description>Du code, du cul</description>
	<lastBuildDate>Sat, 07 Nov 2015 10:56:13 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=4.1</generator>
	<item>
		<title>Today is a glorious day 15</title>
		<link>http://sametmax.com/today-is-a-glorious-day/</link>
		<comments>http://sametmax.com/today-is-a-glorious-day/#comments</comments>
		<pubDate>Sun, 12 Jul 2015 21:29:59 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[crossbar]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[python 3]]></category>
		<category><![CDATA[twisted]]></category>
		<category><![CDATA[wamp]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=16600</guid>
		<description><![CDATA[pip install crossbar]]></description>
				<content:encoded><![CDATA[
<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">import</span> crossbar
<span style="color: #66cc66;">&gt;&gt;&gt;</span> crossbar.__version__
<span style="color: #483d8b;">'0.10.4'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">import</span> twisted
<span style="color: #66cc66;">&gt;&gt;&gt;</span> twisted.__version__
<span style="color: #483d8b;">'15.2.1'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">sys</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'Wait for it...'</span><span style="color: black;">&#41;</span>
Wait <span style="color: #ff7700;font-weight:bold;">for</span> it...
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #dc143c;">sys</span>.<span style="color: black;">version</span>
<span style="color: #483d8b;">'3.4.0 (default, Apr 11 2014, 13:05:11) <span style="color: #000099; font-weight: bold;">\n</span>[GCC 4.8.2]'</span></pre></td></tr></table></div>

]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/today-is-a-glorious-day/feed/</wfw:commentRss>
		<slash:comments>15</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2015/07/T5C15Zm.gif" length="996010" type="image/jpg" />	</item>
		<item>
		<title>Gérer plusieurs versions de Python avec &#8220;py&#8221; sous Windows 7</title>
		<link>http://sametmax.com/gerer-plusieurs-versions-de-python-avec-py-sous-windows/</link>
		<comments>http://sametmax.com/gerer-plusieurs-versions-de-python-avec-py-sous-windows/#comments</comments>
		<pubDate>Sat, 10 Jan 2015 09:10:27 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[py]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[python 2]]></category>
		<category><![CDATA[python 3]]></category>
		<category><![CDATA[windows]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=15699</guid>
		<description><![CDATA[Il est courant de vouloir installer plusieurs versions de Python. Pour faire des tests, pour s'assurer que son code est portable, pour utiliser des libs qui marchent uniquement sur une des versions, etc.

Or, depuis la version 3.3, l'installeur de Python installe la commande <a href="https://docs.python.org/3/using/windows.html#launcher">py</a> sous Windows, qui permet de choisir quelle version de Python on lance.]]></description>
				<content:encoded><![CDATA[<p>Il est courant de vouloir installer plusieurs versions de Python. Pour faire des tests, pour s&#8217;assurer que son code est portable, pour utiliser des libs qui marchent uniquement sur une des versions, etc.</p>
<p>Sous Linux, c&#8217;est facile : chaque interpretteur est préfixé. Par exemple, sous Ubuntu, si je veux utiliser Python 3.4, je l&#8217;installe :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #c20cb9; font-weight: bold;">apt-get install</span> python3.4</pre></td></tr></table></div>

<p>Et si je lance <code>python</code>, ça me lance la 2.7 car c&#8217;est celle de base. Mais si je lance <code>python3.4</code>, ça me lance bien la 3.4. </p>
<p>Au final, on finit par utiliser des <a href="virtuels">environnements virtuels</a> qui isolent des versions de Python particulières. Mais ça ne retire pas l&#8217;envie de pouvoir choisir sa version de Python au niveau du système, ce qui reste difficile à faire sous Windows.</p>
<p>Or, depuis la version 3.3, l&#8217;installeur pour cet OS de Python installe la commande <a href="https://docs.python.org/3/using/windows.html#launcher">py</a>, qui permet de choisir quelle version de Python on lance.</p>
<h2>Dans un terminal</h2>
<p>Si dans une console vous faites :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;">py</pre></td></tr></table></div>

<p>Il lancera le shell de votre installation Python 2.x la plus récente.</p>
<p>Si vous faites :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;">py script.py</pre></td></tr></table></div>

<p>Il exécutera le script avec votre installation Python 2.x la plus récente.</p>
<p>Mais vous pouvez passez un flag <code>-version</code> pour forcer une version de Python. Lancer le shell Python avec la 3.3 :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;">py -<span style="color: #000000;">3.3</span></pre></td></tr></table></div>

<p>Lancer un script avec la 3.4 :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;">py -<span style="color: #000000;">3.4</span> script.py</pre></td></tr></table></div>

<p>Cela suppose que vous avez la 3.3 et la 3.4, installés, évidement.</p>
<p>La syntaxe est surprenante. J&#8217;aurais pensé qu&#8217;ils mettraient un truc du genre <code>py -i 3.4</code> mais non, c&#8217;est direct <code>-numero</code>.</p>
<p>La commande <code>py</code> accepte aussi les paramètres qu&#8217;on passerait normalement à la commande <code>python</code>, et notament l&#8217;option <code>-m module</code>, qui permet de lancer un module en particulier. </p>
<p>C&#8217;est pratique pour lancer <code>ipython</code> ou <code>pip</code> avec une version particulière. Par exemple pour installer <a href="https://github.com/tavendo/AutobahnPython/">autobahn</a> uniquement pour la version 3.4 et donc utiliser <code>asyncio</code> :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;">py -<span style="color: #000000;">3.4</span> <span style="color: #660033;">-m</span> pip <span style="color: #c20cb9; font-weight: bold;">install</span> autobahn</pre></td></tr></table></div>

<h2>Bang !</h2>
<p>La commande <code>py</code> reconnait également la ligne <em>shebang</em>, cette syntaxe unix qui dit quel interpretteur utiliser. Si vous mettez sur la première ligne de votre script :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;">#! python3.4</span></pre></td></tr></table></div>

<p>Alors :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;">py script.py</pre></td></tr></table></div>

<p>Invoquera python 3.4.</p>
<p>La commande est capable de se débrouiller avec les chemins Unix, afin de garder la portabilité. Donc si vous faites :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;">#! /usr/bin/env python2.7</span></pre></td></tr></table></div>

<p>Alors :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;">py script.py</pre></td></tr></table></div>

<p>Va ignorer le debut de la ligne, et prendre l&#8217;installation locale de Python 2.7 pour lancer le script.</p>
<h2>On click</h2>
<p>Si vous installez la version Python 3.3 ou 3.4 en premier, les fichiers <code>.py</code> seront associés à la commande <code>py</code>. Donc si vous cliquez sur un script Python avec une ligne shebang, la bonne version sera lancée.</p>
<p>Mais si vous avez installé Python 2.x avant, il est possible que vos fichiers <code>.py</code> soient encore associés directement à la commande <code>python</code> ordinnaire.</p>
<p>Pour changer cela, faites un clic droit sur un fichier <code>.py</code>, modifiez le programme qui ouvre ce fichier et faites le pointer sur <code>"C:\Windows\py.exe"</code>.</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/gerer-plusieurs-versions-de-python-avec-py-sous-windows/feed/</wfw:commentRss>
		<slash:comments>7</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2015/01/UrBfT5U.jpg" length="469292" type="image/jpg" />	</item>
		<item>
		<title>Ca y est, on peut coder en Python 3 38</title>
		<link>http://sametmax.com/ca-y-est-on-peut-coder-en-python-3/</link>
		<comments>http://sametmax.com/ca-y-est-on-peut-coder-en-python-3/#comments</comments>
		<pubDate>Mon, 17 Mar 2014 11:29:20 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[bonheur]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[python 2]]></category>
		<category><![CDATA[python 3]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=9790</guid>
		<description><![CDATA[La 3.3 et la 3.4 viennent avec tout un tas des goodies super green.</strong>

Voici tout ce dont vous pouvez profiter avec Python 3 que vous ne pouvez pas faire avec Python 2.]]></description>
				<content:encoded><![CDATA[<p><a href="https://www.python.org/download/releases/3.4.0/">Python 3.4 vient de sortir</a>, et avec cette release, je peux enfin recommander aux gens de se mettre à Python 3 plutôt que Python 2. Tout simplement parce que maintenant, en plus d&#8217;avoir énormément de <a href="http://python3wos.appspot.com/">libs qui ont migré</a>, on a l&#8217;expérience de la bestiole. C&#8217;est stable, les perfs sont bonnes, la conversion de code d&#8217;une version à l&#8217;autre est bien documentée et maitrisée.</p>
<p><strong>Et surtout, la 3.3 et la 3.4 viennent avec tout un tas des goodies super green.</strong></p>
<p>Voici tout ce dont vous pouvez profiter avec Python 3 que vous ne pouvez pas faire avec Python 2.</p>

<!-- iframe plugin v.2.9 wordpress.org/plugins/iframe/ -->
<iframe width="420" height="315" src="//www.youtube.com/embed/ILObfEzX92k" frameborder="0" scrolling="no" class="iframe-class"></iframe>

<h2>Des classes classes</h2>
<p>Les classes sont des new type classes en Python 3. Pas besoin d&#8217;hériter d&#8217;<code>object</code>:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># Au revoir !</span>
<span style="color: #ff7700;font-weight:bold;">class</span> TouteMoche<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">pass</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Bonjour !</span>
<span style="color: #ff7700;font-weight:bold;">class</span> PropreEtNette:
    <span style="color: #ff7700;font-weight:bold;">pass</span></pre></td></tr></table></div>

<p>Les metaclasses ne se définissent plus comme un attribut spécial :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># Au revoir !</span>
<span style="color: #ff7700;font-weight:bold;">class</span> TouteMoche<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    <span style="color: #0000cd;">__metaclass__</span> <span style="color: #66cc66;">=</span> UnTruc
&nbsp;
<span style="color: #808080; font-style: italic;"># Bonjour !</span>
<span style="color: #ff7700;font-weight:bold;">class</span> PropreEtNette<span style="color: black;">&#40;</span>metaclass<span style="color: #66cc66;">=</span>Untruc<span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">pass</span></pre></td></tr></table></div>

<h2>Super Super()</h2>
<p>Franchement, qui se souvient de la syntaxe pour appeler proprement la méthode parente d&#8217;une classe ?</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># Au revoir !</span>
<span style="color: #ff7700;font-weight:bold;">class</span> FranchementHein<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">super</span><span style="color: black;">&#40;</span>FranchementHein<span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span><span style="color: black;">&#41;</span>.<span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Bonjour !</span>
<span style="color: #ff7700;font-weight:bold;">class</span> FranchementHein:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">super</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<h2>Meta meta programmation</h2>
<p>Le module <a href="http://docs.python.org/3/library/inspect.html?highlight=signature#inspect.signature">inspect</a> permet maintenant de récupérer des infos très très précises sur la signature des fonctions :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">    <span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">inspect</span> <span style="color: #ff7700;font-weight:bold;">import</span> signature
    <span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">def</span> foo<span style="color: black;">&#40;</span>a<span style="color: #66cc66;">,</span> *<span style="color: #66cc66;">,</span> b:<span style="color: #008000;">int</span><span style="color: #66cc66;">,</span> **kwargs<span style="color: black;">&#41;</span>:
    ...     <span style="color: #ff7700;font-weight:bold;">pass</span>
&nbsp;
    <span style="color: #66cc66;">&gt;&gt;&gt;</span> sig <span style="color: #66cc66;">=</span> signature<span style="color: black;">&#40;</span>foo<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">str</span><span style="color: black;">&#40;</span>sig<span style="color: black;">&#41;</span>
    <span style="color: #483d8b;">'(a, *, b:int, **kwargs)'</span>
&nbsp;
    <span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">str</span><span style="color: black;">&#40;</span>sig.<span style="color: black;">parameters</span><span style="color: black;">&#91;</span><span style="color: #483d8b;">'b'</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>
    <span style="color: #483d8b;">'b:int'</span>
&nbsp;
    <span style="color: #66cc66;">&gt;&gt;&gt;</span> sig.<span style="color: black;">parameters</span><span style="color: black;">&#91;</span><span style="color: #483d8b;">'b'</span><span style="color: black;">&#93;</span>.<span style="color: black;">annotation</span>
    <span style="color: #66cc66;">&lt;</span><span style="color: #ff7700;font-weight:bold;">class</span> <span style="color: #483d8b;">'int'</span><span style="color: #66cc66;">&gt;</span></pre></td></tr></table></div>

<p>Et comme vous pouvez le voir, les <a href="http://sametmax.com/les-annotations-en-python-3/">annotations</a> sont de la partie.</p>
<p>Les classes ont également un nouvel attribut <a href="http://www.python.org/dev/peps/pep-3155/#proposal">__qualname__</a>, qui, comme on peut s&#8217;y attendre, est le qualified name de la classe :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">class</span> C:
...   <span style="color: #ff7700;font-weight:bold;">def</span> f<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">pass</span>
...   <span style="color: #ff7700;font-weight:bold;">class</span> D:
...     <span style="color: #ff7700;font-weight:bold;">def</span> g<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">pass</span>
...
<span style="color: #66cc66;">&gt;&gt;&gt;</span> C.__qualname__
<span style="color: #483d8b;">'C'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> C.<span style="color: black;">f</span>.__qualname__
<span style="color: #483d8b;">'C.f'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> C.<span style="color: black;">D</span>.__qualname__
<span style="color: #483d8b;">'C.D'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> C.<span style="color: black;">D</span>.<span style="color: black;">g</span>.__qualname__
<span style="color: #483d8b;">'C.D.g'</span></pre></td></tr></table></div>

<p>Ca marche aussi pour les fonctions.</p>
<p>Enfin pour les gars qui sont vraiment tordus, on a une nouvelle méthode pour les metaclasses, <a href="http://www.python.org/dev/peps/pep-0447/">__locallookup__</a>, qui permet d&#8217;influencer le <a href="http://python-history.blogspot.fr/2010/06/method-resolution-order.html">MRO</a> à la volée.</p>
<h2>Un yield qui yield</h2>
<p>Bon, mon titre ne veut rien dire, c&#8217;était pour la continuité.</p>
<p><code>yield</code> a maintenant un petit frère, <code>yield from</code>, qui permet de déléguer l&#8217;itération à un itérable sous jacent :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">def</span> generateur<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">yield</span> <span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #483d8b;">&quot;123&quot;</span>
    <span style="color: #ff7700;font-weight:bold;">yield</span> <span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: black;">&#40;</span><span style="color: #008000;">str</span><span style="color: black;">&#40;</span>x<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">4</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">7</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">yield</span> <span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;7&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;8&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">&quot;9&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">for</span> i <span style="color: #ff7700;font-weight:bold;">in</span> generateur<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>i<span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">## 1</span>
<span style="color: #808080; font-style: italic;">## 2</span>
<span style="color: #808080; font-style: italic;">## 3</span>
<span style="color: #808080; font-style: italic;">## 4</span>
<span style="color: #808080; font-style: italic;">## 5</span>
<span style="color: #808080; font-style: italic;">## 6</span>
<span style="color: #808080; font-style: italic;">## 7</span>
<span style="color: #808080; font-style: italic;">## 8</span>
<span style="color: #808080; font-style: italic;">## 9</span></pre></td></tr></table></div>

<p>Là ce n&#8217;est pas très utile, mais sur des générateurs complexes, c&#8217;est sympa. Surtout que <code>yield from</code> passe aussi les valeur avec <code>send()</code>, fait remonter les exceptions proprement et est détecté par les events loops du module asyncio, dont on parlera plus tard.</p>
<h2>Batteries included, with charger</h2>
<p><a href="http://sametmax.com/votre-python-aime-les-pip/">Pip</a> et <a href="http://sametmax.com/les-environnement-virtuels-python-virtualenv-et-virtualenvwrapper/">virtualenv</a> sont livrés avec la 3.4 ! Rien de plus à faire, rien à installer ! Enfin !</p>
<p>Malheureusement pas virtualenv wrapper, mais c&#8217;est déjà pas mal.</p>
<p>Un nouveau format, le <a href="http://pythonwheels.com/">wheel</a>, permet de faire des paquets binaires qui n&#8217;auront pas besoin d&#8217;être compilés sur la machine cible. Ca veut dire bientôt du numpy / scipy sans avoir à compiler quoi que ce soit. C&#8217;est un remplacement du <em>egg</em> plus simple et sans les problèmes de compatibilités. Il ne vise pas la distribution de projets Python standalones, comme le <em>egg</em> qui a notamment eu le problème de vouloir tout faire en même temps.</p>
<p>Pour ce dernier, le <a href="http://www.python.org/dev/peps/pep-0441/">pyz</a> est en discussion.</p>
<p>Enfin les scripts Python supportent maintenant <a href="http://www.python.org/dev/peps/pep-0397/">l&#8217;équivalent du shebang, mais sous Windows</a>. Ceci vient avec l&#8217;introduction de la commande <code>py</code> qui permet de lancer toutes les commandes Python (<code>pip</code>, <code>venv</code>, etc.) pour une version de Python installée spécifique.</p>
<p>Ah, non, pas &#8220;enfin&#8221;, j&#8217;ai oublié un truc :</p>
<p><code>python -X faulthandler votre_script.py</code> vous permet maintenant d&#8217;obtenir une stacktrace sur les scripts utilisant <code>ctypes</code> \o/. Et le module <a href="http://docs.python.org/3.4/library/tracemalloc.html">tracemalloc</a> permet d&#8217;enquêter sur l&#8217;allocation mémoire.</p>
<h2>Tout un tas de trucs que les codeurs Java vont adorer</h2>
<p>Il y a des <a href="http://docs.python.org/3.4/library/enum.html">Enums</a>, et ça vient sous toutes les formes :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">from</span> enum <span style="color: #ff7700;font-weight:bold;">import</span> Enum<span style="color: #66cc66;">,</span> IntEnum
&nbsp;
<span style="color: #808080; font-style: italic;"># La version de feignasse :</span>
Animal <span style="color: #66cc66;">=</span> Enum<span style="color: black;">&#40;</span><span style="color: #483d8b;">'ant bee cat dog'</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># La version 'anal retentive'</span>
<span style="color: #ff7700;font-weight:bold;">class</span> Animal<span style="color: black;">&#40;</span>IntEnum<span style="color: black;">&#41;</span>:
     ant <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span>
     bee <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">2</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># et tout ce qu'il faut entre les deux pour les centristes</span></pre></td></tr></table></div>

<p>Pour les nostalgiques de l&#8217;overloading, on peut maintenant spécifier que le code d&#8217;une fonction est différent selon le type des arguments qui lui sont passés :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">from</span> functools <span style="color: #ff7700;font-weight:bold;">import</span> singledispatch
&nbsp;
<span style="color: #66cc66;">@</span>singledispatch
<span style="color: #ff7700;font-weight:bold;">def</span> fun<span style="color: black;">&#40;</span>arg<span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'Comportement par défaut, teddy'</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #66cc66;">@</span>fun.<span style="color: black;">register</span><span style="color: black;">&#40;</span><span style="color: #008000;">int</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">def</span> _<span style="color: black;">&#40;</span>arg<span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Tu m'as passé un int, jonhy !&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Cacatoes:
    <span style="color: #ff7700;font-weight:bold;">pass</span>
&nbsp;
<span style="color: #66cc66;">@</span>fun.<span style="color: black;">register</span><span style="color: black;">&#40;</span>Cacatoes<span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">def</span> _<span style="color: black;">&#40;</span>arg<span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Tu m'as passé un Cacatoes, billy !&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
fun<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Do'</span><span style="color: black;">&#41;</span>
fun<span style="color: black;">&#40;</span><span style="color: black;">&#91;</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>
fun<span style="color: black;">&#40;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>
fun<span style="color: black;">&#40;</span>Cacatoes<span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">## Comportement par défaut, teddy</span>
<span style="color: #808080; font-style: italic;">## Comportement par défaut, teddy</span>
<span style="color: #808080; font-style: italic;">## Tu m'as passé un int, jonhy !</span>
<span style="color: #808080; font-style: italic;">## Tu m'as passé un Cacatoes, billy !</span></pre></td></tr></table></div>

<p>Et puis le module <a href="http://docs.python.org/2/library/abc.html?highlight=abc#abc">abc</a> pour faire des classes abstraites, même si ça a été backporté en Python 2.7, donc un peu hors sujet.</p>
<h2>Les built-in ont un peu changé</h2>
<p>Pour le texte, c&#8217;est de l&#8217;unicode partout, avec utf8 par défaut pour les conversions. Ca veut dire plus de <code>u</code> devant les chaînes de caractère, plus de déclaration de l&#8217;encoding en haut des fichiers de code. Moins de <code>decode</code> / <code>encode</code>.</p>
<p>Mais ça veut dire aussi que <code>open</code> a besoin obligatoirement d&#8217;un paramètre <code>encoding</code>, dont la valeur par défaut est bien entendu <code>utf8</code>.</p>
<p>Attention cependant, le built-in <code>bytes</code> n&#8217;est pas l&#8217;exacte équivalent du type <code>str</code> en Python 2 puisqu&#8217;il ne possède plus certaines méthodes de manipulation de texte comme <code>replace</code>:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #483d8b;">&quot;Trololo&quot;</span>.<span style="color: black;">replace</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'o'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'a'</span><span style="color: black;">&#41;</span>
<span style="color: #483d8b;">'Tralala'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> b<span style="color: #483d8b;">&quot;Trololo&quot;</span>.<span style="color: black;">replace</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'o'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'a'</span><span style="color: black;">&#41;</span>
Traceback <span style="color: black;">&#40;</span>most recent call last<span style="color: black;">&#41;</span>:
  File <span style="color: #483d8b;">&quot;&lt;ipython-input-5-f7e93d6f629e&gt;&quot;</span><span style="color: #66cc66;">,</span> line <span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #66cc66;">&lt;</span>module<span style="color: #66cc66;">&gt;</span>
    b<span style="color: #483d8b;">&quot;Trololo&quot;</span>.<span style="color: black;">replace</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'o'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'a'</span><span style="color: black;">&#41;</span>
<span style="color: #008000;">TypeError</span>: expected an <span style="color: #008000;">object</span> <span style="color: #ff7700;font-weight:bold;">with</span> the buffer interface</pre></td></tr></table></div>

<p>C&#8217;est un peu chiant quand on manipule des protocoles binaires, et les mecs de mercurial ont un peu gueulé. Donc il est possible que ça change. J&#8217;ai mis beaucoup de fois le mot &#8220;peu&#8221; dans cet article, ce qui est stylistiquement très laid. Mais je suis trop paresseux pour éditer cet article qui fait maintenant 3 km.</p>
<p>Pour les nombres, on n&#8217;a plus à se soucier du type <code>long</code>, qui n&#8217;existe plus. <code>/</code> est maintenant la division ordinaire et <code>//</code> la division entière.</p>
<p>Pour les fonctions built-in, pas mal de changements avec bien entendu, <code>print()</code> qui devient une fonction, mais aussi toute ce qui est <code>zip</code>, <code>map</code>, etc, qui retournent des générateurs au lieu de listes, tout comme <code>dict.items</code> et consorts. Ah oui, et <code>import</code> est maintenant absolu par défaut.</p>
<h2>Quelques libs en plus</h2>
<p>Marre du module <code>os</code> ? <a href="http://docs.python.org/3.4/library/pathlib.html?highlight=pathlib#module-pathlib">pathlib</code> permet de donner un petit goût d&#8217;objet à vos manipulations de FS, comme <a href="https://github.com/jaraco/path.py">path.py</a>. Ca reste moins bien, mais c&#8217;est mieux que rien.</p>
<p>Raz-le bol de recoder la fonction moyenne, médiane, etc ? Le module <a href="http://docs.python.org/3.4/library/statistics.html?highlight=statistics#module-statistics">statistics</a> a été ajouté pour ça.</p>
<p>Enfin, le fameux module <a href="http://docs.python.org/3/library/unittest.mock.html#module-unittest.mock">mock</a>, qui permet de simuler tout un tas de trucs sans tout casser :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">from</span> mock <span style="color: #ff7700;font-weight:bold;">import</span> patch
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">with</span> patch.<span style="color: #008000;">object</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'listdir'</span><span style="color: #66cc66;">,</span> return_value<span style="color: #66cc66;">=</span><span style="color: black;">&#91;</span><span style="color: #483d8b;">'file2.txt'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'file2.text'</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span>.<span style="color: black;">listdir</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'/etc/'</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
...
<span style="color: black;">&#91;</span>u<span style="color: #483d8b;">'file2.txt'</span><span style="color: #66cc66;">,</span> u<span style="color: #483d8b;">'file2.text'</span><span style="color: black;">&#93;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #dc143c;">os</span>.<span style="color: black;">listdir</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'/etc/'</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span>:<span style="color: #ff4500;">2</span><span style="color: black;">&#93;</span>
<span style="color: black;">&#91;</span>u<span style="color: #483d8b;">'environment'</span><span style="color: #66cc66;">,</span> u<span style="color: #483d8b;">'hosts.allow'</span><span style="color: black;">&#93;</span></pre></td></tr></table></div>

<h2>Tout est bien rangé</h2>
<p>Les fichiers bytecode Python sont maintenant tous groupés dans un dossier appelé <em>__pycache__</em>. Finis les <em>.pyc</em> qui trainent partout. Et en plus prefixés de l&#8217;architecture avec laquelle ils ont été générés. Toujours utile.</p>
<p>En prime pas mal de noms ont été normalisés : tous les modules sont maintenant en minuscule, tous les modules liés à IO sont groupés dans le module <code>io</code>, <code>urllib</code> 1 et 2 ont été mergés, et l&#8217;arborescence des exceptions pour les erreurs d&#8217;IO a maintenant beaucoup plus de sens :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># Au revoir !</span>
<span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">errno</span> <span style="color: #ff7700;font-weight:bold;">import</span> ENOENT<span style="color: #66cc66;">,</span> EACCES<span style="color: #66cc66;">,</span> EPERM
&nbsp;
<span style="color: #ff7700;font-weight:bold;">try</span>:
    <span style="color: #ff7700;font-weight:bold;">with</span> <span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;document.txt&quot;</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> f:
        content <span style="color: #66cc66;">=</span> f.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">IOError</span> <span style="color: #ff7700;font-weight:bold;">as</span> err:
    <span style="color: #ff7700;font-weight:bold;">if</span> err.<span style="color: #dc143c;">errno</span> <span style="color: #66cc66;">==</span> ENOENT:
        <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;document.txt file is missing&quot;</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">elif</span> err.<span style="color: #dc143c;">errno</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: black;">&#40;</span>EACCES<span style="color: #66cc66;">,</span> EPERM<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;You are not allowed to read document.txt&quot;</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">else</span>:
        <span style="color: #ff7700;font-weight:bold;">raise</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Bonjour !</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">try</span>:
    <span style="color: #ff7700;font-weight:bold;">with</span> <span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;document.txt&quot;</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> f:
        content <span style="color: #66cc66;">=</span> f.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">except</span> FileNotFoundError:
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;document.txt file is missing&quot;</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">except</span> PermissionError:
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;You are not allowed to read document.txt&quot;</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<h2>Asyncio, la prog asynchrone rebootée</h2>
<p>Une des raisons pour laquelle je tape sur javascript aussi fort, c&#8217;est aussi la jalousie. Ils ont tous les derniers joujoux asynchrones hi-tech, meh !</p>
<p>Avec Python on était obligé d&#8217;installer tornado ou twisted pour ça, et c&#8217;était un peu dommage :)</p>
<p>Avec la 3.4, la prog asynchrone fait peau neauve (adieu l&#8217;horrible module <a href="http://docs.python.org/2/library/asyncore.html">asyncore</a>) et propose de la prog asynchrone plus simple, plus légère, plus facilement intégrable : <a href="http://legacy.python.org/dev/peps/pep-3156/">asyncio</a>.</p>
<p>Si vous lisez ce PEP, ça ne va pas vous parler, alors je vais potasser tout ça et faire un petit article.</p>
<p>Mon seul regret avec asyncio, c&#8217;est que c&#8217;est un module uniquement bas niveau, alors que tulip, le prototype de la lib, contenait des mobiles haut niveau comme par exemple <a href="https://code.google.com/p/tulip/source/browse/tests/http_client_test.py?r=593a96f529b800fb0a67098c0f3bd7ce197c2205">un client http bien foutu</a>. Du coup ça a donné <a href="http://sametmax.com/en-attendant-asyncio/#comment-19108">ce genre de discussion</a> sur le blog, avec des gens qui ne comprenaient pas que je m&#8217;attendais à un peu de haut niveau et eux qui ne voyaient que le bas, et donc s&#8217;attardaient sur de la sémentique d&#8217;implémentation de la prog non blocante.</p>
<h2>En conclusion</h2>
<p>Le code Python 3 est plus court, plus cohérent, avec moins de surprises, moins de dépendances externes et plus de flexibilité. Des comportements par défaut sains un peu partout, des outils en plus, et comme d&#8217;habitude vous n&#8217;en utiliserez pas la moitié tellement il y a à faire.</p>
<p>Python 3.4 est vraiment un très bon cru, honnêtement, avec toutes ces améliorations, le langage parvient à se maintenir au niveau des petits jeunes et de leur hype, sans sacrifier sa solidité et sa cohérence.</p>
<p>C&#8217;est pour ça qu&#8217;on a attendu 5 ans. C&#8217;est pour ça que la migration a été lente et prudente.</p>
<p>Parce que la communauté Python fait vraiment les choses bien.</p>
<p>Les exemples du blogs seront donc à partir de maintenant en Python 3.</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/ca-y-est-on-peut-coder-en-python-3/feed/</wfw:commentRss>
		<slash:comments>38</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2014/03/doodle_snake_4___classy_gavin_by_riku_paradise_finder-d5s9eaa.png" length="125362" type="image/jpg" />	</item>
		<item>
		<title>Changement dans l&#8217;unpacking des iterables en Python 3 6</title>
		<link>http://sametmax.com/changement-dans-lunpacking-des-iterables-en-python-3/</link>
		<comments>http://sametmax.com/changement-dans-lunpacking-des-iterables-en-python-3/#comments</comments>
		<pubDate>Fri, 20 Dec 2013 07:49:59 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[python 3]]></category>
		<category><![CDATA[splat]]></category>
		<category><![CDATA[unpacking]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=7656</guid>
		<description><![CDATA[Ahhh, l'unpacking... On croit qu'on a complètement <a href="http://sametmax.com/tag/unpacking/">fait le tour</a> de cette fonctionalité merveilleuse, et PAF, on découvre encore autre chose.

Par exemple, la syntaxe a été améliorée avec Python 3, et accepte maintenant un <a href="http://www.python.org/dev/peps/pep-3132/">unpacking partiel</a> !]]></description>
				<content:encoded><![CDATA[<p>Ahhh, l&#8217;unpacking&#8230; On croit qu&#8217;on a complètement <a href="http://sametmax.com/tag/unpacking/">fait le tour</a> de cette fonctionalité merveilleuse, et PAF, on découvre encore autre chose.</p>
<p>Par exemple, la syntaxe a été améliorée avec Python 3, et accepte maintenant un <a href="http://www.python.org/dev/peps/pep-3132/">unpacking partiel</a> !</p>
<p>Ca se fait en l&#8217;utilisant l&#8217;opérateur splat, c&#8217;est à dire l&#8217;étoile :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> l <span style="color: #66cc66;">=</span> <span style="color: #008000;">list</span><span style="color: black;">&#40;</span><span style="color: #008000;">range</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">5</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> l
<span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">2</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">3</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">4</span><span style="color: black;">&#93;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> a<span style="color: #66cc66;">,</span> *b <span style="color: #66cc66;">=</span> l
<span style="color: #66cc66;">&gt;&gt;&gt;</span> a
<span style="color: #ff4500;">0</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> b
<span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">2</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">3</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">4</span><span style="color: black;">&#93;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> a<span style="color: #66cc66;">,</span> *b<span style="color: #66cc66;">,</span> c <span style="color: #66cc66;">=</span> l
<span style="color: #66cc66;">&gt;&gt;&gt;</span> a
<span style="color: #ff4500;">0</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> b
<span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">2</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">3</span><span style="color: black;">&#93;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> c
<span style="color: #ff4500;">4</span></pre></td></tr></table></div>

<p>Ca marche bien entendu également dans les boucles <code>for</code>.</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/changement-dans-lunpacking-des-iterables-en-python-3/feed/</wfw:commentRss>
		<slash:comments>6</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2013/12/lHLWwNE.jpg" length="119468" type="image/jpg" />	</item>
		<item>
		<title>Conséquences de print devenant une fonction en Python 3 13</title>
		<link>http://sametmax.com/consequence-de-print-devenant-une-fonction-en-python-3/</link>
		<comments>http://sametmax.com/consequence-de-print-devenant-une-fonction-en-python-3/#comments</comments>
		<pubDate>Tue, 03 Dec 2013 08:31:37 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[print]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[python 3]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=8164</guid>
		<description><![CDATA[Devoir utiliser <code>print()</code> au lieu de <code>print</code> m'arrache la gueule, je dois l'avouer. J'ai l'impression que ces deux parenthèses ma prennent 5 heures à taper, là où avant mon petit espace était à portée de pouce.

Mais évidement, la décision de faire de <code>print</code> une fonction est parfaitement rationnelle, et en voici tous les avantages...]]></description>
				<content:encoded><![CDATA[<p>Devoir utiliser <code>print()</code> au lieu de <code>print</code> m&#8217;arrache la gueule, je dois l&#8217;avouer. J&#8217;ai l&#8217;impression que ces deux parenthèses ma prennent 5 heures à taper, là où avant mon petit espace était à portée de pouce.</p>
<p>Mais évidement, la décision de faire de <code>print</code> une fonction est parfaitement rationnelle, et en voici tous les avantages&#8230;</p>
<h2><code>print</code> n&#8217;est plus une déclaration, mais une expression</h2>
<p>Il y a deux types d&#8217;instructions en Python : les déclarations (&#8216;statement&#8217; dans la langue de Chuck Norris) et les expressions.</p>
<p>Les déclarations sont des instructions indépendantes : <code>while</code>, <code>var = 'valeur'</code>, <code>try</code>, <code>def</code>, etc. On ne peut pas les mettre dans une expression, seulement les imbriquer dans une autre déclaration.</p>
<p>Les expressions, elles, sont imbricables dans n&#8217;importe quoi, et elles retournent toujours quelques chose quelque chose, fusse <code>None</code>. Parmis les expressions on retrouve : les lambdas, les listes en intentions, les appels de fonctions, etc.</p>
<p>Avant, <code>print</code> était une déclaration, ce qui était très peu souple. Maintenant, c&#8217;est un appel de fonction, et donc une expression.</p>
<p>On peut donc utiliser <code>print</code> dans une autre expression et ainsi :</p>
<p>Dans une <a href="http://sametmax.com/fonctions-anonymes-en-python-ou-lambda/">lambda</a> :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">crier <span style="color: #66cc66;">=</span> <span style="color: #ff7700;font-weight:bold;">lambda</span> x<span style="color: #66cc66;">,</span> *a<span style="color: #66cc66;">,</span> **k: <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>x.<span style="color: black;">upper</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> *a<span style="color: #66cc66;">,</span> **k<span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>Dans une <a href="http://sametmax.com/python-love-les-listes-en-intention-partie/">liste en intention</a> :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: black;">&#91;</span><span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>x<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">10</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span></pre></td></tr></table></div>

<h2>Plus de syntaxe bizarre</h2>
<p>Comment supprimer le saut de ligne quand on print avec l&#8217;ancienne syntaxe ?</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;Hello&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #808080; font-style: italic;"># &lt;- notez la virgule</span>
<span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;You&quot;</span>
Hello You</pre></td></tr></table></div>

<p>Avec la nouvelle syntaxe :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Hello &quot;</span><span style="color: #66cc66;">,</span> end<span style="color: #66cc66;">=</span><span style="color: #483d8b;">''</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'You'</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>Comment rediriger le print vers stderr avec l&#8217;ancienne syntaxe ?</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #66cc66;">&gt;&gt;</span> <span style="color: #dc143c;">sys</span>.<span style="color: black;">stderr</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'arg !'</span></pre></td></tr></table></div>

<p>Avec la nouvelle ?</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'arg !'</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">file</span><span style="color: #66cc66;">=</span><span style="color: #dc143c;">sys</span>.<span style="color: black;">stderr</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>Comment faire une liste séparée par des virgules avec l&#8217;ancienne syntaxe ?</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> l <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span><span style="color: #483d8b;">'Des petits trous'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'des petits trous'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'toujours des petits trous'</span><span style="color: black;">&#93;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">', '</span>.<span style="color: black;">join</span><span style="color: black;">&#40;</span>l<span style="color: black;">&#41;</span>
Des petits trous<span style="color: #66cc66;">,</span> des petits trous<span style="color: #66cc66;">,</span> toujours des petits trous</pre></td></tr></table></div>

<p>Avec la nouvelle ?</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>*l<span style="color: #66cc66;">,</span> sep<span style="color: #66cc66;">=</span><span style="color: #483d8b;">', '</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>En gros, la syntaxe est unifiée, plus besoin de penser à tous ces cas particuliers. Et en plus on peut demander de l&#8217;aide avec <code>help(print)</code> alors qu&#8217;avant ça faisait une syntaxe error.</p>
<h2>On peut récupérer une référence sur
<pre>print</pre>
</h2>
<p>Et donc la passer en paramètre pour faire de l&#8217;<a href="http://sametmax.com/quest-ce-quun-callback/">injection de dépendance</a> :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">def</span> truc<span style="color: black;">&#40;</span>a<span style="color: #66cc66;">,</span> <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: #66cc66;">=</span><span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#41;</span>:
    <span style="color: #808080; font-style: italic;"># faire un truc avec a</span>
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>a<span style="color: black;">&#41;</span><span style="color: #66cc66;">;</span> <span style="color: #808080; font-style: italic;"># on peut utiliser print normalement</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">logging</span>
log <span style="color: #66cc66;">=</span> loging.<span style="color: black;">getLogger</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
truc<span style="color: black;">&#40;</span>machin<span style="color: #66cc66;">,</span> <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: #66cc66;">=</span>log<span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># on print pas, on log !</span>
truc<span style="color: black;">&#40;</span>autre_machin<span style="color: #66cc66;">,</span> <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: #66cc66;">=</span><span style="color: #ff7700;font-weight:bold;">lambda</span> *a<span style="color: #66cc66;">,</span> **k: <span style="color: #008000;">None</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># ignore les prints !</span></pre></td></tr></table></div>

<p>Et également appliquer tous les outils de programmation fonctionnelle de Python :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">sys</span>
<span style="color: #ff7700;font-weight:bold;">from</span> functools <span style="color: #ff7700;font-weight:bold;">import</span> partial
error <span style="color: #66cc66;">=</span> partial<span style="color: black;">&#40;</span><span style="color: #ff7700;font-weight:bold;">print</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">file</span><span style="color: #66cc66;">=</span><span style="color: #dc143c;">sys</span>.<span style="color: black;">stderr</span><span style="color: black;">&#41;</span>
error<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Wrong !'</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># va directement sur stderr</span></pre></td></tr></table></div>

<h2>Activer <code>print()</code> en Python 2.7</h2>
<p>Si vous voulez prendre toute de suite de bonnes habitudes, vous pouvez faire, en Python 2.7 :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">__future__</span> <span style="color: #ff7700;font-weight:bold;">import</span> print_function</pre></td></tr></table></div>

]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/consequence-de-print-devenant-une-fonction-en-python-3/feed/</wfw:commentRss>
		<slash:comments>13</slash:comments>
		</item>
		<item>
		<title>Les annotations en Python 3 12</title>
		<link>http://sametmax.com/les-annotations-en-python-3/</link>
		<comments>http://sametmax.com/les-annotations-en-python-3/#comments</comments>
		<pubDate>Wed, 06 Nov 2013 06:05:43 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[annotations]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[python 3]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=7602</guid>
		<description><![CDATA[Que peut-on attendre d'une fonctionnalité optionnelle qui ne fait absolument rien ?]]></description>
				<content:encoded><![CDATA[<p>Mais oui, on va parler un peu plus de Python 3 à partir de maintenant \o/</p>
<p>C&#8217;est qu&#8217;avec la prochaine version 3.4 qui <a href="http://docs.python.org/3.4/whatsnew/3.4.html">apporte tellement de bonnes choses</a>, <a href="https://docs.djangoproject.com/en/dev/releases/1.6/">Django 1.6</a>  pleinement compatible et des libs comme <a href="http://pillow.readthedocs.org/en/latest/">Pillow</a> et <a href="https://pypi.python.org/pypi/six/1.1.0">six</a> pour combler les trous, ça y est, on peut enfin s&#8217;y mettre.</p>
<p>Commençons donc par les <a href="http://www.python.org/dev/peps/pep-3107/">annotations</a>, feature simple, et qu&#8217;on ne retrouve pas backportée en 2.7.</p>
<h2>D&#8217;abord, à quoi servent les annotations ?</h2>
<p>A rien !</p>
<p>Non, non, je ne déconne pas. Non seulement les annotations sont parfaitement optionnelles, mais en plus elles n&#8217;ont aucun effet.</p>
<p>Je répète pour que ça rentre : vous n&#8217;avez pas à utiliser les annotations. Aucun programme Python n&#8217;a besoin d&#8217;utiliser les annotations. Vous pouvez programmer votre vie entière en Python sans avoir jamais à utiliser les annotations. Et si vous les utilisez, elles ne changeront rien à votre programme.</p>
<p>Point.</p>
<h2>Non, mais sérieux, ça sert à quoi ?</h2>
<p>Python est un langage très souple, et une raison de sa souplesse c&#8217;est que la nature des données que vous traitez est dynamiquement découverte à l’exécution. Particulièrement, le type des variables est dynamique. La portée des variable est dynamique.</p>
<p>Avantages :</p>
<ul>
<li>Le code est court et clair.</li>
<li>Le langage est très facile à apprendre.</li>
<li>On peut utiliser le duck typing.</li>
</ul>
<p>Inconvénients :</p>
<ul>
<li>Il faut écrire des informations en plus dans la doc.</li>
<li>Le code est plus lent car la VM ne peut optimiser le code pour les types.</li>
<li>Les IDE ont moins d&#8217;outils pour aider à la rédaction du code.</li>
</ul>
<p>C&#8217;est la nature de Python. Pour certains cas, c&#8217;est ce qu&#8217;on veut. Dans d&#8217;autres cas où ce n&#8217;est pas adapté, il faut choisir un autre langage.</p>
<p>Les annotations sont là pour corriger ce point : on va permettre de fournir des informations en plus, <strong>si, et seulement, si, on le souhaite</strong>.</p>
<p>Ces informations n&#8217;auront aucun impact sur l&#8217;exécution du code. La VM Python va les ignorer. Mais un outil extérieur pourra potentiellement les utiliser pour en faire quelque chose.</p>
<h2>Show me the code !</h2>
<p>Faites chauffer votre interpréteur de Python 3&#8230;</p>
<p>On peut annoter <strong>uniquement</strong> les paramètres d&#8217;une fonction (ou méthode) :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">def</span> ma_fonction<span style="color: black;">&#40;</span>param1: <span style="color: #483d8b;">&quot;Une annotation&quot;</span><span style="color: #66cc66;">,</span> param2: <span style="color: #ff4500;">1</span> + <span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> param3: <span style="color: #008000;">int</span><span style="color: black;">&#41;</span>:
...     <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>param1<span style="color: #66cc66;">,</span> param2<span style="color: #66cc66;">,</span> param3<span style="color: black;">&#41;</span>
...
<span style="color: #66cc66;">&gt;&gt;&gt;</span> ma_fonction<span style="color: black;">&#40;</span><span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">2</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">3</span><span style="color: black;">&#41;</span>  <span style="color: #808080; font-style: italic;"># une annotation ne change absolument RIEN</span>
<span style="color: #ff4500;">1</span> <span style="color: #ff4500;">2</span> <span style="color: #ff4500;">3</span></pre></td></tr></table></div>

<p>L&#8217;annotation se note donc ainsi : nom du paramètre: annotation.</p>
<p>L&#8217;annotation PEUT être n&#8217;importe quelle expression Python valide. En fait l&#8217;annotation DOIT être une expression valide. Et <strong>cette expression sera exécutée</strong> une, et une seule fois, à l&#8217;initialisation du module. Le résultat sera stocké et accessible, via l&#8217;attribut <code>__annotations__</code> :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> ma_fonction.__annotations__
<span style="color: black;">&#123;</span><span style="color: #483d8b;">'param1'</span>: <span style="color: #483d8b;">'Une annotation'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'param2'</span>: <span style="color: #ff4500;">2</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'param3'</span>: <span style="color: #66cc66;">&lt;</span><span style="color: #ff7700;font-weight:bold;">class</span> <span style="color: #483d8b;">'int'</span><span style="color: #66cc66;">&gt;</span><span style="color: black;">&#125;</span></pre></td></tr></table></div>

<p>Évidément, les annotations se mélangent sans problème avec les cas avancés de paramétrage :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">def</span> ma_fonction<span style="color: black;">&#40;</span>param1 : <span style="color: #483d8b;">&quot;Une annotation&quot;</span> <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">&quot;valeur par défaut&quot;</span><span style="color: #66cc66;">,</span> *param2: <span style="color: #483d8b;">&quot;Autre annotation&quot;</span><span style="color: black;">&#41;</span>:
... <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>param1<span style="color: #66cc66;">,</span> param2<span style="color: black;">&#41;</span>
...
<span style="color: #66cc66;">&gt;&gt;&gt;</span> ma_fonction<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
valeur par défaut <span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>On peut également spécifier une annotation pour la valeur de retour :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">def</span> ma_fonction<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> -<span style="color: #66cc66;">&gt;</span> <span style="color: #008000;">None</span>: <span style="color: #808080; font-style: italic;"># un petit goût de coffeescript</span>
...     <span style="color: #ff7700;font-weight:bold;">pass</span>
...
<span style="color: #66cc66;">&gt;&gt;&gt;</span> ma_fonction.__annotations__
<span style="color: black;">&#123;</span><span style="color: #483d8b;">'return'</span>: <span style="color: #008000;">None</span><span style="color: black;">&#125;</span></pre></td></tr></table></div>

<p>Et combiner tout ce bordel pour faire des trucs bien compliqués qui vous garantissent la sécurité d&#8217;emploi, ce qui manque cruellement en Python (les trucs compliqués, pas la sécurité d&#8217;emploi&#8230;):</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">def</span> ma_fonction<span style="color: black;">&#40;</span>param1: <span style="color: #ff7700;font-weight:bold;">lambda</span> x: x * <span style="color: #ff4500;">2</span><span style="color: #66cc66;">,</span>
...                 <span style="color: black;">param2</span>: <span style="color: black;">&#40;</span><span style="color: #ff7700;font-weight:bold;">lambda</span> x: x * <span style="color: #ff4500;">2</span><span style="color: black;">&#41;</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">2</span><span style="color: black;">&#41;</span> <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">5</span><span style="color: #66cc66;">,</span>
...                 **params : <span style="color: #483d8b;">&quot;Keywords parameters rocks&quot;</span><span style="color: black;">&#41;</span> -<span style="color: #66cc66;">&gt;</span> <span style="color: #008000;">list</span>:
...     <span style="color: black;">res</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>param1<span style="color: #66cc66;">,</span> param2<span style="color: black;">&#93;</span>
...     <span style="color: black;">res</span>.<span style="color: black;">extend</span><span style="color: black;">&#40;</span>params<span style="color: black;">&#41;</span>
...     <span style="color: #ff7700;font-weight:bold;">return</span> res
...
<span style="color: #66cc66;">&gt;&gt;&gt;</span> ma_fonction<span style="color: black;">&#40;</span><span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">2</span><span style="color: #66cc66;">,</span> param3<span style="color: #66cc66;">=</span><span style="color: #ff4500;">3</span><span style="color: #66cc66;">,</span> param4<span style="color: #66cc66;">=</span><span style="color: #ff4500;">4</span><span style="color: black;">&#41;</span>
<span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">2</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'param4'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'param3'</span><span style="color: black;">&#93;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> ma_fonction.__annotations__
<span style="color: black;">&#123;</span><span style="color: #483d8b;">'return'</span>: <span style="color: #66cc66;">&lt;</span><span style="color: #ff7700;font-weight:bold;">class</span> <span style="color: #483d8b;">'list'</span><span style="color: #66cc66;">&gt;,</span> <span style="color: #483d8b;">'param1'</span>: <span style="color: #66cc66;">&lt;</span>function <span style="color: #66cc66;">&lt;</span>lambda<span style="color: #66cc66;">&gt;</span> at <span style="color: #ff4500;">0x7f77a2982e60</span><span style="color: #66cc66;">&gt;,</span> <span style="color: #483d8b;">'param2'</span>: <span style="color: #ff4500;">4</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'params'</span>: <span style="color: #483d8b;">'Keywords parameters rocks'</span><span style="color: black;">&#125;</span></pre></td></tr></table></div>

<p>Les lambdas ne peuvent pas être annotées par contre.</p>
<h2>Le potentiel des annotations</h2>
<p>Les annotations sont le cas typique d&#8217;une fonctionnalité bac à sable. En clair, sur la mailling list il y a eu de nombreuses requêtes pour permettre de la vérification de type, de l&#8217;auto documentation, de la translittération et autres joyeusetés.</p>
<p>Ne sachant pas comment répondre de manière propre à ces demandes, ni lesquelles étaient les plus prioritaires, les annotations ont été créées. Le but et de laisser maintenant la communauté fabriquer les outils, et ainsi :</p>
<ul>
<li>Ceux pour les fonctionnalités les plus utilisées seront naturellement priorisées.</li>
<li>Les standards pour les annotations vont émerger par l&#8217;usage, et pas parce que Guido l&#8217;a décidé depuis son bureau au doigt mouillé.</li>
<li>Les fonctionnalités du genre &#8220;je veux un poney&#8221; seront tout simplement ignorées puisque personne ne travaillera suffisamment dessus (quand quelque chose est un caprice, le capricieux se sort rarement les extrémités manuelles de la cavité rectale.)</li>
</ul>
<p>Des outils comme <a href="http://www.fightingquaker.com/pyanno/">pyanno</a> donnaient déjà un exemple de ce que la communauté pouvait désirer. Reste à savoir si ce sera vraiment utilisé. Les gens qui font du Python sont rarement fan du Java. Mais le caractère optionnel de la chose pourrait bien ajouter un vrai plus au langage sans l&#8217;alourdir.</p>
<p>Voici donc ce qu&#8217;on peut attendre des outils tierces parties qui utiliseront les annotations dans le futur :</p>
<h3>Amélioration des performances</h3>
<p>L&#8217;utilisation de <a href="https://rpython.readthedocs.org/en/improve-docs/">RPython</a> pour coder <a href="http://pypy.org/">Pypy</a> a montré que les perfs de Python pouvaient être fantastiques, si on rajoutait quelques annotations. RPython, est, je le rappelle, un subset de Python (donc tout code RPython tourne dans l&#8217;interpréteur Python normal), mais avec des annotations de type, sous forme de commentaires.</p>
<p>On peut donc imaginer que dans le futur, les codes en fort besoin de perfs comme pour l&#8217;embarqué ou le traitement scientifique, pourront ajouter dans les parties clés de l&#8217;algo des annotations pour booster la vitesse ou diminuer la mémoire consommée. On parlerait ici alors d&#8217;annotation de type. <code>int</code>, <code>list</code>, <code>UneClasse</code> sont en effet des expressions Python valides&#8230;</p>
<p>L&#8217;avantage de l&#8217;annotation, c&#8217;est son caractère purement optionnel, qu&#8217;on peut ajouter seulement à certains codes, ou à une partie du code.</p>
<h3>Aide à la saisie</h3>
<p>Les IDE ont du mal avec Python. La complétion du code, l&#8217;aide en popup, la refactorisation automatique et toutes ces joyeusetés sont rarement bien implémentées.</p>
<p>Dans ma vie de tous les jours, je m&#8217;en branle. Je code tellement vite en Python, je ne m&#8217;en aperçois même pas. Mais quand j&#8217;utilise une nouvelle lib, ça peut être utile.</p>
<p>Typiquement, pour un code comme celui de <a href="https://github.com/sametmax/0bin/">0bin</a>, je ne me servirais pas des annotations. Mais pour une lib comme <a href="https://github.com/sametmax/minibelt">minibelt</a>, je prendrais peut être le temps de mettre des annotations de type, pour aider ceux qui vont l&#8217;utiliser. Ou une annotation pour signaler les exceptions que certaines fonctions peuvent lever.</p>
<h3>Génération de documentation</h3>
<p>Certains voient les annotations comme un complément aux docstrings. Ce n&#8217;est pas mon cas, mais je vous le note, au cas où ça devienne une tendance.</p>
<h3>Vérification de Type</h3>
<p>Dans la même lignée de l&#8217;aide à la saisie, pour certaines fonctions (c&#8217;est rare, mais ça arrive), on veut éviter le duck typing et forcer l&#8217;utilisateur à passer un type en particulier. Avoir cette possibilité via les annotations pourraient être utile.</p>
<p>Je suis septique sur cet usage, en effet des libs existent depuis des années pour faire cela, et plus, via des décorateurs, et ça n&#8217;est pas très utilisé. La différence est qu&#8217;un mécanisme standard pourra être détecté par les IDE.</p>
<p>Après on risque d&#8217;avoir des abus pour ce genre de fonctionnalités. Je vois d&#8217;ici arriver les codeurs d&#8217;autres langages caféinés, essayant de pousser l&#8217;usage d&#8217;une annotation rendant des attributs <code>private</code> :-)</p>
<p>Heureusement, les annotations seront normalement pour toujours optionnelles.</p>
<h3>Translittération de code</h3>
<p>Vous avez un code Python et vous voulez le transformer en code Cobol ? Bon, le compilateur de Pypy a déjà le potentiel de le faire, mais avec les annotations, il est potentiellement possible de rajouter suffisamment d&#8217;informations pour qu&#8217;on puisse toujours transformer un code de Python vers un autre langage Turing complet.</p>
<p>J&#8217;ai dit potentiellement.</p>
<h2>Je répète une dernière fois&#8230;</h2>
<p>Les annotations ne font rien. Elles n&#8217;ont pas le but de faire quelque chose et de toute façon sont optionnelles.</p>
<p>Leur but est de permettre à la communauté de créer des nouveaux outils utilisant les annotations et voir lesquels seront les plus utilisés, matures et désirés.</p>
<p>Pour le moment, il n&#8217;y a pas grand chose de fait avec, mais jusqu&#8217;ici Python 3 n&#8217;a pas été très populaire. Cela risque de changer avec 2014 qui propulsera Python 3.4 dans la cour des grands.</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/les-annotations-en-python-3/feed/</wfw:commentRss>
		<slash:comments>12</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2013/11/qyx8R0R.jpg" length="23185" type="image/jpg" />	</item>
		<item>
		<title>Mon premier projet Python3 7</title>
		<link>http://sametmax.com/mon-premier-projet-python3/</link>
		<comments>http://sametmax.com/mon-premier-projet-python3/#comments</comments>
		<pubDate>Thu, 03 Oct 2013 18:37:01 +0000</pubDate>
		<dc:creator><![CDATA[coyote]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[django]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[python 3]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=7281</guid>
		<description><![CDATA[Ceci est un post invité de Coyote posté sous licence creative common 3.0 unported. Et oui, il fallait bien que ça arrive. La genèse Bon, ça avait commencé doucement. Il y a de ça quelques temps (avant même l&#8217;article de Sam), j&#8217;avais configuré mon Sublimissime pour qu&#8217;il me force les import du __futur__. Étant moi-même [&#8230;]]]></description>
				<content:encoded><![CDATA[<blockquote><p>
Ceci est un post invité de <a href="http://sametmax.com/author/coyote/">Coyote</a> posté sous licence <a href="http://creativecommons.org/licenses/by/3.0/">creative common 3.0 unported</a>.
</p></blockquote>
<p>Et oui, il fallait bien que ça arrive.</p>
<h3>La genèse</h3>
<p>Bon, ça avait commencé doucement. Il y a de ça quelques temps (avant même l&#8217;article de Sam), j&#8217;avais configuré mon Sublimissime pour qu&#8217;il me force les <code>import</code> du <code>__futur__</code>.<br />
Étant moi-même un peu un nazi de la convention de code, ça ne m&#8217;a pas dérangé plus que cela: les keyword <code>print</code> et autres sont pas trop ma tasse de thé. Par contre, c&#8217;est vrai que ça m&#8217;a un peu forcé la main sur les import relatifs, que j&#8217;utilisais visiblement un peu trop.</p>
<p>Récemment, sur un autre projet, je me dis “allez, je passe à la syntaxe <code>"hello {}".format("world")</code> au lieu des <code>"hello" % "world"</code>” puisque c&#8217;est ce qui est désormais recommandé. Bon, c&#8217;est un peu chiant au début mais on s&#8217;y fait vite.</p>
<p>Aussi, j&#8217;ai adopté la suppression des prefix <strong>u</strong> devant les strings. Je sais qu&#8217;avec Python 3.3 on peut à nouveau les utiliser, mais vraiment, j&#8217;ai toujours trouvé ça moche et insupportable, alors je suis <strong>très</strong> content de ne plus avoir à me les farcir.<br />
Que ceux que je vois râler me disent comment ils justifient qu&#8217;avec ce temple de la simplicité et de la lisibilité qu&#8217;est Python, on doivent préfixer toutes nos chaines par des petits <code>u</code> ridicules.</p>
<p>Voilà pour l&#8217;historique, lentement mais surement, je me préparais à prendre peut-être de bonnes habitudes pour le jour (très) lointain ou Python3 deviendrait réalité.</p>
<p>Et c&#8217;est là que mon collègue, un pervers à lunettes, nous propose d&#8217;utiliser PY3 pour de vrai, sur un nouveau projet.</p>
<p>C&#8217;est vrai que le projet s&#8217;y prêtait bien: un petit site web de CRUD avec Django. On s&#8217;est gratté le menton deux minutes et puis on s&#8217;est dit “pourquoi pas ?”.</p>
<h3>Par où commencer ?</h3>
<p>C&#8217;est con hein, mais la première chose que tu fais, c&#8217;est te demander qu&#8217;est ce qui change entre PY2 et PY3.<br />
Et bien la réponse est pas simple du tout et si tu crois que tu vas trouver une URL avec une liste de chose à changer, tu te trompes lourdement.</p>
<p>Le problème est que PY3.0 avait sans doute dû être fini à la pisse et que donc les choses ont beaucoup évoluées entre 3.0, 3.1, 3.2 et 3.3. J&#8217;ai lu beaucoup de posts sans importance sur toutes ces étapes intermédiaires, mais la conclusion, c&#8217;est que grosso-modo, il faut passer de 2.7 à 3.3. Entre les deux, c&#8217;est un peu comme naitre au <a href="https://fr.wikipedia.org/wiki/Sahara_Occidental">Sahara Occidental</a>.</p>
<h3>Installer PY3.3</h3>
<p>Comme on travaille en équipe, on a des setup différents: OSX, Ubuntu 12.04 et Ubuntu 13.04.</p>
<p>Ça c&#8217;est passé sans douleur malgré les appréhensions. Pour Ubuntu, il suffit d&#8217;utiliser le <a href="https://launchpad.net/~fkrull/+archive/deadsnakes">ppa deadsnakes</a>.<br />
Une fois installé, un coup de <em>virtualenv</em> (<code>mkvirtualenv -p /usr/bin/python3.3 monenv3</code>) et c&#8217;est parti.</p>
<h3>Les dépendances</h3>
<p>Comme expliqué plus haut, on a choisi de faire ce projet en PY3 parce qu&#8217;il est petit et sans dépendances ; donc pas très représentatif.<br />
Cependant, on utilise:<br />
<code>Django==1.5.4<br />
South==0.8.2<br />
django-mptt==0.6.0<br />
django-picklefield==0.3.0<br />
numpy==1.7.1<br />
unicodecsv*</code></p>
<p>Aucun problème avec ceux là. On a cru que South nous faisait des misères mais en fait c&#8217;était un import relatif avec un <code>pass</code> de cochon qui foutait la merde (<code>try: from local_settings import * except ImportError: pass</code>.<br />
Donc la leçon ici, c&#8217;est que <strong>les imports relatifs c&#8217;est mal</strong>.</p>
<p>Au niveau des dépendances, on a du se séparer de batbelt. Oui, je parle bien de <a href="https://github.com/sametmax/Bat-belt">sametmax/Bat-Belt</a> qui n&#8217;est pas du tout PY3 proof. Ne pleurez pas, moi aussi j&#8217;ai été très déçu et j&#8217;attends des explications (foireuses, je les vois venir d&#8217;ici).</p>
<p>Bref, comme on utilise batbelt pour presque rien, on a copié honteusement (<a href="https://en.wikipedia.org/wiki/Zlib_License">ou pas</a>) le code nécessaire.</p>
<p>Dernière remarque, vous voyez dans la liste <code>unicodecsv</code>. C&#8217;est un peu tricky puisque PY3 supporte unicode par défaut, le module <code>csv</code> de PY3 fonctionne directement ; et de fait, <code>unicodecsv</code> n&#8217;existe plus. Oui, je me suis fait avoir comme un débutant.<br />
Bref, comme on souhaite aussi supporter PY2 et pas uniquement PY3, on a un beau <code>if PY2: import unicodecsv as csv else: import csv</code>.</p>
<h3>Les problèmes</h3>
<p>Peu nombreux je dois dire et c&#8217;est plutôt encourageant. De tête:</p>
<ul>
<li>Fini les <code>__unicode__()</code> dans les modèles Django.<br />
Pour gérer ce cas à la con, on utilise ce <a href="https://raw.github.com/mitsuhiko/jinja2/master/jinja2/_compat.py">fichier _compat de Jinja2</a>. Je vous encourage à le copier, il défini notamment la variable PY2 pratique pour switcher comme le cas du csv ci-dessus.<br />
Bref, dans ce _compat, il y a un class decorator <code>implements_to_string</code> qui permet de ne définir que <code>__str__()</code> (renvoie de l&#8217;unicode) et le reste est géré automatiquement.<br />Django propose la même chose via <code>django.utils.encoding.python_2_unicode_compatible</code> mais je préfère la toolbox Jinja.</li>
<li>J&#8217;ai parlé dans les dépendances du cas <code>unicodecsv</code>. Ici c&#8217;était le seul, mais clairement dans beaucoup de projet qui manipulent des stream ou des fichiers, il va falloir faire ce genre de combines pour suporter PY2 et PY3.</li>
<li>Un edge case très rigolo (après coup!) avec le <code>django-picklefield</code>. Le field se comportait correctement avec PY3 mais pas avec PY2 et pas dans tous les cas. Du bonheur à <s>tariner</s>déboguer.<br />Pour l&#8217;anecdote: <code><br />
x = MyModel(id=1)<br />
x.picklefield = [1,2,3]<br />
x.save()</p>
<p>x = MyModel(id=2)<br />
x.picklefield = {'a': 1, 'b': 3}<br />
x.save()</code><br />
Ce code fonctionne bien avec PY3, mais avec PY2, le fait de réutiliser le même nom de variable rend le PickleField tout chose et donc il sérialise deux fois la valeur passée. Encore une fois, <strong>la leçon ici est d&#8217;être rigoureux</strong>.</li>
<li>Les fonctions du type <code>dict.keys()</code> et assimilés ne renvoient plus de listes, mais ont été remplacés par leur équivalents générateurs (<code>dict.iterkeys()</code>) et ceux-ci n&#8217;existent plus. Donc un peu de gymnastique syntaxique quand on est habitué à l&#8217;ancienne syntaxe.</li>
<li>Numpy refusait de s&#8217;installer sur certaines versions d&#8217;Ubuntu (je me souviens plus laquelle) car il ne trouvait pas un des headers de Python. C&#8217;est du au fait qu&#8217;il cherche ce header dans le même répertoire que le header précédent alors qu&#8217;il est stocké ailleurs. Un symlink fait l&#8217;affaire.</li>
<li>Enfin, le dernier problème, qui va réveler que <strong>tout ceci n&#8217;est qu&#8217;une imposture</strong>: <code>chaussette</code> et <code>circus</code> que j&#8217;utilise pour le déploiement ne sont pas compatibles PY3 !! Pas de debug ici, ça ne s&#8217;installe même pas. Résulalt: <strong>on a déployé en PY 2.7</strong>. Bon, pour vous consoler (et moi avec), le github de ces 2 projets est plein de commits récents en rapport avec PY3 donc j&#8217;imagine que ça ne saurait tarder.</li>
</ul>
<h3>Conclusion</h3>
<p>Et bien, on a un petit projet développé à plusieurs, en PY3.3, qui est déployé en PY2.7 donc c&#8217;est possible ; on a pas rencontré de grande difficultées donc je pense que pour du web, c&#8217;est pas loin d&#8217;être mûr.</p>
<p><strong>Pas grand chose à dire</strong> finalement, et c&#8217;est sans doute ça le plus important !</p>
<p>Allez bookmarker le site <a href="http://python3porting.com">python3porting</a> qui contient les infos sur ce qui a changé. Ca a l&#8217;air long mais en fait, y&#8217;a beaucoup de cas spécifiques.</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/mon-premier-projet-python3/feed/</wfw:commentRss>
		<slash:comments>7</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2013/10/28-manipulations-photographiques-brillantes-qui-vous-feront-rever9.jpg" length="163962" type="image/jpg" />	</item>
		<item>
		<title>Dois-je apprendre Python 2 ou Python 3 ? 23</title>
		<link>http://sametmax.com/dois-je-apprendre-python-2-ou-python-3/</link>
		<comments>http://sametmax.com/dois-je-apprendre-python-2-ou-python-3/#comments</comments>
		<pubDate>Wed, 12 Sep 2012 13:57:39 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Philo et culture]]></category>
		<category><![CDATA[Programmation]]></category>
		<category><![CDATA[migration]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[python 3]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=2098</guid>
		<description><![CDATA[Les deux versions étant incompatibles, et Python 3 ayant plein de super fonctionnalités que Python 2 n'a pas, mais la V2 étant encore très rependue, on peut se demander lequel on doit apprendre.]]></description>
				<content:encoded><![CDATA[<p>J&#8217;ai écris cet artice en 2012. La réponse a depuis changé :</p>
<p><strong>Apprenez Python 3.</strong></p>
<p>Il est plus simple, plus élégant, plus mieux.</p>
<p>Installez minimum Python 3.4, si possible.</p>
<p>Quelques exceptions à cette règle :</p>
<ul>
<li>Vous planifier d&#8217;utiliser une lib en rouge dans <a href="http://python3wos.appspot.com/">cette liste</a>.</li>
<li>Vous savez que vous allez bosser essentiellement sur du vieux code dans votre boîte.</li>
</ul>
<p>Rappelez-vous qu&#8217;il est facile d&#8217;installer et utiliser Python 2 et 3 sur la même machine. Et un virtualenv peut contenir une version de Python particulière. Le choix de l&#8217;un n&#8217;exclus donc pas l&#8217;autre pour plus tard. On peut même écrire un code qui marche sur Python 2 ET Python 3 aujourd&#8217;hui. C&#8217;est moche, mais ça marche :)</p>
<p>Donc, bonjour Python 3 avec pip et venv installés par défaut, les accents qui marchent out of the box, pas de bizarreries qui traînent comme des noms incohérents et <code>object</code>&#8230;</p>
<p>Mac et Linux ont la 2.7 par défaut installé, mais ça se règle avec un coup de homebrew, apt-get install, yum install, etc. N&#8217;ayez pas peur.</p>
<p>Mon ancien article n&#8217;est donc plus valable.</p>
<p><del>Les deux versions étant incompatibles, et Python 3 ayant plein de super fonctionnalités que Python 2 n&#8217;a pas, mais la V2 étant encore très répandue, on peut se demander lequel on doit apprendre.</del></p>
<h2><del>Etat du lard</del></h2>
<p><del>Python 3 permet de s&#8217;affranchir de beaucoup de problèmes d&#8217;encoding en utilisant unicode par défaut. A partir de la version 3.3, il va venir avec un <a href="sametmax.com/les-environnement-virtuels-python-virtualenv-et-virtualenvwrapper">virtualenv</a> intégré, et distutils2, rendant le packaging et le déploiement beaucoup plus simple. Sans compter la délégation à un sous générateur. Plus besoin non plus d&#8217;utiliser &#8216;object&#8217; dans l&#8217;héritage, et des tas de libs nettoyées. Bref, un comportement plus simple et un langage plus beau.</del></p>
<p><del>Python 2 lui est néanmoins présent encore partout:</del></p>
<ul>
<li><del>Ubuntu est toujours en 2.7, et <a href="https://wiki.ubuntu.com/Python/3">passera en 3 dans la prochaine version,</a> mais laissant la possibilité d&#8217;installer la 2.</del></li>
<li><del>Mac OS utilise toujours la 2.6 par défaut.</del></li>
<li><del>Certains serveurs Web sont toujours en 2.4 (!) si bien que Max  recompile carrément Python 2.6 dessus (oui, c&#8217;est un acharné).</del></li>
<li><del>Django est en phase de <a href="https://www.djangoproject.com/weblog/2012/mar/13/py3k/">transition version Python 3</a>, mais pour le moment ce n&#8217;est pas fait, et il sera toujours compatible avec Python 2.7 pour les deux prochaines versions.</del></li>
<li><del>Une bonne partie des libs sur pypi et sur github sont <a href="http://python3wos.appspot.com/">toujours en Python 2</a>, ou au moins compatibles avec.</del></li>
</ul>
<p><del>Enfin, l&#8217;outil <a href="http://docs.python.org/library/2to3.html">2to3</a> permet de convertir automatiquement, et facilement, la plupart des codes de Python 2 vers Python 3.</del></p>
<h2><del>Apprentissage et usage</del></h2>
<p><del>Dans la vie de tous les jours, en tant que programmeur Python, vous allez donc forcément être confronté à Python 2 pendant encore 3 ou 4 ans. Je rappelle que Python 2.4 était encore assez courant il y a deux ans, et qu&#8217;il y a 5 ans je lisais encore des questions sur les fora concernant Python 2.2.</del></p>
<p><del>Or, Python 2 est plus compliqué que Python 3, il demande des connaissances particulières: gérer l&#8217;encoding, setuper son virtualenv, faire gaffe à bien utiliser &#8216;object&#8217;, connaitre les noms des libs mal standardisés, etc.</del></p>
<p><del>Dans tous les cas, il sera toujours <strong>beaucoup</strong> plus simple d&#8217;apprendre Python 2 et de passer à Python 3 que l&#8217;inverse, et il est improbable que vous n&#8217;ayez pas besoin de toucher un code en Python 2. Hey, nous même, nous codons encore tous nos projets en Python 2. On se posera la question de la migration quand Django l&#8217;aura fait, et même là, on aura des tas de projets qui resteront pour toujours en V2.</del></p>
<p><del>Donc, si vous apprenez (ou enseignez le Python)<strong>, le choix le plus pragmatique est d&#8217;apprendre avec Python 2, et de rajouter l&#8217;apprentissage des différences entre la V2 et la V3</strong>. Ce faisant vous saurez aussi comment faire migrer un projet, ce dont il est possible que vous ayez un jour besoin.</del></p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/dois-je-apprendre-python-2-ou-python-3/feed/</wfw:commentRss>
		<slash:comments>23</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2012/09/6a0120a85dcdae970b01287770a775970c.jpg" length="42754" type="image/jpg" />	</item>
	</channel>
</rss>
