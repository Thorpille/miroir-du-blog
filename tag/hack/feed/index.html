<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Sam &#38; Max &#187; hack</title>
	<atom:link href="http://sametmax.com/tag/hack/feed/" rel="self" type="application/rss+xml" />
	<link>http://sametmax.com</link>
	<description>Du code, du cul</description>
	<lastBuildDate>Sat, 07 Nov 2015 10:56:13 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=4.1</generator>
	<item>
		<title>Apprendre le python en 10 ans&#8230; 29</title>
		<link>http://sametmax.com/apprendre-le-python-en-10-ans/</link>
		<comments>http://sametmax.com/apprendre-le-python-en-10-ans/#comments</comments>
		<pubDate>Fri, 08 Nov 2013 06:31:12 +0000</pubDate>
		<dc:creator><![CDATA[01ivier]]></dc:creator>
				<category><![CDATA[Philo et culture]]></category>
		<category><![CDATA[apprentissage]]></category>
		<category><![CDATA[hack]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=7660</guid>
		<description><![CDATA[
Il y a quelques années, esseulé devant 1 millions de pixels noctures, j'ai tapé <em>"Comment devenir un hacker ?"</em> dans un monopolisant moteur de recherche...
Comme ça...
Pour déconner...]]></description>
				<content:encoded><![CDATA[<p style="text-align: center;"><em><small>Ceci est un post invité de <a href="http://sametmax.com/author/01ivier/">01ivier</a> posté sous licence <a href="http://creativecommons.org/licenses/by/3.0/">creative common 3.0 unported</a>.</small></em></p>
<p>Il y a quelques années, esseulé devant 1 millions de pixels noctures, j&#8217;ai tapé <em>&#8220;Comment devenir un hacker ?&#8221;</em> dans un monopolisant moteur de recherche&#8230;<br />
Comme ça&#8230;<br />
Pour déconner&#8230;</p>
<p>Je suis alors tombé sur le texte &#8220;<a href="http://www.tice.ac-versailles.fr/logicielslibres/IMG/devenir_hacker.pdf">Comment devenir un hacker ?</a>&#8221; d&#8217;Eric Steven Raymond.</p>
<p>Après quelques instants dubitatifs où j&#8217;ai pris conscience que si j&#8217;avais écrit <em>&#8220;Comment planter des choux ?&#8221;</em> ou autres <em>&#8220;Comment dessiner un poulet en contre-plongée ?&#8221;</em> je serai certainement tombé sur un document du même nom, j&#8217;ai commencé à lire le texte en question.<br />
Mais ce n&#8217;est que plusieurs mois après que j&#8217;en suis venu à bout.</p>
<p>En effet, arrivé à la partie <em>&#8220;Apprenez à programmer&#8221;</em>, j&#8217;ai non seulement réalisé que je ne savais pas vraiment programmer mais surtout que je pouvais dès à présent mettre à l&#8217;épreuve ma théorie sur les choux et les poulets.<br />
J&#8217;ai donc cherché <em>&#8220;Comment apprendre à programmer ?&#8221;</em> et j&#8217;ai fini par tomber sur l&#8217;article &#8220;<a href="http://www.vizmatic.com/apprenez-a-programmer-en-dix-ans/lang/fr">Apprendre à programmer en 10 ans ?</a>&#8221;</p>
<p>Celui-là, je l&#8217;ai lu en entier et d&#8217;une seule traite.<br />
Mais le titre seulement avait suffit à me décomplexer pour deux ou trois vies.</p>
<h2>Comment acquérir une compétence en 10 ans?</h2>
<p>Quelle évidence !<br />
Tout me paraissait bien plus envisageable en me donnant 10 ans pour y arriver&#8230;<br />
Je veux apprendre l&#8217;espagnol ? Et bien je ferai le bilan dans 10 ans&#8230;<br />
Pas besoin de culpabiliser parce que je n&#8217;ai pas fait la page du jour de la méthode à Mimile&#8230;</p>
<p>Il devait être 1h du matin et je me suis dit :<br />
<em>&#8220;Et si j&#8217;apprenais le Python&#8230;&#8221;</em><br />
J&#8217;avais 10 ans devant moi, mais ce n&#8217;était pas une raison pour perdre du temps.</p>
<p>À 6h, j&#8217;avais donc bouclé la première partie du tuto &#8220;<a href="http://www.siteduzero.com/tutoriel-3-223267-apprendre-python.html">Apprendre le Python</a>&#8221; du site du zéro et entamé la seconde&#8230;</p>
<p>Maintenant, vous vous demandez peut-être, si, trois an plus tard, je connais le Python&#8230;<br />
Et bien je vous dirais ça dans sept ans&#8230; :-)</p>
<h2>Hello world !</h2>
<p>En attendant, j&#8217;ai proposé à Sam et Max de poster quelques articles de temps en temps&#8230;<br />
Je ne suis pas du tout developpeur, mais je n&#8217;ai aucun scrupule à écrire des lignes de code&#8230; encore moins à publier ma prose de cochon&#8230;</p>
<p>Sachant qu&#8217;il est tout à fait possible d&#8217;obtenir des résultats enthousiasmants avec du code bancal, je me propose donc de décomplexer les débutants en publiant des articles de mauvais élève&#8230;<br />
Nulle doute que les lecteurs avertis de S&#038;M sauront, par leurs commentaires avisés, réhausser le niveau technique de mes posts afin de les rendre aussi instructifs que ceux déjà disponibles sur ce blog&#8230;</p>
<p>À bientôt&#8230;</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/apprendre-le-python-en-10-ans/feed/</wfw:commentRss>
		<slash:comments>29</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2013/11/carbre.jpg" length="140603" type="image/jpg" />	</item>
		<item>
		<title>Capturer l&#8217;affichage des prints d&#8217;un code Python 8</title>
		<link>http://sametmax.com/capturer-laffichage-des-prints-dun-code-python/</link>
		<comments>http://sametmax.com/capturer-laffichage-des-prints-dun-code-python/#comments</comments>
		<pubDate>Sat, 29 Sep 2012 14:03:36 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[context manager]]></category>
		<category><![CDATA[hack]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[with]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=2343</guid>
		<description><![CDATA[Hier j’ai eu rencontré le travail d’une de ces fameuses personnes qui pensent que la réutilisabilité c’est pour les pédés, et qui font des scripts dont la moitié des infos renvoyées sont printées au milieu de blocs de code de 50 lignes, sans possibilité de les récupérer.]]></description>
				<content:encoded><![CDATA[<p>Hier j&#8217;ai eu rencontré le travail d&#8217;une de ces fameuses personnes qui pensent que la ré-utilisabilité c&#8217;est pour les pédés, et qui font des scripts dont la moitié des infos renvoyées sont printées au milieu de blocs de code de 50 lignes, sans possibilité de les récupérer.</p>
<p>Heureusement, avec un petit hack, on peut capturer ce qu&#8217;affiche un autre code, et sauver le bébé, l&#8217;eau du bain, et même le canard en plastique.</p>
<h2>Le code pour les gens pressés</h2>
<p>J&#8217;ai enrobé l&#8217;astuce dans un <a href="http://sametmax.com/les-context-managers-et-le-mot-cle-with-en-python/">context manager</a>, ça rend l&#8217;utilisation plus simple.</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">sys</span>
<span style="color: #ff7700;font-weight:bold;">from</span> io <span style="color: #ff7700;font-weight:bold;">import</span> BytesIO
<span style="color: #ff7700;font-weight:bold;">from</span> contextlib <span style="color: #ff7700;font-weight:bold;">import</span> contextmanager
&nbsp;
<span style="color: #66cc66;">@</span>contextmanager
<span style="color: #ff7700;font-weight:bold;">def</span> capture_ouput<span style="color: black;">&#40;</span>stdout_to<span style="color: #66cc66;">=</span><span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> stderr_to<span style="color: #66cc66;">=</span><span style="color: #008000;">None</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">try</span>:
&nbsp;
        stdout<span style="color: #66cc66;">,</span> stderr <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">sys</span>.<span style="color: black;">stdout</span><span style="color: #66cc66;">,</span> <span style="color: #dc143c;">sys</span>.<span style="color: black;">stderr</span>
        <span style="color: #dc143c;">sys</span>.<span style="color: black;">stdout</span> <span style="color: #66cc66;">=</span> c1 <span style="color: #66cc66;">=</span> stdout_to <span style="color: #ff7700;font-weight:bold;">or</span> BytesIO<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #dc143c;">sys</span>.<span style="color: black;">stderr</span> <span style="color: #66cc66;">=</span> c2 <span style="color: #66cc66;">=</span> stderr_to <span style="color: #ff7700;font-weight:bold;">or</span> BytesIO<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">yield</span> c1<span style="color: #66cc66;">,</span> c2
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">finally</span>:
&nbsp;
        <span style="color: #dc143c;">sys</span>.<span style="color: black;">stdout</span> <span style="color: #66cc66;">=</span> stdout
        <span style="color: #dc143c;">sys</span>.<span style="color: black;">stderr</span> <span style="color: #66cc66;">=</span> stderr
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            c1.<span style="color: black;">flush</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
            c1.<span style="color: black;">seek</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: black;">&#40;</span><span style="color: #008000;">ValueError</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">IOError</span><span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">pass</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            c2.<span style="color: black;">flush</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
            c2.<span style="color: black;">seek</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: black;">&#40;</span><span style="color: #008000;">ValueError</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">IOError</span><span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">pass</span></pre></td></tr></table></div>

<p>Notez l&#8217;usage de <a href="http://sametmax.com/comment-utiliser-yield-et-les-generateurs-en-python/">yield</a>.</p>
<p>Et ça s&#8217;utilise comme ça:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">with</span> capture_output<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> stdout<span style="color: #66cc66;">,</span> stderr:
    fonction_qui_fait_que_printer_la_biatch<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">print</span> stdout.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># on récupère le contenu des prints</span></pre></td></tr></table></div>

<p>Attention, le code n&#8217;est pas thread safe, c&#8217;est fait pour hacker un code crade, pas pour devenir une institution. Mais c&#8217;est fort pratique dans notre cas précis.</p>
<h2>Comment ça marche ?</h2>
<p><code>stdin</code> (entrée standard), <code>stdout</code> (sortie standard) et <code>stderr</code> (sortie des erreurs) sont des file like objects, c&#8217;est à dire qu&#8217;ils implémentent l&#8217;interface d&#8217;un objet fichier: on peut les ouvrir, les lire, y écrire et les fermer avec des méthodes portant le même nom et acceptant les mêmes paramètres.</p>
<p>L&#8217;avantage d&#8217;avoir une interface commune, c&#8217;est qu&#8217;on peut du coup échanger un file like objet par un autre.</p>
<p>Par exemple on peut faire ceci:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">sys</span>
log <span style="color: #66cc66;">=</span> <span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'/tmp/log'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'w'</span><span style="color: black;">&#41;</span>
<span style="color: #dc143c;">sys</span>.<span style="color: black;">stdout</span> <span style="color: #66cc66;">=</span> log <span style="color: #808080; font-style: italic;"># hop, on hijack la sortie standard</span>
<span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;Hello&quot;</span>
log.<span style="color: black;">close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>Comme <code>print</code> écrit dans <code>stdout</code>, en remplaçant <code>stdout</code> par un fichier, <code>print</code> va du coup écrire dans le fichier.</p>
<p>Mais ce code est fort dangereux, car il remplace <code>stdout</code> de manière définitive. Du coup, si du code <code>print</code> après, il va écrire dans le fichier, même les libs externes, car <code>stdout</code> est le même pour tout le monde dans le process Python courant.</p>
<p>Du coup, il est de bon ton de s&#8217;assurer la restauration de <code>stdout</code> à son état d&#8217;origine:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">sys</span>
log <span style="color: #66cc66;">=</span> <span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'/tmp/log'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'w'</span><span style="color: black;">&#41;</span>
bak <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">sys</span>.<span style="color: black;">stdout</span> <span style="color: #808080; font-style: italic;"># on sauvegarde l'ancien stdout</span>
<span style="color: #dc143c;">sys</span>.<span style="color: black;">stdout</span> <span style="color: #66cc66;">=</span> log
<span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;Hello&quot;</span>
log.<span style="color: black;">close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #dc143c;">sys</span>.<span style="color: black;">stdout</span> <span style="color: #66cc66;">=</span> bak <span style="color: #808080; font-style: italic;"># on restore stdout</span></pre></td></tr></table></div>

<p>Comme je le disais plus haut, ceci n&#8217;est évidement pas thread safe, puisqu&#8217;entre la hijacking et la restoration de <code>stdout</code>, un autre thread peut faire un <code>print</code>.</p>
<p>Dans notre context manager, on utilise <code>BytesIO()</code> et non un fichier. <code>BytesIO</code> est un file like objet qui permet de récupérer un flux de bits en mémoire. Donc on fait écrire <code>print</code> dedans, ainsi on a tout ce qu&#8217;on affiche qui se sauvegarde en mémoire.</p>
<p>Bien entendu, vous pouvez créé vos propres file like objects, par exemple un objet qui affiche à l&#8217;écran ET capture la sortie. Par exemple, pour mitiger le problème de l&#8217;absence de thread safe: 99% des libs n&#8217;ont pas besoin du vrai <code>stdout</code>, juste d&#8217;un truc qui <code>print</code>.</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">sys</span>
<span style="color: #ff7700;font-weight:bold;">from</span> io <span style="color: #ff7700;font-weight:bold;">import</span> BytesIO
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> PersistentStdout<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    old_stdout <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">sys</span>.<span style="color: black;">stdout</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">memory</span> <span style="color: #66cc66;">=</span> BytesIO<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> write<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> s<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">memory</span>.<span style="color: black;">write</span><span style="color: black;">&#40;</span>s<span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">old_stdout</span>.<span style="color: black;">write</span><span style="color: black;">&#40;</span>s<span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
old_stdout <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">sys</span>.<span style="color: black;">stdout</span>
<span style="color: #dc143c;">sys</span>.<span style="color: black;">stdout</span> <span style="color: #66cc66;">=</span> PersistentStdout<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;test&quot;</span> <span style="color: #808080; font-style: italic;"># ceci est capturé et affiché</span>
&nbsp;
<span style="color: #dc143c;">sys</span>.<span style="color: black;">stdout</span>.<span style="color: black;">memory</span>.<span style="color: black;">seek</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#41;</span>
res <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">sys</span>.<span style="color: black;">stdout</span>.<span style="color: black;">memory</span>.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #dc143c;">sys</span>.<span style="color: black;">stdout</span> <span style="color: #66cc66;">=</span> PersistentStdout.<span style="color: black;">old_stdout</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">print</span> res <span style="color: #808080; font-style: italic;"># résultat de la capture</span></pre></td></tr></table></div>

<p>Pour cette raison le code du context manager permet de passer le file like objet à utiliser en argument. On notera aussi que si on souhaite rediriger <code>stdout</code> mais pas <code>stderr</code> et <a href="https://www.youtube.com/watch?v=WousdWP-5vY">vice-versa</a>, il suffit de passer <code>sys.stdout</code> et <code>sys.stderr</code> en argument :-)</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/capturer-laffichage-des-prints-dun-code-python/feed/</wfw:commentRss>
		<slash:comments>8</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2012/09/belkin-f8v234eawht-apl.jpg" length="12571" type="image/jpg" />	</item>
	</channel>
</rss>
