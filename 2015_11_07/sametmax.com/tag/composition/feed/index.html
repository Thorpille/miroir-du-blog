<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Sam &#38; Max &#187; composition</title>
	<atom:link href="http://sametmax.com/tag/composition/feed/" rel="self" type="application/rss+xml" />
	<link>http://sametmax.com</link>
	<description>Du code, du cul</description>
	<lastBuildDate>Sat, 07 Nov 2015 10:56:13 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=4.1</generator>
	<item>
		<title> Le guide ultime et définitif sur la programmation orientée objet en Python à l’usage des débutants qui sont rassurés par les textes détaillés qui prennent le temps de tout expliquer. Partie 5. 58</title>
		<link>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-5/</link>
		<comments>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-5/#comments</comments>
		<pubDate>Mon, 11 Feb 2013 17:38:28 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[composition]]></category>
		<category><![CDATA[heritage]]></category>
		<category><![CDATA[poo]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=4495</guid>
		<description><![CDATA[La POO, c'est comme les poupées russes. Une fois qu'on a maîtrisé un concept, paf, y en a un autre qui se ramène derrière.
]]></description>
				<content:encoded><![CDATA[<p>Maestro, musique !</p>

<!-- iframe plugin v.2.9 wordpress.org/plugins/iframe/ -->
<iframe width="420" height="315" src="http://www.youtube.com/embed/XWE_VC9DpK0" frameborder="0" scrolling="no" class="iframe-class"></iframe>

<p>Prérequis :</p>
<ul>
<li>Avoir lu la <a href="http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-4/">partie 4</a>.</li>
<li>Etre bien au point sur la notion de <a href="http://sametmax.com/valeurs-et-references-en-python/">références</a>.</li>
</ul>
<p>La POO, c&#8217;est comme les poupées russes. Une fois qu&#8217;on a maîtrisé un concept, paf, y en a un autre qui se ramène derrière.</p>
<h2>J&#8217;ai plusieurs mamans</h2>
<p>En ces temps de polémique sur l&#8217;autorisation du mariage entre êtres amoureux et consentants (par opposition à celui qu&#8217;on fait par convention sociale depuis des siècles), je vous propose de vous rappeler qu&#8217;une fois de plus les informaticiens sont en avance sur les mœurs.</p>
<p>D&#8217;abord parce qu&#8217;une communauté qui fait autant de links vers <a href="http://www.yougotrickrolled.com/">Never Gona Give You Up</a> est forcément pro gay par essence. Ensuite parce qu&#8217;une classe fille peut avoir plusieurs classes mères sans que ça choque personne.</p>
<p>Prenez ces deux classes qui passaient par là sans rien demander :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> MouMoutte<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #008000;">type</span> <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'top'</span> <span style="color: #808080; font-style: italic;"># c'est tip top moumoutte</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Raoul<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    trop <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'cool'</span></pre></td></tr></table></div>

<p>Hé merde, j&#8217;ai écris ça, et maintenant j&#8217;ai aucune idée de comment faire un code cohérent à partir de cet exemple à la con.</p>
<p>On annule tout.</p>
<p>On recommence.</p>
<p>Vous faites un jeu vidéo. Ça, ça parle bien. Et dedans vous avez des protections et des armes.</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Arme<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nom<span style="color: #66cc66;">,</span> degat<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">nom</span> <span style="color: #66cc66;">=</span> nom
        <span style="color: #008000;">self</span>.<span style="color: black;">degat</span> <span style="color: #66cc66;">=</span> degat
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> attaque<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> cible<span style="color: black;">&#41;</span>: <span style="color: #808080; font-style: italic;"># on retire les degâts de l'épee des points de vie</span>
        cible.<span style="color: black;">vie</span> -<span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">degat</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Protection<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nom<span style="color: #66cc66;">,</span> armure<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">nom</span> <span style="color: #66cc66;">=</span> nom
        <span style="color: #008000;">self</span>.<span style="color: black;">armure</span> <span style="color: #66cc66;">=</span> armure
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> defend<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> degat<span style="color: black;">&#41;</span>: <span style="color: #808080; font-style: italic;"># on diminue les degâts, voire on les annule</span>
&nbsp;
        degat <span style="color: #66cc66;">=</span> degat - <span style="color: #008000;">self</span>.<span style="color: black;">armure</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> degat <span style="color: #66cc66;">&lt;</span> <span style="color: #ff4500;">0</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #ff4500;">0</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> degat
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> epee <span style="color: #66cc66;">=</span> Arme<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Epée Mana'</span><span style="color: #66cc66;">,</span> degat<span style="color: #66cc66;">=</span><span style="color: #ff4500;">999</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> casque <span style="color: #66cc66;">=</span> Protection<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Casque de Balduran'</span><span style="color: #66cc66;">,</span> armure<span style="color: #66cc66;">=</span><span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>C&#8217;est simpliste, mais vous voyez le tableau. Maintenant un connard de client arrive et vous sort une idée trop cool : il faudrait ajouter un barbare dans le jeu. Qui tape aussi avec son bouclier, parce que la concurrence le fait et qu&#8217;ils veulent pas se faire mettre un vent par Blizzard.</p>
<p>Enfer et Rutabaga ! Comment allons nous nous sortir de cette situation ?</p>
<p>Il y a moult manières de faire, mais l&#8217;une d&#8217;elle est d&#8217;utiliser l&#8217;<strong>héritage multiple</strong>, c&#8217;est-à-dire de créer une classe qui hérite des deux classes en même temps.</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> ProtectionOffensive<span style="color: black;">&#40;</span>Arme<span style="color: #66cc66;">,</span> Protection<span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nom<span style="color: #66cc66;">,</span> degat<span style="color: #66cc66;">,</span> armure<span style="color: black;">&#41;</span>:
&nbsp;
        Arme.<span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nom<span style="color: #66cc66;">,</span> degat<span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># appelle le __init__ de arme</span>
        Protection.<span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nom<span style="color: #66cc66;">,</span> armure<span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># appelle le __init de protection</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># comme on a appelé les deux __init__, on va avoir les attributs</span>
        <span style="color: #808080; font-style: italic;"># settés dans les deux __init__ attachés à cette classe</span></pre></td></tr></table></div>

<p>Nous avons alors une classe qui possède les méthodes des deux classes parentes :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> bouclier <span style="color: #66cc66;">=</span> ProtectionOffensive<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Bouclier du dragon'</span><span style="color: #66cc66;">,</span> degat<span style="color: #66cc66;">=</span><span style="color: #ff4500;">10</span><span style="color: #66cc66;">,</span> armure<span style="color: #66cc66;">=</span><span style="color: #ff4500;">100</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> bouclier.<span style="color: black;">degat</span>
<span style="color: #ff4500;">10</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> bouclier.<span style="color: black;">armure</span>
<span style="color: #ff4500;">100</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> bouclier.<span style="color: black;">defend</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">10</span><span style="color: black;">&#41;</span>
<span style="color: #ff4500;">0</span></pre></td></tr></table></div>

<p>Ne cherchez pas compliqué, ça fait exactement ce que ça à l&#8217;air de faire : &#8220;copier&#8221; (oui bon, entre guillemets) le code de chaque parent dans l&#8217;enfant.</p>
<p>Néanmoins vous avez vu qu&#8217;il y a quelques subtilités, notamment la partie <code>__init__</code>.</p>
<p>Posez-vous deux minutes. Respirez. Concentrez-vous. Prêt ?</p>
<p>Les deux classes parentes ont une méthode <code>__init__</code>, mais <strong>Python ne peut en &#8220;copier&#8221; qu&#8217;une seule </strong>dans l&#8217;enfant. Il copie donc la première qu&#8217;il trouve. Il va prendre la liste des parents (ici: <code>Arme, Protection</code>), et la lire de gauche à droite. Il va regarder chaque parent, et si la méthode existe, il va la &#8220;copier&#8221; dans l&#8217;enfant.</p>
<p>Si il retrouve une méthode de même nom dans un des parents suivants, il l&#8217;ignore. (Je dis un DES parents suivants car vous pouvez avoir 10 parents si vous voulez).</p>
<p>Donc dans notre exemple, si je fais :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> ProtectionOffensive<span style="color: black;">&#40;</span>Arme<span style="color: #66cc66;">,</span> Protection<span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">pass</span></pre></td></tr></table></div>

<p><code>ProtectionOffensive</code> n&#8217;aura que la méthode <code>__init__</code> de <code>Arme</code>. Or ce n&#8217;est pas ce qu&#8217;on veut. On va donc overrider la méthode <code>__init__</code>, et dedans appeler la méthode <code>__init__</code> de <code>Arme</code> ET celle de <code>Protection</code>.</p>
<p>Cette syntaxe : <code>Classe.methode(self, args...)</code> que l&#8217;on retrouve dans <code>Arme.__init__(self, nom, degat)</code> est juste un moyen d&#8217;appeler spécifiquement la méthode du parent.</p>
<p>Dans la partie précédente, je vous ai montré qu&#8217;on pouvait faire cela avec <code>super()</code>. Or <code>super()</code> vous retournera la première méthode du premier parent qu&#8217;elle trouve : c&#8217;est le but de <code>super()</code>, de faire ça automatiquement sans se soucier de savoir qui est le premier parent à avoir une méthode du bon nom.</p>
<p>C&#8217;est utile car parfois c&#8217;est le parent du parent du parent qui a la méthode qu&#8217;on veut appeler. On ne connaît pas forcément son nom, ou alors on ne veut pas l&#8217;écrire en dur. Mais dans notre cas, on veut spécifiquement une méthode d&#8217;un parent en particulier, il faut donc l&#8217;écrire à la main.</p>
<p>D&#8217;une manière générale :</p>
<ul>
<li>Utilisez<code> super()</code> quand vous faites de l&#8217;héritage simple où que vous voulez juste appeler la méthode du premier parent venu sans vous soucier de son nom (car il peut être très haut dans la chaîne d&#8217;héritage).</li>
<li>Utilisez <code>Classe.methode(self, args...)</code> quand vous voulez spécifiquement appeler la méthode d&#8217;un parent en particulier.</li>
</ul>
<p>Faites attention !</p>
<p>Le <code>self</code> n&#8217;est pas au même endroit dans <code>super(ClassCourante, self).methode(args...)</code> et <code>ClasseParente.methode(self, args...)</code>. Et dans le premier cas, on passe la classe courante (que <code>super()</code> va analyser pour trouver les parents automatiquement), dans le cas suivant, on écrit le nom de la classe parente en dur.</p>
<p>Faites quelques tests avec des scripts bidons pour bien comprendre comment ça marche. Faites ça avec des classes toutes simples. Sinon le jour où vous aurez une classe compliquée, vous allez vous embrouiller.</p>
<h2>La composition (POO pour les vrais mecs)</h2>
<p>Jusqu&#8217;ici c&#8217;était un tuto avec des notions de base pour des petits geeks imberbes qui jouent avec des action figures fabriquées en Chine et achetées sur ebay. Mais maintenant nous allons voir la POO pour les vrais hommes, les barbus, ceux qui jouent avec des <a href="https://www.realdoll.com/">reals dolls</a> et qui n&#8217;ont pas peur de mettre des chaussettes dépareillées.</p>
<p>Voyez-vous, un objet, tout seul, il sert à rien. Il s&#8217;emmerde déjà, rien à foutre le samedi, nul part où sortir, tout ça. Mais surtout, il a personne pour prendre l&#8217;apéro. Non, dans un programme digne d&#8217;un vrai pastis, il faut plusieurs objets qui interagissent entre eux. En fait, plusieurs objets qui s&#8217;utilisent les uns les autres.</p>
<p>Retournez à notre exemple de jeu video :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> HeroViril<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #808080; font-style: italic;"># def __init__(self, nom, prenom, groupe_sanguin, signe_astrologique,</span>
    <span style="color: #808080; font-style: italic;">#              couleur_preferee, tendance_sexuelle, culte,</span>
    <span style="color: #808080; font-style: italic;">#              taille_de_la_troisieme_phallange_de_l_index_gauche)</span>
    <span style="color: #808080; font-style: italic;"># TODO : voir le CDC avec le client pour confirmer les attributs du personnage</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nom<span style="color: #66cc66;">,</span> vie<span style="color: #66cc66;">,</span> arme<span style="color: #66cc66;">=</span><span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> protection<span style="color: #66cc66;">=</span><span style="color: #008000;">None</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">nom</span> <span style="color: #66cc66;">=</span> nom
        <span style="color: #008000;">self</span>.<span style="color: black;">vie</span> <span style="color: #66cc66;">=</span> vie
        <span style="color: #008000;">self</span>.<span style="color: black;">arme</span> <span style="color: #66cc66;">=</span> arme
        <span style="color: #008000;">self</span>.<span style="color: black;">protection</span> <span style="color: #66cc66;">=</span> protection
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> combattre<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> ennemi<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;{} attaque {}&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">nom</span><span style="color: #66cc66;">,</span> ennemi.<span style="color: black;">nom</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">while</span> <span style="color: #008000;">True</span>:
&nbsp;
            <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">arme</span>:
                <span style="color: #008000;">self</span>.<span style="color: black;">arme</span>.<span style="color: black;">attaque</span><span style="color: black;">&#40;</span>ennemi<span style="color: black;">&#41;</span>
&nbsp;
            <span style="color: #ff7700;font-weight:bold;">if</span> ennemi.<span style="color: black;">vie</span> <span style="color: #66cc66;">&lt;=</span> <span style="color: #ff4500;">0</span>:
                <span style="color: #ff7700;font-weight:bold;">break</span>
&nbsp;
            <span style="color: #ff7700;font-weight:bold;">if</span> ennemi.<span style="color: black;">arme</span>:
                ennemi.<span style="color: black;">arme</span>.<span style="color: black;">attaque</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
&nbsp;
            <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">vie</span> <span style="color: #66cc66;">&lt;=</span> <span style="color: #ff4500;">0</span>:
                <span style="color: #ff7700;font-weight:bold;">break</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">vie</span> <span style="color: #66cc66;">&gt;</span> <span style="color: #ff4500;">0</span>:
            <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;Victoire de {}&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">nom</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;{} est mort comme une pov' merde&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">nom</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>Et là vous notez un truc, c&#8217;est que nous n&#8217;avons pas de méthode <code>attaque()</code> sur notre héros. Nous utilisons la méthode attaque d&#8217;un objet arme. Que l&#8217;on a en attribut.</p>
<p>C&#8217;est cela la composition : un objet, qui en fait est composé de plusieurs sous-objets. Dans notre cas, notre objet héros est aussi composé d&#8217;une arme et d&#8217;une protection, qui sont ses attributs. Il peut ainsi utiliser le comportement de ses objets pour faire le boulot à sa place : c&#8217;est ce qu&#8217;on appelle la délégation.</p>
<p>Reprenons notre code des armes, un peu adapté :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># le code de l'armure ne change pas</span>
<span style="color: #ff7700;font-weight:bold;">class</span> Protection<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nom<span style="color: #66cc66;">,</span> armure<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">nom</span> <span style="color: #66cc66;">=</span> nom
        <span style="color: #008000;">self</span>.<span style="color: black;">armure</span> <span style="color: #66cc66;">=</span> armure
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> defend<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> degat<span style="color: black;">&#41;</span>:
&nbsp;
        degat <span style="color: #66cc66;">=</span> degat - <span style="color: #008000;">self</span>.<span style="color: black;">armure</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> degat <span style="color: #66cc66;">&lt;</span> <span style="color: #ff4500;">0</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #ff4500;">0</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> degat
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;"># on change le code de l'arme, si la cible a une protection</span>
<span style="color: #808080; font-style: italic;"># cela diminue les degâts pris</span>
<span style="color: #ff7700;font-weight:bold;">class</span> Arme<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nom<span style="color: #66cc66;">,</span> degat<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">nom</span> <span style="color: #66cc66;">=</span> nom
        <span style="color: #008000;">self</span>.<span style="color: black;">degat</span> <span style="color: #66cc66;">=</span> degat
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> attaque<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> cible<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #808080; font-style: italic;"># je mets aussi quelques prints pour le lulz</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> cible.<span style="color: black;">protection</span>:
            degat <span style="color: #66cc66;">=</span> cible.<span style="color: black;">protection</span>.<span style="color: black;">defend</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">degat</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;{} - {} = {}&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span>cible.<span style="color: black;">vie</span><span style="color: #66cc66;">,</span> degat<span style="color: #66cc66;">,</span> cible.<span style="color: black;">vie</span> - degat<span style="color: black;">&#41;</span>
            cible.<span style="color: black;">vie</span> -<span style="color: #66cc66;">=</span> degat
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;{} - {} = {}&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span>cible.<span style="color: black;">vie</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span>.<span style="color: black;">degat</span><span style="color: #66cc66;">,</span> cible.<span style="color: black;">vie</span> - <span style="color: #008000;">self</span>.<span style="color: black;">degat</span><span style="color: black;">&#41;</span>
            cible.<span style="color: black;">vie</span> -<span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">degat</span></pre></td></tr></table></div>

<p>Maintenant créons deux héros, armons-les, et faisons-les combattre :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> gosu <span style="color: #66cc66;">=</span> HeroViril<span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Drizzt Do'Urden&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">2000</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> gosu.<span style="color: black;">arme</span> <span style="color: #66cc66;">=</span> Arme<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Lame Vorpale'</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">10</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> gosu.<span style="color: black;">protection</span> <span style="color: #66cc66;">=</span> Protection<span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Maille en Kevlar de mithril doré a l'adamantium&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">10</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> noob_qui_repop <span style="color: #66cc66;">=</span> HeroViril<span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Bob&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">200</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> noob_qui_repop.<span style="color: black;">arme</span> <span style="color: #66cc66;">=</span> Arme<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Cure-dent'</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> noob_qui_repop.<span style="color: black;">protection</span> <span style="color: #66cc66;">=</span> Protection<span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Slip&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> noob_qui_repop.<span style="color: black;">combattre</span><span style="color: black;">&#40;</span>gosu<span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># yaaaaaaaaaaaaaaaaaaaaaaa !</span>
&nbsp;
Bob attaque Drizzt Do<span style="color: #483d8b;">'Urden
2000 - 0 = 2000
200 - 9 = 191
2000 - 0 = 2000
191 - 9 = 182
2000 - 0 = 2000
182 - 9 = 173
2000 - 0 = 2000
173 - 9 = 164
2000 - 0 = 2000
164 - 9 = 155
2000 - 0 = 2000
155 - 9 = 146
2000 - 0 = 2000
146 - 9 = 137
2000 - 0 = 2000
137 - 9 = 128
2000 - 0 = 2000
128 - 9 = 119
2000 - 0 = 2000
119 - 9 = 110
2000 - 0 = 2000
110 - 9 = 101
2000 - 0 = 2000
101 - 9 = 92
2000 - 0 = 2000
92 - 9 = 83
2000 - 0 = 2000
83 - 9 = 74
2000 - 0 = 2000
74 - 9 = 65
2000 - 0 = 2000
65 - 9 = 56
2000 - 0 = 2000
56 - 9 = 47
2000 - 0 = 2000
47 - 9 = 38
2000 - 0 = 2000
38 - 9 = 29
2000 - 0 = 2000
29 - 9 = 20
2000 - 0 = 2000
20 - 9 = 11
2000 - 0 = 2000
11 - 9 = 2
2000 - 0 = 2000
2 - 9 = -7
Bob est mort comme une pov'</span> merde</pre></td></tr></table></div>

<h2>Ok, j&#8217;ai pigé le principe, mais comment ça marche dans le détail ?</h2>
<p>Regardons la méthode combattre de plus près :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">    <span style="color: #808080; font-style: italic;"># elle attend un ennemi en paramètre, donc UN OBJET HeroViril</span>
    <span style="color: #808080; font-style: italic;"># self est l'objet en cours, donc aussi un objet HeroViril</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> combattre<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> ennemi<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;{} attaque {}&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">nom</span><span style="color: #66cc66;">,</span> ennemi.<span style="color: black;">nom</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># une petite boucle infinie. Warning, c'est un tuto. Ne faites pas</span>
        <span style="color: #808080; font-style: italic;"># ça chez vous les enfants.</span>
        <span style="color: #808080; font-style: italic;"># cette boucle loop pour toujours si il n'y a pas d'attribut arme donc</span>
        <span style="color: #808080; font-style: italic;"># ceci n'est qu'un exemple. Hein ? Noté ? Les deux du fond là ?</span>
        <span style="color: #ff7700;font-weight:bold;">while</span> <span style="color: #008000;">True</span>:
&nbsp;
            <span style="color: #808080; font-style: italic;"># on donne le premier coup à la personne qui attaque (l'objet en</span>
            <span style="color: #808080; font-style: italic;"># cours). On vérifie qu'il a une arme. Si c'est le cas,</span>
            <span style="color: #808080; font-style: italic;"># on appelle la méthode de l'arme &quot;attaque()&quot;, et on lui passe</span>
            <span style="color: #808080; font-style: italic;"># en paramètre l'ennemi.</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">arme</span>:
                <span style="color: #008000;">self</span>.<span style="color: black;">arme</span>.<span style="color: black;">attaque</span><span style="color: black;">&#40;</span>ennemi<span style="color: black;">&#41;</span>
&nbsp;
            <span style="color: #808080; font-style: italic;"># condition de sortie de la boucle sur la vie du héros qui a pris</span>
            <span style="color: #808080; font-style: italic;"># le coup</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> ennemi.<span style="color: black;">vie</span> <span style="color: #66cc66;">&lt;=</span> <span style="color: #ff4500;">0</span>:
                <span style="color: #ff7700;font-weight:bold;">break</span>
&nbsp;
            <span style="color: #808080; font-style: italic;"># ensuite on fait pareil à l'envers pour donner une chance à l'autre</span>
            <span style="color: #808080; font-style: italic;"># de répliquer : on vérifie que l'ennemi a une arme, et si c'est</span>
            <span style="color: #808080; font-style: italic;"># le cas, on applique la méthode &quot;attaque&quot; de l'arme à l'objet</span>
            <span style="color: #808080; font-style: italic;"># en cours</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> ennemi.<span style="color: black;">arme</span>:
                ennemi.<span style="color: black;">arme</span>.<span style="color: black;">attaque</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
&nbsp;
            <span style="color: #808080; font-style: italic;"># condition de sortie de la boucle sur la vie du héros qui a pris</span>
            <span style="color: #808080; font-style: italic;"># le coup</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">vie</span> <span style="color: #66cc66;">&lt;=</span> <span style="color: #ff4500;">0</span>:
                <span style="color: #ff7700;font-weight:bold;">break</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># une fois sorti de la boucle, on vérifie le niveau de vie pour</span>
        <span style="color: #808080; font-style: italic;"># désigner le vainqueur</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">vie</span> <span style="color: #66cc66;">&gt;</span> <span style="color: #ff4500;">0</span>:
            <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;Victoire de {}&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">nom</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;{} est mort comme une pov' merde&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">nom</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>Donc combattre utilise un objet arme, et appelle sa méthode <code>attaque()</code> sur un héros (j&#8217;ai viré les prints pour rendre le truc plus clair) :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">    <span style="color: #808080; font-style: italic;"># self est l'objet en cours, donc l'arme.</span>
    <span style="color: #808080; font-style: italic;"># cible est un héros, puisqu'on l'a passé en paramètre.</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> attaque<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> cible<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #808080; font-style: italic;"># si la cible (l'objet héros) a un attribut protection,</span>
        <span style="color: #808080; font-style: italic;"># les dégâts retirés sont diminués (ce calcul est fait par la protection)</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> cible.<span style="color: black;">protection</span>:
            cible.<span style="color: black;">vie</span> -<span style="color: #66cc66;">=</span> cible.<span style="color: black;">protection</span>.<span style="color: black;">defend</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">degat</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># sinon, on retire les dégâts à la vie de la cible (le héros)</span>
        <span style="color: #808080; font-style: italic;"># directement</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            cible.<span style="color: black;">vie</span> -<span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">degat</span></pre></td></tr></table></div>

<p>Diantre ! La méthode attaque utilise elle-même la méthode <code>defend(</code>) de la protection :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">    <span style="color: #808080; font-style: italic;"># self est l'objet en cours, donc la protection.</span>
    <span style="color: #808080; font-style: italic;"># degat est un simple int.</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> defend<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> degat<span style="color: black;">&#41;</span>:
        <span style="color: #808080; font-style: italic;"># on retourne les degâts infligés, moins la protection</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> degat - <span style="color: #008000;">self</span>.<span style="color: black;">armure</span></pre></td></tr></table></div>

<p>Pour comprendre tous ces codes, il faut bien piger deux trucs :</p>
<ul>
<li>Il y a 6 objets. Deux héros, deux armes, et deux protections. Les héros ont les armes / protections comme attributs.</li>
<li>On se sert des méthodes des armes pour attaquer. On passe les héros en paramètres à ces méthodes. Les armes se servent des protections des héros pour calculer les dégats.</li>
</ul>
<p>Ce dernier point est le plus important. Si vous comprenez ça, vous avez maîtrisé le plus important de la POO. Relisez le plusieurs fois :</p>
<p>Les héros ont une référence aux armes. Et ensuite, on passe une référence des héros aux armes. Les armes retirent de la vie à ces héros, non sans calculer les dégâts en fonction de la protection qu&#8217;ils portent.</p>
<p>Les objets ont tous des références les uns vers les autres. <strong>Ils se manipulent tous les uns les autres.</strong></p>
<p>Cela fait bizarre car dans la vie une épée ne manipule pas un héros (bon, je connais peu d&#8217;elfes noirs IRL aussi). On comprend facilement qu&#8217;un héros ait un attribut &#8216;épée&#8217;, mais il est difficile de comprendre qu&#8217;une épée ait une méthode, et que le paramètre de cette méthode soit un héros.</p>
<p>C&#8217;est un concept purement informatique : la logique des dégâts est codée dans l&#8217;arme, pas dans le héros. L&#8217;avantage de cette architecture, c&#8217;est que si vous changez l&#8217;arme, vous changez toute la logique des dégâts. Par exemple, vous rajoutez une arme empoisonnée :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> ArmeMegaEmpoisonnee<span style="color: black;">&#40;</span>Arme<span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nom<span style="color: #66cc66;">,</span> degat<span style="color: #66cc66;">,</span> poison<span style="color: #66cc66;">=</span><span style="color: #ff4500;">100000</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">super</span><span style="color: black;">&#40;</span>ArmeMegaEmpoisonnee<span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span><span style="color: black;">&#41;</span>.<span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span>nom<span style="color: #66cc66;">,</span> degat<span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">poison</span> <span style="color: #66cc66;">=</span> poison
&nbsp;
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> attaque<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> cible<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #808080; font-style: italic;"># on prend les degâts une premiere fois</span>
        <span style="color: #008000;">super</span><span style="color: black;">&#40;</span>ArmeMegaEmpoisonnee<span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span><span style="color: black;">&#41;</span>.<span style="color: black;">attaque</span><span style="color: black;">&#40;</span>cible<span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># puis on prend les dégâts du poison</span>
        cible.<span style="color: black;">vie</span> -<span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">poison</span></pre></td></tr></table></div>

<p>Cette arme fait plus de dégâts. Son mécanisme pour faire des dégâts est différent. Il suffit d&#8217;équiper un héros avec l&#8217;arme (en changeant l&#8217;attribut) pour que ce nouveau calcul de dégâts soit pris en compte.</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> noob_qui_repop.<span style="color: black;">vie</span> <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">200</span> <span style="color: #808080; font-style: italic;"># rePOP !</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> noob_qui_repop.<span style="color: black;">arme</span> <span style="color: #66cc66;">=</span> ArmeMegaEmpoisonnee<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Cheat Code'</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> noob_qui_repop.<span style="color: black;">combattre</span><span style="color: black;">&#40;</span>gosu<span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># Vengeance !</span>
Bob attaque Drizzt Do<span style="color: #483d8b;">'Urden
2000 - 0 = 2000
Victoire de Bob</span></pre></td></tr></table></div>

<p>Ce qu&#8217;il faut retenir : on peut mettre des objets en tant qu&#8217;attributs d&#8217;objets. Il n&#8217;y a pas de limite dans les nombres d&#8217;objets à mettre, leur mélange, les niveaux d&#8217;imbrications, etc. On peut mettre des objets, dans des objets, dans des objets&#8230; C&#8217;est la composition.</p>
<p>Et les objets peuvent utiliser les méthodes des autres objets. Et on peut passer des objets comme paramètres à des méthodes. C&#8217;est la délégation.</p>
<p>C&#8217;est la partouze des objets, quoi.</p>
<p>On peut mettre des objets dans des sets, des dicos, des listes&#8230; Par juste dans des attributs. Il y en a des choses à faire !</p>
<h2>Choisir entre l&#8217;héritage et la composition</h2>
<p>Les deux techniques permettent de réutiliser du code, mais pas de la même façon. Aucune règle générale ne tient la route dans tous les cas, mais un bon point de départ est de se dire que :</p>
<ul>
<li>Si vous avez deux objets de même nature et que l&#8217;un est une spécialisation de l&#8217;autre (Garçon est une spécialisation de Personne, Voiture est une spécialisation de véhicule, Clio est une spécialisation de voiture, Reptincel est une spécialisation de pokemon, foxmask est une spécialisation du correcteur orthographique de Word, etc), alors utilisez l&#8217;héritage.</li>
<li>Si vous avez deux objets qui échangent des données, qui sont associés ou qui dans la vie réelle sont des &#8216;part de&#8217; (un article est une partie d&#8217;un blog, Raymond Barre est membre d&#8217;un parti, Raymond fait partie d&#8217;un bar, <del>le bar et la raie font parti des poissons ah non ça c&#8217;est une spécialisation</del>, etc), utilisez la composition.</li>
</ul>
<p>Il y a aussi, quelque part, dans le lointain pays des enculeurs de mouche, une différence entre l’agrégation (qu&#8217;on a pas vu) et la composition. Vous vivrez très bien en considérant que c&#8217;est la même chose.</p>
<h2>Le design pattern &#8220;stratégie&#8221;</h2>
<p>Vous entendrez parfois parler du motif de conception &#8220;stratégie&#8221;. C&#8217;est en fait une mise en application abstraite de la composition.</p>
<p>Normalement la composition s&#8217;utilise avec des &#8220;part de&#8221; concrètes. Vous avez une voiture : elle est composée d&#8217;objets pneus, d&#8217;un objet moteur, etc.</p>
<p>Le design pattern stratégie est l&#8217;extraction d&#8217;une part du comportement d&#8217;un objet pour le mettre dans un autre objet, mais la nature de l&#8217;objet importe peu. Ceci est fait purement pour découpler le comportement de l&#8217;objet.</p>
<p>On a vu plus haut que changer l&#8217;arme permet de changer le calcul des dégâts. C&#8217;est ce type de résultat qu&#8217;on vise avec le design pattern strategy.</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">os</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> ParseurXml<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    ...
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> ParseurJson<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    ...
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> ParseurDeFichier<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    _strategy <span style="color: #66cc66;">=</span> <span style="color: black;">&#123;</span> <span style="color: #808080; font-style: italic;"># les stratégie par défaut</span>
        <span style="color: #483d8b;">'json'</span>: ParseurXml<span style="color: #66cc66;">,</span>
        <span style="color: #483d8b;">'xml'</span>: ParseurJson
    <span style="color: black;">&#125;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> fichier<span style="color: #66cc66;">,</span> strategy<span style="color: #66cc66;">=</span><span style="color: #008000;">None</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">fichier</span> <span style="color: #66cc66;">=</span> fichier
        <span style="color: #808080; font-style: italic;"># on récupère l'extension du fichier</span>
        path<span style="color: #66cc66;">,</span> ext <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">os</span>.<span style="color: black;">path</span>.<span style="color: black;">splitext</span><span style="color: black;">&#40;</span>fichier<span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Strategy est une classe de parseur</span>
        <span style="color: #808080; font-style: italic;"># on la récupère depuis les paramètres ou selon</span>
        <span style="color: #808080; font-style: italic;"># l'extension</span>
        Strategy <span style="color: #66cc66;">=</span> strategy <span style="color: #ff7700;font-weight:bold;">or</span> <span style="color: #008000;">self</span>._strategy<span style="color: black;">&#91;</span>ext.<span style="color: black;">lstrip</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'.'</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>
        <span style="color: #808080; font-style: italic;"># on instancie notre classe de strategie</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">strategy</span> <span style="color: #66cc66;">=</span> Strategy<span style="color: black;">&#40;</span>fichier<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> parse<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #808080; font-style: italic;"># on délègue le boulot à la stratégie</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">strategy</span>.<span style="color: black;">parse</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>La ligne la plus importante est :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">Strategy <span style="color: #66cc66;">=</span> strategy <span style="color: #ff7700;font-weight:bold;">or</span> <span style="color: #008000;">self</span>._strategy<span style="color: black;">&#91;</span>ext<span style="color: black;">&#93;</span></pre></td></tr></table></div>

<p>Ici on dit récupérer la stratégie de parsing en paramètre, ou sinon, la bonne en fonction de l&#8217;extension de fichier. On charge donc une classe dynamiquement, on va créer un objet à partir de cette classe. Et c&#8217;est cet objet à qui on va déléguer le comportement du parseur :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">    <span style="color: #ff7700;font-weight:bold;">def</span> parse<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">strategy</span>.<span style="color: black;">parse</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>On utilise l&#8217;objet dynamiquement pour gérer tout le parsing. On peut ainsi choisir un parseur à la volée.</p>
<p>La pattern strategy mélange donc composition (l&#8217;objet strategy est une part de l&#8217;objet général), délégation (l&#8217;objet général utilise le comportement de l&#8217;objet strategy) et d&#8217;injection de dépendance (on peut changer l&#8217;algo à la volée, il suffit de changer de stratégie).</p>
<p>Bon, ça c&#8217;était le mode hard. C&#8217;est pas grave si vous finissez pas le niveau toute de suite. Mettez pause. Allez pisser un coup et revenez- plus tard, les continues sont infinis sur le blog.</p>
<p>C&#8217;est bon, vous êtes chaud ? Prochaine stations, <a href="http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-6/">le monde merveilleux des méthodes magiques</a>.</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-5/feed/</wfw:commentRss>
		<slash:comments>58</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2013/02/magic_warmhanz.jpg" length="172488" type="image/jpg" />	</item>
	</channel>
</rss>
