<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Sam &#38; Max &#187; __init__</title>
	<atom:link href="http://sametmax.com/tag/__init__/feed/" rel="self" type="application/rss+xml" />
	<link>http://sametmax.com</link>
	<description>Du code, du cul</description>
	<lastBuildDate>Sat, 07 Nov 2015 10:56:13 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=4.1</generator>
	<item>
		<title>Rendez votre package exécutable avec __main__.py 5</title>
		<link>http://sametmax.com/rendez-votre-module-executable-avec-__main__-py/</link>
		<comments>http://sametmax.com/rendez-votre-module-executable-avec-__main__-py/#comments</comments>
		<pubDate>Tue, 13 Jan 2015 06:47:42 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[import]]></category>
		<category><![CDATA[module]]></category>
		<category><![CDATA[package]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[__init__]]></category>
		<category><![CDATA[__main__]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=15704</guid>
		<description><![CDATA[Tout le monde connait le fichier <a href="http://sametmax.com/vous-pouvez-mettre-du-code-dans-__init__-py/">__init__.py</a>, mais <code>__main__.py</code> est moins connu.]]></description>
				<content:encoded><![CDATA[<p>Tout le monde connait le fichier <a href="http://sametmax.com/vous-pouvez-mettre-du-code-dans-__init__-py/">__init__.py</a>, mais <code>__main__.py</code> est moins connu.</p>
<p>Il permet de lancer du code si on tente d&#8217;exécuter un package (c&#8217;est à dire un dossier qui contient un fichier <code>__init__.py</code>):</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;">$ <span style="color: #c20cb9; font-weight: bold;">tree</span> monpackage<span style="color: #000000; font-weight: bold;">/</span>
monpackakge<span style="color: #000000; font-weight: bold;">/</span>
├── __init__.py
└── __main__.py
&nbsp;
<span style="color: #000000;">0</span> directories, <span style="color: #000000;">2</span> files
$ <span style="color: #c20cb9; font-weight: bold;">cat</span> monpackage<span style="color: #000000; font-weight: bold;">/</span>__main__.py
print<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">'Hello :)'</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
$ python monpackage<span style="color: #000000; font-weight: bold;">/</span> <span style="color: #666666; font-style: italic;"># ceci est un dossier </span>
Hello :<span style="color: #7a0874; font-weight: bold;">&#41;</span></pre></td></tr></table></div>

<p>Le <code>__main__.py</code>  est aussi exécuté quand on fait <code>python -m monpackage</code>. </p>
<p>Notez que son exécution suppose l&#8217;import préalable du package, et que donc <code>__init__.py</code> sera toujours exécuté avant <code>__main__.py</code>. En revanche, faire juste <code>import monpackage</code> ne déclenche pas l&#8217;exécution de <code>__main__.py</code>.</p>
<p>Si vous zippez votre package et appelez la commande <code>python</code>, c&#8217;est aussi ce fichier qui sera exécuté. Pratique donc, pour faire un exécutable portable à peu de frais, tout en gardant la lib importable.</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/rendez-votre-module-executable-avec-__main__-py/feed/</wfw:commentRss>
		<slash:comments>5</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2015/01/index2.jpeg" length="8794" type="image/jpg" />	</item>
		<item>
		<title>Vous pouvez mettre du code dans __init__.py 10</title>
		<link>http://sametmax.com/vous-pouvez-mettre-du-code-dans-__init__-py/</link>
		<comments>http://sametmax.com/vous-pouvez-mettre-du-code-dans-__init__-py/#comments</comments>
		<pubDate>Wed, 26 Jun 2013 11:20:04 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[import]]></category>
		<category><![CDATA[init]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[__init__]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=3472</guid>
		<description><![CDATA[Le fichier <em>__init__.py</em> ne sert pas qu'à <a href="http://sametmax.com/les-imports-en-python/">déclarer un dossier comme un package importable</a>. C'est aussi le code exécuté automatiquement, une seule fois, quand on importe le module.]]></description>
				<content:encoded><![CDATA[<p>Le fichier <em>__init__.py</em> ne sert pas qu&#8217;à <a href="http://sametmax.com/les-imports-en-python/">déclarer un dossier comme un package importable</a>. C&#8217;est aussi le code exécuté automatiquement, une seule fois, quand on importe le module.</p>
<p>Du coup vous pouvez mettre dedans tout code Python que vous souhaitez lancer à l&#8217;import. On y voit souvent :</p>
<ul>
<li>Initialisation du cache.</li>
<li>Constantes comme <code>__version__</code>.</li>
<li>Import d&#8217;autres modules pour les mettre dans l&#8217;espace de nom courant.</li>
<li>Check de dépendances.</li>
<li>Aliasing.</li>
<li>Monkey patching and hacks tout moches qui sont là temporairement pour 6 ans.</li>
</ul>
<p>Je vous déconseille de mettre trop de code dans le fichier <em>__init__.py</em>, notamment du code métier. C&#8217;est une mauvaise habitude que l&#8217;on peut voir dans le code de Django par exemple. Car ça veut dire que l&#8217;import du package déclenche ce code, qui lui-même importe d&#8217;autres modules, qui déclenche d&#8217;autres codes, etc. Cela donne des effets de bord à l&#8217;import, alors que l&#8217;import d&#8217;un simple package est quelque chose que l&#8217;on veut généralement ne pas avoir beaucoup d&#8217;effets.</p>
<p>Dans Django par exemple, c&#8217;est ce qui fait que beaucoup de modules lèvent une exception à l&#8217;import :</p>
<p><code>django.core.exceptions.ImproperlyConfigured: Requested setting X but settings are not configured. </code></p>
<p>Alors qu&#8217;ils n&#8217;ont pas du tout besoin des settings pour fonctionner.</p>
<p>Si vous avez besoin que votre classe <code>Bidule</code> soit directement importable dans votre package <code>machin</code>, faites dans <em>machin/__init__.py</em> :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">from</span> .<span style="color: black;">module_qui_contient_bidule</span> <span style="color: #ff7700;font-weight:bold;">import</span> Bidule</pre></td></tr></table></div>

<p>Du coup vous pourrez faire n&#8217;importe où ailleurs:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">from</span> machin <span style="color: #ff7700;font-weight:bold;">import</span> Bidule</pre></td></tr></table></div>

<p>C&#8217;est bien plus propre que de mettre tout le code de <code>Bidule</code> dans le <em>__init__.py</em>.</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/vous-pouvez-mettre-du-code-dans-__init__-py/feed/</wfw:commentRss>
		<slash:comments>10</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2013/06/UHM9zrZ.jpg" length="59179" type="image/jpg" />	</item>
		<item>
		<title>La différence entre __new__ et __init__ en Python 14</title>
		<link>http://sametmax.com/la-difference-entre-__new__-et-__init__-en-python/</link>
		<comments>http://sametmax.com/la-difference-entre-__new__-et-__init__-en-python/#comments</comments>
		<pubDate>Fri, 11 Jan 2013 10:06:36 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[objet]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[__init__]]></category>
		<category><![CDATA[__new__]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=3534</guid>
		<description><![CDATA[Les méthodes <code>__new__</code> et <code>__init__</code> n'ont rien de spécial. Ce sont des méthodes ordinaires. Mais parce qu'elles sont nommées ainsi, Python les détecte et les appelle automatiquement a un moment précis.]]></description>
				<content:encoded><![CDATA[<p>Les méthodes <code>__new__</code> et <code>__init__</code> n&#8217;ont rien de spécial. Ce sont des méthodes ordinaires. Mais parce qu&#8217;elles sont nommées ainsi, Python les détecte et les appelle automatiquement a un moment précis.</p>
<p>Ce moment, c&#8217;est ce qui différencie <code>__init__</code> de <code>__new__</code>.</p>
<h2><code>__init__</code> pour initialiser</h2>
<p><code>__init__</code> est la méthode qui va être appelée automatiquement après qu&#8217;un objet ai été crée. <strong>Ce n&#8217;est pas un contructeur du tout</strong>, c&#8217;est un initialiseur.</p>
<p>Si vous faîtes ça:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">class</span> Premiere<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
...         
...         <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> prix<span style="color: black;">&#41;</span>:
...                 <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;%s euros&quot;</span> % prix
...         
<span style="color: #66cc66;">&gt;&gt;&gt;</span> c <span style="color: #66cc66;">=</span> Premiere<span style="color: black;">&#40;</span><span style="color: #ff4500;">10000</span><span style="color: black;">&#41;</span>
<span style="color: #ff4500;">10000</span> euros</pre></td></tr></table></div>

<p>A la ligne <code>c = Premiere(10000)</code>, Python va créer une instance de la classe <code>Première()</code>. Il va ensuite immédiatement et automatiquement appeler <code>__init__</code> en lui passant cette instance en premier argument et les paramètres passés par l&#8217;appel <code>Premiere(paramètres)</code>. Donc, quand <code>__init__</code> est appelé, l&#8217;objet instancié existe déjà.</p>
<p>On va utiliser <code>__init__</code> pour initialiser l&#8217;objet, c&#8217;est à dire pour lui donner son état de départ: changer les attributs, configurer l&#8217;objet par rapports aux arguments, etc.</p>
<p> Dans tous les autres langages, on utiliserait le constructeur pour faire ce boulot. Pas en Python. </p>
<p> L&#8217;avantage de <code>__init__</code>, c&#8217;est qu&#8217;il est très facile à manipuler. Il n&#8217;y a pas de magie dangereuse dans <code>__init__</code>: on a l&#8217;objet tout neuf, et les arguments passés à l&#8217;instancitation, on peut donc manipuler l&#8217;objet sans se soucier du reste. Ici on attache deux attributs à l&#8217;instance <code>self</code>:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"> <span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">class</span> Premiere<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
...         <span style="color: black;">discount</span> <span style="color: #66cc66;">=</span> <span style="color: #008000;">False</span>
...         <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> prix<span style="color: black;">&#41;</span>:
...                 <span style="color: #008000;">self</span>.<span style="color: black;">prix</span> <span style="color: #66cc66;">=</span> prix
...                 <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">prix</span> <span style="color: #66cc66;">&lt;</span> <span style="color: #ff4500;">5000</span>:
...                     <span style="color: #008000;">self</span>.<span style="color: black;">discount</span> <span style="color: #66cc66;">=</span> <span style="color: #008000;">True</span>
...         
<span style="color: #66cc66;">&gt;&gt;&gt;</span> c <span style="color: #66cc66;">=</span> Premiere<span style="color: black;">&#40;</span><span style="color: #ff4500;">10000</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> c.<span style="color: black;">discount</span>
<span style="color: #008000;">False</span></pre></td></tr></table></div>

<p>Comme en Python les attributs sont dynamiques, on peut attacher un argument même si l&#8217;instance ne le déclare pas, et il est créé automatiquement. </p>
<p>En résumé: <code>__init__</code> est appelé automatiquement APRES la création de l&#8217;objet, et on met dedans le code d&#8217;initialisation de l&#8217;objet (généralement une modification des attributs pour leur donner leur état de départ).</p>
<h2><code>__new__</code> pour créer</h2>
<p><code>__new__</code> est le vrai constructeur. Pour cette raison, elle doit retourner un objet.</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">class</span> Premiere<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
...
...     <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__new__</span><span style="color: black;">&#40;</span>cls<span style="color: #66cc66;">,</span> prix<span style="color: black;">&#41;</span>:
...        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;%s euros&quot;</span> % prix
...        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">super</span><span style="color: black;">&#40;</span>Premiere<span style="color: #66cc66;">,</span> cls<span style="color: black;">&#41;</span>.<span style="color: #0000cd;">__new__</span><span style="color: black;">&#40;</span>cls<span style="color: black;">&#41;</span>
...
<span style="color: #66cc66;">&gt;&gt;&gt;</span> c <span style="color: #66cc66;">=</span> Premiere<span style="color: black;">&#40;</span><span style="color: #ff4500;">10000</span><span style="color: black;">&#41;</span>
<span style="color: #ff4500;">10000</span> euros</pre></td></tr></table></div>

<p><code>__new__</code> est appelée AVANT la création de l&#8217;objet, car c&#8217;est son boulot de créer l&#8217;instance et de la retourner. Comme on ne sait pas retourner une instance nous même (enfin si, mais pas dans cet article :-)), on appelle <code>super()</code> pour utiliser la méthode <code>__new__</code> de <code>object</code> et créer une instance pour cette classe.</p>
<p>L&#8217;objet créé sera ensuite passé à <code>__init__</code> automatiquement par Python.</p>
<p>On utilise rarement <code>__new__</code>. Les deux cas principaux sont:</p>
<ul>
<li>si on hérite d&#8217;un type immutable (str, int, tuple, etc), <code>__new__</code> est le seul endroit où on puisse initialiser l&#8217;objet.</li>
<li>dans le cas des métaclasses.</li>
</ul>
<p>En résumé: <code>__new__</code> est le vrai constructeur, il est appelé pour créer l&#8217;objet, et l&#8217;objet ainsi instancié est passé à <code>__init__</code>. Vous n&#8217;avez presque aucune raison de vous en servir, c&#8217;est vraiment pour les cas particuliers.</p>
<p>Voici l&#8217;ordre d&#8217;éxécution:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">class</span> Premiere<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
...         <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__new__</span><span style="color: black;">&#40;</span>cls<span style="color: #66cc66;">,</span> prix<span style="color: black;">&#41;</span>:
...                 <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;__new__&quot;</span>
...                 <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">super</span><span style="color: black;">&#40;</span>Premiere<span style="color: #66cc66;">,</span> cls<span style="color: black;">&#41;</span>.<span style="color: #0000cd;">__new__</span><span style="color: black;">&#40;</span>cls<span style="color: black;">&#41;</span>
...         <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> *args<span style="color: black;">&#41;</span>:
...                 <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;__init__&quot;</span>
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> c <span style="color: #66cc66;">=</span> Premiere<span style="color: black;">&#40;</span><span style="color: #ff4500;">10000</span><span style="color: black;">&#41;</span>
<span style="color: #0000cd;">__new__</span>
<span style="color: #0000cd;">__init__</span></pre></td></tr></table></div>

<h2>Exemple d&#8217;utilisation de <code>__new__</code></h2>
<p>Généralement on sait très bien utiliser <code>__init__</code>, mais <code>__new__</code> est moins évident.</p>
<p>L&#8217;usage le plus fréquent de <code>__new__</code> quand on hérite d&#8217;objets immutables. Par exemple, si vous voulez faire un objet <code>Temperature</code> qui hérite de <code>float</code> et qui accepte une unité en plus, ceci ne va pas marcher:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Temperature<span style="color: black;">&#40;</span><span style="color: #008000;">float</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> value<span style="color: #66cc66;">,</span> unit<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">super</span><span style="color: black;">&#40;</span>Temperature<span style="color: #66cc66;">,</span> cls<span style="color: black;">&#41;</span>.<span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span>value<span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">unit</span> <span style="color: #66cc66;">=</span> unit
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__str__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #483d8b;">&quot;%s%s&quot;</span> % <span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">value</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span>.<span style="color: black;">unit</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">print</span> Temperature<span style="color: black;">&#40;</span><span style="color: #ff4500;">10</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'°C'</span><span style="color: black;">&#41;</span>
&nbsp;
Traceback <span style="color: black;">&#40;</span>most recent call last<span style="color: black;">&#41;</span>:
  File <span style="color: #483d8b;">&quot;&lt;ipython-input-1-65b676255e09&gt;&quot;</span><span style="color: #66cc66;">,</span> line <span style="color: #ff4500;">11</span><span style="color: #66cc66;">,</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #66cc66;">&lt;</span>module<span style="color: #66cc66;">&gt;</span>
    Temperature<span style="color: black;">&#40;</span><span style="color: #ff4500;">10</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'°C'</span><span style="color: black;">&#41;</span>
<span style="color: #008000;">TypeError</span>: <span style="color: #008000;">float</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> takes at most <span style="color: #ff4500;">1</span> argument <span style="color: black;">&#40;</span><span style="color: #ff4500;">2</span> given<span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>La raison est que du fait de la nature immutable de <code>float</code>, il est initialisé dans <code>__new__</code>, et il n&#8217;attend aucune valeur de plus dans <code>__new__</code>, mais on lui passe malgré tout (via <code>Temperature(10, '°C')</code>).</p>
<p>En revanche, ceci va marcher:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Temperature<span style="color: black;">&#40;</span><span style="color: #008000;">float</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__new__</span><span style="color: black;">&#40;</span>cls<span style="color: #66cc66;">,</span> value<span style="color: #66cc66;">,</span> unit<span style="color: black;">&#41;</span>:
&nbsp;
        instance <span style="color: #66cc66;">=</span> <span style="color: #008000;">super</span><span style="color: black;">&#40;</span>Temperature<span style="color: #66cc66;">,</span> cls<span style="color: black;">&#41;</span>.<span style="color: #0000cd;">__new__</span><span style="color: black;">&#40;</span>cls<span style="color: #66cc66;">,</span> value<span style="color: black;">&#41;</span>
        instance.<span style="color: black;">unit</span> <span style="color: #66cc66;">=</span> unit
        <span style="color: #ff7700;font-weight:bold;">return</span> instance
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__str__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #483d8b;">&quot;%s%s&quot;</span> % <span style="color: black;">&#40;</span><span style="color: #008000;">super</span><span style="color: black;">&#40;</span>Temperature<span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span><span style="color: black;">&#41;</span>.<span style="color: #0000cd;">__str__</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span>.<span style="color: black;">unit</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">print</span> Temperature<span style="color: black;">&#40;</span><span style="color: #ff4500;">10</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'°C'</span><span style="color: black;">&#41;</span>
<span style="color: #ff4500;">10.0</span>°C</pre></td></tr></table></div>

<p>Comme on override <code>__new__</code>, on lui donne la possibilité d&#8217;accepter une argument de plus.</p>
<p>Un autre exemple serait de vouloir créer une chaîne de caractères qui est toujours en majuscule (ce qui est bien moins utile que l&#8217;exemple précédent):</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> CapsLockString<span style="color: black;">&#40;</span><span style="color: #008000;">str</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> value<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">print</span> value <span style="color: #808080; font-style: italic;"># et maintenant je fais quoi ?</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">print</span> CapsLockString<span style="color: black;">&#40;</span><span style="color: #483d8b;">'test'</span><span style="color: black;">&#41;</span>
<span style="color: #dc143c;">test</span>
<span style="color: #dc143c;">test</span></pre></td></tr></table></div>

<p>Ça ne plantera pas, mais il n&#8217;y a rien que nous puissions faire car <code>str</code> est immutable. On ne peut tout simplement pas faire quoique ce soit avec <code>value</code>. Avec <code>__new__</code>, on peut faire quelque chose sur la chaîne intermédiaire:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> CapsLockString<span style="color: black;">&#40;</span><span style="color: #008000;">str</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__new__</span><span style="color: black;">&#40;</span>cls<span style="color: #66cc66;">,</span> value<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">super</span><span style="color: black;">&#40;</span>CapsLockString<span style="color: #66cc66;">,</span> cls<span style="color: black;">&#41;</span>.<span style="color: #0000cd;">__new__</span><span style="color: black;">&#40;</span>cls<span style="color: #66cc66;">,</span> value.<span style="color: black;">upper</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">print</span> CapsLockString<span style="color: black;">&#40;</span><span style="color: #483d8b;">'test'</span><span style="color: black;">&#41;</span>
TEST</pre></td></tr></table></div>

<p>Deux chaînes sont en fait créées, une normale, puis une en majuscule retournée par upper() qui va servir de valeur à notre objet (en fait il y en a même 3 dans l&#8217;implémentation CPython, c&#8217;est pour ça que les notations littérales sont plus rapides que l&#8217;usage des classes pour créer des built-in).</p>
<p><code>__new__</code> permet donc essentiellement de créer de jolis API. On l&#8217;utilise par ailleurs dans les metaclasses, mais ce sera pour un autre article.</p>
<p>Un troisième usage de<code> __new__</code>, assez rare (mais en même temps utiliser <code>__new__</code> est déjà rare), c&#8217;est le pattern factory. Les javaistes le connaissent bien, c&#8217;est un motif de conception qui permet de gérer la création d&#8217;objets qui peuvent eux même créer des objets, qui créer des objets qui&#8230; Bref.</p>
<p>Car en fait <code>__new__</code> peut retourner n&#8217;importe quoi. Il peut <a href="http://sametmax.com/usages-et-dangers-du-null-object-pattern-en-python/">retourner toujours la même instance</a> pour faire un singleton par exemple. On peut même carrément renvoyer un truc qui n&#8217;a rien n&#8217;a voir, par exemple une fonction :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> FonctionFactory<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__new__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> value<span style="color: #66cc66;">,</span> repeat<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">def</span> repeater<span style="color: black;">&#40;</span><span style="color: #dc143c;">string</span><span style="color: #66cc66;">=</span>value<span style="color: black;">&#41;</span>:
&nbsp;
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #dc143c;">string</span> * repeat
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> repeater
&nbsp;
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> function <span style="color: #66cc66;">=</span> FonctionFactory<span style="color: black;">&#40;</span><span style="color: #483d8b;">'hello'</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">2</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># création de la fonction</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span> function<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
hellohello
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span> function<span style="color: black;">&#40;</span><span style="color: #483d8b;">'bonjour'</span><span style="color: black;">&#41;</span>
bonjourbonjour</pre></td></tr></table></div>

<p>Ici on retourne carrément une fonction, et pas du tout une instance de <code>FonctionFactory()</code> comme prévu. On pourrait faire ceci de manière plus simple avec de la programmation fonctionnelle, mais <code>__new__</code> permet de bénéficier de tout l&#8217;outillage de la POO.</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/la-difference-entre-__new__-et-__init__-en-python/feed/</wfw:commentRss>
		<slash:comments>14</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2013/01/trouver-les-7_differences.jpg" length="50393" type="image/jpg" />	</item>
	</channel>
</rss>
