<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Sam &#38; Max &#187; heritage</title>
	<atom:link href="http://sametmax.com/tag/heritage/feed/" rel="self" type="application/rss+xml" />
	<link>http://sametmax.com</link>
	<description>Du code, du cul</description>
	<lastBuildDate>Sat, 07 Nov 2015 10:56:13 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=4.1</generator>
	<item>
		<title>Mais qui donc hérite de ma classe ? 6</title>
		<link>http://sametmax.com/mais-qui-donc-herite-de-ma-classe/</link>
		<comments>http://sametmax.com/mais-qui-donc-herite-de-ma-classe/#comments</comments>
		<pubDate>Fri, 20 Jun 2014 13:39:23 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[heritage]]></category>
		<category><![CDATA[poo]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=11013</guid>
		<description><![CDATA[Je me suis dit que ça pourrait intéresser quelques geeks de savoir comment lister les enfants d'une classe, récursivement.]]></description>
				<content:encoded><![CDATA[<p>Pas une question que l&#8217;on se pose souvent, à moins d&#8217;avoir une lib qui expose une classe avec beaucoup d&#8217;introspection.</p>
<p>Ceci dit pour la culture G, je me suis dit que ça pourrait intéresser quelques geeks de savoir comment lister les enfants d&#8217;une classe, récursivement.</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">def</span> subclasses<span style="color: black;">&#40;</span>cls<span style="color: #66cc66;">,</span> _found<span style="color: #66cc66;">=</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot; Retourne toutes les classes héritant d'une classe &quot;&quot;&quot;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># On check que la classe est hérite bien de &quot;object&quot;.</span>
    <span style="color: #808080; font-style: italic;"># Utile uniquement pour un code 2.x qui utiliserait</span>
    <span style="color: #808080; font-style: italic;"># des old style classes, qui n'ont pas &quot;__subclasses__&quot;.</span>
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #008000;">isinstance</span><span style="color: black;">&#40;</span>cls<span style="color: #66cc66;">,</span> <span style="color: #008000;">type</span><span style="color: black;">&#41;</span>:
      <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">TypeError</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'subclasses works only with new-style classes'</span>
                            <span style="color: #483d8b;">', not %s'</span> % cls<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># On va stocker les classes rencontrées dans un set</span>
    <span style="color: #808080; font-style: italic;"># pour éviter les doublons car on peut tomber sur</span>
    <span style="color: #808080; font-style: italic;"># un héritage en forme de diamant.</span>
    _found <span style="color: #66cc66;">=</span> _found <span style="color: #ff7700;font-weight:bold;">or</span> <span style="color: #008000;">set</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">try</span>:
      subs <span style="color: #66cc66;">=</span> cls.__subclasses__<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">TypeError</span>:  <span style="color: #808080; font-style: italic;"># Erreur levée si cls == type, petits vicieux</span>
      subs <span style="color: #66cc66;">=</span> cls.__subclasses__<span style="color: black;">&#40;</span>cls<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">for</span> sub <span style="color: #ff7700;font-weight:bold;">in</span> subs:
        <span style="color: #ff7700;font-weight:bold;">if</span> sub <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #ff7700;font-weight:bold;">in</span> _found:
            _found.<span style="color: black;">add</span><span style="color: black;">&#40;</span>sub<span style="color: black;">&#41;</span>
            <span style="color: #808080; font-style: italic;"># Un appel récursif comme on les aimes</span>
            subclasses<span style="color: black;">&#40;</span>sub<span style="color: #66cc66;">,</span> _found<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">return</span> _found</pre></td></tr></table></div>

<p>Pas très compliqué, donc, si on connait les piègeounets : ça ne marche pas sur les old syle classes, et il y a un traitement spécial pour <code>type</code>. Celà dit, qui utilise encore des old styles classes ? Et franchement lister les héritiers de <code>type</code>, à par pour satisfaire sa curiosité&#8230;</p>
<p>Aller, juste pour le fun, sur un virtualenv vierge:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> subclasses<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">print</span> x
<span style="color: #808080; font-style: italic;">## &lt;type 'callable-iterator'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class '_abcoll.Sized'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.EOFError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class '_abcoll.Mapping'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.UnicodeWarning'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.IOError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'memoryview'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'code'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.ImportWarning'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'sys.flags'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'iterator'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class 'warnings.catch_warnings'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.Warning'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.EnvironmentError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'dict'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class 'encodings.utf_8.IncrementalEncoder'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'weakproxy'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class '_abcoll.Iterator'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'sys.version_info'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'posix.stat_result'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'frozenset'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class 'codecs.CodecInfo'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class 'zipimport.ZipImportError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.StopIteration'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.ImportError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class 'site._Printer'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'weakref'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class '_abcoll.Sequence'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'property'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class 'encodings.utf_8.IncrementalDecoder'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'imp.NullImporter'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.TypeError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'bytearray'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'int'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.UnicodeTranslateError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'instance'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.BaseException'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.SyntaxWarning'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'file'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class '_abcoll.MappingView'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class '_weakrefset._IterationGuard'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.UnicodeDecodeError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'classobj'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.UnicodeError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class 'abc.abstractproperty'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.DeprecationWarning'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'complex'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'set'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'buffer'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'generator'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.Exception'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class 'codecs.IncrementalDecoder'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.UserWarning'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'staticmethod'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.UnicodeEncodeError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class 'encodings.CodecRegistryError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class '_abcoll.MutableSequence'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class '_abcoll.KeysView'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'cell'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.StandardError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'enumerate'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.KeyboardInterrupt'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.BufferError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class 'warnings.WarningMessage'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'EncodingMap'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class 'codecs.BufferedIncrementalDecoder'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.ValueError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class '_abcoll.Set'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.MemoryError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.SystemExit'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'reversed'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class '_abcoll.Hashable'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'bool'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'classmethod'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.ReferenceError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.GeneratorExit'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class '_abcoll.Container'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class '_abcoll.ItemsView'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'xrange'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.PendingDeprecationWarning'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'basestring'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.SystemError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.ZeroDivisionError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class 'site.Quitter'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'long'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'NotImplementedType'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'super'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'fieldnameiterator'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class '_abcoll.Callable'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class '_abcoll.MutableSet'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.ArithmeticError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class 'abc.ABCMeta'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.OverflowError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.FutureWarning'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'sys.float_info'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'formatteriterator'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'type'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.AssertionError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'traceback'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.FloatingPointError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'function'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'instancemethod'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'sys.long_info'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'builtin_function_or_method'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class 'signal.ItimerError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class 'site._Helper'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.LookupError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'wrapper_descriptor'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.KeyError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class '_abcoll.ValuesView'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'slice'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class '_weakrefset.WeakSet'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'list'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.IndexError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'getset_descriptor'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'posix.statvfs_result'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.SyntaxError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'frame'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class 'codecs.BufferedIncrementalEncoder'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'PyCapsule'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.IndentationError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'NoneType'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'zipimport.zipimporter'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'member_descriptor'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.AttributeError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'ellipsis'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.UnboundLocalError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'unicode'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class '_abcoll.Iterable'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.TabError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.NameError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'tuple'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class 'warnings._OptionError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.NotImplementedError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.RuntimeWarning'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'str'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class '_abcoll.MutableMapping'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.BytesWarning'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'module'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.RuntimeError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;class 'codecs.IncrementalEncoder'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'float'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'exceptions.OSError'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'dictproxy'&gt;</span>
<span style="color: #808080; font-style: italic;">## &lt;type 'weakcallableproxy'&gt;</span></pre></td></tr></table></div>

<p>Putain, ça c&#8217;est du remplissage ! 20minutes serait fier de moi.</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/mais-qui-donc-herite-de-ma-classe/feed/</wfw:commentRss>
		<slash:comments>6</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2014/06/orULZfw.jpg" length="25736" type="image/jpg" />	</item>
		<item>
		<title>Django, une app à la fois : Outils pour templates 4</title>
		<link>http://sametmax.com/django-une-app-a-la-fois-outils-pour-templates/</link>
		<comments>http://sametmax.com/django-une-app-a-la-fois-outils-pour-templates/#comments</comments>
		<pubDate>Sun, 18 Aug 2013 19:19:54 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[django]]></category>
		<category><![CDATA[filters]]></category>
		<category><![CDATA[heritage]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[tags]]></category>
		<category><![CDATA[templates]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=7133</guid>
		<description><![CDATA[Je vous poste la nouvelle app de <a href="http://sametmax.com/django-une-app-a-la-fois/">Django, une app à la fois</a> depuis le Mac Do, parce que c'est le seul truc à avoir un Wifi dans le coin paumé où je me trouve.]]></description>
				<content:encoded><![CDATA[<p>Ouaaa, j&#8217;ai passé la journée sur ce truc. Il y avait beaucoup de texte pour une fois, alors la traduction anglais => français a pris pas mal de temps. C&#8217;est fou ce qu&#8217;on peut faire comme trucs chiants quand on a pas Internet&#8230;</p>
<p>Bref, je vous poste la nouvelle app de <a href="http://sametmax.com/django-une-app-a-la-fois/">Django, une app à la fois</a> depuis le Mac Do, parce que c&#8217;est le seul truc à avoir un Wifi dans le coin paumé où je me trouve.</p>
<p><a href="https://github.com/sametmax/Django--an-app-at-a-time/tree/fran%C3%A7ais">Machez bien, c&#8217;est assez dense.</a></p>
<p>P.S: ouinnnn, ils font plus le wrap chèvre.</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/django-une-app-a-la-fois-outils-pour-templates/feed/</wfw:commentRss>
		<slash:comments>4</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2013/08/R19eKGa.jpg" length="291257" type="image/jpg" />	</item>
		<item>
		<title>Le guide ultime et définitif sur la programmation orientée objet en Python à l’usage des débutants qui sont rassurés par les textes détaillés qui prennent le temps de tout expliquer. Partie 7. 24</title>
		<link>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-7/</link>
		<comments>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-7/#comments</comments>
		<pubDate>Sun, 28 Apr 2013 05:47:17 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[classe]]></category>
		<category><![CDATA[classes]]></category>
		<category><![CDATA[heritage]]></category>
		<category><![CDATA[path.py]]></category>
		<category><![CDATA[poo]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=5912</guid>
		<description><![CDATA[L'orienté object est particulièrement adapté à la création de belles APIs. Nous allons donc étudier aujourd'hui un cas réel de mise en pratique réussi avec la lib <a href="https://github.com/jaraco/path.py">path.py</a>.]]></description>
				<content:encoded><![CDATA[<p>Un peu de rock à l&#8217;anglaise pour faire passer la pilule :</p>

<!-- iframe plugin v.2.9 wordpress.org/plugins/iframe/ -->
<iframe width="420" height="315" src="http://www.youtube.com/embed/wcb4gCJ9da0" frameborder="0" scrolling="no" class="iframe-class"></iframe>

<p>Après avoir lu <a href="http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-6">la partie précédente</a>, vous avez dû vous demander comment mettre tout ça en application.</p>
<p>Comme je vous l&#8217;avais expliqué, l&#8217;orienté objet est particulièrement adapté à la création de belles APIs. Nous allons donc étudier aujourd&#8217;hui un cas réel de mise en pratique réussi avec la lib <a href="https://github.com/jaraco/path.py">path.py</a>.</p>
<p>J&#8217;ai choisi cette lib car :</p>
<ul>
<li>Le code tient dans un seul fichier.</li>
<li>Il y a plein de patterns utilisés dedans qui sont intéressants à expliquer.</li>
<li>C&#8217;est une source propre qui suit globalement les bonnes pratiques.</li>
<li>Path.py a une API élégante, donc le résultat à l&#8217;usage est un bon exemple.</li>
</ul>
<p>Petit rappel, path.py est une surcouche au dessus des modules <a href="http://docs.python.org/2/library/tempfile.html?highlight=tempfile#tempfile">tempfile</ ahref=>, <a href="http://docs.python.org/2/library/os.html?highlight=os#os">os</a> ou encore <a href="http://docs.python.org/2/library/shutil.html?highlight=shutils">shutil</a>, c&#8217;est à dire qu&#8217;elle permet de faire exactement la même chose, en plus pratique.</p>
<p>C&#8217;est donc typiquement un bibliothèque de confort, et elle n&#8217;aurait aucun intérêt si elle n&#8217;était pas agréable à utiliser puisque l&#8217;on peut déjà faire tout ce qu&#8217;elle fait avec Python en standard. Son attractivité réside dans la beauté de son interface qui rend la manipulation de fichiers très intuitive :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># elle permet de manipuler des chemins facilement</span>
<span style="color: #ff7700;font-weight:bold;">from</span> path <span style="color: #ff7700;font-weight:bold;">import</span> path
dossier <span style="color: #66cc66;">=</span> path<span style="color: black;">&#40;</span><span style="color: #483d8b;">'/etc'</span><span style="color: black;">&#41;</span>
fichier <span style="color: #66cc66;">=</span> dossier / <span style="color: #483d8b;">'postgresql/9.1/main/pg_hba.conf'</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># d'obtenir des informations sur le fichier</span>
fichier.<span style="color: black;">exists</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #808080; font-style: italic;">## True</span>
fichier.<span style="color: black;">parent</span>
<span style="color: #808080; font-style: italic;">## path(u'/etc/postgresql/9.1/main')</span>
fichier.<span style="color: black;">basename</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #808080; font-style: italic;">## path(u'pg_hba.conf')</span>
fichier.<span style="color: black;">dirname</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #808080; font-style: italic;">## path(u'/etc/postgresql/9.1/main')</span>
fichier.<span style="color: black;">spli</span>
fichier.<span style="color: black;">split</span>       fichier.<span style="color: black;">splitall</span>    fichier.<span style="color: black;">splitdrive</span>  fichier.<span style="color: black;">splitext</span>    fichier.<span style="color: black;">splitlines</span>  fichier.<span style="color: black;">splitpath</span>   fichier.<span style="color: black;">splitunc</span>
fichier.<span style="color: black;">splitext</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #808080; font-style: italic;">## (path(u'/etc/postgresql/9.1/main/pg_hba'), u'.conf')</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;"># lister les fichiers dans un dossier</span>
<span style="color: #ff7700;font-weight:bold;">for</span> fichier <span style="color: #ff7700;font-weight:bold;">in</span> dossier.<span style="color: black;">listdir</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
...     <span style="color: #ff7700;font-weight:bold;">print</span> fichier
...
<span style="color: #808080; font-style: italic;">## /etc/thunderbird</span>
<span style="color: #808080; font-style: italic;">## /etc/libpaper.d</span>
<span style="color: #808080; font-style: italic;">## /etc/mtools.conf</span>
<span style="color: #808080; font-style: italic;">## ...</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># lister récursivement les fichiers dans un dossier</span>
<span style="color: #ff7700;font-weight:bold;">for</span> fichier <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: black;">&#40;</span>dossier / <span style="color: #483d8b;">'apt/'</span><span style="color: black;">&#41;</span>.<span style="color: black;">walkfiles</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">print</span> fichier
...
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.save</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/trusted.gpg</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/trusted.gpg~</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/indicator-brightness-ppa-raring.list.save</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/tualatrix-ppa-raring.list</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/webupd8team-sublime-text-2-raring.list</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/fossfreedom-byzanz-raring.list.save</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/hotot-team-ppa-raring.list.save</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/webupd8team-y-ppa-manager-raring.list</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/pitti-postgresql-raring.list.save</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/pitti-postgresql-raring.list</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/yorba-ppa-raring.list.save</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/indicator-brightness-ppa-raring.list</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/webupd8team-sublime-text-2-raring.list.save</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/yorba-ppa-raring.list</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/webupd8team-y-ppa-manager-raring.list.save</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/fossfreedom-byzanz-raring.list</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/trustdb.gpg</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/20dbus</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/10periodic</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/99synaptic</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/70debconf</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/05aptitude</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/20archive</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/01autoremove</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/50unattended-upgrades</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/00aptitude</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/99update-notifier</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/15update-stamp</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/00trustcdrom</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/20changelog</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/01autoremove-kernels</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># et bien d'autres choses</span></pre></td></tr></table></div>

<p>Nous allons donc commenter son code, dans le cadre du tuto (on ne va pas voir les algos en détail). Je mettrai mes commentaires entre <code>#< sm ></ sm ></code> afin de les distinguer du reste.</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">&nbsp;
<span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
<span style="color: #808080; font-style: italic;"># On commence par un bon gros bloc de copyright, sachant que path.py est</span>
<span style="color: #808080; font-style: italic;"># sous MIT License. Le plus inhabituel c'est l'absence de déclaration</span>
<span style="color: #808080; font-style: italic;"># d'encoding en en-tête, qui s'explique par le fait que toute la lib est</span>
<span style="color: #808080; font-style: italic;"># écrite uniquement avec des caractères ASCII, ce qui est l'encodage par</span>
<span style="color: #808080; font-style: italic;"># défaut de Python 2.7. Python 3 a UTF8 en encodage par défaut, mais ASCII</span>
<span style="color: #808080; font-style: italic;"># est un sous-ensemble de UTF8, donc ça ne pose pas de problème.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Notez qu'avec mes commentaires en plus, ça ferait planter le script puisque</span>
<span style="color: #808080; font-style: italic;"># j'utilise des accents.</span>
<span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">#</span>
<span style="color: #808080; font-style: italic;"># Copyright (c) 2010 Mikhail Gusarov</span>
<span style="color: #808080; font-style: italic;">#</span>
<span style="color: #808080; font-style: italic;"># Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span style="color: #808080; font-style: italic;"># of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span style="color: #808080; font-style: italic;"># in the Software without restriction, including without limitation the rights</span>
<span style="color: #808080; font-style: italic;"># to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span style="color: #808080; font-style: italic;"># copies of the Software, and to permit persons to whom the Software is</span>
<span style="color: #808080; font-style: italic;"># furnished to do so, subject to the following conditions:</span>
<span style="color: #808080; font-style: italic;">#</span>
<span style="color: #808080; font-style: italic;"># The above copyright notice and this permission notice shall be included in all</span>
<span style="color: #808080; font-style: italic;"># copies or substantial portions of the Software.</span>
<span style="color: #808080; font-style: italic;">#</span>
<span style="color: #808080; font-style: italic;"># THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span style="color: #808080; font-style: italic;"># IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span style="color: #808080; font-style: italic;"># FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span style="color: #808080; font-style: italic;"># AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span style="color: #808080; font-style: italic;"># LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span style="color: #808080; font-style: italic;"># OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<span style="color: #808080; font-style: italic;"># SOFTWARE.</span>
<span style="color: #808080; font-style: italic;">#</span>
&nbsp;
<span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
<span style="color: #808080; font-style: italic;"># La docstring du module qui documente l'usage général du module. En</span>
<span style="color: #808080; font-style: italic;"># l'occurence au moins l'existence de la classe principale et son usage. Les</span>
<span style="color: #808080; font-style: italic;"># symboles comme '\x40' sont juste une autre représentation d'un caractère</span>
<span style="color: #808080; font-style: italic;"># via sa valeur dans la table ASCII.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Par exemple, '@' est à la case 64 dans la table ASCII, et 64 se note 40 en</span>
<span style="color: #808080; font-style: italic;"># hexadécimal:</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># &gt;&gt;&gt; ord('@')</span>
<span style="color: #808080; font-style: italic;"># 64</span>
<span style="color: #808080; font-style: italic;"># &gt;&gt;&gt; int('40', base=16)</span>
<span style="color: #808080; font-style: italic;"># 64</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Du coup on peut écrire '@' juste avec un caractère d’échappement en Python</span>
<span style="color: #808080; font-style: italic;"># qui va faire le lien. Cette technique est utile si on veut faire passer</span>
<span style="color: #808080; font-style: italic;"># du texte avec des caractères spéciaux dans certains protocoles, par exemple</span>
<span style="color: #808080; font-style: italic;"># quand on veut rentrer un email dans une URL. En l’occurrence je ne vois</span>
<span style="color: #808080; font-style: italic;"># absolument pas ce que ça vient foutre ici.</span>
<span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
&nbsp;
<span style="color: #483d8b;">&quot;&quot;&quot; path.py - An object representing a path to a file or directory.
&nbsp;
Original author:
 Jason Orendorff &lt;jason.orendorff<span style="color: #000099; font-weight: bold;">\x</span>40gmail<span style="color: #000099; font-weight: bold;">\x</span>2ecom&gt;
&nbsp;
Current maintainer:
 Jason R. Coombs &lt;jaraco@jaraco.com&gt;
&nbsp;
Contributors:
 Mikhail Gusarov &lt;dottedmag@dottedmag.net&gt;
 Marc Abramowitz &lt;marc@marc-abramowitz.com&gt;
 Jason R. Coombs &lt;jaraco@jaraco.com&gt;
 Jason Chu &lt;jchu@xentac.net&gt;
 Vojislav Stojkovic &lt;vstojkovic@syntertainment.com&gt;
&nbsp;
Example::
&nbsp;
    from path import path
    d = path('/home/guido/bin')
    for f in d.files('*.py'):
        f.chmod(0755)
&nbsp;
path.py requires Python 2.5 or later.
&quot;&quot;&quot;</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
<span style="color: #808080; font-style: italic;"># Import du mot clé with, car cette lib est compatible avec Python 2.5</span>
<span style="color: #808080; font-style: italic;"># et le keyword est apparu en 2.6. Il a été backporté dans __future__</span>
<span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">__future__</span> <span style="color: #ff7700;font-weight:bold;">import</span> with_statement
&nbsp;
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">sys</span> <span style="color: #808080; font-style: italic;">#&lt;sm&gt;Informations sur le système&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">warnings</span> <span style="color: #808080; font-style: italic;">#&lt;sm&gt;Alertes techniques à d'autres dev&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">os</span> <span style="color: #808080; font-style: italic;">#&lt;sm&gt;Manipulation du File System&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">fnmatch</span> <span style="color: #808080; font-style: italic;">#&lt;sm&gt;Pattern matching comme dans un shell&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">glob</span> <span style="color: #808080; font-style: italic;">#&lt;sm&gt;Lister des fichier avec la syntax shell&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">shutil</span> <span style="color: #808080; font-style: italic;">#&lt;sm&gt;Manipulation de fichiers de haut niveau&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">codecs</span> <span style="color: #808080; font-style: italic;">#&lt;sm&gt;Encoding&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">import</span> hashlib <span style="color: #808080; font-style: italic;">#&lt;sm&gt;Sommes de contrôle&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">errno</span> <span style="color: #808080; font-style: italic;">#&lt;sm&gt;Les codes d'erreurs liées aux fichiers.&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">tempfile</span> <span style="color: #808080; font-style: italic;">#&lt;sm&gt;Création de fichiers temporaires&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">import</span> functools <span style="color: #808080; font-style: italic;">#&lt;sm&gt;Manipulation des fonctions&lt;/sm&gt;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
<span style="color: #808080; font-style: italic;"># Tentative d'utilisation de la lib win32security qui sert à gérer</span>
<span style="color: #808080; font-style: italic;"># des aspects sécuritaires du FS sous Windows. C'est une lib tierce partie,</span>
<span style="color: #808080; font-style: italic;"># et une dépendance optionelle, donc l'import est géré pour ne pas faire</span>
<span style="color: #808080; font-style: italic;"># d'erreur si la lib n'est pas disponible.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Idem pour pwd qui est dans la lib standard mais uniquement sur les distribs</span>
<span style="color: #808080; font-style: italic;"># unix et qui donne accès aux infos sur l'utilisateur du système, tester</span>
<span style="color: #808080; font-style: italic;"># son mot de passe, etc.</span>
<span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">try</span>:
    <span style="color: #ff7700;font-weight:bold;">import</span> win32security
<span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">ImportError</span>:
    <span style="color: #ff7700;font-weight:bold;">pass</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">try</span>:
    <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">pwd</span>
<span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">ImportError</span>:
    <span style="color: #ff7700;font-weight:bold;">pass</span>
&nbsp;
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
<span style="color: #808080; font-style: italic;"># Manière standard de lister la version de la lib dans un module Python.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># __all__ est une variable magique qui peut contenir une liste des noms de</span>
<span style="color: #808080; font-style: italic;"># tout ce qui est importable dans le module, de telle sorte que si</span>
<span style="color: #808080; font-style: italic;"># quelqu'un fait : from path import *, seul le contenu de __all__ soit</span>
<span style="color: #808080; font-style: italic;"># importé.</span>
<span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
__version__ <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'3.0'</span>
__all__ <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span><span style="color: #483d8b;">'path'</span><span style="color: black;">&#93;</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
<span style="color: #808080; font-style: italic;"># Les warnings ressemblent beaucoup aux exceptions excepté qu'ils ne font</span>
<span style="color: #808080; font-style: italic;"># pas planter le programme. Ici donc, ou hérite de la base des warnings</span>
<span style="color: #808080; font-style: italic;"># comme on le ferait pour créer son Exception personnalisée, ce qui va</span>
<span style="color: #808080; font-style: italic;"># permettre à l'utilisateur de la lib path.py de, plus tard, pouvoir filter</span>
<span style="color: #808080; font-style: italic;"># ce warning en particulier.</span>
<span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> TreeWalkWarning<span style="color: black;">&#40;</span><span style="color: #008000;">Warning</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">pass</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
<span style="color: #808080; font-style: italic;"># Un décorateur de mémorisation, c'est à dire qui va mettre en cache les</span>
<span style="color: #808080; font-style: italic;"># résultats de la fonction sur lequel il est appliqué afin que les prochains</span>
<span style="color: #808080; font-style: italic;"># appels avec les mêmes paramètres lisent les valeurs du cache en mémoire</span>
<span style="color: #808080; font-style: italic;"># plutôt que de refaire l'opération.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Il est utilisé plus bas sur :</span>
&nbsp;
<span style="color: #808080; font-style: italic;">#     @classmethod</span>
<span style="color: #808080; font-style: italic;">#     @simple_cache</span>
<span style="color: #808080; font-style: italic;">#     def using_module(cls, module):</span>
<span style="color: #808080; font-style: italic;">#         subclass_name = cls.__name__ + '_' + module.__name__</span>
<span style="color: #808080; font-style: italic;">#         bases = (cls,)</span>
<span style="color: #808080; font-style: italic;">#         ns = {'module': module}</span>
<span style="color: #808080; font-style: italic;">#         return type(subclass_name, bases, ns)</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Ça évitera plusieurs traitements de using_module() si le paramètre de</span>
<span style="color: #808080; font-style: italic;"># 'module' ne change pas.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Et oui, on peut mélanger plusieurs classes et fonctions dans un même module,</span>
<span style="color: #808080; font-style: italic;"># ça n'a pas d'importance.</span>
&nbsp;
<span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">def</span> simple_cache<span style="color: black;">&#40;</span>func<span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot;
    Save results for the 'using_module' classmethod.
    When Python 3.2 is available, use functools.lru_cache instead.
    &quot;&quot;&quot;</span>
    saved_results <span style="color: #66cc66;">=</span> <span style="color: black;">&#123;</span><span style="color: black;">&#125;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> wrapper<span style="color: black;">&#40;</span>cls<span style="color: #66cc66;">,</span> module<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">if</span> module <span style="color: #ff7700;font-weight:bold;">in</span> saved_results:
            <span style="color: #ff7700;font-weight:bold;">return</span> saved_results<span style="color: black;">&#91;</span>module<span style="color: black;">&#93;</span>
        saved_results<span style="color: black;">&#91;</span>module<span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> func<span style="color: black;">&#40;</span>cls<span style="color: #66cc66;">,</span> module<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> saved_results<span style="color: black;">&#91;</span>module<span style="color: black;">&#93;</span>
    <span style="color: #ff7700;font-weight:bold;">return</span> wrapper
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
<span style="color: #808080; font-style: italic;"># Nous avons vu que les propriétés permettaient de déguiser une méthode</span>
<span style="color: #808080; font-style: italic;"># en attribut. Cela ne marche pas sur une méthode de classe car dans ce cas</span>
<span style="color: #808080; font-style: italic;"># la propriété va se retourner elle-même.</span>
<span style="color: #808080; font-style: italic;"># Cette classe hérite de property pour écraser ce comportement et bien</span>
<span style="color: #808080; font-style: italic;"># retourner la valeur de la méthode de classe.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Elle est utilisée plus loin dans:</span>
&nbsp;
<span style="color: #808080; font-style: italic;">#     @ClassProperty</span>
<span style="color: #808080; font-style: italic;">#     @classmethod</span>
<span style="color: #808080; font-style: italic;">#     def _next_class(cls):</span>
<span style="color: #808080; font-style: italic;">#         &quot;&quot;&quot;</span>
<span style="color: #808080; font-style: italic;">#         What class should be used to construct new instances from this class</span>
<span style="color: #808080; font-style: italic;">#         &quot;&quot;&quot;</span>
<span style="color: #808080; font-style: italic;">#         return cls</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Ce qui va permettre de faire path._next_class au lieu de path._next_class().</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># C'est cosmétique, mais c'est le but de la lib d'être jolie.</span>
<span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">class</span> ClassProperty<span style="color: black;">&#40;</span><span style="color: #008000;">property</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__get__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> cls<span style="color: #66cc66;">,</span> owner<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">fget</span>.<span style="color: #0000cd;">__get__</span><span style="color: black;">&#40;</span><span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> owner<span style="color: black;">&#41;</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
<span style="color: #808080; font-style: italic;"># Encore un décorateur, cette fois sous forme de classe (on ne les a pas vu)</span>
<span style="color: #808080; font-style: italic;"># Celui-ci, quand il est appliqué, sert à ce qu'une méthode soit à la fois</span>
<span style="color: #808080; font-style: italic;"># une méthode d'instance et une méthode de classe, le choix se faisant</span>
<span style="color: #808080; font-style: italic;"># dynamiquement selon la situation.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Par exemple dans:</span>
&nbsp;
<span style="color: #808080; font-style: italic;">#     @multimethod</span>
<span style="color: #808080; font-style: italic;">#     def joinpath(cls, first, *others):</span>
<span style="color: #808080; font-style: italic;">#         &quot;&quot;&quot;</span>
<span style="color: #808080; font-style: italic;">#         Join first to zero or more path components, adding a separator</span>
<span style="color: #808080; font-style: italic;">#         character (first.module.sep) if needed.  Returns a new instance of</span>
<span style="color: #808080; font-style: italic;">#         first._next_class.</span>
<span style="color: #808080; font-style: italic;">#         &quot;&quot;&quot;</span>
<span style="color: #808080; font-style: italic;">#         if not isinstance(first, cls):</span>
<span style="color: #808080; font-style: italic;">#             first = cls(first)</span>
<span style="color: #808080; font-style: italic;">#         return first._next_class(first.module.join(first, *others))</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># 'cls' sera une instance ou une classe selon que l'appel se fasse depuis la</span>
<span style="color: #808080; font-style: italic;"># classe ou l'instance.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Notez le nom de la classe qui n'est pas en CamelCase (pas de majuscule)</span>
<span style="color: #808080; font-style: italic;"># alors qu'il s'agit bien d'un classe. Comme c'est un décorateur, on a</span>
<span style="color: #808080; font-style: italic;"># l'habitude de les voir en minuscule, donc on laisse ce nom en minuscule.</span>
<span style="color: #808080; font-style: italic;"># C'est une des rares exceptions au PEP8 (on en verra d'autres plus bas)</span>
<span style="color: #808080; font-style: italic;"># qu'on peut se permettre quand on sait ce qu'on fait :-)</span>
<span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">class</span> multimethod<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot;
    Acts like a classmethod when invoked from the class and like an
    instancemethod when invoked from the instance.
    &quot;&quot;&quot;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> func<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">func</span> <span style="color: #66cc66;">=</span> func
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__get__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> instance<span style="color: #66cc66;">,</span> owner<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#40;</span>
            functools.<span style="color: black;">partial</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">func</span><span style="color: #66cc66;">,</span> owner<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">if</span> instance <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #008000;">None</span>
            <span style="color: #ff7700;font-weight:bold;">else</span> functools.<span style="color: black;">partial</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">func</span><span style="color: #66cc66;">,</span> owner<span style="color: #66cc66;">,</span> instance<span style="color: black;">&#41;</span>
        <span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
<span style="color: #808080; font-style: italic;"># La classe principale, et le plus gros morceau de code. Une classe peut</span>
<span style="color: #808080; font-style: italic;"># tout à fait faire plusieurs centaines de lignes.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># En général je recommande de ne pas avoir de fichiers qui fait plus de 500</span>
<span style="color: #808080; font-style: italic;"># lignes en Python, mais ici le but est clairement de faire une lib qui tient</span>
<span style="color: #808080; font-style: italic;"># dans un fichier pour l'auteur.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># La classe hérite du type unicode (hé oui, on peut hériter des types</span>
<span style="color: #808080; font-style: italic;"># built-in !); ainsi le path peut être manipulé comme une chaîne et reste</span>
<span style="color: #808080; font-style: italic;"># compatible avec tous les outils existants de manipulation de nom de fichiers</span>
<span style="color: #808080; font-style: italic;"># car ils utilisent les chaînes.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># L'héritage est une techno qui sert donc aussi à conserver des compatibilités</span>
<span style="color: #808080; font-style: italic;"># et des comportements existants / attendus.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Encore une fois le nom est en minuscule alors que c'est une classe, c'est une</span>
<span style="color: #808080; font-style: italic;"># autre exception : quand on crée un type de base, on le met en minuscule</span>
<span style="color: #808080; font-style: italic;"># car c'est ce que fait la lib standard (int(), str(), list(), datetime(),</span>
<span style="color: #808080; font-style: italic;"># unicode(), etc, sont en fait des classes).</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># La docstring pourrait être meilleure.</span>
<span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">class</span> path<span style="color: black;">&#40;</span><span style="color: #008000;">unicode</span><span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot; Represents a filesystem path.
&nbsp;
    For documentation on individual methods, consult their
    counterparts in os.path.
    &quot;&quot;&quot;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Probablement mon désaccord principal avec cette lib, l'init vérifie</span>
    <span style="color: #808080; font-style: italic;"># qu'on lui passe bien une chaîne alors que j'aurais choisi le duck typing.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> other<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #008000;">isinstance</span><span style="color: black;">&#40;</span>other<span style="color: #66cc66;">,</span> <span style="color: #008000;">basestring</span><span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">TypeError</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;path must be a string&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># L'auteur stocke la référence de os.path ici, et l'utilise partout à la</span>
    <span style="color: #808080; font-style: italic;"># place d'utiliser os.path directement. Cela permet de changer ce module à</span>
    <span style="color: #808080; font-style: italic;"># la volée, par exemple pour utiliser spécifiquement le module dédié à</span>
    <span style="color: #808080; font-style: italic;"># Windows ou à unix au lieu de celui choisit automatiquement.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># C'est un exemple de pattern stratégie.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Et non, la docstring n'a aucun effet. Ça pourrait être un comment.</span>
    <span style="color: #808080; font-style: italic;"># En revanche, comme spécifié en comment, certains outils comme sphinx</span>
    <span style="color: #808080; font-style: italic;"># prennent les docstring en compte sur les variables.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    module <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">os</span>.<span style="color: black;">path</span>
    <span style="color: #483d8b;">&quot;The path module to use for path operations.&quot;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Une méthode retourne une classe path dont le module est</span>
    <span style="color: #808080; font-style: italic;"># celui passé en paramètre. Pratique si vous voulez</span>
    <span style="color: #808080; font-style: italic;"># utiliser un module spécifique à un OS depuis un autre</span>
    <span style="color: #808080; font-style: italic;"># mais juste ponctuellement.</span>
    <span style="color: #808080; font-style: italic;"># Par exemple sous Windows, vous voulez traiter un chemin</span>
    <span style="color: #808080; font-style: italic;"># (mais un seul, le reste est sous Windows) Unix, vous</span>
    <span style="color: #808080; font-style: italic;"># pouvez faire :</span>
    <span style="color: #808080; font-style: italic;">#</span>
    <span style="color: #808080; font-style: italic;"># &gt;&gt;&gt; import posixpath</span>
    <span style="color: #808080; font-style: italic;"># &gt;&gt;&gt; p = path.using_module(posixpath)('/etc')</span>
    <span style="color: #808080; font-style: italic;"># &gt;&gt;&gt; print p</span>
    <span style="color: #808080; font-style: italic;"># /etc</span>
    <span style="color: #808080; font-style: italic;"># &gt;&gt;&gt; p</span>
    <span style="color: #808080; font-style: italic;"># path_posixpath(u'/etc')</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># ce qui crée un objet path() dont l'attribut 'module' est le module</span>
    <span style="color: #808080; font-style: italic;">#  posixpath. C'est une application concrète de l'injection de dépendance.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
    <span style="color: #66cc66;">@</span><span style="color: #008000;">classmethod</span>
    <span style="color: #66cc66;">@</span>simple_cache
    <span style="color: #ff7700;font-weight:bold;">def</span> using_module<span style="color: black;">&#40;</span>cls<span style="color: #66cc66;">,</span> module<span style="color: black;">&#41;</span>:
        subclass_name <span style="color: #66cc66;">=</span> cls.__name__ + <span style="color: #483d8b;">'_'</span> + module.__name__
        bases <span style="color: #66cc66;">=</span> <span style="color: black;">&#40;</span>cls<span style="color: #66cc66;">,</span><span style="color: black;">&#41;</span>
        ns <span style="color: #66cc66;">=</span> <span style="color: black;">&#123;</span><span style="color: #483d8b;">'module'</span>: module<span style="color: black;">&#125;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">type</span><span style="color: black;">&#40;</span>subclass_name<span style="color: #66cc66;">,</span> bases<span style="color: #66cc66;">,</span> ns<span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Une propriété qui retourne la classe (oui, on peut retourner une CLASSE)</span>
    <span style="color: #808080; font-style: italic;"># à utiliser si on veut créer une nouvelle instance de cette classe.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># C'est très abstrait, vous n'aurez pas à faire ça tous les jours.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># C'est une méthode placée là pour permettre un maximum de configurabilité</span>
    <span style="color: #808080; font-style: italic;"># : si vous changez cette classe, certaines méthodes renverront un autre</span>
    <span style="color: #808080; font-style: italic;"># type plutôt que le type en cours. Utile pour certains cas où vous voulez</span>
    <span style="color: #808080; font-style: italic;"># hériter de path() mais désirez un comportement spécial pour la création</span>
    <span style="color: #808080; font-style: italic;"># de nouveaux path.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
    <span style="color: #66cc66;">@</span>ClassProperty
    <span style="color: #66cc66;">@</span><span style="color: #008000;">classmethod</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> _next_class<span style="color: black;">&#40;</span>cls<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot;
        What class should be used to construct new instances from this class
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> cls
&nbsp;
    <span style="color: #808080; font-style: italic;"># --- Special Python methods.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Là on attaque la définition de toutes les méthodes magiques.</span>
    <span style="color: #808080; font-style: italic;"># Essentiellement pour overrider le comportement par défaut des chaînes</span>
    <span style="color: #808080; font-style: italic;"># unicode et exposer une API sympa.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Dans le shell, un path s'affichera path('chemin') et non 'chemin'</span>
    <span style="color: #808080; font-style: italic;"># L'auteur affiche en fait le nom du type en cours (en cas d'héritage</span>
    <span style="color: #808080; font-style: italic;"># cela changera) et ensuite la représentation du parent, en l'occurence</span>
    <span style="color: #808080; font-style: italic;"># la classe unicode().</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__repr__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #483d8b;">'%s(%s)'</span> % <span style="color: black;">&#40;</span><span style="color: #008000;">type</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>.__name__<span style="color: #66cc66;">,</span> <span style="color: #008000;">super</span><span style="color: black;">&#40;</span>path<span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span><span style="color: black;">&#41;</span>.<span style="color: #0000cd;">__repr__</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Override l'addition.</span>
    <span style="color: #808080; font-style: italic;"># path('truc') + 'machin' donne path('trucmachin')</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Adding a path and a string yields a path.</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__add__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> more<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #008000;">super</span><span style="color: black;">&#40;</span>path<span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span><span style="color: black;">&#41;</span>.<span style="color: #0000cd;">__add__</span><span style="color: black;">&#40;</span>more<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">TypeError</span>:  <span style="color: #808080; font-style: italic;"># Python bug</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">NotImplemented</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># 'machin' + path('truc') donne path('trucmachin')</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__radd__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> other<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #008000;">isinstance</span><span style="color: black;">&#40;</span>other<span style="color: #66cc66;">,</span> <span style="color: #008000;">basestring</span><span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">NotImplemented</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span>other.<span style="color: #0000cd;">__add__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Override la division.</span>
    <span style="color: #808080; font-style: italic;"># path('truc') / 'machin' donne path('truc/machin')</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># The / operator joins paths.</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__div__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> rel<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; fp.__div__(rel) == fp / rel == fp.joinpath(rel)
&nbsp;
        Join two path components, adding a separator character if
        needed.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">join</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> rel<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Petite astuce de compatibilité si le mec a fait</span>
    <span style="color: #808080; font-style: italic;"># from __future__ import division ou si on est en Python 3</span>
    <span style="color: #808080; font-style: italic;">#</span>
    <span style="color: #808080; font-style: italic;"># Remarque : on peut définir des attributs de classe n'importe où, et pas</span>
    <span style="color: #808080; font-style: italic;"># seulement en haut de la classe.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Make the / operator work even when true division is enabled.</span>
    __truediv__ <span style="color: #66cc66;">=</span> <span style="color: #0000cd;">__div__</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># path() est aussi un context manager qu'on peut utiliser avec with !</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># with path('truc'):</span>
    <span style="color: #808080; font-style: italic;">#     tout ce qui est ici se fait dans le dossier truc</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># *_ n'est pas une notation qui a un effet spécial. '_' est un nom de</span>
    <span style="color: #808080; font-style: italic;"># variable valide, c'est une convention pour dire 'je ne vais pas me</span>
    <span style="color: #808080; font-style: italic;"># servir de cet argument, je le déclare juste pour respecter la signature'</span>
    <span style="color: #808080; font-style: italic;"># et '*' est l'opérateur de paramétrage dynamique. '*_' est donc l'auteur</span>
    <span style="color: #808080; font-style: italic;"># signalant qu'il accepte n'importe quels paramètres positionnels, mais</span>
    <span style="color: #808080; font-style: italic;"># qu'ils ne les utilisera pas.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> __enter__<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>._old_dir <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">getcwd</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #dc143c;">os</span>.<span style="color: black;">chdir</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> __exit__<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> *_<span style="color: black;">&#41;</span>:
        <span style="color: #dc143c;">os</span>.<span style="color: black;">chdir</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>._old_dir<span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Le résultat de os.getcwdu(), mais retourne un objet path().</span>
    <span style="color: #808080; font-style: italic;"># Une bonne part du travail de la lib consiste à wrapper les méthodes</span>
    <span style="color: #808080; font-style: italic;"># ordinaires des autres modules pour qu'elles retournent un type path()</span>
    <span style="color: #808080; font-style: italic;"># pour qu'après on puisse faire des '.parent' ou utiliser '/' dessus</span>
    <span style="color: #808080; font-style: italic;"># sans y penser.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #66cc66;">@</span><span style="color: #008000;">classmethod</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> getcwd<span style="color: black;">&#40;</span>cls<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Return the current working directory as a path object. &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> cls<span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span>.<span style="color: black;">getcwdu</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#</span>
    <span style="color: #808080; font-style: italic;"># --- Operations on path strings.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># On enchaine ici des wrappers sur des méthodes de os.path (ou son</span>
    <span style="color: #808080; font-style: italic;"># remplaçant dans self.module), que l'objet s'applique à lui-même (self).</span>
    <span style="color: #808080; font-style: italic;"># Comme la classe hérite de 'unicode', toutes ces méthodes marchent.</span>
    <span style="color: #808080; font-style: italic;"># Et comme self._next_class retourne la classe pour créer le prochain</span>
    <span style="color: #808080; font-style: italic;"># path, on retourne toujours un objet de type 'path'.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Si on fait fi des abstractions et qu'on lit les valeurs par défaut,</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#     self._next_class(self.module.abspath(self))</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># fait en fait:</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#     path(os.path.abspath('ton_chemin'))</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Ce qui donne l'API suivante quand on utilise la lib :</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#     &gt;&gt;&gt; path('/etc/nginx/..').abspath()</span>
    <span style="color: #808080; font-style: italic;">#     path(u'/etc')</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> abspath<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">abspath</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> normcase<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">normcase</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> normpath<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">normpath</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> realpath<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">realpath</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> expanduser<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">expanduser</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> expandvars<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">expandvars</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> dirname<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">dirname</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> basename<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">basename</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Là on rentre dans les méthodes utilitaires. L'auteur a constaté qu'on</span>
    <span style="color: #808080; font-style: italic;"># appelait très souvent ces trois méthodes sur les chemin des fichiers de</span>
    <span style="color: #808080; font-style: italic;"># config genre '~/toto' pour obtenir '/home/sam/toto' et propose donc</span>
    <span style="color: #808080; font-style: italic;"># un shortcut pour le faire car honnêtement, qui se souvient du nom</span>
    <span style="color: #808080; font-style: italic;"># de ces 3 méthodes à enchaîner pour obtenir un truc bullet proof ?</span>
    <span style="color: #808080; font-style: italic;"># Règle d'or d'une belle API : si il faut regarder dans la doc à chaque</span>
    <span style="color: #808080; font-style: italic;"># fois qu'on utilise quelque chose, il faut écrire un meilleur code.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> expand<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Clean up a filename by calling expandvars(),
        expanduser(), and normpath() on it.
&nbsp;
        This is commonly everything needed to clean up a filename
        read from a configuration file, for example.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">expandvars</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">expanduser</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">normpath</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Les méthodes suivantes sont préfixées d'un '_', donc elle n'apparaîtront</span>
    <span style="color: #808080; font-style: italic;"># pas dans les résultats d'outils avec complétion du code. Cela nous</span>
    <span style="color: #808080; font-style: italic;"># indique qu'il s'agit d'un détail d'implémentation, et que l'on ne devrait</span>
    <span style="color: #808080; font-style: italic;"># pas l'utiliser en dehors de la classe. Rien n'empêche de le faire</span>
    <span style="color: #808080; font-style: italic;"># cependant si vous avez envie de faire un beau hack bien gras.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Ici l'auteur fait ce choix car il va enrober ces appels dans des</span>
    <span style="color: #808080; font-style: italic;"># propriétés pour les déguiser en attributs.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Ces 3 méthodes retournent respectivement l'extension de fichier, le nom</span>
    <span style="color: #808080; font-style: italic;"># de fichier sans extension, et la lettre de lecteur sur les chemins</span>
    <span style="color: #808080; font-style: italic;"># windows.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> _get_namebase<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        base<span style="color: #66cc66;">,</span> ext <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">splitext</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">name</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> base
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> _get_ext<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        f<span style="color: #66cc66;">,</span> ext <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">splitext</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> ext
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> _get_drive<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        drive<span style="color: #66cc66;">,</span> r <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">splitdrive</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span>drive<span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Malgré l'indentation bizarre, il s'agit bien de :</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#     attribut_de_classe = function(arg1, arg2, arg3, arg4)</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;"># Dans les tutos précédents vous avez vu comment créer une propriété avec</span>
    <span style="color: #808080; font-style: italic;"># le décorateur @property.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Ici l'auteur utilise l'ancienne façon de faire, car il veut garder la</span>
    <span style="color: #808080; font-style: italic;"># compatibilité avec python 2.5.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># C'est globalement la même chose, par exemple ici l'attribut 'namebase'</span>
    <span style="color: #808080; font-style: italic;"># est défini comme une property et y accéder en lecture va appeler la</span>
    <span style="color: #808080; font-style: italic;"># méthode '_get_namebase'. Le second et le troisième argument de</span>
    <span style="color: #808080; font-style: italic;"># property() sont les setter et les deleter qui ne sont pas ici définis et</span>
    <span style="color: #808080; font-style: italic;"># mis à None (donc l'attribut est en lecture seule). Le dernier argument</span>
    <span style="color: #808080; font-style: italic;"># est la docstring.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    parent <span style="color: #66cc66;">=</span> <span style="color: #008000;">property</span><span style="color: black;">&#40;</span>
        dirname<span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span>
        <span style="color: #483d8b;">&quot;&quot;&quot; This path's parent directory, as a new path object.
&nbsp;
        For example, path('/usr/local/lib/libpython.so').parent == path('/usr/local/lib')
        &quot;&quot;&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    name <span style="color: #66cc66;">=</span> <span style="color: #008000;">property</span><span style="color: black;">&#40;</span>
        basename<span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span>
        <span style="color: #483d8b;">&quot;&quot;&quot; The name of this file or directory without the full path.
&nbsp;
        For example, path('/usr/local/lib/libpython.so').name == 'libpython.so'
        &quot;&quot;&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    namebase <span style="color: #66cc66;">=</span> <span style="color: #008000;">property</span><span style="color: black;">&#40;</span>
        _get_namebase<span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span>
        <span style="color: #483d8b;">&quot;&quot;&quot; The same as path.name, but with one file extension stripped off.
&nbsp;
        For example, path('/home/guido/python.tar.gz').name     == 'python.tar.gz',
        but          path('/home/guido/python.tar.gz').namebase == 'python.tar'
        &quot;&quot;&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    ext <span style="color: #66cc66;">=</span> <span style="color: #008000;">property</span><span style="color: black;">&#40;</span>
        _get_ext<span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span>
        <span style="color: #483d8b;">&quot;&quot;&quot; The file extension, for example '.py'. &quot;&quot;&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    drive <span style="color: #66cc66;">=</span> <span style="color: #008000;">property</span><span style="color: black;">&#40;</span>
        _get_drive<span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span>
        <span style="color: #483d8b;">&quot;&quot;&quot; The drive specifier, for example 'C:'.
        This is always empty on systems that don't use drive specifiers.
        &quot;&quot;&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Encore des wrappers pour retourner des objets path(). La structure</span>
    <span style="color: #808080; font-style: italic;"># est classique: définition de méthodes courtes avec docstring.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># L'auteur retourne un tuple comme les méthodes originales (autant</span>
    <span style="color: #808080; font-style: italic;"># changer le comportement attendu le moins possible), mais cast la</span>
    <span style="color: #808080; font-style: italic;"># première partie du tuple en objet path().</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> splitpath<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; p.splitpath() -&gt; Return (p.parent, p.name). &quot;&quot;&quot;</span>
        parent<span style="color: #66cc66;">,</span> child <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">split</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span>parent<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> child
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> splitdrive<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; p.splitdrive() -&gt; Return (p.drive, &lt;the rest of p&gt;).
&nbsp;
        Split the drive specifier from this path.  If there is
        no drive specifier, p.drive is empty, so the return value
        is simply (path(''), p).  This is always the case on Unix.
        &quot;&quot;&quot;</span>
        drive<span style="color: #66cc66;">,</span> rel <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">splitdrive</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span>drive<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> rel
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> splitext<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; p.splitext() -&gt; Return (p.stripext(), p.ext).
&nbsp;
        Split the filename extension from this path and return
        the two parts.  Either part may be empty.
&nbsp;
        The extension is everything from '.' to the end of the
        last path segment.  This has the property that if
        (a, b) == p.splitext(), then a + b == p.
        &quot;&quot;&quot;</span>
        filename<span style="color: #66cc66;">,</span> ext <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">splitext</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span>filename<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> ext
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Ici on a des méthodes légèrement différentes de celles qu'elles wrappent.</span>
    <span style="color: #808080; font-style: italic;"># C'est vraiment pour se faciliter la tâche sur les opérations courantes</span>
    <span style="color: #808080; font-style: italic;"># et sauver quelques caractères à la frappe.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> stripext<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; p.stripext() -&gt; Remove one file extension from the path.
&nbsp;
        For example, path('/home/guido/python.tar.gz').stripext()
        returns path('/home/guido/python.tar').
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">splitext</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#93;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> splitunc<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        unc<span style="color: #66cc66;">,</span> rest <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">splitunc</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span>unc<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> rest
&nbsp;
    <span style="color: #66cc66;">@</span><span style="color: #008000;">property</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> uncshare<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot;
        The UNC mount point for this path.
        This is empty for paths on local drives.
        &quot;&quot;&quot;</span>
        unc<span style="color: #66cc66;">,</span> r <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">splitunc</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span>unc<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># joinpath cast le premier argument si il n'est pas du même type que la</span>
    <span style="color: #808080; font-style: italic;"># classe en cours. Il n'y a pas de raison apparente, donc je suppose que</span>
    <span style="color: #808080; font-style: italic;"># c'est pour éviter une bug qu'ils ont découvert dans une situation</span>
    <span style="color: #808080; font-style: italic;"># borderline</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #66cc66;">@</span>multimethod
    <span style="color: #ff7700;font-weight:bold;">def</span> joinpath<span style="color: black;">&#40;</span>cls<span style="color: #66cc66;">,</span> first<span style="color: #66cc66;">,</span> *others<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot;
        Join first to zero or more path components, adding a separator
        character (first.module.sep) if needed.  Returns a new instance of
        first._next_class.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #008000;">isinstance</span><span style="color: black;">&#40;</span>first<span style="color: #66cc66;">,</span> cls<span style="color: black;">&#41;</span>:
            first <span style="color: #66cc66;">=</span> cls<span style="color: black;">&#40;</span>first<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> first._next_class<span style="color: black;">&#40;</span>first.<span style="color: black;">module</span>.<span style="color: black;">join</span><span style="color: black;">&#40;</span>first<span style="color: #66cc66;">,</span> *others<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Puis on arrive enfin dans les méthodes métiers qui ne sont pas dans les</span>
    <span style="color: #808080; font-style: italic;"># modules. Typiquement ce seront des méthodes plus longues et inconnues</span>
    <span style="color: #808080; font-style: italic;"># car n'existant pas dans les autres modules donc :</span>
    <span style="color: #808080; font-style: italic;"># - on les met à la fin</span>
    <span style="color: #808080; font-style: italic;"># - la docstring est plus explicite.</span>
    <span style="color: #808080; font-style: italic;"># Ici splitall permet de faire :</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># &gt;&gt;&gt; path('/usr/lib/python2.7/fnmatch.pyc').splitall()</span>
    <span style="color: #808080; font-style: italic;"># [path(u'/'), u'usr', u'lib', u'python2.7', u'fnmatch.pyc']</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Ce que os.path ne permet pas de faire directement.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> splitall<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        r<span style="color: #483d8b;">&quot;&quot;&quot; Return a list of the path components in this path.
&nbsp;
        The first item in the list will be a path.  Its value will be
        either os.curdir, os.pardir, empty, or the root directory of
        this path (for example, ``'/'`` or ``'C:<span style="color: #000099; font-weight: bold;">\\</span>'``).  The other items in
        the list will be strings.
&nbsp;
        ``path.path.joinpath(*result)`` will yield the original path.
        &quot;&quot;&quot;</span>
        parts <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span><span style="color: black;">&#93;</span>
        loc <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>
        <span style="color: #ff7700;font-weight:bold;">while</span> loc <span style="color: #66cc66;">!=</span> <span style="color: #dc143c;">os</span>.<span style="color: black;">curdir</span> <span style="color: #ff7700;font-weight:bold;">and</span> loc <span style="color: #66cc66;">!=</span> <span style="color: #dc143c;">os</span>.<span style="color: black;">pardir</span>:
            prev <span style="color: #66cc66;">=</span> loc
            loc<span style="color: #66cc66;">,</span> child <span style="color: #66cc66;">=</span> prev.<span style="color: black;">splitpath</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> loc <span style="color: #66cc66;">==</span> prev:
                <span style="color: #ff7700;font-weight:bold;">break</span>
            parts.<span style="color: black;">append</span><span style="color: black;">&#40;</span>child<span style="color: black;">&#41;</span>
        parts.<span style="color: black;">append</span><span style="color: black;">&#40;</span>loc<span style="color: black;">&#41;</span>
        parts.<span style="color: black;">reverse</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> parts
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Voici une bonne pratique, avoir une méthode complexe (ici relpathto(),</span>
    <span style="color: #808080; font-style: italic;"># qui crée un chemin relatif du path() courant vers un autre dossier), et</span>
    <span style="color: #808080; font-style: italic;"># son opposée plus simple (ici relpath(), qui crée un chemin relatif d'un</span>
    <span style="color: #808080; font-style: italic;"># dossier vers le path courant) qui utilise la méthode précédente en en</span>
    <span style="color: #808080; font-style: italic;"># inversant juste les paramètres.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># En effet ça ne sert à rien d'écrire deux fois la même méthode, on</span>
    <span style="color: #808080; font-style: italic;"># factorise ainsi du code et respecte le principe DRY (don't repeat</span>
    <span style="color: #808080; font-style: italic;"># yourself).</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># relpathto() est un bon exemple d'un code assez complexe pour une</span>
    <span style="color: #808080; font-style: italic;"># opération qui parait pourtant assez simple. C'est aussi un très bon</span>
    <span style="color: #808080; font-style: italic;"># exemple de comment écrire des commentaires : on ne décrit pas les</span>
    <span style="color: #808080; font-style: italic;"># opérations évidentes mais on explique les choses ambiguës et on met des</span>
    <span style="color: #808080; font-style: italic;"># avertissements</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> relpath<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> start<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'.'</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Return this path as a relative path,
        based from start, which defaults to the current working directory.
        &quot;&quot;&quot;</span>
        cwd <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span>start<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> cwd.<span style="color: black;">relpathto</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> relpathto<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> dest<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Return a relative path from self to dest.
&nbsp;
        If there is no relative path from self to dest, for example if
        they reside on different drives in Windows, then this returns
        dest.abspath().
        &quot;&quot;&quot;</span>
        origin <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">abspath</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        dest <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span>dest<span style="color: black;">&#41;</span>.<span style="color: black;">abspath</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
        orig_list <span style="color: #66cc66;">=</span> origin.<span style="color: black;">normcase</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">splitall</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #808080; font-style: italic;"># Don't normcase dest!  We want to preserve the case.</span>
        dest_list <span style="color: #66cc66;">=</span> dest.<span style="color: black;">splitall</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> orig_list<span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#93;</span> <span style="color: #66cc66;">!=</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">normcase</span><span style="color: black;">&#40;</span>dest_list<span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>:
            <span style="color: #808080; font-style: italic;"># Can't get here from there.</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> dest
&nbsp;
        <span style="color: #808080; font-style: italic;"># Find the location where the two paths start to differ.</span>
        i <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">0</span>
        <span style="color: #ff7700;font-weight:bold;">for</span> start_seg<span style="color: #66cc66;">,</span> dest_seg <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">zip</span><span style="color: black;">&#40;</span>orig_list<span style="color: #66cc66;">,</span> dest_list<span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">if</span> start_seg <span style="color: #66cc66;">!=</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">normcase</span><span style="color: black;">&#40;</span>dest_seg<span style="color: black;">&#41;</span>:
                <span style="color: #ff7700;font-weight:bold;">break</span>
            i +<span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Now i is the point where the two paths diverge.</span>
        <span style="color: #808080; font-style: italic;"># Need a certain number of &quot;os.pardir&quot;s to work up</span>
        <span style="color: #808080; font-style: italic;"># from the origin to the point of divergence.</span>
        segments <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span><span style="color: #dc143c;">os</span>.<span style="color: black;">pardir</span><span style="color: black;">&#93;</span> * <span style="color: black;">&#40;</span><span style="color: #008000;">len</span><span style="color: black;">&#40;</span>orig_list<span style="color: black;">&#41;</span> - i<span style="color: black;">&#41;</span>
        <span style="color: #808080; font-style: italic;"># Need to add the diverging part of dest_list.</span>
        segments +<span style="color: #66cc66;">=</span> dest_list<span style="color: black;">&#91;</span>i:<span style="color: black;">&#93;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">len</span><span style="color: black;">&#40;</span>segments<span style="color: black;">&#41;</span> <span style="color: #66cc66;">==</span> <span style="color: #ff4500;">0</span>:
            <span style="color: #808080; font-style: italic;"># If they happen to be identical, use os.curdir.</span>
            relpath <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">os</span>.<span style="color: black;">curdir</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            relpath <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">join</span><span style="color: black;">&#40;</span>*segments<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span>relpath<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># --- Listing, searching, walking, and matching</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># un simple wrapper mais qui rajoute un argument en plus : un pattern à la</span>
    <span style="color: #808080; font-style: italic;"># unix. C'est une extension naturelle, et c'est le genre de chose que vous</span>
    <span style="color: #808080; font-style: italic;"># vouliez faire et vous vous êtes toujours demandé : &quot;mais pourquoi</span>
    <span style="color: #808080; font-style: italic;"># c'est pas par défaut ?&quot; ou &quot;comment on fait ça facilement ?&quot; Si vous</span>
    <span style="color: #808080; font-style: italic;"># vous posez ce genre de question, étendez un peu les comportements</span>
    <span style="color: #808080; font-style: italic;"># initiaux. Rajouter un argument ne rend pas le comportement différent du</span>
    <span style="color: #808080; font-style: italic;"># précédent grâce au paramètre par défaut mis à None, donc c'est tout</span>
    <span style="color: #808080; font-style: italic;"># bénef.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> listdir<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> pattern<span style="color: #66cc66;">=</span><span style="color: #008000;">None</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; D.listdir() -&gt; List of items in this directory.
&nbsp;
        Use D.files() or D.dirs() instead if you want a listing
        of just files or just subdirectories.
&nbsp;
        The elements of the list are path objects.
&nbsp;
        With the optional 'pattern' argument, this only lists
        items whose names match the given pattern.
        &quot;&quot;&quot;</span>
        names <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">os</span>.<span style="color: black;">listdir</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> pattern <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #008000;">None</span>:
            names <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">fnmatch</span>.<span style="color: #008000;">filter</span><span style="color: black;">&#40;</span>names<span style="color: #66cc66;">,</span> pattern<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#91;</span><span style="color: #008000;">self</span> / child <span style="color: #ff7700;font-weight:bold;">for</span> child <span style="color: #ff7700;font-weight:bold;">in</span> names<span style="color: black;">&#93;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Dans la même lignée de ce qu'on a vu plus haut: utiliser une fonction</span>
    <span style="color: #808080; font-style: italic;"># plus complexe (qui déjà étend un comportement par défaut) pour en</span>
    <span style="color: #808080; font-style: italic;"># faire encore une méthode plus spécialisée.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># L'avantage de cette approche c'est que le code est plein de petites</span>
    <span style="color: #808080; font-style: italic;"># briques:</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># vous avez listdir(), qui est assez court (mais déjà plus puissant),</span>
    <span style="color: #808080; font-style: italic;"># puis dirs() et files(), qui font la même chose en plus spécialisés.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># L'alternative aurait été d'ajouter une param à listdir() et ne pas</span>
    <span style="color: #808080; font-style: italic;"># créer dirs() et files(), mais ça aurait rajouté un if dans le code et</span>
    <span style="color: #808080; font-style: italic;"># un paramètre qui fait rechercher dans la doc celui qui l'utilise et</span>
    <span style="color: #808080; font-style: italic;"># celui qui lit le code.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Avec l'approche actuelle, l'API est très claire :</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># for d in path('/etc').dirs()</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># On s'attend à lire tous les dossiers de /etc. Et les</span>
    <span style="color: #808080; font-style: italic;"># méthodes restent courtes.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> dirs<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> pattern<span style="color: #66cc66;">=</span><span style="color: #008000;">None</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; D.dirs() -&gt; List of this directory's subdirectories.
&nbsp;
        The elements of the list are path objects.
        This does not walk recursively into subdirectories
        (but see path.walkdirs).
&nbsp;
        With the optional 'pattern' argument, this only lists
        directories whose names match the given pattern.  For
        example, ``d.dirs('build-*')``.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#91;</span>p <span style="color: #ff7700;font-weight:bold;">for</span> p <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">self</span>.<span style="color: black;">listdir</span><span style="color: black;">&#40;</span>pattern<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">if</span> p.<span style="color: black;">isdir</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> files<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> pattern<span style="color: #66cc66;">=</span><span style="color: #008000;">None</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; D.files() -&gt; List of the files in this directory.
&nbsp;
        The elements of the list are path objects.
        This does not walk into subdirectories (see path.walkfiles).
&nbsp;
        With the optional 'pattern' argument, this only lists files
        whose names match the given pattern.  For example,
        ``d.files('*.pyc')``.
        &quot;&quot;&quot;</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#91;</span>p <span style="color: #ff7700;font-weight:bold;">for</span> p <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">self</span>.<span style="color: black;">listdir</span><span style="color: black;">&#40;</span>pattern<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">if</span> p.<span style="color: black;">isfile</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># walk() et ses pendants walkdirs() et walkfiles() sont des alternatives</span>
    <span style="color: #808080; font-style: italic;"># au très peu intuitif os.path.walk qui permet de traverser récursivement</span>
    <span style="color: #808080; font-style: italic;"># un répertoire.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># En effet, en Python les callbacks sont quelque chose qu'on utilise peu,</span>
    <span style="color: #808080; font-style: italic;"># et à l'inverse, on itère beaucoup.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Cela permet de faire:</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># for f in path('/etc').walk_files():</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Pour lister récursivement tous les fichiers de /etc et de ses sous</span>
    <span style="color: #808080; font-style: italic;"># (et sous, sous, sous) dossiers.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># C'est clair, c'est simple à comprendre et facile à utiliser.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># L'auteur utilise ici 'yield', et c'est l'outil parfait pour cela.</span>
    <span style="color: #808080; font-style: italic;"># Souvenez vous de 'yield' comme un très bon moyen de parcourir des choses</span>
    <span style="color: #808080; font-style: italic;"># imbriquées comme si c'était une structure plate à une dimension.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Yield permet de transformer n'importe quelle méthode d'un objet en</span>
    <span style="color: #808080; font-style: italic;"># un générateur sur un algorithme qui peut être très complexe, simplifiant</span>
    <span style="color: #808080; font-style: italic;"># son utilisation. Pensez-y !</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Sous le capot, c'est presque un appel récursif, si ce n'est qu'un nouvel</span>
    <span style="color: #808080; font-style: italic;"># objet path() est créé à chaque fois, depuis lequel on fait walk().</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Notez également que sur une méthode comme ça qui peut foirer facilement</span>
    <span style="color: #808080; font-style: italic;"># (une opération sur des centaines de fichiers...), un paramètre permet</span>
    <span style="color: #808080; font-style: italic;"># de choisir une gestion des erreurs parmi :</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># - lever une exception (qui est dans un code propre le choix par défaut)</span>
    <span style="color: #808080; font-style: italic;"># - ignorer (pour faire un code tolérant aux erreurs)</span>
    <span style="color: #808080; font-style: italic;"># - ou faire un retour sans erreur, mais avec un warning technique (utile</span>
    <span style="color: #808080; font-style: italic;">#     pour le scripting)</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Encore une fois, faire une classe, c'est l'occasion de penser à</span>
    <span style="color: #808080; font-style: italic;"># l'utilisateur de la classe, ce qui a été ici bien fait.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Enfin, contrairement à ce qu'on pourrait attendre, walkdirs et walkfiles</span>
    <span style="color: #808080; font-style: italic;"># n'utilisent pas walk(), ce qui est généralement fait pour des raisons de</span>
    <span style="color: #808080; font-style: italic;"># performances (on sacrifie le DRY pour éviter un appel de callback</span>
    <span style="color: #808080; font-style: italic;"># ou un test sur des grosses boucles), même si ici c'est une supposition.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> walk<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> pattern<span style="color: #66cc66;">=</span><span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> errors<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'strict'</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; D.walk() -&gt; iterator over files and subdirs, recursively.
&nbsp;
        The iterator yields path objects naming each child item of
        this directory and its descendants.  This requires that
        D.isdir().
&nbsp;
        This performs a depth-first traversal of the directory tree.
        Each directory is returned just before all its children.
&nbsp;
        The errors= keyword argument controls behavior when an
        error occurs.  The default is 'strict', which causes an
        exception.  The other allowed values are 'warn', which
        reports the error via warnings.warn(), and 'ignore'.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> errors <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">'strict'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'warn'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'ignore'</span><span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">ValueError</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;invalid errors parameter&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            childList <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">listdir</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">Exception</span>:
            <span style="color: #ff7700;font-weight:bold;">if</span> errors <span style="color: #66cc66;">==</span> <span style="color: #483d8b;">'ignore'</span>:
                <span style="color: #ff7700;font-weight:bold;">return</span>
            <span style="color: #ff7700;font-weight:bold;">elif</span> errors <span style="color: #66cc66;">==</span> <span style="color: #483d8b;">'warn'</span>:
                <span style="color: #dc143c;">warnings</span>.<span style="color: black;">warn</span><span style="color: black;">&#40;</span>
                    <span style="color: #483d8b;">&quot;Unable to list directory '%s': %s&quot;</span>
                    % <span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> <span style="color: #dc143c;">sys</span>.<span style="color: black;">exc_info</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                    TreeWalkWarning<span style="color: black;">&#41;</span>
                <span style="color: #ff7700;font-weight:bold;">return</span>
            <span style="color: #ff7700;font-weight:bold;">else</span>:
                <span style="color: #ff7700;font-weight:bold;">raise</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">for</span> child <span style="color: #ff7700;font-weight:bold;">in</span> childList:
            <span style="color: #ff7700;font-weight:bold;">if</span> pattern <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #008000;">None</span> <span style="color: #ff7700;font-weight:bold;">or</span> child.<span style="color: #dc143c;">fnmatch</span><span style="color: black;">&#40;</span>pattern<span style="color: black;">&#41;</span>:
                <span style="color: #ff7700;font-weight:bold;">yield</span> child
            <span style="color: #ff7700;font-weight:bold;">try</span>:
                isdir <span style="color: #66cc66;">=</span> child.<span style="color: black;">isdir</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">Exception</span>:
                <span style="color: #ff7700;font-weight:bold;">if</span> errors <span style="color: #66cc66;">==</span> <span style="color: #483d8b;">'ignore'</span>:
                    isdir <span style="color: #66cc66;">=</span> <span style="color: #008000;">False</span>
                <span style="color: #ff7700;font-weight:bold;">elif</span> errors <span style="color: #66cc66;">==</span> <span style="color: #483d8b;">'warn'</span>:
                    <span style="color: #dc143c;">warnings</span>.<span style="color: black;">warn</span><span style="color: black;">&#40;</span>
                        <span style="color: #483d8b;">&quot;Unable to access '%s': %s&quot;</span>
                        % <span style="color: black;">&#40;</span>child<span style="color: #66cc66;">,</span> <span style="color: #dc143c;">sys</span>.<span style="color: black;">exc_info</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                        TreeWalkWarning<span style="color: black;">&#41;</span>
                    isdir <span style="color: #66cc66;">=</span> <span style="color: #008000;">False</span>
                <span style="color: #ff7700;font-weight:bold;">else</span>:
                    <span style="color: #ff7700;font-weight:bold;">raise</span>
&nbsp;
            <span style="color: #ff7700;font-weight:bold;">if</span> isdir:
                <span style="color: #ff7700;font-weight:bold;">for</span> item <span style="color: #ff7700;font-weight:bold;">in</span> child.<span style="color: black;">walk</span><span style="color: black;">&#40;</span>pattern<span style="color: #66cc66;">,</span> errors<span style="color: black;">&#41;</span>:
                    <span style="color: #ff7700;font-weight:bold;">yield</span> item
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> walkdirs<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> pattern<span style="color: #66cc66;">=</span><span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> errors<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'strict'</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; D.walkdirs() -&gt; iterator over subdirs, recursively.
&nbsp;
        With the optional 'pattern' argument, this yields only
        directories whose names match the given pattern.  For
        example, ``mydir.walkdirs('*test')`` yields only directories
        with names ending in 'test'.
&nbsp;
        The errors= keyword argument controls behavior when an
        error occurs.  The default is 'strict', which causes an
        exception.  The other allowed values are 'warn', which
        reports the error via warnings.warn(), and 'ignore'.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> errors <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">'strict'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'warn'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'ignore'</span><span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">ValueError</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;invalid errors parameter&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            dirs <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">dirs</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">Exception</span>:
            <span style="color: #ff7700;font-weight:bold;">if</span> errors <span style="color: #66cc66;">==</span> <span style="color: #483d8b;">'ignore'</span>:
                <span style="color: #ff7700;font-weight:bold;">return</span>
            <span style="color: #ff7700;font-weight:bold;">elif</span> errors <span style="color: #66cc66;">==</span> <span style="color: #483d8b;">'warn'</span>:
                <span style="color: #dc143c;">warnings</span>.<span style="color: black;">warn</span><span style="color: black;">&#40;</span>
                    <span style="color: #483d8b;">&quot;Unable to list directory '%s': %s&quot;</span>
                    % <span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> <span style="color: #dc143c;">sys</span>.<span style="color: black;">exc_info</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                    TreeWalkWarning<span style="color: black;">&#41;</span>
                <span style="color: #ff7700;font-weight:bold;">return</span>
            <span style="color: #ff7700;font-weight:bold;">else</span>:
                <span style="color: #ff7700;font-weight:bold;">raise</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">for</span> child <span style="color: #ff7700;font-weight:bold;">in</span> dirs:
            <span style="color: #ff7700;font-weight:bold;">if</span> pattern <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #008000;">None</span> <span style="color: #ff7700;font-weight:bold;">or</span> child.<span style="color: #dc143c;">fnmatch</span><span style="color: black;">&#40;</span>pattern<span style="color: black;">&#41;</span>:
                <span style="color: #ff7700;font-weight:bold;">yield</span> child
            <span style="color: #ff7700;font-weight:bold;">for</span> subsubdir <span style="color: #ff7700;font-weight:bold;">in</span> child.<span style="color: black;">walkdirs</span><span style="color: black;">&#40;</span>pattern<span style="color: #66cc66;">,</span> errors<span style="color: black;">&#41;</span>:
                <span style="color: #ff7700;font-weight:bold;">yield</span> subsubdir
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> walkfiles<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> pattern<span style="color: #66cc66;">=</span><span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> errors<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'strict'</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; D.walkfiles() -&gt; iterator over files in D, recursively.
&nbsp;
        The optional argument, pattern, limits the results to files
        with names that match the pattern.  For example,
        ``mydir.walkfiles('*.tmp')`` yields only files with the .tmp
        extension.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> errors <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">'strict'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'warn'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'ignore'</span><span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">ValueError</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;invalid errors parameter&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            childList <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">listdir</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">Exception</span>:
            <span style="color: #ff7700;font-weight:bold;">if</span> errors <span style="color: #66cc66;">==</span> <span style="color: #483d8b;">'ignore'</span>:
                <span style="color: #ff7700;font-weight:bold;">return</span>
            <span style="color: #ff7700;font-weight:bold;">elif</span> errors <span style="color: #66cc66;">==</span> <span style="color: #483d8b;">'warn'</span>:
                <span style="color: #dc143c;">warnings</span>.<span style="color: black;">warn</span><span style="color: black;">&#40;</span>
                    <span style="color: #483d8b;">&quot;Unable to list directory '%s': %s&quot;</span>
                    % <span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> <span style="color: #dc143c;">sys</span>.<span style="color: black;">exc_info</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                    TreeWalkWarning<span style="color: black;">&#41;</span>
                <span style="color: #ff7700;font-weight:bold;">return</span>
            <span style="color: #ff7700;font-weight:bold;">else</span>:
                <span style="color: #ff7700;font-weight:bold;">raise</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">for</span> child <span style="color: #ff7700;font-weight:bold;">in</span> childList:
            <span style="color: #ff7700;font-weight:bold;">try</span>:
                isfile <span style="color: #66cc66;">=</span> child.<span style="color: black;">isfile</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
                isdir <span style="color: #66cc66;">=</span> <span style="color: #ff7700;font-weight:bold;">not</span> isfile <span style="color: #ff7700;font-weight:bold;">and</span> child.<span style="color: black;">isdir</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">except</span>:
                <span style="color: #ff7700;font-weight:bold;">if</span> errors <span style="color: #66cc66;">==</span> <span style="color: #483d8b;">'ignore'</span>:
                    <span style="color: #ff7700;font-weight:bold;">continue</span>
                <span style="color: #ff7700;font-weight:bold;">elif</span> errors <span style="color: #66cc66;">==</span> <span style="color: #483d8b;">'warn'</span>:
                    <span style="color: #dc143c;">warnings</span>.<span style="color: black;">warn</span><span style="color: black;">&#40;</span>
                        <span style="color: #483d8b;">&quot;Unable to access '%s': %s&quot;</span>
                        % <span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> <span style="color: #dc143c;">sys</span>.<span style="color: black;">exc_info</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                        TreeWalkWarning<span style="color: black;">&#41;</span>
                    <span style="color: #ff7700;font-weight:bold;">continue</span>
                <span style="color: #ff7700;font-weight:bold;">else</span>:
                    <span style="color: #ff7700;font-weight:bold;">raise</span>
&nbsp;
            <span style="color: #ff7700;font-weight:bold;">if</span> isfile:
                <span style="color: #ff7700;font-weight:bold;">if</span> pattern <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #008000;">None</span> <span style="color: #ff7700;font-weight:bold;">or</span> child.<span style="color: #dc143c;">fnmatch</span><span style="color: black;">&#40;</span>pattern<span style="color: black;">&#41;</span>:
                    <span style="color: #ff7700;font-weight:bold;">yield</span> child
            <span style="color: #ff7700;font-weight:bold;">elif</span> isdir:
                <span style="color: #ff7700;font-weight:bold;">for</span> f <span style="color: #ff7700;font-weight:bold;">in</span> child.<span style="color: black;">walkfiles</span><span style="color: black;">&#40;</span>pattern<span style="color: #66cc66;">,</span> errors<span style="color: black;">&#41;</span>:
                    <span style="color: #ff7700;font-weight:bold;">yield</span> f
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #dc143c;">fnmatch</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> pattern<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Return True if self.name matches the given pattern.
&nbsp;
        pattern - A filename pattern with wildcards,
            for example ``'*.py'``.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #dc143c;">fnmatch</span>.<span style="color: #dc143c;">fnmatch</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">name</span><span style="color: #66cc66;">,</span> pattern<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #dc143c;">glob</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> pattern<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Return a list of path objects that match the pattern.
&nbsp;
        pattern - a path relative to this directory, with wildcards.
&nbsp;
        For example, path('/users').glob('*/bin/*') returns a list
        of all the files users have in their bin directories.
        &quot;&quot;&quot;</span>
        cls <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>._next_class
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#91;</span>cls<span style="color: black;">&#40;</span>s<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">for</span> s <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #dc143c;">glob</span>.<span style="color: #dc143c;">glob</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span> / pattern<span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#</span>
    <span style="color: #808080; font-style: italic;"># --- Reading or writing an entire file at once.</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> mode<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'r'</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Open this file.  Return a file object. &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> mode<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># L'avantage d'avoir une classe comme point de départ de tout c'est que</span>
    <span style="color: #808080; font-style: italic;"># c'est facile à manipuler dans le shell, surtout en autocompletion.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Donc il est bon de mettre quelques outils qui sont pratiques dans les</span>
    <span style="color: #808080; font-style: italic;"># usages type shell.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Ici c'est exactement le cas : on fait des méthodes un peu bourrines (</span>
    <span style="color: #808080; font-style: italic;"># globalement ça dump en mémoire ou ça écrit tout le fichier d'un coup),</span>
    <span style="color: #808080; font-style: italic;"># mais très pratiques pour manipuler les objets dans un terminal.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Notez aussi le nettoyage opéré:</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#             return (t.replace(u'\r\n', u'\n')</span>
    <span style="color: #808080; font-style: italic;">#                  .replace(u'\r\x85', u'\n')</span>
    <span style="color: #808080; font-style: italic;">#                  .replace(u'\r', u'\n')</span>
    <span style="color: #808080; font-style: italic;">#                  .replace(u'\x85', u'\n')</span>
    <span style="color: #808080; font-style: italic;">#                  .replace(u'\u2028', u'\n'))</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Ce n'est pas particulièrement lié à la POO, mais l'encapsulation de</span>
    <span style="color: #808080; font-style: italic;"># ce genre de process est toujours le bienvenu. L'idée est que l'objet</span>
    <span style="color: #808080; font-style: italic;"># puisse être utilisé comme une boîte noire en laquelle on a totalement</span>
    <span style="color: #808080; font-style: italic;"># confiance.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #dc143c;">bytes</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Open this file, read all bytes, return them as a string. &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">with</span> <span style="color: #008000;">self</span>.<span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'rb'</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> f:
            <span style="color: #ff7700;font-weight:bold;">return</span> f.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> write_bytes<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> <span style="color: #dc143c;">bytes</span><span style="color: #66cc66;">,</span> append<span style="color: #66cc66;">=</span><span style="color: #008000;">False</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Open this file and write the given bytes to it.
&nbsp;
        Default behavior is to overwrite any existing file.
        Call p.write_bytes(bytes, append=True) to append instead.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> append:
            mode <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'ab'</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            mode <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'wb'</span>
        <span style="color: #ff7700;font-weight:bold;">with</span> <span style="color: #008000;">self</span>.<span style="color: #008000;">open</span><span style="color: black;">&#40;</span>mode<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> f:
            f.<span style="color: black;">write</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">bytes</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> text<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> encoding<span style="color: #66cc66;">=</span><span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> errors<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'strict'</span><span style="color: black;">&#41;</span>:
        r<span style="color: #483d8b;">&quot;&quot;&quot; Open this file, read it in, return the content as a string.
&nbsp;
        This method uses 'U' mode, so '<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>' and '<span style="color: #000099; font-weight: bold;">\r</span>' are automatically
        translated to '<span style="color: #000099; font-weight: bold;">\n</span>'.
&nbsp;
        Optional arguments:
&nbsp;
        encoding - The Unicode encoding (or character set) of
            the file.  If present, the content of the file is
            decoded and returned as a unicode object; otherwise
            it is returned as an 8-bit str.
        errors - How to handle Unicode errors; see help(str.decode)
            for the options.  Default is 'strict'.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> encoding <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #008000;">None</span>:
            <span style="color: #808080; font-style: italic;"># 8-bit</span>
            <span style="color: #ff7700;font-weight:bold;">with</span> <span style="color: #008000;">self</span>.<span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'U'</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> f:
                <span style="color: #ff7700;font-weight:bold;">return</span> f.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            <span style="color: #808080; font-style: italic;"># Unicode</span>
            <span style="color: #ff7700;font-weight:bold;">with</span> <span style="color: #dc143c;">codecs</span>.<span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'r'</span><span style="color: #66cc66;">,</span> encoding<span style="color: #66cc66;">,</span> errors<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> f:
                <span style="color: #808080; font-style: italic;"># (Note - Can't use 'U' mode here, since codecs.open</span>
                <span style="color: #808080; font-style: italic;"># doesn't support 'U' mode.)</span>
                t <span style="color: #66cc66;">=</span> f.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#40;</span>t.<span style="color: black;">replace</span><span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #66cc66;">,</span> u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span>
                     .<span style="color: black;">replace</span><span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\x</span>85'</span><span style="color: #66cc66;">,</span> u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span>
                     .<span style="color: black;">replace</span><span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\r</span>'</span><span style="color: #66cc66;">,</span> u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span>
                     .<span style="color: black;">replace</span><span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\x</span>85'</span><span style="color: #66cc66;">,</span> u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span>
                     .<span style="color: black;">replace</span><span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\u</span>2028'</span><span style="color: #66cc66;">,</span> u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Sur des méthodes avec de nombreux paramètres, ne pas hésiter</span>
    <span style="color: #808080; font-style: italic;"># à mettre un maximum de valeurs par défaut &quot;saines&quot; (c'est à dire la</span>
    <span style="color: #808080; font-style: italic;"># valeur du cas le plus courant ou pragmatique).</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Comme c'est une grosse fonction très configurable, la docstring</span>
    <span style="color: #808080; font-style: italic;"># est écrite en conséquence. Ne soyez pas timide avec la dosctring,</span>
    <span style="color: #808080; font-style: italic;"># on peut la faire très très très longue, ce n'est pas une mauvaise</span>
    <span style="color: #808080; font-style: italic;"># chose.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Notez que la docstring est préfixée d'un &quot;r&quot; ici, pour que Python</span>
    <span style="color: #808080; font-style: italic;"># n'interprète pas les \n et \r.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> write_text<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> text<span style="color: #66cc66;">,</span> encoding<span style="color: #66cc66;">=</span><span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> errors<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'strict'</span><span style="color: #66cc66;">,</span> linesep<span style="color: #66cc66;">=</span><span style="color: #dc143c;">os</span>.<span style="color: black;">linesep</span><span style="color: #66cc66;">,</span> append<span style="color: #66cc66;">=</span><span style="color: #008000;">False</span><span style="color: black;">&#41;</span>:
        r<span style="color: #483d8b;">&quot;&quot;&quot; Write the given text to this file.
&nbsp;
        The default behavior is to overwrite any existing file;
        to append instead, use the 'append=True' keyword argument.
&nbsp;
        There are two differences between path.write_text() and
        path.write_bytes(): newline handling and Unicode handling.
        See below.
&nbsp;
        Parameters:
&nbsp;
          - text - str/unicode - The text to be written.
&nbsp;
          - encoding - str - The Unicode encoding that will be used.
            This is ignored if 'text' isn't a Unicode string.
&nbsp;
          - errors - str - How to handle Unicode encoding errors.
            Default is 'strict'.  See help(unicode.encode) for the
            options.  This is ignored if 'text' isn't a Unicode
            string.
&nbsp;
          - linesep - keyword argument - str/unicode - The sequence of
            characters to be used to mark end-of-line.  The default is
            os.linesep.  You can also specify None; this means to
            leave all newlines as they are in 'text'.
&nbsp;
          - append - keyword argument - bool - Specifies what to do if
            the file already exists (True: append to the end of it;
            False: overwrite it.)  The default is False.
&nbsp;
&nbsp;
        --- Newline handling.
&nbsp;
        write_text() converts all standard end-of-line sequences
        ('<span style="color: #000099; font-weight: bold;">\n</span>', '<span style="color: #000099; font-weight: bold;">\r</span>', and '<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>') to your platform's default end-of-line
        sequence (see os.linesep; on Windows, for example, the
        end-of-line marker is '<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>').
&nbsp;
        If you don't like your platform's default, you can override it
        using the 'linesep=' keyword argument.  If you specifically want
        write_text() to preserve the newlines as-is, use 'linesep=None'.
&nbsp;
        This applies to Unicode text the same as to 8-bit text, except
        there are three additional standard Unicode end-of-line sequences:
        u'<span style="color: #000099; font-weight: bold;">\x</span>85', u'<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\x</span>85', and u'<span style="color: #000099; font-weight: bold;">\u</span>2028'.
&nbsp;
        (This is slightly different from when you open a file for
        writing with fopen(filename, &quot;w&quot;) in C or open(filename, 'w')
        in Python.)
&nbsp;
&nbsp;
        --- Unicode
&nbsp;
        If 'text' isn't Unicode, then apart from newline handling, the
        bytes are written verbatim to the file.  The 'encoding' and
        'errors' arguments are not used and must be omitted.
&nbsp;
        If 'text' is Unicode, it is first converted to bytes using the
        specified 'encoding' (or the default encoding if 'encoding'
        isn't specified).  The 'errors' argument applies only to this
        conversion.
&nbsp;
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">isinstance</span><span style="color: black;">&#40;</span>text<span style="color: #66cc66;">,</span> <span style="color: #008000;">unicode</span><span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">if</span> linesep <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #008000;">None</span>:
                <span style="color: #808080; font-style: italic;"># Convert all standard end-of-line sequences to</span>
                <span style="color: #808080; font-style: italic;"># ordinary newline characters.</span>
                text <span style="color: #66cc66;">=</span> <span style="color: black;">&#40;</span>text.<span style="color: black;">replace</span><span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #66cc66;">,</span> u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span>
                            .<span style="color: black;">replace</span><span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\x</span>85'</span><span style="color: #66cc66;">,</span> u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span>
                            .<span style="color: black;">replace</span><span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\r</span>'</span><span style="color: #66cc66;">,</span> u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span>
                            .<span style="color: black;">replace</span><span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\x</span>85'</span><span style="color: #66cc66;">,</span> u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span>
                            .<span style="color: black;">replace</span><span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\u</span>2028'</span><span style="color: #66cc66;">,</span> u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
                text <span style="color: #66cc66;">=</span> text.<span style="color: black;">replace</span><span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #66cc66;">,</span> linesep<span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> encoding <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #008000;">None</span>:
                encoding <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">sys</span>.<span style="color: black;">getdefaultencoding</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
            <span style="color: #dc143c;">bytes</span> <span style="color: #66cc66;">=</span> text.<span style="color: black;">encode</span><span style="color: black;">&#40;</span>encoding<span style="color: #66cc66;">,</span> errors<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            <span style="color: #808080; font-style: italic;"># It is an error to specify an encoding if 'text' is</span>
            <span style="color: #808080; font-style: italic;"># an 8-bit string.</span>
            <span style="color: #ff7700;font-weight:bold;">assert</span> encoding <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #008000;">None</span>
&nbsp;
            <span style="color: #ff7700;font-weight:bold;">if</span> linesep <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #008000;">None</span>:
                text <span style="color: #66cc66;">=</span> <span style="color: black;">&#40;</span>text.<span style="color: black;">replace</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span>
                            .<span style="color: black;">replace</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\r</span>'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
                <span style="color: #dc143c;">bytes</span> <span style="color: #66cc66;">=</span> text.<span style="color: black;">replace</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #66cc66;">,</span> linesep<span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">write_bytes</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">bytes</span><span style="color: #66cc66;">,</span> append<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> lines<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> encoding<span style="color: #66cc66;">=</span><span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> errors<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'strict'</span><span style="color: #66cc66;">,</span> retain<span style="color: #66cc66;">=</span><span style="color: #008000;">True</span><span style="color: black;">&#41;</span>:
        r<span style="color: #483d8b;">&quot;&quot;&quot; Open this file, read all lines, return them in a list.
&nbsp;
        Optional arguments:
            encoding - The Unicode encoding (or character set) of
                the file.  The default is None, meaning the content
                of the file is read as 8-bit characters and returned
                as a list of (non-Unicode) str objects.
            errors - How to handle Unicode errors; see help(str.decode)
                for the options.  Default is 'strict'
            retain - If true, retain newline characters; but all newline
                character combinations ('<span style="color: #000099; font-weight: bold;">\r</span>', '<span style="color: #000099; font-weight: bold;">\n</span>', '<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>') are
                translated to '<span style="color: #000099; font-weight: bold;">\n</span>'.  If false, newline characters are
                stripped off.  Default is True.
&nbsp;
        This uses 'U' mode.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> encoding <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #008000;">None</span> <span style="color: #ff7700;font-weight:bold;">and</span> retain:
            <span style="color: #ff7700;font-weight:bold;">with</span> <span style="color: #008000;">self</span>.<span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'U'</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> f:
                <span style="color: #ff7700;font-weight:bold;">return</span> f.<span style="color: black;">readlines</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">text</span><span style="color: black;">&#40;</span>encoding<span style="color: #66cc66;">,</span> errors<span style="color: black;">&#41;</span>.<span style="color: black;">splitlines</span><span style="color: black;">&#40;</span>retain<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> write_lines<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> lines<span style="color: #66cc66;">,</span> encoding<span style="color: #66cc66;">=</span><span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> errors<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'strict'</span><span style="color: #66cc66;">,</span>
                    linesep<span style="color: #66cc66;">=</span><span style="color: #dc143c;">os</span>.<span style="color: black;">linesep</span><span style="color: #66cc66;">,</span> append<span style="color: #66cc66;">=</span><span style="color: #008000;">False</span><span style="color: black;">&#41;</span>:
        r<span style="color: #483d8b;">&quot;&quot;&quot; Write the given lines of text to this file.
&nbsp;
        By default this overwrites any existing file at this path.
&nbsp;
        This puts a platform-specific newline sequence on every line.
        See 'linesep' below.
&nbsp;
        lines - A list of strings.
&nbsp;
        encoding - A Unicode encoding to use.  This applies only if
            'lines' contains any Unicode strings.
&nbsp;
        errors - How to handle errors in Unicode encoding.  This
            also applies only to Unicode strings.
&nbsp;
        linesep - The desired line-ending.  This line-ending is
            applied to every line.  If a line already has any
            standard line ending ('<span style="color: #000099; font-weight: bold;">\r</span>', '<span style="color: #000099; font-weight: bold;">\n</span>', '<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>', u'<span style="color: #000099; font-weight: bold;">\x</span>85',
            u'<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\x</span>85', u'<span style="color: #000099; font-weight: bold;">\u</span>2028'), that will be stripped off and
            this will be used instead.  The default is os.linesep,
            which is platform-dependent ('<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>' on Windows, '<span style="color: #000099; font-weight: bold;">\n</span>' on
            Unix, etc.)  Specify None to write the lines as-is,
            like file.writelines().
&nbsp;
        Use the keyword argument append=True to append lines to the
        file.  The default is to overwrite the file.  Warning:
        When you use this with Unicode data, if the encoding of the
        existing data in the file is different from the encoding
        you specify with the encoding= parameter, the result is
        mixed-encoding data, which can really confuse someone trying
        to read the file later.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> append:
            mode <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'ab'</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            mode <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'wb'</span>
        <span style="color: #ff7700;font-weight:bold;">with</span> <span style="color: #008000;">self</span>.<span style="color: #008000;">open</span><span style="color: black;">&#40;</span>mode<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> f:
            <span style="color: #ff7700;font-weight:bold;">for</span> line <span style="color: #ff7700;font-weight:bold;">in</span> lines:
                isUnicode <span style="color: #66cc66;">=</span> <span style="color: #008000;">isinstance</span><span style="color: black;">&#40;</span>line<span style="color: #66cc66;">,</span> <span style="color: #008000;">unicode</span><span style="color: black;">&#41;</span>
                <span style="color: #ff7700;font-weight:bold;">if</span> linesep <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #008000;">None</span>:
                    <span style="color: #808080; font-style: italic;"># Strip off any existing line-end and add the</span>
                    <span style="color: #808080; font-style: italic;"># specified linesep string.</span>
                    <span style="color: #ff7700;font-weight:bold;">if</span> isUnicode:
                        <span style="color: #ff7700;font-weight:bold;">if</span> line<span style="color: black;">&#91;</span>-<span style="color: #ff4500;">2</span>:<span style="color: black;">&#93;</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #66cc66;">,</span> u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\x</span>0d<span style="color: #000099; font-weight: bold;">\x</span>85'</span><span style="color: black;">&#41;</span>:
                            line <span style="color: #66cc66;">=</span> line<span style="color: black;">&#91;</span>:-<span style="color: #ff4500;">2</span><span style="color: black;">&#93;</span>
                        <span style="color: #ff7700;font-weight:bold;">elif</span> line<span style="color: black;">&#91;</span>-<span style="color: #ff4500;">1</span>:<span style="color: black;">&#93;</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\r</span>'</span><span style="color: #66cc66;">,</span> u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #66cc66;">,</span>
                                           u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\x</span>85'</span><span style="color: #66cc66;">,</span> u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\u</span>2028'</span><span style="color: black;">&#41;</span>:
                            line <span style="color: #66cc66;">=</span> line<span style="color: black;">&#91;</span>:-<span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span>
                    <span style="color: #ff7700;font-weight:bold;">else</span>:
                        <span style="color: #ff7700;font-weight:bold;">if</span> line<span style="color: black;">&#91;</span>-<span style="color: #ff4500;">2</span>:<span style="color: black;">&#93;</span> <span style="color: #66cc66;">==</span> <span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>'</span>:
                            line <span style="color: #66cc66;">=</span> line<span style="color: black;">&#91;</span>:-<span style="color: #ff4500;">2</span><span style="color: black;">&#93;</span>
                        <span style="color: #ff7700;font-weight:bold;">elif</span> line<span style="color: black;">&#91;</span>-<span style="color: #ff4500;">1</span>:<span style="color: black;">&#93;</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\r</span>'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span>:
                            line <span style="color: #66cc66;">=</span> line<span style="color: black;">&#91;</span>:-<span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span>
                    line +<span style="color: #66cc66;">=</span> linesep
                <span style="color: #ff7700;font-weight:bold;">if</span> isUnicode:
                    <span style="color: #ff7700;font-weight:bold;">if</span> encoding <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #008000;">None</span>:
                        encoding <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">sys</span>.<span style="color: black;">getdefaultencoding</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
                    line <span style="color: #66cc66;">=</span> line.<span style="color: black;">encode</span><span style="color: black;">&#40;</span>encoding<span style="color: #66cc66;">,</span> errors<span style="color: black;">&#41;</span>
                f.<span style="color: black;">write</span><span style="color: black;">&#40;</span>line<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> read_md5<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Calculate the md5 hash for this file.
&nbsp;
        This reads through the entire file.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">read_hash</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'md5'</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> _hash<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> hash_name<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">with</span> <span style="color: #008000;">self</span>.<span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'rb'</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> f:
            m <span style="color: #66cc66;">=</span> hashlib.<span style="color: #dc143c;">new</span><span style="color: black;">&#40;</span>hash_name<span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">while</span> <span style="color: #008000;">True</span>:
                d <span style="color: #66cc66;">=</span> f.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">8192</span><span style="color: black;">&#41;</span>
                <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> d:
                    <span style="color: #ff7700;font-weight:bold;">break</span>
                m.<span style="color: black;">update</span><span style="color: black;">&#40;</span>d<span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> m
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> read_hash<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> hash_name<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Calculate given hash for this file.
&nbsp;
        List of supported hashes can be obtained from hashlib package. This
        reads the entire file.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._hash<span style="color: black;">&#40;</span>hash_name<span style="color: black;">&#41;</span>.<span style="color: black;">digest</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> read_hexhash<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> hash_name<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Calculate given hash for this file, returning hexdigest.
&nbsp;
        List of supported hashes can be obtained from hashlib package. This
        reads the entire file.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._hash<span style="color: black;">&#40;</span>hash_name<span style="color: black;">&#41;</span>.<span style="color: black;">hexdigest</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Comme les fonctions, les méthodes peuvent être définies sur une ligne si</span>
    <span style="color: #808080; font-style: italic;"># le bloc ne fait qu'une ligne de taille. On utilise ça quand la fonction</span>
    <span style="color: #808080; font-style: italic;"># est juste un alias un peu avancé comme ici pour garder un style quasi</span>
    <span style="color: #808080; font-style: italic;"># déclaratif.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># --- Methods for querying the filesystem.</span>
    <span style="color: #808080; font-style: italic;"># N.B. On some platforms, the os.path functions may be implemented in C</span>
    <span style="color: #808080; font-style: italic;"># (e.g. isdir on Windows, Python 3.2.2), and compiled functions don't get</span>
    <span style="color: #808080; font-style: italic;"># bound. Playing it safe and wrapping them all in method calls.</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> isabs<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">isabs</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> exists<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">exists</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> isdir<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">isdir</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> isfile<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">isfile</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> islink<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">islink</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> ismount<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">ismount</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> samefile<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">samefile</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> getatime<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">getatime</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
    atime <span style="color: #66cc66;">=</span> <span style="color: #008000;">property</span><span style="color: black;">&#40;</span>
        getatime<span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span>
        <span style="color: #483d8b;">&quot;&quot;&quot; Last access time of the file. &quot;&quot;&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> getmtime<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">getmtime</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
    mtime <span style="color: #66cc66;">=</span> <span style="color: #008000;">property</span><span style="color: black;">&#40;</span>
        getmtime<span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span>
        <span style="color: #483d8b;">&quot;&quot;&quot; Last-modified time of the file. &quot;&quot;&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> getctime<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">getctime</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
    ctime <span style="color: #66cc66;">=</span> <span style="color: #008000;">property</span><span style="color: black;">&#40;</span>
        getctime<span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span>
        <span style="color: #483d8b;">&quot;&quot;&quot; Creation time of the file. &quot;&quot;&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> getsize<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">getsize</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
    size <span style="color: #66cc66;">=</span> <span style="color: #008000;">property</span><span style="color: black;">&#40;</span>
        getsize<span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span>
        <span style="color: #483d8b;">&quot;&quot;&quot; Size of the file, in bytes. &quot;&quot;&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Technique intéressante : on peut générer dynamiquement le corps de</span>
    <span style="color: #808080; font-style: italic;"># la classe. En effet, il peut contenir des if, des try, des for, etc.</span>
    <span style="color: #808080; font-style: italic;"># Ici par exemple, on ne définit la méthode access() que si le module</span>
    <span style="color: #808080; font-style: italic;"># 'os' possède l'attribut 'access'.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Si ce n'est pas le cas, la classe n'aura pas cette méthode.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'access'</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">def</span> access<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> mode<span style="color: black;">&#41;</span>:
            <span style="color: #483d8b;">&quot;&quot;&quot; Return true if current user has access to this path.
&nbsp;
            mode - One of the constants os.F_OK, os.R_OK, os.W_OK, os.X_OK
            &quot;&quot;&quot;</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #dc143c;">os</span>.<span style="color: black;">access</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> mode<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #dc143c;">stat</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Perform a stat() system call on this path. &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #dc143c;">os</span>.<span style="color: #dc143c;">stat</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> lstat<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Like path.stat(), but do not follow symbolic links. &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #dc143c;">os</span>.<span style="color: black;">lstat</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Une autre technique intéressante : une des rares utilisation du double</span>
    <span style="color: #808080; font-style: italic;"># '_' en tant que préfixe qui ait du sens. '__method' interdit d'accéder</span>
    <span style="color: #808080; font-style: italic;"># directement à la méthode depuis l'extérieur. C'est ce qu'on a de plus</span>
    <span style="color: #808080; font-style: italic;"># proche de &quot;private&quot; en Python.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Ce n'est pas sécurisé du tout (on peut le contourner) et cela empêche le</span>
    <span style="color: #808080; font-style: italic;"># monkey patching et autres mesures de contournement en cas de besoin,</span>
    <span style="color: #808080; font-style: italic;"># donc je ne vous recommande pas de le faire.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Mais dans ce cas, ces méthodes sont volontairement définies ainsi pour</span>
    <span style="color: #808080; font-style: italic;"># être invisibles puis un peu plus bas, si win32security ou pwd existent</span>
    <span style="color: #808080; font-style: italic;"># (rappelez-vous, ce sont des dépendances optionnelles), alors elles sont</span>
    <span style="color: #808080; font-style: italic;"># aliasées pour être rendues disponibles.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Il y a 3 implémentations (3 méthodes: une pour windows, une pour unix et</span>
    <span style="color: #808080; font-style: italic;"># une pour le cas où aucun module n'est présent) pour la même</span>
    <span style="color: #808080; font-style: italic;"># fonctionnalité, et l'une des 3 méthodes est utilisée comme</span>
    <span style="color: #808080; font-style: italic;"># implémentation de get_owner().</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># On aurait pu tout mettre dans des if directement, mais ça ferait des</span>
    <span style="color: #808080; font-style: italic;"># gros blocs moins lisibles. Ici il est facile de comprendre le code</span>
    <span style="color: #808080; font-style: italic;"># source.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> __get_owner_windows<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        r<span style="color: #483d8b;">&quot;&quot;&quot;
        Return the name of the owner of this file or directory. Follow
        symbolic links.
&nbsp;
        Return a name of the form ur'DOMAIN<span style="color: #000099; font-weight: bold;">\U</span>ser Name'; may be a group.
        &quot;&quot;&quot;</span>
        desc <span style="color: #66cc66;">=</span> win32security.<span style="color: black;">GetFileSecurity</span><span style="color: black;">&#40;</span>
            <span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> win32security.<span style="color: black;">OWNER_SECURITY_INFORMATION</span><span style="color: black;">&#41;</span>
        sid <span style="color: #66cc66;">=</span> desc.<span style="color: black;">GetSecurityDescriptorOwner</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        account<span style="color: #66cc66;">,</span> domain<span style="color: #66cc66;">,</span> typecode <span style="color: #66cc66;">=</span> win32security.<span style="color: black;">LookupAccountSid</span><span style="color: black;">&#40;</span><span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> sid<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> domain + u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\\</span>'</span> + account
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> __get_owner_unix<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot;
        Return the name of the owner of this file or directory. Follow
        symbolic links.
        &quot;&quot;&quot;</span>
        st <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: #dc143c;">stat</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #dc143c;">pwd</span>.<span style="color: black;">getpwuid</span><span style="color: black;">&#40;</span>st.<span style="color: black;">st_uid</span><span style="color: black;">&#41;</span>.<span style="color: black;">pw_name</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> __get_owner_not_implemented<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">NotImplementedError</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Ownership not available on this platform.&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #483d8b;">'win32security'</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">globals</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
        get_owner <span style="color: #66cc66;">=</span> __get_owner_windows
    <span style="color: #ff7700;font-weight:bold;">elif</span> <span style="color: #483d8b;">'pwd'</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">globals</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
        get_owner <span style="color: #66cc66;">=</span> __get_owner_unix
    <span style="color: #ff7700;font-weight:bold;">else</span>:
        get_owner <span style="color: #66cc66;">=</span> __get_owner_not_implemented
&nbsp;
    owner <span style="color: #66cc66;">=</span> <span style="color: #008000;">property</span><span style="color: black;">&#40;</span>
        get_owner<span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span>
        <span style="color: #483d8b;">&quot;&quot;&quot; Name of the owner of this file or directory. &quot;&quot;&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'statvfs'</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #dc143c;">statvfs</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
            <span style="color: #483d8b;">&quot;&quot;&quot; Perform a statvfs() system call on this path. &quot;&quot;&quot;</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #dc143c;">os</span>.<span style="color: #dc143c;">statvfs</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'pathconf'</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">def</span> pathconf<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> name<span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #dc143c;">os</span>.<span style="color: black;">pathconf</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> name<span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Pas d'autres commentaires après celui-là. jusqu'à la classe de fin.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Les méthodes suivantes retournent 'self' bien que ce ne soit</span>
    <span style="color: #808080; font-style: italic;"># pas nécessaire.</span>
    <span style="color: #808080; font-style: italic;"># Par exemple path('/tmp/test').chmod(777) va retourner path('/tmp/test')</span>
    <span style="color: #808080; font-style: italic;"># alors que tout ce qu'on lui demande, c'est de changer la permission</span>
    <span style="color: #808080; font-style: italic;"># du dossier. On le fait pour permettre le chaîning, c'est à dire</span>
    <span style="color: #808080; font-style: italic;"># d'autoriser les appels enchainés comme :</span>
    <span style="color: #808080; font-style: italic;"># path('/tmp/test').chmod(777).rename('/tmp/essai').mkdir('ping')</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#</span>
    <span style="color: #808080; font-style: italic;"># --- Modifying operations on files and directories</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> utime<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> times<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Set the access and modified times of this file. &quot;&quot;&quot;</span>
        <span style="color: #dc143c;">os</span>.<span style="color: black;">utime</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> times<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> chmod<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> mode<span style="color: black;">&#41;</span>:
        <span style="color: #dc143c;">os</span>.<span style="color: black;">chmod</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> mode<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'chown'</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">def</span> chown<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> uid<span style="color: #66cc66;">,</span> gid<span style="color: black;">&#41;</span>:
            <span style="color: #dc143c;">os</span>.<span style="color: black;">chown</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> uid<span style="color: #66cc66;">,</span> gid<span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> rename<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> <span style="color: #dc143c;">new</span><span style="color: black;">&#41;</span>:
        <span style="color: #dc143c;">os</span>.<span style="color: black;">rename</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> <span style="color: #dc143c;">new</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #dc143c;">new</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> renames<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> <span style="color: #dc143c;">new</span><span style="color: black;">&#41;</span>:
        <span style="color: #dc143c;">os</span>.<span style="color: black;">renames</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> <span style="color: #dc143c;">new</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #dc143c;">new</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#</span>
    <span style="color: #808080; font-style: italic;"># --- Create/delete operations on directories</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> mkdir<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> mode<span style="color: #66cc66;">=</span><span style="color: #ff4500;">0777</span><span style="color: black;">&#41;</span>:
        <span style="color: #dc143c;">os</span>.<span style="color: black;">mkdir</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> mode<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> mkdir_p<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> mode<span style="color: #66cc66;">=</span><span style="color: #ff4500;">0777</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            <span style="color: #008000;">self</span>.<span style="color: black;">mkdir</span><span style="color: black;">&#40;</span>mode<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">OSError</span><span style="color: #66cc66;">,</span> e:
            <span style="color: #ff7700;font-weight:bold;">if</span> e.<span style="color: #dc143c;">errno</span> <span style="color: #66cc66;">!=</span> <span style="color: #dc143c;">errno</span>.<span style="color: black;">EEXIST</span>:
                <span style="color: #ff7700;font-weight:bold;">raise</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> makedirs<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> mode<span style="color: #66cc66;">=</span><span style="color: #ff4500;">0777</span><span style="color: black;">&#41;</span>:
        <span style="color: #dc143c;">os</span>.<span style="color: black;">makedirs</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> mode<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> makedirs_p<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> mode<span style="color: #66cc66;">=</span><span style="color: #ff4500;">0777</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            <span style="color: #008000;">self</span>.<span style="color: black;">makedirs</span><span style="color: black;">&#40;</span>mode<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">OSError</span><span style="color: #66cc66;">,</span> e:
            <span style="color: #ff7700;font-weight:bold;">if</span> e.<span style="color: #dc143c;">errno</span> <span style="color: #66cc66;">!=</span> <span style="color: #dc143c;">errno</span>.<span style="color: black;">EEXIST</span>:
                <span style="color: #ff7700;font-weight:bold;">raise</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> rmdir<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #dc143c;">os</span>.<span style="color: black;">rmdir</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> rmdir_p<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            <span style="color: #008000;">self</span>.<span style="color: black;">rmdir</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">OSError</span><span style="color: #66cc66;">,</span> e:
            <span style="color: #ff7700;font-weight:bold;">if</span> e.<span style="color: #dc143c;">errno</span> <span style="color: #66cc66;">!=</span> <span style="color: #dc143c;">errno</span>.<span style="color: black;">ENOTEMPTY</span> <span style="color: #ff7700;font-weight:bold;">and</span> e.<span style="color: #dc143c;">errno</span> <span style="color: #66cc66;">!=</span> <span style="color: #dc143c;">errno</span>.<span style="color: black;">EEXIST</span>:
                <span style="color: #ff7700;font-weight:bold;">raise</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> removedirs<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #dc143c;">os</span>.<span style="color: black;">removedirs</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> removedirs_p<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            <span style="color: #008000;">self</span>.<span style="color: black;">removedirs</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">OSError</span><span style="color: #66cc66;">,</span> e:
            <span style="color: #ff7700;font-weight:bold;">if</span> e.<span style="color: #dc143c;">errno</span> <span style="color: #66cc66;">!=</span> <span style="color: #dc143c;">errno</span>.<span style="color: black;">ENOTEMPTY</span> <span style="color: #ff7700;font-weight:bold;">and</span> e.<span style="color: #dc143c;">errno</span> <span style="color: #66cc66;">!=</span> <span style="color: #dc143c;">errno</span>.<span style="color: black;">EEXIST</span>:
                <span style="color: #ff7700;font-weight:bold;">raise</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># --- Modifying operations on files</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> touch<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Set the access/modified times of this file to the current time.
        Create the file if it does not exist.
        &quot;&quot;&quot;</span>
        fd <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">os</span>.<span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> <span style="color: #dc143c;">os</span>.<span style="color: black;">O_WRONLY</span> | <span style="color: #dc143c;">os</span>.<span style="color: black;">O_CREAT</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0666</span><span style="color: black;">&#41;</span>
        <span style="color: #dc143c;">os</span>.<span style="color: black;">close</span><span style="color: black;">&#40;</span>fd<span style="color: black;">&#41;</span>
        <span style="color: #dc143c;">os</span>.<span style="color: black;">utime</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> remove<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #dc143c;">os</span>.<span style="color: black;">remove</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> remove_p<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            <span style="color: #008000;">self</span>.<span style="color: black;">unlink</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">OSError</span><span style="color: #66cc66;">,</span> e:
            <span style="color: #ff7700;font-weight:bold;">if</span> e.<span style="color: #dc143c;">errno</span> <span style="color: #66cc66;">!=</span> <span style="color: #dc143c;">errno</span>.<span style="color: black;">ENOENT</span>:
                <span style="color: #ff7700;font-weight:bold;">raise</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> unlink<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #dc143c;">os</span>.<span style="color: black;">unlink</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> unlink_p<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">remove_p</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># --- Links</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'link'</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">def</span> link<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> newpath<span style="color: black;">&#41;</span>:
            <span style="color: #483d8b;">&quot;&quot;&quot; Create a hard link at 'newpath', pointing to this file. &quot;&quot;&quot;</span>
            <span style="color: #dc143c;">os</span>.<span style="color: black;">link</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> newpath<span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span>newpath<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'symlink'</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">def</span> symlink<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> newlink<span style="color: black;">&#41;</span>:
            <span style="color: #483d8b;">&quot;&quot;&quot; Create a symbolic link at 'newlink', pointing here. &quot;&quot;&quot;</span>
            <span style="color: #dc143c;">os</span>.<span style="color: black;">symlink</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> newlink<span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span>newlink<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'readlink'</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">def</span> readlink<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
            <span style="color: #483d8b;">&quot;&quot;&quot; Return the path to which this symbolic link points.
&nbsp;
            The result may be an absolute or a relative path.
            &quot;&quot;&quot;</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span>.<span style="color: black;">readlink</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">def</span> readlinkabs<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
            <span style="color: #483d8b;">&quot;&quot;&quot; Return the path to which this symbolic link points.
&nbsp;
            The result is always an absolute path.
            &quot;&quot;&quot;</span>
            p <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">readlink</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> p.<span style="color: black;">isabs</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
                <span style="color: #ff7700;font-weight:bold;">return</span> p
            <span style="color: #ff7700;font-weight:bold;">else</span>:
                <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">parent</span> / p<span style="color: black;">&#41;</span>.<span style="color: black;">abspath</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#</span>
    <span style="color: #808080; font-style: italic;"># --- High-level functions from shutil</span>
&nbsp;
    copyfile <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">shutil</span>.<span style="color: black;">copyfile</span>
    copymode <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">shutil</span>.<span style="color: black;">copymode</span>
    copystat <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">shutil</span>.<span style="color: black;">copystat</span>
    <span style="color: #dc143c;">copy</span> <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">shutil</span>.<span style="color: #dc143c;">copy</span>
    copy2 <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">shutil</span>.<span style="color: black;">copy2</span>
    copytree <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">shutil</span>.<span style="color: black;">copytree</span>
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">shutil</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'move'</span><span style="color: black;">&#41;</span>:
        move <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">shutil</span>.<span style="color: black;">move</span>
    rmtree <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">shutil</span>.<span style="color: black;">rmtree</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> rmtree_p<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            <span style="color: #008000;">self</span>.<span style="color: black;">rmtree</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">OSError</span><span style="color: #66cc66;">,</span> e:
            <span style="color: #ff7700;font-weight:bold;">if</span> e.<span style="color: #dc143c;">errno</span> <span style="color: #66cc66;">!=</span> <span style="color: #dc143c;">errno</span>.<span style="color: black;">ENOENT</span>:
                <span style="color: #ff7700;font-weight:bold;">raise</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#</span>
    <span style="color: #808080; font-style: italic;"># --- Special stuff from os</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'chroot'</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">def</span> chroot<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
            <span style="color: #dc143c;">os</span>.<span style="color: black;">chroot</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'startfile'</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">def</span> startfile<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
            <span style="color: #dc143c;">os</span>.<span style="color: black;">startfile</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
<span style="color: #808080; font-style: italic;"># La seule spécificité de cette classe est d'overrider la méthode __new__ qui</span>
<span style="color: #808080; font-style: italic;"># est le véritable constructeur en Python (__init__ n'est pas un constructeur)</span>
<span style="color: #808080; font-style: italic;"># L'auteur le fait car tempdir hérite de path qui hérite d'unicode. Or, tous</span>
<span style="color: #808080; font-style: italic;"># les types non-mutables (int, tuple, str, etc, et donc unicode), n'étant pas</span>
<span style="color: #808080; font-style: italic;"># modifiables, ne peuvent être changés dans __init__. Ici __new__ est</span>
<span style="color: #808080; font-style: italic;"># utilisé pour retourner un path tout en créant un dossier temporaire, ce</span>
<span style="color: #808080; font-style: italic;"># qui ne marcherait pas dans __init__. Il est très rare d'avoir besoin de</span>
<span style="color: #808080; font-style: italic;"># s'occuper de __new__.</span>
<span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> tempdir<span style="color: black;">&#40;</span>path<span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot;
    A temporary directory via tempfile.mkdtemp, and constructed with the
    same parameters that you can use as a context manager.
&nbsp;
    Example:
&nbsp;
        with tempdir() as d:
            # do stuff with the path object &quot;d&quot;
&nbsp;
        # here the directory is deleted automatically
    &quot;&quot;&quot;</span>
&nbsp;
    <span style="color: #66cc66;">@</span>ClassProperty
    <span style="color: #66cc66;">@</span><span style="color: #008000;">classmethod</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> _next_class<span style="color: black;">&#40;</span>cls<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> path
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__new__</span><span style="color: black;">&#40;</span>cls<span style="color: #66cc66;">,</span> *args<span style="color: #66cc66;">,</span> **kwargs<span style="color: black;">&#41;</span>:
        dirname <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">tempfile</span>.<span style="color: black;">mkdtemp</span><span style="color: black;">&#40;</span>*args<span style="color: #66cc66;">,</span> **kwargs<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">super</span><span style="color: black;">&#40;</span>tempdir<span style="color: #66cc66;">,</span> cls<span style="color: black;">&#41;</span>.<span style="color: #0000cd;">__new__</span><span style="color: black;">&#40;</span>cls<span style="color: #66cc66;">,</span> dirname<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> *args<span style="color: #66cc66;">,</span> **kwargs<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">pass</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> __enter__<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> __exit__<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> exc_type<span style="color: #66cc66;">,</span> exc_value<span style="color: #66cc66;">,</span> <span style="color: #dc143c;">traceback</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> exc_value:
            <span style="color: #008000;">self</span>.<span style="color: black;">rmtree</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>C&#8217;est une bibliothèque très complète et propre, et bien qu&#8217;il y ait quelques astuces ici et là, vous avez pu constater que l&#8217;usage de la POO reste tout à fait accessible : héritage simple, déclaration de méthode, properties, etc. On ne fait pas beaucoup de folies.</p>
<p>Il n&#8217;y a pas besoin de faire les choses compliquées avec la POO, on peut faire des choses tout à fait ordinaires et utiles.</p>
<p>Pour le dernier tuto de la série, on tapera dans la magie noire, à savoir <a href="http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-8/">les métaclasses</a>. Tintintin.</p>
<p>P.S: cet article a été sponsorisé par le plugin Sublime Text <a href="https://github.com/ehuss/Sublime-Wrap-Plus">Wraps Plus</a>. Avec Wraps Plus, plus de caractères en sus !</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-7/feed/</wfw:commentRss>
		<slash:comments>24</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2013/04/PzXJlX6.jpg" length="217148" type="image/jpg" />	</item>
		<item>
		<title> Le guide ultime et définitif sur la programmation orientée objet en Python à l’usage des débutants qui sont rassurés par les textes détaillés qui prennent le temps de tout expliquer. Partie 5. 58</title>
		<link>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-5/</link>
		<comments>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-5/#comments</comments>
		<pubDate>Mon, 11 Feb 2013 17:38:28 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[composition]]></category>
		<category><![CDATA[heritage]]></category>
		<category><![CDATA[poo]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=4495</guid>
		<description><![CDATA[La POO, c'est comme les poupées russes. Une fois qu'on a maîtrisé un concept, paf, y en a un autre qui se ramène derrière.
]]></description>
				<content:encoded><![CDATA[<p>Maestro, musique !</p>

<!-- iframe plugin v.2.9 wordpress.org/plugins/iframe/ -->
<iframe width="420" height="315" src="http://www.youtube.com/embed/XWE_VC9DpK0" frameborder="0" scrolling="no" class="iframe-class"></iframe>

<p>Prérequis :</p>
<ul>
<li>Avoir lu la <a href="http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-4/">partie 4</a>.</li>
<li>Etre bien au point sur la notion de <a href="http://sametmax.com/valeurs-et-references-en-python/">références</a>.</li>
</ul>
<p>La POO, c&#8217;est comme les poupées russes. Une fois qu&#8217;on a maîtrisé un concept, paf, y en a un autre qui se ramène derrière.</p>
<h2>J&#8217;ai plusieurs mamans</h2>
<p>En ces temps de polémique sur l&#8217;autorisation du mariage entre êtres amoureux et consentants (par opposition à celui qu&#8217;on fait par convention sociale depuis des siècles), je vous propose de vous rappeler qu&#8217;une fois de plus les informaticiens sont en avance sur les mœurs.</p>
<p>D&#8217;abord parce qu&#8217;une communauté qui fait autant de links vers <a href="http://www.yougotrickrolled.com/">Never Gona Give You Up</a> est forcément pro gay par essence. Ensuite parce qu&#8217;une classe fille peut avoir plusieurs classes mères sans que ça choque personne.</p>
<p>Prenez ces deux classes qui passaient par là sans rien demander :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> MouMoutte<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #008000;">type</span> <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'top'</span> <span style="color: #808080; font-style: italic;"># c'est tip top moumoutte</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Raoul<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    trop <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'cool'</span></pre></td></tr></table></div>

<p>Hé merde, j&#8217;ai écris ça, et maintenant j&#8217;ai aucune idée de comment faire un code cohérent à partir de cet exemple à la con.</p>
<p>On annule tout.</p>
<p>On recommence.</p>
<p>Vous faites un jeu vidéo. Ça, ça parle bien. Et dedans vous avez des protections et des armes.</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Arme<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nom<span style="color: #66cc66;">,</span> degat<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">nom</span> <span style="color: #66cc66;">=</span> nom
        <span style="color: #008000;">self</span>.<span style="color: black;">degat</span> <span style="color: #66cc66;">=</span> degat
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> attaque<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> cible<span style="color: black;">&#41;</span>: <span style="color: #808080; font-style: italic;"># on retire les degâts de l'épee des points de vie</span>
        cible.<span style="color: black;">vie</span> -<span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">degat</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Protection<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nom<span style="color: #66cc66;">,</span> armure<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">nom</span> <span style="color: #66cc66;">=</span> nom
        <span style="color: #008000;">self</span>.<span style="color: black;">armure</span> <span style="color: #66cc66;">=</span> armure
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> defend<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> degat<span style="color: black;">&#41;</span>: <span style="color: #808080; font-style: italic;"># on diminue les degâts, voire on les annule</span>
&nbsp;
        degat <span style="color: #66cc66;">=</span> degat - <span style="color: #008000;">self</span>.<span style="color: black;">armure</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> degat <span style="color: #66cc66;">&lt;</span> <span style="color: #ff4500;">0</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #ff4500;">0</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> degat
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> epee <span style="color: #66cc66;">=</span> Arme<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Epée Mana'</span><span style="color: #66cc66;">,</span> degat<span style="color: #66cc66;">=</span><span style="color: #ff4500;">999</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> casque <span style="color: #66cc66;">=</span> Protection<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Casque de Balduran'</span><span style="color: #66cc66;">,</span> armure<span style="color: #66cc66;">=</span><span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>C&#8217;est simpliste, mais vous voyez le tableau. Maintenant un connard de client arrive et vous sort une idée trop cool : il faudrait ajouter un barbare dans le jeu. Qui tape aussi avec son bouclier, parce que la concurrence le fait et qu&#8217;ils veulent pas se faire mettre un vent par Blizzard.</p>
<p>Enfer et Rutabaga ! Comment allons nous nous sortir de cette situation ?</p>
<p>Il y a moult manières de faire, mais l&#8217;une d&#8217;elle est d&#8217;utiliser l&#8217;<strong>héritage multiple</strong>, c&#8217;est-à-dire de créer une classe qui hérite des deux classes en même temps.</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> ProtectionOffensive<span style="color: black;">&#40;</span>Arme<span style="color: #66cc66;">,</span> Protection<span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nom<span style="color: #66cc66;">,</span> degat<span style="color: #66cc66;">,</span> armure<span style="color: black;">&#41;</span>:
&nbsp;
        Arme.<span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nom<span style="color: #66cc66;">,</span> degat<span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># appelle le __init__ de arme</span>
        Protection.<span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nom<span style="color: #66cc66;">,</span> armure<span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># appelle le __init de protection</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># comme on a appelé les deux __init__, on va avoir les attributs</span>
        <span style="color: #808080; font-style: italic;"># settés dans les deux __init__ attachés à cette classe</span></pre></td></tr></table></div>

<p>Nous avons alors une classe qui possède les méthodes des deux classes parentes :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> bouclier <span style="color: #66cc66;">=</span> ProtectionOffensive<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Bouclier du dragon'</span><span style="color: #66cc66;">,</span> degat<span style="color: #66cc66;">=</span><span style="color: #ff4500;">10</span><span style="color: #66cc66;">,</span> armure<span style="color: #66cc66;">=</span><span style="color: #ff4500;">100</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> bouclier.<span style="color: black;">degat</span>
<span style="color: #ff4500;">10</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> bouclier.<span style="color: black;">armure</span>
<span style="color: #ff4500;">100</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> bouclier.<span style="color: black;">defend</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">10</span><span style="color: black;">&#41;</span>
<span style="color: #ff4500;">0</span></pre></td></tr></table></div>

<p>Ne cherchez pas compliqué, ça fait exactement ce que ça à l&#8217;air de faire : &#8220;copier&#8221; (oui bon, entre guillemets) le code de chaque parent dans l&#8217;enfant.</p>
<p>Néanmoins vous avez vu qu&#8217;il y a quelques subtilités, notamment la partie <code>__init__</code>.</p>
<p>Posez-vous deux minutes. Respirez. Concentrez-vous. Prêt ?</p>
<p>Les deux classes parentes ont une méthode <code>__init__</code>, mais <strong>Python ne peut en &#8220;copier&#8221; qu&#8217;une seule </strong>dans l&#8217;enfant. Il copie donc la première qu&#8217;il trouve. Il va prendre la liste des parents (ici: <code>Arme, Protection</code>), et la lire de gauche à droite. Il va regarder chaque parent, et si la méthode existe, il va la &#8220;copier&#8221; dans l&#8217;enfant.</p>
<p>Si il retrouve une méthode de même nom dans un des parents suivants, il l&#8217;ignore. (Je dis un DES parents suivants car vous pouvez avoir 10 parents si vous voulez).</p>
<p>Donc dans notre exemple, si je fais :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> ProtectionOffensive<span style="color: black;">&#40;</span>Arme<span style="color: #66cc66;">,</span> Protection<span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">pass</span></pre></td></tr></table></div>

<p><code>ProtectionOffensive</code> n&#8217;aura que la méthode <code>__init__</code> de <code>Arme</code>. Or ce n&#8217;est pas ce qu&#8217;on veut. On va donc overrider la méthode <code>__init__</code>, et dedans appeler la méthode <code>__init__</code> de <code>Arme</code> ET celle de <code>Protection</code>.</p>
<p>Cette syntaxe : <code>Classe.methode(self, args...)</code> que l&#8217;on retrouve dans <code>Arme.__init__(self, nom, degat)</code> est juste un moyen d&#8217;appeler spécifiquement la méthode du parent.</p>
<p>Dans la partie précédente, je vous ai montré qu&#8217;on pouvait faire cela avec <code>super()</code>. Or <code>super()</code> vous retournera la première méthode du premier parent qu&#8217;elle trouve : c&#8217;est le but de <code>super()</code>, de faire ça automatiquement sans se soucier de savoir qui est le premier parent à avoir une méthode du bon nom.</p>
<p>C&#8217;est utile car parfois c&#8217;est le parent du parent du parent qui a la méthode qu&#8217;on veut appeler. On ne connaît pas forcément son nom, ou alors on ne veut pas l&#8217;écrire en dur. Mais dans notre cas, on veut spécifiquement une méthode d&#8217;un parent en particulier, il faut donc l&#8217;écrire à la main.</p>
<p>D&#8217;une manière générale :</p>
<ul>
<li>Utilisez<code> super()</code> quand vous faites de l&#8217;héritage simple où que vous voulez juste appeler la méthode du premier parent venu sans vous soucier de son nom (car il peut être très haut dans la chaîne d&#8217;héritage).</li>
<li>Utilisez <code>Classe.methode(self, args...)</code> quand vous voulez spécifiquement appeler la méthode d&#8217;un parent en particulier.</li>
</ul>
<p>Faites attention !</p>
<p>Le <code>self</code> n&#8217;est pas au même endroit dans <code>super(ClassCourante, self).methode(args...)</code> et <code>ClasseParente.methode(self, args...)</code>. Et dans le premier cas, on passe la classe courante (que <code>super()</code> va analyser pour trouver les parents automatiquement), dans le cas suivant, on écrit le nom de la classe parente en dur.</p>
<p>Faites quelques tests avec des scripts bidons pour bien comprendre comment ça marche. Faites ça avec des classes toutes simples. Sinon le jour où vous aurez une classe compliquée, vous allez vous embrouiller.</p>
<h2>La composition (POO pour les vrais mecs)</h2>
<p>Jusqu&#8217;ici c&#8217;était un tuto avec des notions de base pour des petits geeks imberbes qui jouent avec des action figures fabriquées en Chine et achetées sur ebay. Mais maintenant nous allons voir la POO pour les vrais hommes, les barbus, ceux qui jouent avec des <a href="https://www.realdoll.com/">reals dolls</a> et qui n&#8217;ont pas peur de mettre des chaussettes dépareillées.</p>
<p>Voyez-vous, un objet, tout seul, il sert à rien. Il s&#8217;emmerde déjà, rien à foutre le samedi, nul part où sortir, tout ça. Mais surtout, il a personne pour prendre l&#8217;apéro. Non, dans un programme digne d&#8217;un vrai pastis, il faut plusieurs objets qui interagissent entre eux. En fait, plusieurs objets qui s&#8217;utilisent les uns les autres.</p>
<p>Retournez à notre exemple de jeu video :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> HeroViril<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #808080; font-style: italic;"># def __init__(self, nom, prenom, groupe_sanguin, signe_astrologique,</span>
    <span style="color: #808080; font-style: italic;">#              couleur_preferee, tendance_sexuelle, culte,</span>
    <span style="color: #808080; font-style: italic;">#              taille_de_la_troisieme_phallange_de_l_index_gauche)</span>
    <span style="color: #808080; font-style: italic;"># TODO : voir le CDC avec le client pour confirmer les attributs du personnage</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nom<span style="color: #66cc66;">,</span> vie<span style="color: #66cc66;">,</span> arme<span style="color: #66cc66;">=</span><span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> protection<span style="color: #66cc66;">=</span><span style="color: #008000;">None</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">nom</span> <span style="color: #66cc66;">=</span> nom
        <span style="color: #008000;">self</span>.<span style="color: black;">vie</span> <span style="color: #66cc66;">=</span> vie
        <span style="color: #008000;">self</span>.<span style="color: black;">arme</span> <span style="color: #66cc66;">=</span> arme
        <span style="color: #008000;">self</span>.<span style="color: black;">protection</span> <span style="color: #66cc66;">=</span> protection
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> combattre<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> ennemi<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;{} attaque {}&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">nom</span><span style="color: #66cc66;">,</span> ennemi.<span style="color: black;">nom</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">while</span> <span style="color: #008000;">True</span>:
&nbsp;
            <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">arme</span>:
                <span style="color: #008000;">self</span>.<span style="color: black;">arme</span>.<span style="color: black;">attaque</span><span style="color: black;">&#40;</span>ennemi<span style="color: black;">&#41;</span>
&nbsp;
            <span style="color: #ff7700;font-weight:bold;">if</span> ennemi.<span style="color: black;">vie</span> <span style="color: #66cc66;">&lt;=</span> <span style="color: #ff4500;">0</span>:
                <span style="color: #ff7700;font-weight:bold;">break</span>
&nbsp;
            <span style="color: #ff7700;font-weight:bold;">if</span> ennemi.<span style="color: black;">arme</span>:
                ennemi.<span style="color: black;">arme</span>.<span style="color: black;">attaque</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
&nbsp;
            <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">vie</span> <span style="color: #66cc66;">&lt;=</span> <span style="color: #ff4500;">0</span>:
                <span style="color: #ff7700;font-weight:bold;">break</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">vie</span> <span style="color: #66cc66;">&gt;</span> <span style="color: #ff4500;">0</span>:
            <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;Victoire de {}&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">nom</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;{} est mort comme une pov' merde&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">nom</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>Et là vous notez un truc, c&#8217;est que nous n&#8217;avons pas de méthode <code>attaque()</code> sur notre héros. Nous utilisons la méthode attaque d&#8217;un objet arme. Que l&#8217;on a en attribut.</p>
<p>C&#8217;est cela la composition : un objet, qui en fait est composé de plusieurs sous-objets. Dans notre cas, notre objet héros est aussi composé d&#8217;une arme et d&#8217;une protection, qui sont ses attributs. Il peut ainsi utiliser le comportement de ses objets pour faire le boulot à sa place : c&#8217;est ce qu&#8217;on appelle la délégation.</p>
<p>Reprenons notre code des armes, un peu adapté :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># le code de l'armure ne change pas</span>
<span style="color: #ff7700;font-weight:bold;">class</span> Protection<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nom<span style="color: #66cc66;">,</span> armure<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">nom</span> <span style="color: #66cc66;">=</span> nom
        <span style="color: #008000;">self</span>.<span style="color: black;">armure</span> <span style="color: #66cc66;">=</span> armure
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> defend<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> degat<span style="color: black;">&#41;</span>:
&nbsp;
        degat <span style="color: #66cc66;">=</span> degat - <span style="color: #008000;">self</span>.<span style="color: black;">armure</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> degat <span style="color: #66cc66;">&lt;</span> <span style="color: #ff4500;">0</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #ff4500;">0</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> degat
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;"># on change le code de l'arme, si la cible a une protection</span>
<span style="color: #808080; font-style: italic;"># cela diminue les degâts pris</span>
<span style="color: #ff7700;font-weight:bold;">class</span> Arme<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nom<span style="color: #66cc66;">,</span> degat<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">nom</span> <span style="color: #66cc66;">=</span> nom
        <span style="color: #008000;">self</span>.<span style="color: black;">degat</span> <span style="color: #66cc66;">=</span> degat
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> attaque<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> cible<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #808080; font-style: italic;"># je mets aussi quelques prints pour le lulz</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> cible.<span style="color: black;">protection</span>:
            degat <span style="color: #66cc66;">=</span> cible.<span style="color: black;">protection</span>.<span style="color: black;">defend</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">degat</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;{} - {} = {}&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span>cible.<span style="color: black;">vie</span><span style="color: #66cc66;">,</span> degat<span style="color: #66cc66;">,</span> cible.<span style="color: black;">vie</span> - degat<span style="color: black;">&#41;</span>
            cible.<span style="color: black;">vie</span> -<span style="color: #66cc66;">=</span> degat
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;{} - {} = {}&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span>cible.<span style="color: black;">vie</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span>.<span style="color: black;">degat</span><span style="color: #66cc66;">,</span> cible.<span style="color: black;">vie</span> - <span style="color: #008000;">self</span>.<span style="color: black;">degat</span><span style="color: black;">&#41;</span>
            cible.<span style="color: black;">vie</span> -<span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">degat</span></pre></td></tr></table></div>

<p>Maintenant créons deux héros, armons-les, et faisons-les combattre :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> gosu <span style="color: #66cc66;">=</span> HeroViril<span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Drizzt Do'Urden&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">2000</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> gosu.<span style="color: black;">arme</span> <span style="color: #66cc66;">=</span> Arme<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Lame Vorpale'</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">10</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> gosu.<span style="color: black;">protection</span> <span style="color: #66cc66;">=</span> Protection<span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Maille en Kevlar de mithril doré a l'adamantium&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">10</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> noob_qui_repop <span style="color: #66cc66;">=</span> HeroViril<span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Bob&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">200</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> noob_qui_repop.<span style="color: black;">arme</span> <span style="color: #66cc66;">=</span> Arme<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Cure-dent'</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> noob_qui_repop.<span style="color: black;">protection</span> <span style="color: #66cc66;">=</span> Protection<span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Slip&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> noob_qui_repop.<span style="color: black;">combattre</span><span style="color: black;">&#40;</span>gosu<span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># yaaaaaaaaaaaaaaaaaaaaaaa !</span>
&nbsp;
Bob attaque Drizzt Do<span style="color: #483d8b;">'Urden
2000 - 0 = 2000
200 - 9 = 191
2000 - 0 = 2000
191 - 9 = 182
2000 - 0 = 2000
182 - 9 = 173
2000 - 0 = 2000
173 - 9 = 164
2000 - 0 = 2000
164 - 9 = 155
2000 - 0 = 2000
155 - 9 = 146
2000 - 0 = 2000
146 - 9 = 137
2000 - 0 = 2000
137 - 9 = 128
2000 - 0 = 2000
128 - 9 = 119
2000 - 0 = 2000
119 - 9 = 110
2000 - 0 = 2000
110 - 9 = 101
2000 - 0 = 2000
101 - 9 = 92
2000 - 0 = 2000
92 - 9 = 83
2000 - 0 = 2000
83 - 9 = 74
2000 - 0 = 2000
74 - 9 = 65
2000 - 0 = 2000
65 - 9 = 56
2000 - 0 = 2000
56 - 9 = 47
2000 - 0 = 2000
47 - 9 = 38
2000 - 0 = 2000
38 - 9 = 29
2000 - 0 = 2000
29 - 9 = 20
2000 - 0 = 2000
20 - 9 = 11
2000 - 0 = 2000
11 - 9 = 2
2000 - 0 = 2000
2 - 9 = -7
Bob est mort comme une pov'</span> merde</pre></td></tr></table></div>

<h2>Ok, j&#8217;ai pigé le principe, mais comment ça marche dans le détail ?</h2>
<p>Regardons la méthode combattre de plus près :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">    <span style="color: #808080; font-style: italic;"># elle attend un ennemi en paramètre, donc UN OBJET HeroViril</span>
    <span style="color: #808080; font-style: italic;"># self est l'objet en cours, donc aussi un objet HeroViril</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> combattre<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> ennemi<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;{} attaque {}&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">nom</span><span style="color: #66cc66;">,</span> ennemi.<span style="color: black;">nom</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># une petite boucle infinie. Warning, c'est un tuto. Ne faites pas</span>
        <span style="color: #808080; font-style: italic;"># ça chez vous les enfants.</span>
        <span style="color: #808080; font-style: italic;"># cette boucle loop pour toujours si il n'y a pas d'attribut arme donc</span>
        <span style="color: #808080; font-style: italic;"># ceci n'est qu'un exemple. Hein ? Noté ? Les deux du fond là ?</span>
        <span style="color: #ff7700;font-weight:bold;">while</span> <span style="color: #008000;">True</span>:
&nbsp;
            <span style="color: #808080; font-style: italic;"># on donne le premier coup à la personne qui attaque (l'objet en</span>
            <span style="color: #808080; font-style: italic;"># cours). On vérifie qu'il a une arme. Si c'est le cas,</span>
            <span style="color: #808080; font-style: italic;"># on appelle la méthode de l'arme &quot;attaque()&quot;, et on lui passe</span>
            <span style="color: #808080; font-style: italic;"># en paramètre l'ennemi.</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">arme</span>:
                <span style="color: #008000;">self</span>.<span style="color: black;">arme</span>.<span style="color: black;">attaque</span><span style="color: black;">&#40;</span>ennemi<span style="color: black;">&#41;</span>
&nbsp;
            <span style="color: #808080; font-style: italic;"># condition de sortie de la boucle sur la vie du héros qui a pris</span>
            <span style="color: #808080; font-style: italic;"># le coup</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> ennemi.<span style="color: black;">vie</span> <span style="color: #66cc66;">&lt;=</span> <span style="color: #ff4500;">0</span>:
                <span style="color: #ff7700;font-weight:bold;">break</span>
&nbsp;
            <span style="color: #808080; font-style: italic;"># ensuite on fait pareil à l'envers pour donner une chance à l'autre</span>
            <span style="color: #808080; font-style: italic;"># de répliquer : on vérifie que l'ennemi a une arme, et si c'est</span>
            <span style="color: #808080; font-style: italic;"># le cas, on applique la méthode &quot;attaque&quot; de l'arme à l'objet</span>
            <span style="color: #808080; font-style: italic;"># en cours</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> ennemi.<span style="color: black;">arme</span>:
                ennemi.<span style="color: black;">arme</span>.<span style="color: black;">attaque</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
&nbsp;
            <span style="color: #808080; font-style: italic;"># condition de sortie de la boucle sur la vie du héros qui a pris</span>
            <span style="color: #808080; font-style: italic;"># le coup</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">vie</span> <span style="color: #66cc66;">&lt;=</span> <span style="color: #ff4500;">0</span>:
                <span style="color: #ff7700;font-weight:bold;">break</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># une fois sorti de la boucle, on vérifie le niveau de vie pour</span>
        <span style="color: #808080; font-style: italic;"># désigner le vainqueur</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">vie</span> <span style="color: #66cc66;">&gt;</span> <span style="color: #ff4500;">0</span>:
            <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;Victoire de {}&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">nom</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;{} est mort comme une pov' merde&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">nom</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>Donc combattre utilise un objet arme, et appelle sa méthode <code>attaque()</code> sur un héros (j&#8217;ai viré les prints pour rendre le truc plus clair) :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">    <span style="color: #808080; font-style: italic;"># self est l'objet en cours, donc l'arme.</span>
    <span style="color: #808080; font-style: italic;"># cible est un héros, puisqu'on l'a passé en paramètre.</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> attaque<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> cible<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #808080; font-style: italic;"># si la cible (l'objet héros) a un attribut protection,</span>
        <span style="color: #808080; font-style: italic;"># les dégâts retirés sont diminués (ce calcul est fait par la protection)</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> cible.<span style="color: black;">protection</span>:
            cible.<span style="color: black;">vie</span> -<span style="color: #66cc66;">=</span> cible.<span style="color: black;">protection</span>.<span style="color: black;">defend</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">degat</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># sinon, on retire les dégâts à la vie de la cible (le héros)</span>
        <span style="color: #808080; font-style: italic;"># directement</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            cible.<span style="color: black;">vie</span> -<span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">degat</span></pre></td></tr></table></div>

<p>Diantre ! La méthode attaque utilise elle-même la méthode <code>defend(</code>) de la protection :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">    <span style="color: #808080; font-style: italic;"># self est l'objet en cours, donc la protection.</span>
    <span style="color: #808080; font-style: italic;"># degat est un simple int.</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> defend<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> degat<span style="color: black;">&#41;</span>:
        <span style="color: #808080; font-style: italic;"># on retourne les degâts infligés, moins la protection</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> degat - <span style="color: #008000;">self</span>.<span style="color: black;">armure</span></pre></td></tr></table></div>

<p>Pour comprendre tous ces codes, il faut bien piger deux trucs :</p>
<ul>
<li>Il y a 6 objets. Deux héros, deux armes, et deux protections. Les héros ont les armes / protections comme attributs.</li>
<li>On se sert des méthodes des armes pour attaquer. On passe les héros en paramètres à ces méthodes. Les armes se servent des protections des héros pour calculer les dégats.</li>
</ul>
<p>Ce dernier point est le plus important. Si vous comprenez ça, vous avez maîtrisé le plus important de la POO. Relisez le plusieurs fois :</p>
<p>Les héros ont une référence aux armes. Et ensuite, on passe une référence des héros aux armes. Les armes retirent de la vie à ces héros, non sans calculer les dégâts en fonction de la protection qu&#8217;ils portent.</p>
<p>Les objets ont tous des références les uns vers les autres. <strong>Ils se manipulent tous les uns les autres.</strong></p>
<p>Cela fait bizarre car dans la vie une épée ne manipule pas un héros (bon, je connais peu d&#8217;elfes noirs IRL aussi). On comprend facilement qu&#8217;un héros ait un attribut &#8216;épée&#8217;, mais il est difficile de comprendre qu&#8217;une épée ait une méthode, et que le paramètre de cette méthode soit un héros.</p>
<p>C&#8217;est un concept purement informatique : la logique des dégâts est codée dans l&#8217;arme, pas dans le héros. L&#8217;avantage de cette architecture, c&#8217;est que si vous changez l&#8217;arme, vous changez toute la logique des dégâts. Par exemple, vous rajoutez une arme empoisonnée :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> ArmeMegaEmpoisonnee<span style="color: black;">&#40;</span>Arme<span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nom<span style="color: #66cc66;">,</span> degat<span style="color: #66cc66;">,</span> poison<span style="color: #66cc66;">=</span><span style="color: #ff4500;">100000</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">super</span><span style="color: black;">&#40;</span>ArmeMegaEmpoisonnee<span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span><span style="color: black;">&#41;</span>.<span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span>nom<span style="color: #66cc66;">,</span> degat<span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">poison</span> <span style="color: #66cc66;">=</span> poison
&nbsp;
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> attaque<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> cible<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #808080; font-style: italic;"># on prend les degâts une premiere fois</span>
        <span style="color: #008000;">super</span><span style="color: black;">&#40;</span>ArmeMegaEmpoisonnee<span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span><span style="color: black;">&#41;</span>.<span style="color: black;">attaque</span><span style="color: black;">&#40;</span>cible<span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># puis on prend les dégâts du poison</span>
        cible.<span style="color: black;">vie</span> -<span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">poison</span></pre></td></tr></table></div>

<p>Cette arme fait plus de dégâts. Son mécanisme pour faire des dégâts est différent. Il suffit d&#8217;équiper un héros avec l&#8217;arme (en changeant l&#8217;attribut) pour que ce nouveau calcul de dégâts soit pris en compte.</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> noob_qui_repop.<span style="color: black;">vie</span> <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">200</span> <span style="color: #808080; font-style: italic;"># rePOP !</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> noob_qui_repop.<span style="color: black;">arme</span> <span style="color: #66cc66;">=</span> ArmeMegaEmpoisonnee<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Cheat Code'</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> noob_qui_repop.<span style="color: black;">combattre</span><span style="color: black;">&#40;</span>gosu<span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># Vengeance !</span>
Bob attaque Drizzt Do<span style="color: #483d8b;">'Urden
2000 - 0 = 2000
Victoire de Bob</span></pre></td></tr></table></div>

<p>Ce qu&#8217;il faut retenir : on peut mettre des objets en tant qu&#8217;attributs d&#8217;objets. Il n&#8217;y a pas de limite dans les nombres d&#8217;objets à mettre, leur mélange, les niveaux d&#8217;imbrications, etc. On peut mettre des objets, dans des objets, dans des objets&#8230; C&#8217;est la composition.</p>
<p>Et les objets peuvent utiliser les méthodes des autres objets. Et on peut passer des objets comme paramètres à des méthodes. C&#8217;est la délégation.</p>
<p>C&#8217;est la partouze des objets, quoi.</p>
<p>On peut mettre des objets dans des sets, des dicos, des listes&#8230; Par juste dans des attributs. Il y en a des choses à faire !</p>
<h2>Choisir entre l&#8217;héritage et la composition</h2>
<p>Les deux techniques permettent de réutiliser du code, mais pas de la même façon. Aucune règle générale ne tient la route dans tous les cas, mais un bon point de départ est de se dire que :</p>
<ul>
<li>Si vous avez deux objets de même nature et que l&#8217;un est une spécialisation de l&#8217;autre (Garçon est une spécialisation de Personne, Voiture est une spécialisation de véhicule, Clio est une spécialisation de voiture, Reptincel est une spécialisation de pokemon, foxmask est une spécialisation du correcteur orthographique de Word, etc), alors utilisez l&#8217;héritage.</li>
<li>Si vous avez deux objets qui échangent des données, qui sont associés ou qui dans la vie réelle sont des &#8216;part de&#8217; (un article est une partie d&#8217;un blog, Raymond Barre est membre d&#8217;un parti, Raymond fait partie d&#8217;un bar, <del>le bar et la raie font parti des poissons ah non ça c&#8217;est une spécialisation</del>, etc), utilisez la composition.</li>
</ul>
<p>Il y a aussi, quelque part, dans le lointain pays des enculeurs de mouche, une différence entre l’agrégation (qu&#8217;on a pas vu) et la composition. Vous vivrez très bien en considérant que c&#8217;est la même chose.</p>
<h2>Le design pattern &#8220;stratégie&#8221;</h2>
<p>Vous entendrez parfois parler du motif de conception &#8220;stratégie&#8221;. C&#8217;est en fait une mise en application abstraite de la composition.</p>
<p>Normalement la composition s&#8217;utilise avec des &#8220;part de&#8221; concrètes. Vous avez une voiture : elle est composée d&#8217;objets pneus, d&#8217;un objet moteur, etc.</p>
<p>Le design pattern stratégie est l&#8217;extraction d&#8217;une part du comportement d&#8217;un objet pour le mettre dans un autre objet, mais la nature de l&#8217;objet importe peu. Ceci est fait purement pour découpler le comportement de l&#8217;objet.</p>
<p>On a vu plus haut que changer l&#8217;arme permet de changer le calcul des dégâts. C&#8217;est ce type de résultat qu&#8217;on vise avec le design pattern strategy.</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">os</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> ParseurXml<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    ...
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> ParseurJson<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    ...
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> ParseurDeFichier<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    _strategy <span style="color: #66cc66;">=</span> <span style="color: black;">&#123;</span> <span style="color: #808080; font-style: italic;"># les stratégie par défaut</span>
        <span style="color: #483d8b;">'json'</span>: ParseurXml<span style="color: #66cc66;">,</span>
        <span style="color: #483d8b;">'xml'</span>: ParseurJson
    <span style="color: black;">&#125;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> fichier<span style="color: #66cc66;">,</span> strategy<span style="color: #66cc66;">=</span><span style="color: #008000;">None</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">fichier</span> <span style="color: #66cc66;">=</span> fichier
        <span style="color: #808080; font-style: italic;"># on récupère l'extension du fichier</span>
        path<span style="color: #66cc66;">,</span> ext <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">os</span>.<span style="color: black;">path</span>.<span style="color: black;">splitext</span><span style="color: black;">&#40;</span>fichier<span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Strategy est une classe de parseur</span>
        <span style="color: #808080; font-style: italic;"># on la récupère depuis les paramètres ou selon</span>
        <span style="color: #808080; font-style: italic;"># l'extension</span>
        Strategy <span style="color: #66cc66;">=</span> strategy <span style="color: #ff7700;font-weight:bold;">or</span> <span style="color: #008000;">self</span>._strategy<span style="color: black;">&#91;</span>ext.<span style="color: black;">lstrip</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'.'</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>
        <span style="color: #808080; font-style: italic;"># on instancie notre classe de strategie</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">strategy</span> <span style="color: #66cc66;">=</span> Strategy<span style="color: black;">&#40;</span>fichier<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> parse<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #808080; font-style: italic;"># on délègue le boulot à la stratégie</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">strategy</span>.<span style="color: black;">parse</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>La ligne la plus importante est :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">Strategy <span style="color: #66cc66;">=</span> strategy <span style="color: #ff7700;font-weight:bold;">or</span> <span style="color: #008000;">self</span>._strategy<span style="color: black;">&#91;</span>ext<span style="color: black;">&#93;</span></pre></td></tr></table></div>

<p>Ici on dit récupérer la stratégie de parsing en paramètre, ou sinon, la bonne en fonction de l&#8217;extension de fichier. On charge donc une classe dynamiquement, on va créer un objet à partir de cette classe. Et c&#8217;est cet objet à qui on va déléguer le comportement du parseur :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">    <span style="color: #ff7700;font-weight:bold;">def</span> parse<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">strategy</span>.<span style="color: black;">parse</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>On utilise l&#8217;objet dynamiquement pour gérer tout le parsing. On peut ainsi choisir un parseur à la volée.</p>
<p>La pattern strategy mélange donc composition (l&#8217;objet strategy est une part de l&#8217;objet général), délégation (l&#8217;objet général utilise le comportement de l&#8217;objet strategy) et d&#8217;injection de dépendance (on peut changer l&#8217;algo à la volée, il suffit de changer de stratégie).</p>
<p>Bon, ça c&#8217;était le mode hard. C&#8217;est pas grave si vous finissez pas le niveau toute de suite. Mettez pause. Allez pisser un coup et revenez- plus tard, les continues sont infinis sur le blog.</p>
<p>C&#8217;est bon, vous êtes chaud ? Prochaine stations, <a href="http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-6/">le monde merveilleux des méthodes magiques</a>.</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-5/feed/</wfw:commentRss>
		<slash:comments>58</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2013/02/magic_warmhanz.jpg" length="172488" type="image/jpg" />	</item>
		<item>
		<title>Le guide ultime et définitif sur la programmation orientée objet en Python à l’usage des débutants qui sont rassurés par les textes détaillés qui prennent le temps de tout expliquer. Partie 4. 21</title>
		<link>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-4/</link>
		<comments>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-4/#comments</comments>
		<pubDate>Sun, 03 Feb 2013 11:04:56 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[heritage]]></category>
		<category><![CDATA[poo]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=4395</guid>
		<description><![CDATA[Aujourd'hui nous allons voir ce qui fait toute la puissance de la programmation orientée objet : l'héritage.]]></description>
				<content:encoded><![CDATA[<p>Un peu de zik, puisque c&#8217;est ce qu&#8217;on fait maintenant :</p>

<!-- iframe plugin v.2.9 wordpress.org/plugins/iframe/ -->
<iframe width="420" height="315" src="http://www.youtube.com/embed/5DeOSLNbhfg" frameborder="0" scrolling="no" class="iframe-class"></iframe>

<p>Prérequis :</p>
<ul>
<li>Avoir lu (et compris) la <a href="http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-3/">partie 3</a></li>
</ul>
<p>Aujourd&#8217;hui nous allons voir ce qui fait toute la puissance de la programmation orientée objet : l&#8217;héritage.</p>
<h2>Héritage simple</h2>
<p>L&#8217;héritage est un moyen de factoriser du code, c&#8217;est à dire que si on a le même code à deux endroits, l&#8217;héritage permet de centraliser ce code à un seul endroit. Ce n&#8217;est pas le seul moyen de faire ça. On peut très bien factoriser du code uniquement avec des fonctions. Néanmoins l&#8217;héritage a des caractéristiques qui rendent la factorisation très efficace.</p>
<p>Supposons que vous fassiez un jeu vidéo pour apprendre les prières chrétiennes, et que vous ayez une classe par prière :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> AveMaria:
&nbsp;
&nbsp;
    texte <span style="color: #66cc66;">=</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Je vous salue, Marie pleine de grâce ;&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Le Seigneur est avec vous.&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Vous êtes bénie entre toutes les femmes&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Et Jésus, le fruit de vos entrailles, est béni.&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Sainte Marie, Mère de Dieu,&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Priez pour nous, pauvres pécheurs,&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Maintenant, et à l'heure de notre mort.&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Amen.&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> prier<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nombre_de_fois<span style="color: #66cc66;">=</span><span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">xrange</span><span style="color: black;">&#40;</span>nombre_de_fois<span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">for</span> ligne <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">self</span>.<span style="color: black;">texte</span>:
                <span style="color: #ff7700;font-weight:bold;">print</span> ligne
&nbsp;
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> PaterNoster:
&nbsp;
&nbsp;
    texte <span style="color: #66cc66;">=</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Notre Père qui es aux cieux&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;que ton nom soit sanctifié&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;que ton règne vienne,&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;que ta volonté soit faite&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;sur la terre comme au ciel.&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Donne-nous aujourd’hui&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;notre pain de ce jour,&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;pardonne-nous nos offenses&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;comme nous pardonnons aussi&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;à ceux qui nous ont offensés&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;et ne nous soumets pas à la tentation&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;mais délivre-nous du mal.&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Amen&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> prier<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nombre_de_fois<span style="color: #66cc66;">=</span><span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">xrange</span><span style="color: black;">&#40;</span>nombre_de_fois<span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">for</span> ligne <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">self</span>.<span style="color: black;">texte</span>:
                <span style="color: #ff7700;font-weight:bold;">print</span> ligne
&nbsp;
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> piere <span style="color: #66cc66;">=</span> AveMaria<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> piere.<span style="color: black;">prier</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
Je vous salue<span style="color: #66cc66;">,</span> Marie pleine de grâce <span style="color: #66cc66;">;</span>
Le Seigneur est avec vous.
<span style="color: black;">Vous</span> êtes bénie entre toutes les femmes
Et Jésus<span style="color: #66cc66;">,</span> le fruit de vos entrailles<span style="color: #66cc66;">,</span> est béni.
<span style="color: black;">Sainte</span> Marie<span style="color: #66cc66;">,</span> Mè<span style="color: #dc143c;">re</span> de Dieu<span style="color: #66cc66;">,</span>
Priez pour nous<span style="color: #66cc66;">,</span> pauvres pécheurs<span style="color: #66cc66;">,</span>
Maintenant<span style="color: #66cc66;">,</span> et à l<span style="color: #483d8b;">'heure de notre mort.
Amen.</span></pre></td></tr></table></div>

<p>Ici la méthode <code>prier()</code> est dupliquée. Or, c&#8217;est exactement la même. Il n&#8217;y a pas de raison de l&#8217;écrire deux fois. Nous allons utiliser l&#8217;héritage pour centraliser ce code en créant une classe <code>Priere</code> qui contiendra le code commun à toutes les prières :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Priere:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> prier<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nombre_de_fois<span style="color: #66cc66;">=</span><span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">xrange</span><span style="color: black;">&#40;</span>nombre_de_fois<span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">for</span> ligne <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">self</span>.<span style="color: black;">texte</span>:
                <span style="color: #ff7700;font-weight:bold;">print</span> ligne</pre></td></tr></table></div>

<p>Ensuite, nous allons demander à toutes les classes prières d&#8217;hériter de cette classe commune :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> AveMaria<span style="color: black;">&#40;</span>Priere<span style="color: black;">&#41;</span>: <span style="color: #808080; font-style: italic;"># &lt;---- cette syntaxe veut dire 'hérite de Priere'</span>
&nbsp;
    texte <span style="color: #66cc66;">=</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Je vous salue, Marie pleine de grâce ;&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Le Seigneur est avec vous.&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Vous êtes bénie entre toutes les femmes&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Et Jésus, le fruit de vos entrailles, est béni.&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Sainte Marie, Mère de Dieu,&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Priez pour nous, pauvres pécheurs,&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Maintenant, et à l'heure de notre mort.&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Amen.&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> PaterNoster<span style="color: black;">&#40;</span>Priere<span style="color: black;">&#41;</span>:
&nbsp;
    texte <span style="color: #66cc66;">=</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Notre Père qui es aux cieux&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;que ton nom soit sanctifié&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;que ton règne vienne,&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;que ta volonté soit faite&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;sur la terre comme au ciel.&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Donne-nous aujourd’hui&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;notre pain de ce jour,&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;pardonne-nous nos offenses&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;comme nous pardonnons aussi&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;à ceux qui nous ont offensés&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;et ne nous soumets pas à la tentation&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;mais délivre-nous du mal.&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Amen&quot;</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>Ici, les classes <code>AveMaria</code> et <code>PaterNoster</code> héritent de la classe <code>Priere</code>. On dit qu&#8217;elles sont les enfants (ou filles) de <code>Priere</code>. Ou que <code>Priere</code> est la classe parente de <code>AveMaria</code> et <code>PaterNoster</code></p>
<p>Notez qu&#8217;on a retiré la méthode <code>prier()</code> de <code>PaterNoster</code> et <code>AveMaria</code>. Malgré cela, ça marche :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> PaterNoster<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">prier</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
Notre Pè<span style="color: #dc143c;">re</span> qui es aux cieux
que ton nom soit sanctifié
que ton règne vienne<span style="color: #66cc66;">,</span>
que ta volonté soit faite
sur la terre comme au ciel.
<span style="color: black;">Donne</span>-nous aujourd<span style="color: #483d8b;">'hui
notre pain de ce jour,
pardonne-nous nos offenses
comme nous pardonnons aussi
à ceux qui nous ont offensés
et ne nous soumets pas à la tentation
mais délivre-nous du mal.
Amen</span></pre></td></tr></table></div>

<p>Cela marche car quand on hérite d&#8217;une classe, le code de cette classe est copié de la classe parente vers la classe enfant. Ainsi, <code>prier()</code> est automatiquement copiée de <code>Priere</code> vers <code>AveMaria</code> et <code>PaterNostre</code>.</p>
<p>Cela marche pour toutes les méthodes, même celles appelées automatiquement. C&#8217;est particulièrement utile avec la méthode <code>__init__</code>:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Priere:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> expiation<span style="color: #66cc66;">=</span><span style="color: #008000;">False</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">expiation</span> <span style="color: #66cc66;">=</span> expiation
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> prier<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nombre_de_fois<span style="color: #66cc66;">=</span><span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">xrange</span><span style="color: black;">&#40;</span>nombre_de_fois<span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">for</span> ligne <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">self</span>.<span style="color: black;">texte</span>:
                <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">expiation</span>:
                    <span style="color: #ff7700;font-weight:bold;">print</span> ligne.<span style="color: black;">upper</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
                <span style="color: #ff7700;font-weight:bold;">else</span>:
                    <span style="color: #ff7700;font-weight:bold;">print</span> ligne</pre></td></tr></table></div>

<p>On rajoute ici un attribut, et il se retrouve dans la classe enfant (si vous êtes dans un shell, n&#8217;oubliez pas de réécrire aussi la classe <code>AveMaria</code> à chaque fois, même si elle ne change pas):</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> priere <span style="color: #66cc66;">=</span> AveMaria<span style="color: black;">&#40;</span>expiation<span style="color: #66cc66;">=</span><span style="color: #008000;">True</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> priere.<span style="color: black;">expiation</span>
<span style="color: #008000;">True</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> priere.<span style="color: black;">prier</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
JE VOUS SALUE<span style="color: #66cc66;">,</span> MARIE PLEINE DE GRâCE <span style="color: #66cc66;">;</span>
LE SEIGNEUR EST AVEC VOUS.
<span style="color: black;">VOUS</span> êTES BéNIE ENTRE TOUTES LES FEMMES
ET JéSUS<span style="color: #66cc66;">,</span> LE FRUIT DE VOS ENTRAILLES<span style="color: #66cc66;">,</span> EST BéNI.
<span style="color: black;">SAINTE</span> MARIE<span style="color: #66cc66;">,</span> MèRE DE DIEU<span style="color: #66cc66;">,</span>
PRIEZ POUR NOUS<span style="color: #66cc66;">,</span> PAUVRES PéCHEURS<span style="color: #66cc66;">,</span>
MAINTENANT<span style="color: #66cc66;">,</span> ET à L<span style="color: #483d8b;">'HEURE DE NOTRE MORT.
AMEN.</span></pre></td></tr></table></div>

<p>L&#8217;héritage, c&#8217;est juste cela. Pas la peine de chercher un truc compliqué : le code du parent se retrouve dans celui de l&#8217;enfant. Cela marche pour les méthodes et les attributs.</p>
<h2>Petit apparté sur <code>object</code></h2>
<p>Dans la partie précédente et dans de nombreux codes, vous avez dû voir des classes comme cela :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> MaClass<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>: <span style="color: #808080; font-style: italic;"># wtf is this object stuff ?</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># code</span></pre></td></tr></table></div>

<p>Il s&#8217;agit bel et bien d&#8217;héritage, <code>object</code> étant un type buil-in en Python au même titre que les string ou les int :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">object</span>
<span style="color: #66cc66;">&lt;</span><span style="color: #008000;">type</span> <span style="color: #483d8b;">'object'</span><span style="color: #66cc66;">&gt;</span></pre></td></tr></table></div>

<p>La raison de cet héritage bizarre est qu&#8217;à partir de Python 2.2, une nouvelle architecture des classes a été introduite qui corrige les problèmes de l&#8217;ancienne. Mais pour garder le code compatible, ces nouvelles classes n&#8217;ont pas été activées par défaut.</p>
<p>Ainsi, même si vous êtes en Python 2.7, quand vous faites :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> MaClass:
&nbsp;
    <span style="color: #808080; font-style: italic;"># code</span></pre></td></tr></table></div>

<p>Vous utilisez l&#8217;ancien type de classe (old-style class). Pour dire à Python que vous voulez utiliser le nouveau type de classe (new-style class), il faut hériter d&#8217;<code>object</code> :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> MaClass<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #808080; font-style: italic;"># code</span></pre></td></tr></table></div>

<p><strong>Il n&#8217;y a AUCUN intérêt à utiliser les old-style classes.</strong> Je l&#8217;ai fais en ce début de cours pour éviter d&#8217;introduire la notion d&#8217;héritage trop tôt.</p>
<p>A partir de maintenant, quand vous créez une nouvelle classe qui n&#8217;a pas de parent, faites la TOUJOURS hériter de <code>object</code>.</p>
<p>Des tas de fonctions (par exemple les properties) fonctionnent beaucoup mieux avec les new-style classes. (D&#8217;ailleurs à partir de Python 3, elles sont activées par défaut)</p>
<p>Ainsi, notre classe Priere doit ressembler à ça maintenant :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Priere<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> expiation<span style="color: #66cc66;">=</span><span style="color: #008000;">False</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">expiation</span> <span style="color: #66cc66;">=</span> expiation
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> prier<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nombre_de_fois<span style="color: #66cc66;">=</span><span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">xrange</span><span style="color: black;">&#40;</span>nombre_de_fois<span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">for</span> ligne <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">self</span>.<span style="color: black;">texte</span>:
                <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">expiation</span>:
                    <span style="color: #ff7700;font-weight:bold;">print</span> ligne.<span style="color: black;">upper</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
                <span style="color: #ff7700;font-weight:bold;">else</span>:
                    <span style="color: #ff7700;font-weight:bold;">print</span> ligne</pre></td></tr></table></div>

<h2>Overriding</h2>
<p>Parfois on veut tout le code du parent dans l&#8217;enfant. Parfois juste une partie. L&#8217;héritage vous permet de réécrire certaines méthodes du parent dans l&#8217;enfant, c&#8217;est ce qu&#8217;on appelle l&#8217;overriding.</p>
<p>Quand vous faites :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Parent<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> truc<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'foo'</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Enfant<span style="color: black;">&#40;</span>Parent<span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">pass</span></pre></td></tr></table></div>

<p>En fait vous faites en quelque sorte :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Enfant<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> truc<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'foo'</span></pre></td></tr></table></div>

<p>Si vous faites :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Enfant<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> truc<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'foo'</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> truc<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'bar'</span></pre></td></tr></table></div>

<p>Vous allez écraser la première méthode avec la deuxième, car elles portent toutes les deux le même nom :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> Enfant<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">truc</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
bar</pre></td></tr></table></div>

<p>&#8220;Ecraser&#8221; en anglais, se dit &#8220;to override&#8221;. Félicitation, vous venez d&#8217;apprendre l&#8217;overriding ! Ce qu&#8217;on vient de voir plus haut s&#8217;écrit comme ça dans le cadre de l&#8217;héritage :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Parent<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> truc<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'foo'</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Enfant1<span style="color: black;">&#40;</span>Parent<span style="color: black;">&#41;</span>: 
    <span style="color: #ff7700;font-weight:bold;">pass</span> <span style="color: #808080; font-style: italic;"># pas d'overriding</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Enfant2<span style="color: black;">&#40;</span>Parent<span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> truc<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'bar'</span> <span style="color: #808080; font-style: italic;"># overriding !</span>
&nbsp;
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> Enfant1<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">truc</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
foo
<span style="color: #66cc66;">&gt;&gt;&gt;</span> Enfant2<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">truc</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
bar</pre></td></tr></table></div>

<p><code>Enfant1</code> a tout le code du parent qui est copié. <code>Enfant2</code> aussi, mais il réécrit la méthode, donc sa version de la méthode écrase celle du parent.</p>
<p>Voyons ce que ça donne sur un cas plus concret dans la vie de tous les jours comme les prières chrétiennes (promis je fais les sourates du Coran si je fais un tuto Haskell) :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Priere<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> expiation<span style="color: #66cc66;">=</span><span style="color: #008000;">False</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">expiation</span> <span style="color: #66cc66;">=</span> expiation
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> prier<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nombre_de_fois<span style="color: #66cc66;">=</span><span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">xrange</span><span style="color: black;">&#40;</span>nombre_de_fois<span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">for</span> ligne <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">self</span>.<span style="color: black;">texte</span>:
                <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">expiation</span>:
                    <span style="color: #ff7700;font-weight:bold;">print</span> ligne.<span style="color: black;">upper</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
                <span style="color: #ff7700;font-weight:bold;">else</span>:
                    <span style="color: #ff7700;font-weight:bold;">print</span> ligne
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> PaterNoster<span style="color: black;">&#40;</span>Priere<span style="color: black;">&#41;</span>:
&nbsp;
    texte <span style="color: #66cc66;">=</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Notre Père qui es aux cieux&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;que ton nom soit sanctifié&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;que ton règne vienne,&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;que ta volonté soit faite&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;sur la terre comme au ciel.&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Donne-nous aujourd’hui&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;notre pain de ce jour,&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;pardonne-nous nos offenses&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;comme nous pardonnons aussi&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;à ceux qui nous ont offensés&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;et ne nous soumets pas à la tentation&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;mais délivre-nous du mal.&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Amen&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;"># sur avemaria, on veut mettre en avant la version en araméen</span>
<span style="color: #808080; font-style: italic;"># car l'araméen c'est trop cool (ça ressemble au langage des furlings</span>
<span style="color: #808080; font-style: italic;"># dans stargate)</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> AveMaria<span style="color: black;">&#40;</span>Priere<span style="color: black;">&#41;</span>: 
&nbsp;
    vf <span style="color: #66cc66;">=</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Je vous salue, Marie pleine de grâce ;&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Le Seigneur est avec vous.&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Vous êtes bénie entre toutes les femmes&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Et Jésus, le fruit de vos entrailles, est béni.&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Sainte Marie, Mère de Dieu,&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Priez pour nous, pauvres pécheurs,&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Maintenant, et à l'heure de notre mort.&quot;</span><span style="color: #66cc66;">,</span>
            <span style="color: #483d8b;">&quot;Amen.&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    vo <span style="color: #66cc66;">=</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;ܡܠܝܬ ܛܝܒܘܬܐ&quot;</span><span style="color: #66cc66;">,</span>
          <span style="color: #483d8b;">&quot;ܡܪܢ ܥܡܟܝ&quot;</span><span style="color: #66cc66;">,</span>
          <span style="color: #483d8b;">&quot;ܡܒܪܟܬܐ ܐܢܬܝ ܒܢܫ̈ܐ&quot;</span><span style="color: #66cc66;">,</span>
          <span style="color: #483d8b;">&quot;ܘܡܒܪܟ ܗܘ ܦܐܪܐ ܕܒܟܪܣܟܝ ܡܪܢ ܝܫܘܥ&quot;</span><span style="color: #66cc66;">,</span>
          <span style="color: #483d8b;">&quot;ܐܘ ܩܕܝܫܬܐ ܡܪܝܡ ܝܠܕܬ ܐܠܗܐ&quot;</span><span style="color: #66cc66;">,</span>
          <span style="color: #483d8b;">&quot;ܨܠܝ ܚܠܦܝܢ ܚܛܝ̈ܐ&quot;</span><span style="color: #66cc66;">,</span>
          <span style="color: #483d8b;">&quot;ܗܫܐ ܘܒܫܥܬ ܘܡܘܬܢ&quot;</span><span style="color: #66cc66;">,</span>
          <span style="color: #483d8b;">&quot;ܐܡܝܢ܀&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> prier<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> nombre_de_fois<span style="color: #66cc66;">=</span><span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> version<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'vo'</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">xrange</span><span style="color: black;">&#40;</span>nombre_de_fois<span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">for</span> ligne <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">getattr</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> version<span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'vo'</span><span style="color: black;">&#41;</span>:
                <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">expiation</span>:
                    <span style="color: #ff7700;font-weight:bold;">print</span> ligne.<span style="color: black;">upper</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
                <span style="color: #ff7700;font-weight:bold;">else</span>:
                    <span style="color: #ff7700;font-weight:bold;">print</span> ligne
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> AveMaria<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">prier</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
ܡܠܝܬ ܛܝܒܘܬܐ
ܡܪܢ ܥܡܟܝ
ܡܒܪܟܬܐ ܐܢܬܝ ܒܢܫ̈ܐ
ܘܡܒܪܟ ܗܘ ܦܐܪܐ ܕܒܟܪܣܟܝ ܡܪܢ ܝܫܘܥ
ܐܘ ܩܕܝܫܬܐ ܡܪܝܡ ܝܠܕܬ ܐܠܗܐ
ܨܠܝ ܚܠܦܝܢ ܚܛܝ̈ܐ
ܗܫܐ ܘܒܫܥܬ ܘܡܘܬܢ
ܐܡܝܢ܀
<span style="color: #66cc66;">&gt;&gt;&gt;</span> AveMaria<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">prier</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">2</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'vf'</span><span style="color: black;">&#41;</span>
Je vous salue<span style="color: #66cc66;">,</span> Marie pleine de grâce <span style="color: #66cc66;">;</span>
Le Seigneur est avec vous.
<span style="color: black;">Vous</span> êtes bénie entre toutes les femmes
Et Jésus<span style="color: #66cc66;">,</span> le fruit de vos entrailles<span style="color: #66cc66;">,</span> est béni.
<span style="color: black;">Sainte</span> Marie<span style="color: #66cc66;">,</span> Mè<span style="color: #dc143c;">re</span> de Dieu<span style="color: #66cc66;">,</span>
Priez pour nous<span style="color: #66cc66;">,</span> pauvres pécheurs<span style="color: #66cc66;">,</span>
Maintenant<span style="color: #66cc66;">,</span> et à l<span style="color: #483d8b;">'heure de notre mort.
Amen.
Je vous salue, Marie pleine de grâce ;
Le Seigneur est avec vous.
Vous êtes bénie entre toutes les femmes
Et Jésus, le fruit de vos entrailles, est béni.
Sainte Marie, Mère de Dieu,
Priez pour nous, pauvres pécheurs,
Maintenant, et à l'</span>heure de notre mort.
<span style="color: black;">Amen</span>.</pre></td></tr></table></div>

<p>Ici la classe <code>AveMaria</code> hérite de la classe <code>Priere</code>. Deux méthodes sont copiées de <code>Priere</code> vers <code>AveMaria</code> : <code>__init__</code> et <code>prier()</code>.</p>
<p><code>__init__</code> ne change pas. Donc <code>AveMaria</code> a toujours le <code>__init__</code> de <code>Priere</code>. Par contre, on a overridé <code>prier()</code> dans <code>AveMaria</code>, qui est maintenant un code personnalisé<code>.<br />
</code><br />
Ceci nous permet donc de bénéficier d&#8217;une partie du code en commun (<code>__init__</code>), et de choisir un comportement différent pour d&#8217;autres bout du code (<code>prier()</code>).</p>
<p>La classe <code>PaterNoster</code>, elle, n&#8217;est pas affectée. Elle n&#8217;override rien, et sa méthode <code>prier()</code> est la même que celle de <code>Priere</code>.</p>
<p>Peut-être voulez-vous une exemple plus terre à terre (et moins dans les cieux) :</p>
<p>Prenez la bibliothèque <a href="http://sametmax.com/path-py-plus-en-detail/">path.py</a>, par exemple. Normalement quand on additionne deux strings, ça les concatène. Mais quand on les divise, le comportement par défaut est de lever une erreur.</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #483d8b;">'/home/sam'</span> + <span style="color: #483d8b;">'/blog'</span>
<span style="color: #483d8b;">'/home/sam/blog'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #483d8b;">'/home/sam'</span> / <span style="color: #483d8b;">'/blog'</span>
Traceback <span style="color: black;">&#40;</span>most recent call last<span style="color: black;">&#41;</span>:
  File <span style="color: #483d8b;">&quot;&lt;ipython-input-58-8701a4e82b4b&gt;&quot;</span><span style="color: #66cc66;">,</span> line <span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #66cc66;">&lt;</span>module<span style="color: #66cc66;">&gt;</span>
    <span style="color: #483d8b;">'/home/sam'</span> / <span style="color: #483d8b;">'/blog'</span>
<span style="color: #008000;">TypeError</span>: unsupported operand <span style="color: #008000;">type</span><span style="color: black;">&#40;</span>s<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">for</span> /: <span style="color: #483d8b;">'str'</span> <span style="color: #ff7700;font-weight:bold;">and</span> <span style="color: #483d8b;">'str'</span></pre></td></tr></table></div>

<p>Path.py override ce comportement :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">os</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> path<span style="color: black;">&#40;</span><span style="color: #008000;">str</span><span style="color: black;">&#41;</span>: <span style="color: #808080; font-style: italic;"># hé oui, on peut hériter des types de base</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__div__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> other<span style="color: black;">&#41;</span>: <span style="color: #808080; font-style: italic;"># override le comportement face à l'opérateur '/'</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> path<span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span>.<span style="color: black;">path</span>.<span style="color: black;">join</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> other<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
... <span style="color: black;">p</span> <span style="color: #66cc66;">=</span> path<span style="color: black;">&#40;</span><span style="color: #483d8b;">'/home/sam'</span><span style="color: black;">&#41;</span>
... <span style="color: #ff7700;font-weight:bold;">print</span> p / <span style="color: #483d8b;">'blog'</span>
/home/sam/blog</pre></td></tr></table></div>

<p>Ca nous donne une très jolie interface pour la manipulation des chemins d&#8217;accès.</p>
<h2>Polymorphisme et autres diableries</h2>
<p>Comme d&#8217;hab en prog, on adore les mots qui font super hype de la vibes du flex.</p>
<p>Le polymorphisme fait partie de ces termes compliqués qui cachent une notion simple : avoir une API commune qui fait des choses différentes.</p>
<p>Voyez-vous, nos deux classes <code>AveMaria</code> et <code>PaterNoster</code>, sont toutes les deux filles de la même classe parente. Elles se ressemblent donc beaucoup : elles ont des attributs et des méthodes en commun :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> p1 <span style="color: #66cc66;">=</span> AveMaria<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> p2 <span style="color: #66cc66;">=</span> PaterNoster<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> p1.<span style="color: black;">expiation</span>
<span style="color: #008000;">False</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> p2.<span style="color: black;">expiation</span>
<span style="color: #008000;">False</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> p1.<span style="color: black;">prier</span>
<span style="color: #66cc66;">&lt;</span>bound method AveMaria.<span style="color: black;">prier</span> of <span style="color: #66cc66;">&lt;</span><span style="color: #dc143c;">__main__</span>.<span style="color: black;">AveMaria</span> <span style="color: #008000;">object</span> at <span style="color: #ff4500;">0x20618d0</span><span style="color: #66cc66;">&gt;&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> p2.<span style="color: black;">prier</span>
<span style="color: #66cc66;">&lt;</span>bound method PaterNoster.<span style="color: black;">prier</span> of <span style="color: #66cc66;">&lt;</span><span style="color: #dc143c;">__main__</span>.<span style="color: black;">PaterNoster</span> <span style="color: #008000;">object</span> at <span style="color: #ff4500;">0x2061c90</span><span style="color: #66cc66;">&gt;&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> p1.<span style="color: #0000cd;">__init__</span>
<span style="color: #66cc66;">&lt;</span>bound method AveMaria.<span style="color: #0000cd;">__init__</span> of <span style="color: #66cc66;">&lt;</span><span style="color: #dc143c;">__main__</span>.<span style="color: black;">AveMaria</span> <span style="color: #008000;">object</span> at <span style="color: #ff4500;">0x20618d0</span><span style="color: #66cc66;">&gt;&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> p2.<span style="color: #0000cd;">__init__</span>
<span style="color: #66cc66;">&lt;</span>bound method PaterNoster.<span style="color: #0000cd;">__init__</span> of <span style="color: #66cc66;">&lt;</span><span style="color: #dc143c;">__main__</span>.<span style="color: black;">PaterNoster</span> <span style="color: #008000;">object</span> at <span style="color: #ff4500;">0x2061c90</span><span style="color: #66cc66;">&gt;&gt;</span></pre></td></tr></table></div>

<p>Ce sont pourtant des classes différentes (et <code>prier()</code> ne fait pas du tout le même chose), mais elles partagent ce qu&#8217;on appelle une API (une interface), c&#8217;est à dire une manière de les utiliser.</p>
<p>Cette capacité à être utilisé pareil, mais produire un résultat diffférent est ce qu&#8217;on appelle le polymorphisme (et c&#8217;est la base du <a href="https://fr.wikipedia.org/wiki/Duck_typing">duck typing</a>). Concrètement ça veut dire que vous pouvez utiliser les deux classes dans le même contexte, sans vous soucier de si c&#8217;est l&#8217;une ou l&#8217;autre :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> prieres <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>AveMaria<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> AveMaria<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> PaterNoster<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> AveMaria<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> PaterNoster<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> prieres
<span style="color: black;">&#91;</span><span style="color: #66cc66;">&lt;</span><span style="color: #dc143c;">__main__</span>.<span style="color: black;">AveMaria</span> <span style="color: #008000;">object</span> at <span style="color: #ff4500;">0x2061d50</span><span style="color: #66cc66;">&gt;,</span> <span style="color: #66cc66;">&lt;</span><span style="color: #dc143c;">__main__</span>.<span style="color: black;">AveMaria</span> <span style="color: #008000;">object</span> at <span style="color: #ff4500;">0x2061d90</span><span style="color: #66cc66;">&gt;,</span> <span style="color: #66cc66;">&lt;</span><span style="color: #dc143c;">__main__</span>.<span style="color: black;">PaterNoster</span> <span style="color: #008000;">object</span> at <span style="color: #ff4500;">0x2061f50</span><span style="color: #66cc66;">&gt;,</span> <span style="color: #66cc66;">&lt;</span><span style="color: #dc143c;">__main__</span>.<span style="color: black;">AveMaria</span> <span style="color: #008000;">object</span> at <span style="color: #ff4500;">0x2061f90</span><span style="color: #66cc66;">&gt;,</span> <span style="color: #66cc66;">&lt;</span><span style="color: #dc143c;">__main__</span>.<span style="color: black;">PaterNoster</span> <span style="color: #008000;">object</span> at <span style="color: #ff4500;">0x2061fd0</span><span style="color: #66cc66;">&gt;</span><span style="color: black;">&#93;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">for</span> priere <span style="color: #ff7700;font-weight:bold;">in</span> prieres: 
...     <span style="color: black;">priere</span>.<span style="color: black;">prier</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># prier une prière, ça se fait pareil</span>
&nbsp;
ܡܠܝܬ ܛܝܒܘܬܐ
ܡܪܢ ܥܡܟܝ
ܡܒܪܟܬܐ ܐܢܬܝ ܒܢܫ̈ܐ
ܘܡܒܪܟ ܗܘ ܦܐܪܐ ܕܒܟܪܣܟܝ ܡܪܢ ܝܫܘܥ
ܐܘ ܩܕܝܫܬܐ ܡܪܝܡ ܝܠܕܬ ܐܠܗܐ
ܨܠܝ ܚܠܦܝܢ ܚܛܝ̈ܐ
ܗܫܐ ܘܒܫܥܬ ܘܡܘܬܢ
ܐܡܝܢ܀
ܡܠܝܬ ܛܝܒܘܬܐ
ܡܪܢ ܥܡܟܝ
ܡܒܪܟܬܐ ܐܢܬܝ ܒܢܫ̈ܐ
ܘܡܒܪܟ ܗܘ ܦܐܪܐ ܕܒܟܪܣܟܝ ܡܪܢ ܝܫܘܥ
ܐܘ ܩܕܝܫܬܐ ܡܪܝܡ ܝܠܕܬ ܐܠܗܐ
ܨܠܝ ܚܠܦܝܢ ܚܛܝ̈ܐ
ܗܫܐ ܘܒܫܥܬ ܘܡܘܬܢ
ܐܡܝܢ܀
Notre Pè<span style="color: #dc143c;">re</span> qui es aux cieux
que ton nom soit sanctifié
que ton règne vienne<span style="color: #66cc66;">,</span>
que ta volonté soit faite
sur la terre comme au ciel.
<span style="color: black;">Donne</span>-nous aujourd’hui
notre pain de ce jour<span style="color: #66cc66;">,</span>
pardonne-nous nos offenses
comme nous pardonnons aussi
à ceux qui nous ont offensés
et ne nous soumets pas à la tentation
mais délivre-nous du mal.
<span style="color: black;">Amen</span>
ܡܠܝܬ ܛܝܒܘܬܐ
ܡܪܢ ܥܡܟܝ
ܡܒܪܟܬܐ ܐܢܬܝ ܒܢܫ̈ܐ
ܘܡܒܪܟ ܗܘ ܦܐܪܐ ܕܒܟܪܣܟܝ ܡܪܢ ܝܫܘܥ
ܐܘ ܩܕܝܫܬܐ ܡܪܝܡ ܝܠܕܬ ܐܠܗܐ
ܨܠܝ ܚܠܦܝܢ ܚܛܝ̈ܐ
ܗܫܐ ܘܒܫܥܬ ܘܡܘܬܢ
ܐܡܝܢ܀
Notre Pè<span style="color: #dc143c;">re</span> qui es aux cieux
que ton nom soit sanctifié
que ton règne vienne<span style="color: #66cc66;">,</span>
que ta volonté soit faite
sur la terre comme au ciel.
<span style="color: black;">Donne</span>-nous aujourd’hui
notre pain de ce jour<span style="color: #66cc66;">,</span>
pardonne-nous nos offenses
comme nous pardonnons aussi
à ceux qui nous ont offensés
et ne nous soumets pas à la tentation
mais délivre-nous du mal.
<span style="color: black;">Amen</span></pre></td></tr></table></div>

<p>Le polymorphisme, c&#8217;est donc l&#8217;utilisation de l&#8217;héritage pour faire des choses différentes, mais en proposant la même interface (ensemble de méthodes et d&#8217;attributs) pour le faire. Le polymorphisme s&#8217;étend aussi à la réaction aux opérateurs (+, -, /, or, and, etc), d&#8217;autant qu&#8217;en Python, c&#8217;est implémenté avec les méthodes nommées avec <code>__</code>.</p>
<p>Un dernier point pour les gens qui se demandent ce que veut dire <em>overloader</em>. L&#8217;overload est lié à l&#8217;override et au polymorphisme, mais ce n&#8217;est pas la même chose : elle consiste à overrider plusieurs fois une même méthode avec une signature différente. Il n&#8217;y a pas d&#8217;overload en Python, la notion ne nous concerne donc pas. Si vous voulez en apprendre plus, chopez un tuto Java ou C++.</p>
<h2>Qui est qui</h2>
<p>Avec l&#8217;héritage vient la notion de type. Quand vous créez une classe, vous créez un nouveau type. Quand vous sous-classez, vous créez un sous-type.</p>
<p>C&#8217;est intéressant, car une classe fille, est de son propre type ET du type de son parent (mais l&#8217;inverse n&#8217;est pas vrai).</p>
<p>Avec Python, on vérifie cela avec <code>isinstance()</code> :</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">isinstance</span><span style="color: black;">&#40;</span>Priere<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> Priere<span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># instance de sa propre classe</span>
<span style="color: #008000;">True</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">isinstance</span><span style="color: black;">&#40;</span>Priere<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">str</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># pas l'instance d'une classe quelconque</span>
<span style="color: #008000;">False</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">isinstance</span><span style="color: black;">&#40;</span>Priere<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> AveMaria<span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># pas l'instance d'un enfant</span>
<span style="color: #008000;">False</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">isinstance</span><span style="color: black;">&#40;</span>AveMaria<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> AveMaria<span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># instance de sa propre classe</span>
<span style="color: #008000;">True</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">isinstance</span><span style="color: black;">&#40;</span>AveMaria<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> Priere<span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># instance de sa classe parente</span>
<span style="color: #008000;">True</span></pre></td></tr></table></div>

<p>C&#8217;est utile, car certains comportements sont basés sur le type. Le plus important étant le mécanisme des exceptions. Un <code>try</code> / <code>except</code> arrêtera l&#8217;exception demandée, <strong>ou du même type</strong>.</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> MonExceptionPerso<span style="color: black;">&#40;</span><span style="color: #008000;">Exception</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">pass</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> FillesDeMonExceptionPerso<span style="color: black;">&#40;</span>MonExceptionPerso<span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">pass</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">try</span>:
    <span style="color: #ff7700;font-weight:bold;">raise</span> MonExceptionPerso<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Alerte ! Alerte !'</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">except</span> MonExceptionPerso:
    <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'Exception arrêtée'</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">try</span>:
    <span style="color: #ff7700;font-weight:bold;">raise</span> FillesDeMonExceptionPerso<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Alerte ! Alerte !'</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">except</span> FillesDeMonExceptionPerso:
    <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'Exception arrêtée'</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">try</span>:
    <span style="color: #ff7700;font-weight:bold;">raise</span> FillesDeMonExceptionPerso<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Alerte ! Alerte !'</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">except</span> MonExceptionPerso:
    <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'Exception arrêtée'</span>    
&nbsp;
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">try</span>:
    <span style="color: #ff7700;font-weight:bold;">raise</span> MonExceptionPerso<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Alerte ! Alerte !'</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">except</span> FillesDeMonExceptionPerso:
    <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'Exception arrêtée'</span>    
&nbsp;
&nbsp;
<span style="color: #008000;">Exception</span> arrêtée
<span style="color: #008000;">Exception</span> arrêtée
<span style="color: #008000;">Exception</span> arrêtée
Traceback <span style="color: black;">&#40;</span>most recent call last<span style="color: black;">&#41;</span>:
  File <span style="color: #483d8b;">&quot;&lt;ipython-input-67-7e7aec1e78c9&gt;&quot;</span><span style="color: #66cc66;">,</span> line <span style="color: #ff4500;">21</span><span style="color: #66cc66;">,</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #66cc66;">&lt;</span>module<span style="color: #66cc66;">&gt;</span>
    <span style="color: #ff7700;font-weight:bold;">raise</span> MonExceptionPerso<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Alerte ! Alerte !'</span><span style="color: black;">&#41;</span>
MonExceptionPerso: Alerte <span style="color: #66cc66;">!</span> Alerte <span style="color: #66cc66;">!</span></pre></td></tr></table></div>

<p><code>MonExceptionPerso</code> est de type <code>MonExceptionPerso</code>, donc l&#8217;exception est arrêtée. <code>FillesDeMonExceptionPerso</code> est de type <code>FillesDeMonExceptionPerso</code>, donc l&#8217;exception est arrêtée. <code>FillesDeMonExceptionPerso</code>, qui hérite de <code>MonExceptionPerso</code>, et donc de type <code>MonExceptionPerso</code> est arrêtée.</p>
<p>En revanche, <code>MonExceptionPerso</code> n&#8217;est PAS de type <code>FillesDeMonExceptionPerso</code>. Donc elle n&#8217;est pas arrêtée.</p>
<p>Je le signale car il est très courant de faire des enfants de <code>ValueError</code>, <code>IOError</code>, <code>IndexError</code>, <code>KeyError</code>, etc. et de le lever dans son propre programme. Cela permet à l&#8217;utilisateur de son code de pouvoir attraper soit toutes les erreurs de son code en faisant un <code>except</code> sur l&#8217;enfant, soit attraper toutes les erreurs de type <code>ValueError</code>, <code>IOError</code>, <code>IndexError</code>, <code>KeyError</code> en faisant le <code>except</code> sur le parent. On laisse ainsi une marge de manoeuvre dans la gestion des erreurs.</p>
<h2>Appeler la méthode de la classe parent</h2>
<p>Bon, vous avez overridé une méthode du parent. Mais c&#8217;est une groooooooooooooossse méthode. Vous allez pas la réécrire en entier, si ?</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Escorte<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> calculer_prix<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> heures<span style="color: #66cc66;">,</span> tarif<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> heures * tarif
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> EscorteDeLuxe<span style="color: black;">&#40;</span>Escorte<span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> calculer_prix<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> heures<span style="color: #66cc66;">,</span> tarif<span style="color: #66cc66;">,</span> supplement<span style="color: black;">&#41;</span>:
&nbsp;
        tarif <span style="color: #66cc66;">=</span>  heures * tarif
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> tarif + <span style="color: black;">&#40;</span>tarif * supplement / <span style="color: #ff4500;">100</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>Sur cet exemple éminement intellectuel, <code>calculer_prix()</code> est simple, donc tout réécrire dans <code>EscorteDeLuxe</code> n&#8217;est pas grave. Mais si c&#8217;était une <code>Geisha</code>, hein ? Avec un manuel en Japonais ? </p>
<p>Pour éviter ces problèmes de complexité liés à la globalisation, le perméabilisation des frontières et les sites de streaming, on peut appeler la méthode du parent, dans l&#8217;enfant, en utilisant <code>super()</code>:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> EscorteDeLuxe<span style="color: black;">&#40;</span>Escorte<span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> calculer_prix<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> heures<span style="color: #66cc66;">,</span> tarif<span style="color: #66cc66;">,</span> supplement<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #808080; font-style: italic;"># ceci est une manière compliquée de faire Escorte.calculer_prix</span>
        <span style="color: #808080; font-style: italic;"># et de récupérer le résultat</span>
        tarif <span style="color: #66cc66;">=</span>  <span style="color: #008000;">super</span><span style="color: black;">&#40;</span>EscorteDeLuxe<span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span><span style="color: black;">&#41;</span>.<span style="color: black;">calculer_prix</span><span style="color: black;">&#40;</span>heures<span style="color: #66cc66;">,</span> tarif<span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> tarif + <span style="color: black;">&#40;</span>tarif * supplement / <span style="color: #ff4500;">100</span><span style="color: black;">&#41;</span></pre></td></tr></table></div>

<p>C&#8217;est exactement la même chose que plus haut. Sauf qu&#8217;au lieu de copier / coller le code du parent, on l&#8217;appelle directement.</p>
<p>Je résume :</p>
<ul>
<li>on hérite du parent, et de son code</li>
<li>on override son code, car on veut un comportement différent</li>
<li>mais on veut quand même une partie du comportement du parent</li>
<li>donc dans la méthode de l&#8217;enfant, on appelle la méthode du parent</li>
</ul>
<p>Je réformule : quand vous overridez la méthode du parent dans l&#8217;enfant, celle du parent ne disparait pas. Elle est remplacée uniquement dans l&#8217;enfant. Et vous pouvez toujours vous servir de la version du parent en utilisant <code>super(ClassEncours, self).nom_de_method(arguments)</code> si vous en avez besoin.</p>
<p>Bon, c&#8217;était un gros morceau, et je suis pas sûr de pas être allé trop fort. Donc laissez en comment les remarques sur ce qui pourrait être mieux expliqué. <a href="http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-5/">La prochaine fois</a>, on verra des usages poussés comme la composition, la délégation et tous ces trucs d&#8217;un vrai code de production.</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-4/feed/</wfw:commentRss>
		<slash:comments>21</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2013/02/image01.jpg" length="43410" type="image/jpg" />	</item>
		<item>
		<title>TypeError: Error when calling the metaclass bases function() argument 1 must be code, not str 7</title>
		<link>http://sametmax.com/typeerror-error-when-calling-the-metaclass-bases-function-argument-1-must-be-code-not-str/</link>
		<comments>http://sametmax.com/typeerror-error-when-calling-the-metaclass-bases-function-argument-1-must-be-code-not-str/#comments</comments>
		<pubDate>Wed, 16 Jan 2013 12:16:23 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[error]]></category>
		<category><![CDATA[exception]]></category>
		<category><![CDATA[heritage]]></category>
		<category><![CDATA[pep8]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=4150</guid>
		<description><![CDATA[Cette erreur est souvent déclenchée quand on essaye d'hériter d'une fonction au lieu d'une classe. Cela peut arriver par erreur avec des fonctions qui sont nommées en CamelCase, en dépit du PEP8.]]></description>
				<content:encoded><![CDATA[<p>Cette erreur est souvent déclenchée quand on essaye d&#8217;hériter d&#8217;une fonction au lieu d&#8217;une classe. Cela peut arriver par erreur avec des fonctions qui sont nommées en CamelCase, en dépit du PEP8.</p>
<p>Par exemple:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Truc<span style="color: black;">&#40;</span><span style="color: #dc143c;">threading</span>.<span style="color: black;">Condition</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">pass</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Machine<span style="color: black;">&#40;</span><span style="color: #dc143c;">tempfile</span>.<span style="color: black;">NamedTemporaryFile</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">pass</span></pre></td></tr></table></div>

<p>Lèveront l&#8217;exception :</p>
<pre>TypeError: Error when calling the metaclass bases 
    function() argument 1 must be code, not str</pre>
<p>Car:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">threading</span><span style="color: #66cc66;">,</span> <span style="color: #dc143c;">tempfile</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">type</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">threading</span>.<span style="color: black;">Condition</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&lt;</span><span style="color: #008000;">type</span> <span style="color: #483d8b;">'function'</span><span style="color: #66cc66;">&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">type</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">tempfile</span>.<span style="color: black;">NamedTemporaryFile</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&lt;</span><span style="color: #008000;">type</span> <span style="color: #483d8b;">'function'</span><span style="color: #66cc66;">&gt;</span></pre></td></tr></table></div>

<p>Malgré leurs noms en majuscule.</p>
<p>Le message d&#8217;erreur est lui-même complètement obscure. Bref, le genre de truc qui est 100% lié à des erreurs d&#8217;autres personnes que vous aller payer par une après-midi de debug si on ne vous donne pas la solution. </p>
<p>Mais bon, la queue de celui qui n&#8217;a jamais pourri l&#8217;après-midi d&#8217;un autre codeur avec son travail merdique jette le premier parpaing.</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/typeerror-error-when-calling-the-metaclass-bases-function-argument-1-must-be-code-not-str/feed/</wfw:commentRss>
		<slash:comments>7</slash:comments>
	<enclosure url="http://sametmax.com/wp-content/uploads/2013/01/errormessagesrk3.png" length="424492" type="image/jpg" />	</item>
	</channel>
</rss>
