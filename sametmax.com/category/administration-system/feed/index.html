<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Sam &#38; Max: Python, Django, Git et du cul &#187; Administration System</title>
	<atom:link href="http://sametmax.com/category/administration-system/feed/" rel="self" type="application/rss+xml" />
	<link>http://sametmax.com</link>
	<description>Deux développeurs en vadrouille qui se sortent les doigts du code</description>
	<lastBuildDate>Wed, 05 Feb 2014 14:20:37 +0000</lastBuildDate>
	<language>en</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.3.1</generator>
	<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2F&amp;language=en_US&amp;category=text&amp;title=Sam+%26amp%3B+Max%3A+Python%2C+Django%2C+Git+et+du+cul&amp;description=Deux+d%C3%A9veloppeurs+en+vadrouille+qui+se+sortent+les+doigts+du+code&amp;tags=blog" type="text/html" />
		<item>
		<title>Virtualenv EnvironmentError: mysql_config not found sous MAC OSX</title>
		<link>http://sametmax.com/virtualenv-environmenterror-mysql_config-not-found-sous-mac-osx/</link>
		<comments>http://sametmax.com/virtualenv-environmenterror-mysql_config-not-found-sous-mac-osx/#comments</comments>
		<pubDate>Tue, 04 Feb 2014 10:56:18 +0000</pubDate>
		<dc:creator>Max</dc:creator>
				<category><![CDATA[Administration System]]></category>
		<category><![CDATA[Programmation]]></category>
		<category><![CDATA[Web]]></category>
		<category><![CDATA[config]]></category>
		<category><![CDATA[erreur]]></category>
		<category><![CDATA[mysql-python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=8963</guid>
		<description><![CDATA[Des fois il y a des petites choses comme ça qui devraient s'installer comme un rien et passer innaperçues mais non, ça vous fait une belle erreur et vous passez des heures à vous demander pourquoi ça ne veut pas s'installer. Restons zen...]]></description>
			<content:encoded><![CDATA[<p>Comme le post précédent est inutile j&#8217;en fait un autre qui doit concerner au moins 0.00001% de la population.</p>
<p>A vous qui essayez depuis 2 heures de configurer MySQL-python sous votre virtualenv, cet article vous est dédié.</p>
<p>Cette erreur vicieuse m&#8217;arrive à chaque fois que j&#8217;installe MySQL-python dans un nouvel environnement virtuel. Ceci dit vous l&#8217;aurez peut-être sous un autre OS. Sur centos j&#8217;avais qu&#8217;à faire un <em>yum install mysql-devel</em> mais sous Mac c&#8217;est autre chose. Plus de puissance engendre plus de responsabilités&#8230;</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">&nbsp;
Max $  pip <span style="color: #c20cb9; font-weight: bold;">install</span> MySQL-python
Downloading<span style="color: #000000; font-weight: bold;">/</span>unpacking MySQL-python
  Downloading MySQL-python-1.2.5.zip <span style="color: #7a0874; font-weight: bold;">&#40;</span>108Kb<span style="color: #7a0874; font-weight: bold;">&#41;</span>: 108Kb downloaded
  Running setup.py egg_info <span style="color: #000000; font-weight: bold;">for</span> package MySQL-python
    <span style="color: #c20cb9; font-weight: bold;">sh</span>: mysql_config: <span style="color: #7a0874; font-weight: bold;">command</span> not found
    Traceback <span style="color: #7a0874; font-weight: bold;">&#40;</span>most recent call <span style="color: #c20cb9; font-weight: bold;">last</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>:
      File <span style="color: #ff0000;">&quot;&lt;string&gt;&quot;</span>, line <span style="color: #000000;">14</span>, <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #000000; font-weight: bold;">&lt;</span>module<span style="color: #000000; font-weight: bold;">&gt;</span>
      File <span style="color: #ff0000;">&quot;/Users/Max/.virtualenvs/zooscator/build/MySQL-python/setup.py&quot;</span>, line <span style="color: #000000;">17</span>, <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #000000; font-weight: bold;">&lt;</span>module<span style="color: #000000; font-weight: bold;">&gt;</span>
        metadata, options = get_config<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
      File <span style="color: #ff0000;">&quot;setup_posix.py&quot;</span>, line <span style="color: #000000;">43</span>, <span style="color: #000000; font-weight: bold;">in</span> get_config
        libs = mysql_config<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">&quot;libs_r&quot;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
      File <span style="color: #ff0000;">&quot;setup_posix.py&quot;</span>, line <span style="color: #000000;">25</span>, <span style="color: #000000; font-weight: bold;">in</span> mysql_config
        raise EnvironmentError<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">&quot;%s not found&quot;</span> <span style="color: #000000; font-weight: bold;">%</span> <span style="color: #7a0874; font-weight: bold;">&#40;</span>mysql_config.path,<span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
    EnvironmentError: mysql_config not found
    Complete output from <span style="color: #7a0874; font-weight: bold;">command</span> python setup.py egg_info:
    <span style="color: #c20cb9; font-weight: bold;">sh</span>: mysql_config: <span style="color: #7a0874; font-weight: bold;">command</span> not found
&nbsp;
Traceback <span style="color: #7a0874; font-weight: bold;">&#40;</span>most recent call <span style="color: #c20cb9; font-weight: bold;">last</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>:
&nbsp;
  File <span style="color: #ff0000;">&quot;&lt;string&gt;&quot;</span>, line <span style="color: #000000;">14</span>, <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #000000; font-weight: bold;">&lt;</span>module<span style="color: #000000; font-weight: bold;">&gt;</span>
&nbsp;
  File <span style="color: #ff0000;">&quot;/Users/Max/.virtualenvs/zooscator/build/MySQL-python/setup.py&quot;</span>, line <span style="color: #000000;">17</span>, <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #000000; font-weight: bold;">&lt;</span>module<span style="color: #000000; font-weight: bold;">&gt;</span>
&nbsp;
    metadata, options = get_config<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
&nbsp;
  File <span style="color: #ff0000;">&quot;setup_posix.py&quot;</span>, line <span style="color: #000000;">43</span>, <span style="color: #000000; font-weight: bold;">in</span> get_config
&nbsp;
    libs = mysql_config<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">&quot;libs_r&quot;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
&nbsp;
  File <span style="color: #ff0000;">&quot;setup_posix.py&quot;</span>, line <span style="color: #000000;">25</span>, <span style="color: #000000; font-weight: bold;">in</span> mysql_config
&nbsp;
    raise EnvironmentError<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">&quot;%s not found&quot;</span> <span style="color: #000000; font-weight: bold;">%</span> <span style="color: #7a0874; font-weight: bold;">&#40;</span>mysql_config.path,<span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
&nbsp;
EnvironmentError: mysql_config not found
&nbsp;
<span style="color: #660033;">----------------------------------------</span>
Command python setup.py egg_info failed with error code <span style="color: #000000;">1</span>
Storing <span style="color: #7a0874; font-weight: bold;">complete</span> log <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #000000; font-weight: bold;">/</span>Users<span style="color: #000000; font-weight: bold;">/</span>Max<span style="color: #000000; font-weight: bold;">/</span>.pip<span style="color: #000000; font-weight: bold;">/</span>pip.log</pre></div></div>

<p>Il faut éditer votre fichier <strong>activate</strong> qui se trouve dans le répertoire bin de votre environnement virtuel: ex &#8220;/Users/Max/.virtualenvs/zooscator/bin/activate&#8221;</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">vi</span> <span style="color: #000000; font-weight: bold;">/</span>Users<span style="color: #000000; font-weight: bold;">/</span>Max<span style="color: #000000; font-weight: bold;">/</span>.virtualenvs<span style="color: #000000; font-weight: bold;">/</span>zooscator<span style="color: #000000; font-weight: bold;">/</span>bin</pre></div></div>

<p><strong>Trouvez les lignes suivantes et ajoutez:</strong></p>
<blockquote><p>PATH=&#8221;$PATH:/opt/local/lib/mysql5/bin/&#8221;
</p></blockquote>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">...
<span style="color: #007800;">_OLD_VIRTUAL_PATH</span>=<span style="color: #ff0000;">&quot;<span style="color: #007800;">$PATH</span>&quot;</span>
<span style="color: #007800;">PATH</span>=<span style="color: #ff0000;">&quot;<span style="color: #007800;">$VIRTUAL_ENV</span>/bin:<span style="color: #007800;">$PATH</span>&quot;</span>
<span style="color: #007800;">PATH</span>=<span style="color: #ff0000;">&quot;<span style="color: #007800;">$PATH</span>:/opt/local/lib/mysql5/bin/&quot;</span>
<span style="color: #7a0874; font-weight: bold;">export</span> PATH
...</pre></div></div>

<p>Chez moi le chemin vers mysql est /opt/local/lib/mysql5/bin/, si vous ne connaissez pas le vôtre utilisez la commande <em>locate</em>: ex <em>locate mysql</em></p>
<p><strong>Une fois le fichier <em>activate</em> édité il faut le resourcer:<br />
</strong></p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #7a0874; font-weight: bold;">source</span> <span style="color: #000000; font-weight: bold;">/</span>Users<span style="color: #000000; font-weight: bold;">/</span>Max<span style="color: #000000; font-weight: bold;">/</span>.virtualenvs<span style="color: #000000; font-weight: bold;">/</span>zooscator<span style="color: #000000; font-weight: bold;">/</span>bin<span style="color: #000000; font-weight: bold;">/</span>activate</pre></div></div>

<p><strong>Et vous pourrez alors installer MySQL-python tranquillou billou:<br />
</strong></p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">Max $  pip <span style="color: #c20cb9; font-weight: bold;">install</span> MySQL-python
&nbsp;
Downloading<span style="color: #000000; font-weight: bold;">/</span>unpacking MySQL-python
  Running setup.py egg_info <span style="color: #000000; font-weight: bold;">for</span> package MySQL-python
&nbsp;
Installing collected packages: MySQL-python
  Running setup.py <span style="color: #c20cb9; font-weight: bold;">install</span> <span style="color: #000000; font-weight: bold;">for</span> MySQL-python
<span style="color: #7a0874; font-weight: bold;">&#91;</span>....................<span style="color: #7a0874; font-weight: bold;">&#93;</span>
Successfully installed MySQL-python
Cleaning up...</pre></div></div>

<p>Je vais nourir mon cochon d&#8217;Inde.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=8963&amp;md5=c153ddb9ef35528707273f7e6d6bc2fe" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/virtualenv-environmenterror-mysql_config-not-found-sous-mac-osx/feed/</wfw:commentRss>
		<slash:comments>14</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fvirtualenv-environmenterror-mysql_config-not-found-sous-mac-osx%2F&amp;language=en_GB&amp;category=text&amp;title=Virtualenv+EnvironmentError%3A+mysql_config+not+found+sous+MAC+OSX&amp;description=Comme+le+post+pr%C3%A9c%C3%A9dent+est+inutile+j%26%238217%3Ben+fait+un+autre+qui+doit+concerner+au+moins+0.00001%25+de+la+population.+A+vous+qui+essayez+depuis+2+heures+de+configurer+MySQL-python+sous...&amp;tags=config%2Cerreur%2Cmysql-python%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2014/02/burn_out_1086894409_sato_kronik0405.jpg" length="49452" type="image/jpg" />	</item>
		<item>
		<title>ERROR:  invalid locale name avec PostGres</title>
		<link>http://sametmax.com/error-invalid-locale-name-avec-postgres/</link>
		<comments>http://sametmax.com/error-invalid-locale-name-avec-postgres/#comments</comments>
		<pubDate>Thu, 30 Jan 2014 13:12:02 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Administration System]]></category>
		<category><![CDATA[locale]]></category>
		<category><![CDATA[posgres]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=8743</guid>
		<description><![CDATA[Oui, j'avais besoin d'un poste bouche-trou.]]></description>
			<content:encoded><![CDATA[<p>Il suffit de redémarrer PostGres.</p>
<p>Ca arrive quand on met à jour ses locales et que des services tournent. Ils ne reçoivent pas l&#8217;information, et utilisent l&#8217;ancienne locale.</p>
<p>Oui, j&#8217;avais besoin d&#8217;un poste bouche-trou.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=8743&amp;md5=a3e3d51b364d4cb9428bd1922787d2e5" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/error-invalid-locale-name-avec-postgres/feed/</wfw:commentRss>
		<slash:comments>8</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Ferror-invalid-locale-name-avec-postgres%2F&amp;language=en_GB&amp;category=text&amp;title=ERROR%3A++invalid+locale+name+avec+PostGres&amp;description=Il+suffit+de+red%C3%A9marrer+PostGres.+Ca+arrive+quand+on+met+%C3%A0+jour+ses+locales+et+que+des+services+tournent.+Ils+ne+re%C3%A7oivent+pas+l%26%238217%3Binformation%2C+et+utilisent+l%26%238217%3Bancienne+locale.+Oui%2C+j%26%238217%3Bavais...&amp;tags=locale%2Cposgres%2Cblog" type="text/html" />
	</item>
		<item>
		<title>Remplacer sed, awk, cut et Perl par Python (= orgasme pour sysadmin)</title>
		<link>http://sametmax.com/remplacer-sed-awk-cut-et-perl-par-python-orgasme-pour-sysadmin/</link>
		<comments>http://sametmax.com/remplacer-sed-awk-cut-et-perl-par-python-orgasme-pour-sysadmin/#comments</comments>
		<pubDate>Sat, 14 Dec 2013 08:28:41 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Administration System]]></category>
		<category><![CDATA[awk]]></category>
		<category><![CDATA[bash]]></category>
		<category><![CDATA[perl]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[sed]]></category>
		<category><![CDATA[sysadmin]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=8261</guid>
		<description><![CDATA[La force de perl c'est qu'il permettait de piper des données directement via la ligne de commande pour faire des manipulations rapides.

C'est pour cela que c'était devenu les choix des sysadmins. Parce que jusqu'ici, le choix c'était soit de faire un truc simple en connaissant par coeur la tool box GNU, soit ouvrir un fichier et faire un script.

Python ne permet pas de piper des données directement dans la commande, mais des projets ont vu le jour pour le faire.]]></description>
			<content:encoded><![CDATA[<p>La force de Perl c&#8217;est qu&#8217;il permettait de piper des données directement via la ligne de commande pour faire des manipulations rapides.</p>
<p>C&#8217;est pour cela que c&#8217;était devenu les choix des sysadmins. Parce que jusqu&#8217;ici, le choix c&#8217;était soit de faire un truc simple en connaissant par coeur la tool box GNU, soit ouvrir un fichier et faire un script.</p>
<p>Python ne permet pas de piper des données directement dans la commande, mais des projets ont vu le jour pour le faire.</p>
<p>Il y a le projet <a href="http://code.google.com/p/pyp/">pyp</a>, que l&#8217;on doit à Sony Pictures Imageworks qui avait besoin de se simplifier l&#8217;automatisation des tâches de build pour ses films.</p>
<p>Et il y a <a href="https://pypi.python.org/pypi/Pyped/1.0">pyped</a>, dont j&#8217;avais brièvement parlé <a href="http://sametmax.com/sept-petites-libs-qui-changent-la-vie-dun-dev-python/">ici</a> (article qui mérite d&#8217;être mis à jour vu que j&#8217;ai remplace dateutils par <a href="http://sametmax.com/les-time-zones-en-python/">arrow</a>).</p>
<p>Les deux étaient sympas, mais avait des syntaxes alambiquées. Cependant, pyped est récemment passé en v1.0, donc stable, et a une toute nouvelle approche de syntaxe qui rend la bestiole super agréable à utiliser.</p>
<p>Présentation.</p>
<h2>Stdin, ligne à ligne</h2>
<p>L&#8217;installation est bateau, c&#8217;est du <a href="http://sametmax.com/votre-python-aime-les-pip/">pip</a> :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">pip <span style="color: #c20cb9; font-weight: bold;">install</span> <span style="color: #660033;">--user</span> pyped</pre></div></div>

<p>Et derrirère, on obtient la commande <code>py</code>. Elle s&#8217;utilise essentiellement à la suite d&#8217;une autre commande. Typiquement :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">cat</span> <span style="color: #000000; font-weight: bold;">/</span>etc<span style="color: #000000; font-weight: bold;">/</span>fsta <span style="color: #000000; font-weight: bold;">|</span> py <span style="color: #ff0000;">&quot;un truc&quot;</span></pre></div></div>

<p>L&#8217;astuce, c&#8217;est que &#8220;un truc&#8221; peut être n&#8217;importe quelle expression Python. Généralement une expression qui <code>print()</code> quelque chose.</p>
<p>Or, Pyped met automatiquement à disposition de cette expression deux variables :</p>
<ul>
<li>La ligne en cours, dans la variable <code>x</code>.</li>
<li>Le numéro de la ligne en cours, dans la variable <code>i</code>.</li>
</ul>
<p>L&#8217;expression Python est appelée une fois pour chaque ligne.</p>
<p>Par exemple, supposons que j&#8217;ai un fichier &#8220;fortune.txt&#8221; contenant :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">bitcoin <span style="color: #7a0874; font-weight: bold;">&#40;</span>btc<span style="color: #7a0874; font-weight: bold;">&#41;</span> : <span style="color: #000000;">5</span>
euros <span style="color: #7a0874; font-weight: bold;">&#40;</span>€<span style="color: #7a0874; font-weight: bold;">&#41;</span> : <span style="color: #000000;">100</span>
dollars <span style="color: #7a0874; font-weight: bold;">&#40;</span>$<span style="color: #7a0874; font-weight: bold;">&#41;</span> : <span style="color: #000000;">80</span></pre></div></div>

<p>Si je veut tout mettre en majuscule, je fais :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">$ <span style="color: #c20cb9; font-weight: bold;">cat</span> fortune.txt <span style="color: #000000; font-weight: bold;">|</span> py <span style="color: #ff0000;">&quot;print(x.upper())&quot;</span>
BITCOIN <span style="color: #7a0874; font-weight: bold;">&#40;</span>BTC<span style="color: #7a0874; font-weight: bold;">&#41;</span> : <span style="color: #000000;">5</span>
EUROS <span style="color: #7a0874; font-weight: bold;">&#40;</span>€<span style="color: #7a0874; font-weight: bold;">&#41;</span> : <span style="color: #000000;">100</span>
DOLLARS <span style="color: #7a0874; font-weight: bold;">&#40;</span>$<span style="color: #7a0874; font-weight: bold;">&#41;</span> : <span style="color: #000000;">80</span></pre></div></div>

<p>On peut mettre plusieurs expressions d&#8217;affilé. Ainsi, si je veux récupérer la somme et le symbole uniquement :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">$ <span style="color: #c20cb9; font-weight: bold;">cat</span> fortune.txt <span style="color: #000000; font-weight: bold;">|</span> py <span style="color: #ff0000;">&quot;devise, sign, _, value = x.split()&quot;</span> <span style="color: #ff0000;">&quot;sign = sign.strip('()')&quot;</span> <span style="color: #ff0000;">&quot;print('%s%s' % (value, sign))&quot;</span>
5btc
<span style="color: #000000;">100</span>€
<span style="color: #000000;">80</span>$</pre></div></div>

<p>Ok, c&#8217;est plus long que perl, mais vachement plus facile à écrire et à relire. Et j&#8217;utilise un langage que je connais déjà. Et pas besoin de faire un mix incompréhensible de sed, awk et autre cut.</p>
<p>Si j&#8217;ai vraiment besoin de lisibilité, je peux même le mettre sur plusieurs lignes :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">$ <span style="color: #c20cb9; font-weight: bold;">cat</span> fortune.txt <span style="color: #000000; font-weight: bold;">|</span> py <span style="color: #ff0000;">&quot;                                                                                                 
devise, sign, _, value = x.split() 
sign = sign.strip('()') 
print('%s%s' % (value, sign))  
&quot;</span>
5btc
<span style="color: #000000;">100</span>€
<span style="color: #000000;">80</span>$</pre></div></div>

<p>Vous aurez noté que j&#8217;utilise <code>print()</code> et que je semble ne pas me soucier de l&#8217;unicode. C&#8217;est parceque pyped fait ça au début du script :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">__future__</span> <span style="color: #ff7700;font-weight:bold;">import</span> print_function, unicode_literals, division, absolute_imports</pre></div></div>

<p>Du coup, on est bien en Python 2.7, mais on bénéficie de la division améliorée, de la fonction pour printer, des imports absolus et surtout, de l&#8217;unicode partout. D&#8217;ailleurs pyped vous transforme <code>x</code> pour que ce soit un objet unicode. </p>
<h2>Tout traiter d&#8217;un coup</h2>
<p>Parfois, on a besoin d&#8217;avoir accès à toutes les lignes, pas juste les lignes une à une. pyped permet cela avec l&#8217;option <code>-i</code>. Les variables <code>x</code> et <code>i</code> disparaissent au profit de la variable <code>l</code>, qui contient un itérable sur toutes les lignes.</p>
<p>Par exemple, envie de trier tout ça ?</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">cat fortune.<span style="color: black;">txt</span> | py -i <span style="color: #483d8b;">&quot;
lignes = (x.split() for x in l)
lignes = sorted((v, s.strip('()')) for d, s, _, v in lignes)
for ligne in lignes: print('%s%s' % ligne)
&quot;</span>
<span style="color: #ff4500;">100</span>€
5btc
<span style="color: #ff4500;">80</span>$</pre></div></div>

<h2>Moar options</h2>
<p>Lisez la doc, car il y a d&#8217;autres options du genre éviter que pyped vous strip automatiquement le ligne break, forcer l&#8217;encoding, etc.</p>
<p>Parmi les trucs les plus utiles, il y a l&#8217;option <code>-b</code> qui permet de lancer un code avant la boucle. Pratique pour importer des trucs genre le module <code>tarfile</code> pour extraire une archive avant d&#8217;utiliser son contenu.</p>
<p>Néanmoins la plupart du temps on a rien besoin d&#8217;importer car pyped importe déjà automatiquement les modules les plus utiles : maths, datetime, re, json, hashlib, uuid, etc. </p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=8261&amp;md5=83a66390fd625dd860b54e895ddffdee" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/remplacer-sed-awk-cut-et-perl-par-python-orgasme-pour-sysadmin/feed/</wfw:commentRss>
		<slash:comments>21</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fremplacer-sed-awk-cut-et-perl-par-python-orgasme-pour-sysadmin%2F&amp;language=en_GB&amp;category=text&amp;title=Remplacer+sed%2C+awk%2C+cut+et+Perl+par+Python+%28%3D+orgasme+pour+sysadmin%29&amp;description=La+force+de+Perl+c%26%238217%3Best+qu%26%238217%3Bil+permettait+de+piper+des+donn%C3%A9es+directement+via+la+ligne+de+commande+pour+faire+des+manipulations+rapides.+C%26%238217%3Best+pour+cela+que+c%26%238217%3B%C3%A9tait+devenu+les+choix...&amp;tags=awk%2Cbash%2Cperl%2Cpython%2Csed%2Csysadmin%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/12/hsmFx9T.jpg" length="182812" type="image/jpg" />	</item>
		<item>
		<title>Introduction à Ansible: l’outil du sysadmin paresseux mais pragmatique</title>
		<link>http://sametmax.com/introduction-a-ansible-loutil-du-sysadmin-paresseux-mais-pragmatique/</link>
		<comments>http://sametmax.com/introduction-a-ansible-loutil-du-sysadmin-paresseux-mais-pragmatique/#comments</comments>
		<pubDate>Fri, 06 Dec 2013 10:43:19 +0000</pubDate>
		<dc:creator>VonTenia</dc:creator>
				<category><![CDATA[Administration System]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=8177</guid>
		<description><![CDATA[Ceci est un post invité de VonTenia posté sous licence creative common 3.0 unported. Je profite du fait que Sam &#038; Max me donnent la parole pour vous parler d’Ansible, un programme très puissant et relativement simple dont je me sers depuis récemment (beaucoup trop tardivement à mon goût), mais qui a radicalement changé ma [...]]]></description>
			<content:encoded><![CDATA[<p style="text-align: center;"><em><small>Ceci est un post invité de <a href="http://sametmax.com/author/VonTenia/">VonTenia</a> posté sous licence <a href="http://creativecommons.org/licenses/by/3.0/">creative common 3.0 unported</a>.</small></em></p>
<p>Je profite du fait que Sam &#038; Max me donnent la parole pour vous parler d’Ansible, un programme très puissant et relativement simple dont je me sers depuis récemment (beaucoup trop tardivement à mon goût), mais qui a radicalement changé ma façon de gérer mes déploiements d’appli sur serveur.</p>
<p><strong>Avant-propos</strong> : Ce guide s’adresse avant tout à ceux et celles ayant le minimum d’aisance avec les systèmes linux. Je pense qu’il est nécessaire de savoir marcher avant d’apprendre à courir, l’automatisation de configuration est une bonne chose (vous allez voir que vous ne pourrez plus vous en passer), mais si vous n’avez aucune idée de comment éditer un fichier de configuration, ou comment redémarrer un service, vous risqueriez bien d&#8217;être pris au dépourvu&#8230; Mieux vaut alors pour vous commencer par apprendre les bases de l’administration système puis revenir une fois à l’aise avec le concept.</p>
<h3>Pourquoi utiliser un “Configuration Management Tool”</h3>
<p>Vous vous dites : mon boulot c’est de coder, l’administration système c’est sympa 5 minutes mais ça me gonfle… Et pourtant, au final votre application sera accédée via vos serveurs, et selon leur fragilité, la satisfaction de vos clients pourrait en pâtir (ce malgré votre excellent code parfaitement testé).</p>
<p>En tant que dev, il serait risible pour vous de ne pas versionner votre code ou ne pas le tester. Pourtant c’est ce que vous faites avec vos systèmes en n’utilisant pas de CfM. Et personne n’est à l&#8217;abri des aléas de la vie, par exemple:</p>
<ul>
<li>vous êtes hébergé dans le cloud et votre voisin d’hyperviseur s&#8217;avère maintenir un site Tor de trafic d’organes et de prostitution animalière (tout ça pour blanchir des bitcoins)… Vous apprécierez moyennement le downtime lorsque le FBI saisira le serveur que vous partagiez avec cet indélicat voisin.</li>
<li>Votre sysadmin ultra compètent pourrait se trouver dans l&#8217;incapacité d’exercer à la suite d’une banale auto-asphyxie érotique qui aurait mal tournée. Et bien évidemment il n’a rien documenté avant, le saligaud…</li>
</ul>
<p>Bref, le genre de risque qu&#8217;on apprend à identifier quand on passe sa certif ITIL&#8230;</p>
<h3>Les alternatives aux CfM</h3>
<p>Je vous vois venir, me disant que vous ne m’avez pas attendu pour envisager les situations précédentes. Vous avez déjà un plan de secours, à savoir :</p>
<ul>
<li>
<p><strong>Des scripts :</strong> Si vous êtes déjà un peu plus malin que la moyenne, vous vous êtes aperçu que pour déployer une nouvelle machine, vous tapez toujours les mêmes commandes : installer vos packages, les configurer, démarrer les services. Vous aurez donc votre collection de scripts shell ou fabric pour vous aider à la tâche.</p>
<p>Inconvénient : il faut être très organisé, gérer les différents fichiers de config peut prendre du temps lorsqu’il faut les modifier pour chaque serveur. Il est aussi parfois dangereux de relancer le script plusieurs fois sur la même machine, cela peut avoir des conséquences pour le moins hasardeuses.</p>
</li>
<li>
<p><strong>Une image disque :</strong> Une fois votre serveur configuré et parfaitement fonctionnel, vous avez pris soin d’en prendre une image disque. Le saint Graal de la prod, contenant la vérité absolue. En cas de crash vous serez opérationnel en un rien de temps.</p>
<p>Inconvénient : Les besoins de votre application vont évoluer avec le temps, les fichiers de configuration auront probablement changé aussi. A chaque changement vous devez refaire votre image… Ça devient assez lourd à la longue, et c’est facile d’oublier de le faire jusqu’au jour où “the shit hit the fan”.</p>
</li>
<li>
<p><strong>Rien (ou presque) :</strong> Si vous êtes comme moi, d’un naturel optimiste, vous n’avez quasiment pas de solution de secours (à part des backups). Le jour ou votre serveur crash, vous essayez de fixer le problème, et au pire vous en re-configurez un nouveau, ce qui vous prends entre 2 heures et 2 jours, en fonction de la dernière fois où vous avez eu à le faire (je n’ai jamais prétendu être un sysadmin très compètent&#8230;). Sans aller jusqu’au crash irrécupérable, le simple fait de vouloir changer d’hébergeur peut vous faire perdre un temps précieux. Vous perdez donc en flexibilité.</p>
<p>Inutile de vous dire que si vous faites parti de cette catégorie, je vous invite d’autant plus à continuer de lire.</p>
</li>
</ul>
<h3>Ansible à votre secours</h3>
<p>Ansible est un outil open-source de gestion de configuration écrit en python (aussi dispo en version commerciale avec une interface graphique et un service de déploiement). La configuration se fait via des fichiers appelés “Playbooks”. Citons parmi les avantages :</p>
<ul>
<li>Un système déclaratif : syntaxe YAML facilement lisible, ce qui rend l’apprentissage très rapide (plus qu’avec Chef à mon goût, où l’on s&#8217;empêtre très vite dans des problèmes de dépendance, et en plus je ne suis pas très fluent en ruby).</li>
<li>Templating des fichiers de configuration : qui permet d’avoir des fichiers dynamiquement générés en fonction de ce que vous voulez, tel que le rôle du serveur, ou bien dépendant d’un autre serveur. En plus le langage de template par défaut est Jinja2, ça plaira aux amateurs de Django.</li>
<li>Quasiment rien à installer. A part Ansible sur votre machine hôte, tout ce dont vous avez besoin c’est d’un accès root via SSH sur vos serveurs cibles.</li>
</ul>
<p>Ansible ne sert pas qu’à déployer votre infrastructure, il peut aussi servir à tester et s’assurer que tous les services qui sont censés fonctionner soient bien tous actifs, et que tous les fichiers de configurations sont bien à jour. Autant vous dire que plus vous avez de machines, plus ça devient intéressant.</p>
<p>Je sens que j&#8217;écris beaucoup et que j’ai déjà perdu la moitié des lecteurs. Aussi je vous invite à suivre ce petit tutoriel que j’ai préparé rien que pour vous parce que vous êtes quand même sympa.</p>
<h3>Tutoriel : Déployer une app django</h3>
<p>Nous allons essayer de déployer l’application <a href="https://github.com/sametmax/Django--an-app-at-a-time">Django&#8211;an-app-at-a-time</a> sur un système Debian wheezy en utilisant Ansible.</p>
<h4>1. Préparer la machine cible</h4>
<p>Pour les besoins du test, créer un serveur tout neuf sous Debian Wheezy :</p>
<ul>
<li>Soit en utilisant Virtualbox (dans ce cas utilisez <a href="http://www.debian.org/CD/netinst/">Debian netinstall</a>). N&#8217;installez que le système de base et le serveur SSH. Seul impératif: un accès ssh via root sur la machine.</li>
<li>Si vous avez les moyens, vous pouvez aussi vous créer temporairement une machine cloud sur OVH ou digital ocean, ça pourrait être plus rapide.</li>
</ul>
<h4>2. Installer Ansible</h4>
<p>Sur votre machine hôte (que j’assume être sous Ubuntu pour simplifier):</p>
<p>
Installez Ansible, via pip (de façon globale sans passer par virtualenv) :<br />
<code>$ sudo pip install ansible</code></p>
<p>Générez clefs privée/publique si vous n’en avez pas déjà :<br />
<code>$ ssh-keygen</code></p>
<p>Copiez la clef publique sur le serveur cible (qui sera désigné par 192.168.1.1 dans ce tutoriel, mais bien entendu remplacez par l’adresse de votre serveur cible).<br />
<code>$ ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.1.1</code></p>
<p>Créez le fichier <strong>/etc/ansible/hosts</strong> qui contiendra la liste des serveurs à gérer, et placez-y l&#8217;adresse de votre serveur:<br />
<code>$ sudo vim /etc/ansible/hosts</code><br />
<code>192.168.1.1</code></p>
<p>Testez que le serveur soit bien accessible:<br />
<code>$ ansible all -m ping -u root </code><br />
devrait retourner:<br />
<code>192.168.1.1 | success >> {<br />
    "changed": false,<br />
    "ping": "pong"<br />
}</code></p>
<p>Bravo, Ansible est installé et peut communiquer avec votre serveur cible. En avant pour la magie !</p>
<p><img src="http://sametmax.com/wp-content/uploads/2013/12/its-Magic.gif" alt="" title="its-Magic" width="350" height="196" class="alignnone size-full wp-image-8192" /><br />

</p>
<h4>3. Récupérer le Playbook de démo et l&#8217;exécuter</h4>
<p>Clonez mon repo github concocté avec amour et exécutez le playbook:</p>
<p><code>$ git clone https://github.com/Remiz/playbook-demo.git<br />
$ cd playbook-demo/<br />
$ ansible-playbook site.yml</code></p>
<p>Maintenant, plus qu&#8217;à attendre&#8230;</p>
<p><img src="http://sametmax.com/wp-content/uploads/2013/12/cookie-monster.gif" alt="" title="cookie monster is waiting..." width="250" height="143" class="alignnone size-full wp-image-8203" /></p>
<h4>3. Admirer le résultat</h4>
<p>Visitez le site hébergé à l’adresse de votre serveur (dans mon exemple <a href="http://192.168.1.1">http://192.168.1.1</a>)</p>
<p>Votre réaction la plus normale devrait être la suivante :</p>
<p><img src="http://sametmax.com/wp-content/uploads/2013/12/areyouawizard.png" alt="" title="areyouawizard" width="200" height="259" class="alignnone size-full wp-image-8209" /></p>
<p>Je vous invite maintenant à ouvrir le playbook <a href="https://github.com/Remiz/playbook-demo/blob/master/site.yml">site.yml</a> et essayer de comprendre. Durant ce court laps de temps, nous avons:</p>
<ul>
<li>Créé un utilisateur “myproject”</li>
<li>Ajouté cet utilisateur aux sudoers</li>
<li>Ajouté votre clef privée locale</li>
<li>Mis a jour la date du serveur</li>
<li>Installé/activé le serveur NTP</li>
<li>Sécurisé le serveur en installant fail2ban et en configurant le firewall iptables (laissant ouvert les ports 22, 80, 443 et 4949 pour le monitoring sous munin)</li>
<li>Installé quelques outils systèmes bien utiles tel que git ou htop</li>
<li>Installé/configuré Nginx, Supervisor, Pip, virtualenv</li>
<li>Cloné le repo Django&#8211;an-app-at-a-time</li>
<li>Créé un virtualenv avec django/gunicorn</li>
<li>Configuré gunicorn pour être lancé via supervisor</li>
<li>et finalement deployé les fichiers statiques&#8230;</li>
</ul>
<p>Pas mal en 5 minutes, non ? Maintenant si vous ne me croyez pas, je vous invite à vous connecter sur votre serveur</p>
<p><code>$ ssh myproject@192.168.1.1</code></p>
<p>et tester les commandes suivantes :</p>
<p><code>$ date<br />
$ sudo iptables -L<br />
$ ps -ef | grep fail2ban<br />
$ ps -ef | grep gunicorn</code></p>
<p>Notez que je n’ai pas utilisé runserver de Django, tout est proprement déployé sur une stack gunicorn/supervisor/virtualenv, bref je me suis pas foutu de votre gueule. Le Playbook est à vous, c’est cadeau. J&#8217;espère qu’il vous servira comme base pour vos futurs déploiements, et si jamais vous vous rendez compte que vous gagnez un temps fou à l&#8217;utiliser, n&#8217;hésitez pas à me payer une pinte si vous êtes de passage au Canada.</p>
<p>Une autre expérience intéressante consiste à relancer l&#8217;exécution du playbook :</p>
<p><code>$ ansible-playbook site.yml</code></p>
<p>Tout devrait aller beaucoup plus vite, et à la place de “changed” après chaque instruction, vous devriez lire “ok”. Ce qui veut dire qu’un playbook est plus intelligent qu’un bête script, et ne se contente pas d&#8217;exécuter des instructions, Ansible va garantir quel tel service soit bien actif et qu’il utilise bien le dernier fichier de conf. Ce qui en fait l’outil parfait pour tester vos systèmes automatiquement.</p>
<h3>La syntaxe Playbook</h3>
<p>Le but de ce tutoriel n’est que de vous présenter Ansible, aussi je ne rentrerai pas trop dans les détails et je vous inviterai à vous rendre sur le site officiel pour une <a href="http://www.ansibleworks.com/docs/">documentation</a> plus complète.</p>
<p>Un playbook est avant tout composé de tâches :</p>
<p><code>- name: Texte qui décris votre tâche<br />
    module: option=value</code></p>
<p>Une tâche va donc appeler un <a href="http://www.ansibleworks.com/docs/modules.html">module</a> Ansible, dont la fonction peut être de copier un fichier, démarrer un service, clôner un repository… Il y en a vraiment beaucoup. Chaque module reçoit des paramètres tels que : un fichier de configuration source (sur votre machine hôte), un path de destination, un package apt à installer… Référez vous à la doc pour savoir quels paramètres sont acceptés.</p>
<p>Exemples :</p>
<p><code>- name: Démarrer fail2ban<br />
    service: name=fail2ban state=started enabled=true</code></p>
<p>va s’assurer que le service appelé fail2ban soit bien démarré (le démarrer si ce n’est pas le cas), mais aussi s’assurer qu’il soit bien présent au démarrage du système. Quand je vous disait que la syntaxe est très simple (même plus simple qu’avec des scripts shell).</p>
<p>Autre exemple:</p>
<p><code>- name: Configurer Nginx<br />
          template: src=templates/nginx.conf.j2<br />
          dest=/etc/nginx/sites-enabled/{{ user }}.conf<br />
notify: restart nginx</code></p>
<p>se traduit par : récupérer le template de conf dans le répertoire local templates/ (le parser avec les bonnes valeurs), et placer le résultat dans le répertoire de conf de Nginx (en utilisant le nom d’utilisateur comme nom du fichier). Enfin redémarrer nginx via un handler (uniquement si le contenu du fichier de conf a changé).</p>
<h3>Conclusion (et aller plus loin)</h3>
<p>Je vous conseille de lire la documentation officielle, elle est plutôt bien faite, dites-vous que je ne connaissais pas du tout cet outil il y a deux semaines et je m’en sert désormais régulièrement (et je suis du genre slow-learner). Renseignez vous particulièrement sur les <a href="http://www.ansibleworks.com/docs/playbooks_roles.html#id5">rôles</a> que vous pouvez donner à vos serveurs, ce qui vous permet de diviser vos playbooks (frontend, cluster DB, worker celery…), et ce qui encourage aussi la réutilisation (par exemple j’ai toujours un rôle “common” qui inclus tout ce qui est nécessaire à l&#8217;ensemble de mes serveurs : utilisateur admin, sécurité, timezone…). Comme on n’apprend jamais aussi bien que par l’exemple, n&#8217;hésitez pas à vous inspirer des <a href="https://github.com/ansible/ansible-examples">exemples</a> issus de la doc (l’outil évolue vite et certains ne sont plus entièrement valides, mais c’est toujours bon à prendre).</p>
<p>Si vous voulez pousser l’automatisation jusqu&#8217;à l&#8217;extrême, il est aussi possible de configurer Ansible sur vos serveurs pour se connecter à un repo git, récupérer les playbooks et fichiers de conf appropriés et s’auto-configurer&#8230;</p>
<p>Voila, mon rôle s&#8217;arrête ici et libre à vous d’en apprendre plus. Au final j&#8217;espère avoir tenu ma promesse d&#8217;éclairer vos esprit sur les miracles de l’automatisation.</p>
<p><img src="http://sametmax.com/wp-content/uploads/2013/12/mind-blown1.gif" alt="" title="mind-blown" width="200" height="200" class="alignnone size-full wp-image-8212" /></p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=8177&amp;md5=0929d9232ef6125d29da5de891ac4d52" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/introduction-a-ansible-loutil-du-sysadmin-paresseux-mais-pragmatique/feed/</wfw:commentRss>
		<slash:comments>29</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fintroduction-a-ansible-loutil-du-sysadmin-paresseux-mais-pragmatique%2F&amp;language=en_GB&amp;category=text&amp;title=Introduction+%C3%A0+Ansible%3A+l%E2%80%99outil+du+sysadmin+paresseux+mais+pragmatique&amp;description=Ceci+est+un+post+invit%C3%A9+de+VonTenia+post%C3%A9+sous+licence+creative+common+3.0+unported.+Je+profite+du+fait+que+Sam+%26%23038%3B+Max+me+donnent+la+parole+pour+vous+parler+d%E2%80%99Ansible%2C...&amp;tags=blog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/12/sysadmin-hanged.jpg" length="167782" type="image/jpg" />	</item>
		<item>
		<title>Marre des mots de passe pour push sur git ?</title>
		<link>http://sametmax.com/marre-des-mots-de-passe-pour-push-sur-git/</link>
		<comments>http://sametmax.com/marre-des-mots-de-passe-pour-push-sur-git/#comments</comments>
		<pubDate>Tue, 19 Nov 2013 08:36:34 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Administration System]]></category>
		<category><![CDATA[auth]]></category>
		<category><![CDATA[cache]]></category>
		<category><![CDATA[git]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=8013</guid>
		<description><![CDATA[Vous êtes dans une situation où vous ne pouvez pas utiliser uniquement un clé pour vous authentifier, et il faut taper votre putain de mot de passe à chaque push.]]></description>
			<content:encoded><![CDATA[<p>Vous êtes dans une situation où vous ne pouvez pas utiliser uniquement une clé pour vous authentifier, et il faut taper votre putain de mot de passe à chaque push.</p>
<p><a href="http://sametmax.com/git-push-via-http-ou-comment-travailler-au-macdo/">Ça sent le vécu n&#8217;est-ce pas ?</a></p>
<p>Mais bien entendu git vient avec une option bien cachée au fond de son fion pour adresser ce problème :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">git</span> config credential.helper <span style="color: #ff0000;">'cache --timeout=3600'</span></pre></div></div>

<p>Et votre authentification sera gardée en mémoire pour une heure. Vous pouvez faire :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">git</span> config <span style="color: #660033;">--global</span> credential.helper <span style="color: #ff0000;">'cache --timeout=3600'</span></pre></div></div>

<p>Pour l&#8217;étendre à tous les repos de votre machine.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=8013&amp;md5=e4c62cc7ed21334f85fbfed045830fc7" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/marre-des-mots-de-passe-pour-push-sur-git/feed/</wfw:commentRss>
		<slash:comments>12</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fmarre-des-mots-de-passe-pour-push-sur-git%2F&amp;language=en_GB&amp;category=text&amp;title=Marre+des+mots+de+passe+pour+push+sur+git+%3F&amp;description=Vous+%C3%AAtes+dans+une+situation+o%C3%B9+vous+ne+pouvez+pas+utiliser+uniquement+une+cl%C3%A9+pour+vous+authentifier%2C+et+il+faut+taper+votre+putain+de+mot+de+passe+%C3%A0+chaque+push....&amp;tags=auth%2Ccache%2Cgit%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/11/cdempDI.jpg" length="51081" type="image/jpg" />	</item>
		<item>
		<title>You are deprecated</title>
		<link>http://sametmax.com/you-are-deprecated/</link>
		<comments>http://sametmax.com/you-are-deprecated/#comments</comments>
		<pubDate>Mon, 18 Nov 2013 08:20:47 +0000</pubDate>
		<dc:creator>Toniob</dc:creator>
				<category><![CDATA[Administration System]]></category>
		<category><![CDATA[ifconfig]]></category>
		<category><![CDATA[ip]]></category>
		<category><![CDATA[route]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=7985</guid>
		<description><![CDATA[Oh oui, je sais ce que vous allez me dire, et vous avez parfaitement raison. Oui, il m'arrive d'être un peut obtus sur certaines choses, surtout quand il s'agit d'un domaine que je connais. Bref, aujourd'hui nous allons parler de ifconfig et de route.]]></description>
			<content:encoded><![CDATA[<p style="text-align: center;"><em><small>Ceci est un post invité de <a href="http://sametmax.com/author/toniob/">Toniob</a> posté sous licence <a href="http://creativecommons.org/licenses/by/3.0/">creative common 3.0 unported</a>.</small></em></p>
<p>Oh oui, je sais ce que vous allez me dire, et vous avez parfaitement raison. Oui, il m&#8217;arrive d&#8217;être un peu obtus sur certaines choses, surtout quand il s&#8217;agit d&#8217;un domaine que je connais. Bref, aujourd&#8217;hui nous allons parler de ifconfig et de route.</p>
<p>Soyons clair tout de suite : arrêtez d&#8217;utiliser ces merdes, elles sont dépréciées depuis longtemps ! Je sais comment sont les informaticiens de manière générale, et les administrateurs systèmes en particulier. Il est difficile de changer leurs habitudes. Mais si on vous proposait Scarlett Johansson, vous resteriez fidèle à Régine ou Jonathan Rhys Meyers si vous aviez Mickey Rourke ? Je vois à vos yeux lubriques que vous m&#8217;avez saisi. Alors c&#8217;est parti.</p>
<div id="attachment_7987" class="wp-caption alignnone" style="width: 490px"><a href="http://sametmax.com/you-are-deprecated/ifconfig-deprecated/" rel="attachment wp-att-7987"><img src="http://sametmax.com/wp-content/uploads/2013/11/ifconfig-deprecated.jpg" alt="" title="ifconfig-deprecated" width="480" height="288" class="size-full wp-image-7987" /></a><p class="wp-caption-text">- ifconfig ? - ouiiiii ** tum tum tum tum **</p></div>
<p><strong>Les interfaces</strong></p>
<p>Utilisez la commande ip, c&#8217;est un ordre. Elle remplacera avantageusement ifconfig. Dans la suite de ce billet, je mettrai des exemples de commandes avec ifconfig et leur équivalent avec ip. Commençons avec du simple, afficher la liste des interfaces disponibles :</p>
<p><code>
<pre># ifconfig -a
eth0      Link encap:Ethernet  HWaddr 00:90:f5:ee:62:31
          UP BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 lg file transmission:1000
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
          Interruption:20 Mémoire:f7e00000-f7e20000

lo        Link encap:Boucle locale
          inet adr:127.0.0.1  Masque:255.0.0.0
          adr inet6: ::1/128 Scope:Hôte
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:12 errors:0 dropped:0 overruns:0 frame:0
          TX packets:12 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 lg file transmission:0
          RX bytes:720 (720.0 B)  TX bytes:720 (720.0 B)
$ ip addr
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: eth0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc pfifo_fast state DOWN mode DEFAULT group default qlen 1000
    link/ether 00:90:f5:ee:62:31 brd ff:ff:ff:ff:ff:ff</pre>
<p></code></p>
<p>Vous voyez, pour le moment ce n&#8217;est pas si compliqué, vous économisez même de précieuses lettres. Vous constatez que la sortie est différente, mais vous y trouverez globalement les mêmes informations. C&#8217;est une question d&#8217;habitude. Personnellement, ça m&#8217;a pris un peu de temps, mais je ne reviendrais en arrière pour rien au monde.</p>
<p>On va maintenant assigner une adresse ip. Bon, j&#8217;avoue, c&#8217;est un peu plus long cette fois avec la commande ip :</p>
<p><code>
<pre># ifconfig eth0 192.168.1.1/24
# ip addr add 192.168.1.1/24 dev eth0</pre>
<p></code></p>
<p>Et si maintenant nous ajoutions une adresse ipv4 ? Sauf qu&#8217;avec ifconfig, ce n&#8217;est pas possible, on ne peut le faire qu&#8217;avec ip :</p>
<p><code>
<pre># ip addr add 192.168.1.2/32 dev eth0</pre>
<p></code></p>
<p>Si on affiche la configuration de l&#8217;interface réseau :</p>
<p><code>
<pre># ifconfig eth0
eth0      Link encap:Ethernet  HWaddr 00:90:f5:ee:62:31
          inet adr:192.168.1.1  Bcast:0.0.0.0  Masque:255.255.255.0
          UP BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 lg file transmission:1000
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
          Interruption:20 Mémoire:f7e00000-f7e20000
$ ip addr show eth0
2: eth0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc pfifo_fast state DOWN group default qlen 1000
    link/ether 00:90:f5:ee:62:31 brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.1/24 scope global eth0
       valid_lft forever preferred_lft forever
    inet 192.168.1.2/32 scope global eth0
       valid_lft forever preferred_lft forever</pre>
<p></code></p>
<p>Et oui, rien du côté de ifconfig. Il ne voit pas que l&#8217;interface dispose de deux adresses différentes. Alors qu&#8217;il fallait utiliser des alias d&#8217;interface avec ifconfig, plus de souci de ce côté là avec ip. Voici maintenant quelques exemples d&#8217;autres commandes pouvant être utiles :</p>
<p><code>
<pre># ifconfig eth0 mtu 9000
# ip link set eth0 mtu 9000</pre>
<p></code></p>
<p><code>
<pre># ifconfig eth0 up
# ip link set eth0 up</pre>
<p></code></p>
<p><strong>Les routes</strong></p>
<p>Passons maintenant aux routes. Si vous utilisez ifconfig, vous vous servez aussi probablement de route. C&#8217;est fini les conneries maintenant ! Commençons par les afficher :</p>
<p><code>
<pre># route -n
Table de routage IP du noyau
Destination     Passerelle      Genmask         Indic Metric Ref    Use Iface
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 eth0
$ ip route
192.168.1.0/24 dev eth0  proto kernel  scope link  src 192.168.1.1</pre>
<p></code></p>
<p>Oui, la sortie est moins verbeuse par défaut. Ça devrait vous plaire pour vos scripts shell. Ajoutons maintenant une route par défaut :</p>
<p><code>
<pre># route add default gw 192.168.1.254
# ip route add defaut via 192.168.1.254</pre>
<p></code></p>
<p>Et si on regarde le résultat de la commande ip route maintenant :</p>
<p><code>
<pre>$ ip route
default via 192.168.1.254 dev eth0
192.168.1.0/24 dev eth0  proto kernel  scope link  src 192.168.1.1</pre>
<p></code></p>
<p>Contrairement à route, ip route génère une sortie qui peut être copiée / collée dans un ip route add. Pratique pour dupliquer une conf sur un autre serveur. Pour ajouter une route vers un hôte ou un réseau en particulier :</p>
<p><code>
<pre># route add -net 192.168.2.0 netmask 255.255.255.0 gw 192.168.1.253
# ip route add 192.168.2.0/24 via 192.168.1.253</pre>
<p></code></p>
<p>C&#8217;est une affaire de goût, mais je préfère largement la syntaxe de ip à celle de route.</p>
<p><strong>Conclusion</strong></p>
<p>Voilà cette petite introduction à la commande ip est terminée. Essayez de remplacer ifconfig dans vos usages au quotidien. Ça prend un peu de temps pour s&#8217;y faire, mais la syntaxe plus claire et les fonctionnalités disponibles permettent vite d&#8217;être plus rapide dans la configuration réseau d&#8217;une machine. Les exemples que j&#8217;ai donnés dans cet article devraient être suffisants pour 90% des usages. Si vous cherchez à vouloir en faire plus, il suffit d&#8217;ajouter l&#8217;option help à votre ligne de commande pour avoir des informations. Plus pratique que d&#8217;avoir à taper dans le man sans arrêt.</p>
<p>Si cet article vous plaît (merci de me faire des commentaires élogieux, c&#8217;est mon premier ici), j&#8217;essaierai de vous faire découvrir un peu plus la stack réseau sous Linux. Si les vlans sont connus, les bondings un peu moins, je pense que les macvtaps sont un mystère pour la plupart d&#8217;entre vous. Et tout se fait avec l&#8217;aide d&#8217;ip en plus, que demande le peuple ?</p>
<p>Et si la conf réseau ça vous saoule, je trouverai à m&#8217;énerver sur d&#8217;autres choses (le larousse n&#8217;a qu&#8217;à bien se tenir).</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=7985&amp;md5=7688f2e615a39a55e2be8fb8328f7629" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/you-are-deprecated/feed/</wfw:commentRss>
		<slash:comments>18</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fyou-are-deprecated%2F&amp;language=en_GB&amp;category=text&amp;title=You+are+deprecated&amp;description=Ceci+est+un+post+invit%C3%A9+de+Toniob+post%C3%A9+sous+licence+creative+common+3.0+unported.+Oh+oui%2C+je+sais+ce+que+vous+allez+me+dire%2C+et+vous+avez+parfaitement+raison.+Oui%2C...&amp;tags=ifconfig%2Cip%2Croute%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/11/terminator_02_connor.jpg" length="27630" type="image/jpg" />	</item>
		<item>
		<title>Changer la timezone sous Ubuntu Server en ligne de commande</title>
		<link>http://sametmax.com/changer-la-timezone-sous-ubuntu-server-en-ligne-de-commande/</link>
		<comments>http://sametmax.com/changer-la-timezone-sous-ubuntu-server-en-ligne-de-commande/#comments</comments>
		<pubDate>Fri, 15 Nov 2013 10:28:15 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Administration System]]></category>
		<category><![CDATA[ntp]]></category>
		<category><![CDATA[timezone]]></category>
		<category><![CDATA[ubuntu]]></category>
		<category><![CDATA[utc]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=7954</guid>
		<description><![CDATA[Avoir tous ses serveur à la même heure, c'est primordial. Et cette même heure devrait <a href="http://sametmax.com/les-time-zones-en-python/">toujours être UTC</a>. Sous Ubuntu server, ça se fait en deux lignes.
]]></description>
			<content:encoded><![CDATA[<p>Avoir tous ses serveur à la même heure, c&#8217;est primordial. Et cette même heure devrait <a href="http://sametmax.com/les-time-zones-en-python/">toujours être UTC</a>.</p>
<p>Du coup dans votre script de déploiement, n&#8217;oubliez pas de changer la timezone de la machine.</p>
<p>Sous Ubuntu server, ça se fait en deux lignes :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">&quot;UTC&quot;</span> <span style="color: #000000; font-weight: bold;">|</span> <span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #c20cb9; font-weight: bold;">tee</span> <span style="color: #000000; font-weight: bold;">/</span>etc<span style="color: #000000; font-weight: bold;">/</span>timezone
<span style="color: #c20cb9; font-weight: bold;">sudo</span> dpkg-reconfigure  <span style="color: #660033;">--frontend</span> noninteractive  tzdata</pre></div></div>

<p>Si vous avez des cron, redémarrez le daemon sinon il sera toujours décalé :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">sudo</span> service cron restart</pre></div></div>

<p>Si vous êtes du genre à aimer la précision, vous pouvez installer un daemon NTP qui permet de synchroniser l&#8217;horloge du serveur régulièrement avec un serveur distant :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #c20cb9; font-weight: bold;">apt-get</span> <span style="color: #660033;">-y</span> <span style="color: #c20cb9; font-weight: bold;">install</span> ntp</pre></div></div>

 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=7954&amp;md5=5233124b2b79eb104b08969a1448f361" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/changer-la-timezone-sous-ubuntu-server-en-ligne-de-commande/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fchanger-la-timezone-sous-ubuntu-server-en-ligne-de-commande%2F&amp;language=en_GB&amp;category=text&amp;title=Changer+la+timezone+sous+Ubuntu+Server+en+ligne+de+commande&amp;description=Avoir+tous+ses+serveur+%C3%A0+la+m%C3%AAme+heure%2C+c%26%238217%3Best+primordial.+Et+cette+m%C3%AAme+heure+devrait+toujours+%C3%AAtre+UTC.+Du+coup+dans+votre+script+de+d%C3%A9ploiement%2C+n%26%238217%3Boubliez+pas+de+changer+la...&amp;tags=ntp%2Ctimezone%2Cubuntu%2Cutc%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/11/wAiL8lw.png" length="492697" type="image/jpg" />	</item>
		<item>
		<title>La stack techno qu&#8217;on utilise pour faire un site Web, et pourquoi</title>
		<link>http://sametmax.com/la-stack-techno-quon-utilise-pour-faire-un-site-web-et-pourquoi/</link>
		<comments>http://sametmax.com/la-stack-techno-quon-utilise-pour-faire-un-site-web-et-pourquoi/#comments</comments>
		<pubDate>Mon, 11 Nov 2013 06:40:38 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Administration System]]></category>
		<category><![CDATA[celery]]></category>
		<category><![CDATA[django]]></category>
		<category><![CDATA[fabric]]></category>
		<category><![CDATA[mysql]]></category>
		<category><![CDATA[nginx]]></category>
		<category><![CDATA[nosql]]></category>
		<category><![CDATA[postgres]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[redis]]></category>
		<category><![CDATA[vm]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=7648</guid>
		<description><![CDATA[Une stack techno n'est pas une référence. Il n'y a pas de combo absolu qui rox absolument tout, c'est une question de contexte technique, financier, humain...

Mais c'est vrai que ça aide bien d'avoir sous les yeux les pratiques des autres.]]></description>
			<content:encoded><![CDATA[<p>Une stack techno n&#8217;est pas une référence. Il n&#8217;y a pas de combo absolu qui rox absolument tout, c&#8217;est une question de contexte technique, financier, humain&#8230;</p>
<p>Mais c&#8217;est vrai que ça aide bien d&#8217;avoir sous les yeux les pratiques des autres.</p>
<p>Je ne vais pas expliquer pourquoi Python, <a href="http://sametmax.com/10-raisons-pour-lesquelles-je-suis-toujours-marie-a-python/">je l&#8217;ai déjà fait</a>.</p>
<p>Commençons plutôt par la partie purement Web, pour laquelle on utilise Django, le framework Web Python.</p>
<p>Max et moi avons tout deux fait du PHP avant, j&#8217;ai tâté des frameworks internes, du Symfony et plus tard du Zope. J&#8217;ai regardé du côté de Pyramid et de ses prédécesseurs, et Django est celui qui me plaît le plus. J&#8217;ai juste un peu forcé la main à Max :-)</p>
<p>Car oui, le framework a été avant tout un choix de goût.</p>
<p>Ce n&#8217;est pas un choix de performances : le framework n&#8217;a aucun impact dessus. Aucun. Les architectures ont un impact. Le framework, non. Votre bottleneck sera sur les IO, pas sur le CPU. Le choix de technos asynchrones peut avoir un impact, mais ce n&#8217;est pas une question de framework. Tornado, Twisted ou NodeJS, on s&#8217;en fout. </p>
<p>Donc Django, essentiellement parce qu&#8217;il me plait. Et il me plaît pour ces raisons :</p>
<ul>
<li>Il y a un bon équilibre entre découplage et intégration. En général c&#8217;est soit très découplé et mal intégré, soit très bien intégré et très couplé.</li>
<li>C&#8217;est bien foutu et bien documenté. Et c&#8217;est stable. Vraiment très stable. Les core devs sont hyper sérieux.</li>
<li>C&#8217;est très versatile et ça peut faire plein de trucs out of the box, petits comme gros.</li>
<li>C&#8217;est assez facile à apprendre. Ça reste un framework, donc ce n&#8217;est pas la plus simple des démarches, mais dans le royaume des frameworks de cette taille, ça reste vraiment le plus simple.</li>
<li>La communauté est fantastique : il y a des centaines d&#8217;apps qui couvrent pratiquement tous les besoins.</li>
<li>Et bien entendu, c&#8217;est en Python.</li>
</ul>
<p>En terme de base de données, on a fait du MySQL pendant longtemps. Ça a plutôt bien marché. Maintenant je commence mes nouveaux projets avec PostGres, qui est plus solide. Parfois je fais juste du Sqlite, parce que ça suffit.</p>
<p>Pas de NoSQL. Après plusieurs expériences avec MongoDB et CouchDB, je n&#8217;ai pas été convaincu que les bénéfices dépassaient le coût. Il faudrait un article complet là dessus (qu&#8217;on m&#8217;a d&#8217;ailleurs demandé).</p>
<p>Question OS. c&#8217;est du CentOS avec Max (il a plus l&#8217;habitude) ou du Ubuntu Server pour mes autres projets. Je reste sur les LTS. Ce n&#8217;est pas un choix très réfléchi, c&#8217;est surtout par habitude.</p>
<p>Pas de machine virtuelle. On a essayé, sans y trouver un grand intérêt :</p>
<ul>
<li>Il faut quand même faire des scripts de migration, donc autant s&#8217;en servir pour le déploiement.</li>
<li>On perd en perfs.</li>
<li>Les erreurs liées au mal-fonctionnement d&#8217;une VM sont absolument indébuggable.</li>
<li>Si on ne fait pas la VM soit-même, il faut mettre ses couilles dans les mains d&#8217;un pestataire de service. J&#8217;ai horreur de ça.</li>
<li>Trouver des gens avec la compétence pour gérer une VM, c&#8217;est difficile. Un script de déploiement, c&#8217;est du code que tout dev saura déjà lire. Par extension ça veut dire que je m&#8217;y replonge facilement des semaines plus tard.</li>
</ul>
<p>Et donc pour le déploiement, j&#8217;utilise <a href="http://sametmax.com/travailler-moins-pour-gagner-plus-en-15-minutes-avec-python-fabric/">fabric</a>, avec <a href="https://github.com/ronnix/fabtools/">fabtools</a>.</p>
<p>Ce n&#8217;est pas la solution la plus efficace, d&#8217;autant que ça limite à Python 2.7, mais c&#8217;est la plus simple. C&#8217;est juste du code Python. N&#8217;importe qui peut comprendre le déploiement en 15 minutes. Ça se modifie vite, s&#8217;adapte facilement. </p>
<p>Il faut comprendre qu&#8217;on a jamais plus d&#8217;une dizaine de serveurs pour un projet, ces choix sont donc fait en fonction de cela. Il va sans dire que si vous gérez un parc de centaines de machines, ça ne sera pas du tout le même choix technique. Peut être que Chef ou des VM seront alors carrément plus interressant. Peut être que le NoSQL et sa capacité au scalling sera bien plus rentable.</p>
<p>Il ne s&#8217;agit pas de décrier les technos que nous n&#8217;utilisons pas. Il s&#8217;agit juste de dire, voilà les choix que nous avons fait, dans tel contexte, pour telles (bonnes ou mauvaises) raisons.</p>
<p>Durant les dernières années, on a ajouté <a href="http://redis.io/">Redis</a> à notre stack. C&#8217;est un outil fantastique qui sert à tout : de la base de données pour les trucs simples (il y a des fois ou un schéma est overkill) à la solution de caching. C&#8217;est ce qu&#8217;on a de plus proche du NoSQL.</p>
<p>L&#8217;outil est tellement simple à installer (vraiment le degré zero de la maintenance, c&#8217;est beau) et à utiliser que ça ne vaut juste pas le coup de s&#8217;en priver. </p>
<p>Du coup, plus de memcache. Toutes les grosses requêtes sont sauvegardées dans Redis, dès qu&#8217;on fait un script qui a besoin de persistance temporaire, Redis, pour communiquer entre plusieurs process, Redis, pour toutes les opérations qui ont besoin de grosses perfs comme les stats, Redis. Vive Redis.</p>
<p>D&#8217;ailleurs on utilise Redis aussi comme broker pour notre gestionnaire de queues et de taches : <a href="sametmax.com/files-de-taches-et-taches-recurrentes-avec-celery/">celery</a>. Si vous pythonez, je vous recommande chaudement celery pour toutes les tâches en background, les crawlers, les chaînes de process, etc.</p>
<p>On a aussi du moteur de recherche. Là on tappe dans du <a href="http://lucene.apache.org/solr/">Solr</a> (avec <a href="http://haystacksearch.org/">haystack</a>). C&#8217;est très puissant, en tout cas syntaxiquement car ça ne fait pas de sémantique. Ne vous attendez-donc pas à rattraper Google. Mais c&#8217;est aussi méga chiant à configurer et très lourd. Je pense qu&#8217;un jour on va migrer sur <a href="http://www.elasticsearch.org/">ElasticSearch</a>, mais c&#8217;est pas la priorité. Don&#8217;t fix what ain&#8217;t broken.</p>
<p>Devant tout ça on a <a href="http://nginx.org/">Nginx</a>. Comme beaucoup on a fait Apache => Cherokee => lighttp => nginx. Et franchement, je ne reviendrais jamais en arrière : plus léger, plus rapide, plus facile à installer et à configurer, plus versatile. Nginx fait tout, et mieux. </p>
<p>En proxy on a du <a href="http://gunicorn.org/">gunicorn</a>. Parce qu&#8217;on avait la flemme de configurer uwsgi et qu&#8217;on a pris l&#8217;habitude.</p>
<p>Après on utilise plein de libs, de petits outils, etc. Mais ça c&#8217;est le gros de notre archi.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=7648&amp;md5=a3c473ad94a4298f30d5296cdd292afc" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/la-stack-techno-quon-utilise-pour-faire-un-site-web-et-pourquoi/feed/</wfw:commentRss>
		<slash:comments>25</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fla-stack-techno-quon-utilise-pour-faire-un-site-web-et-pourquoi%2F&amp;language=en_GB&amp;category=text&amp;title=La+stack+techno+qu%26%238217%3Bon+utilise+pour+faire+un+site+Web%2C+et+pourquoi&amp;description=Une+stack+techno+n%26%238217%3Best+pas+une+r%C3%A9f%C3%A9rence.+Il+n%26%238217%3By+a+pas+de+combo+absolu+qui+rox+absolument+tout%2C+c%26%238217%3Best+une+question+de+contexte+technique%2C+financier%2C+humain%26%238230%3B+Mais+c%26%238217%3Best+vrai+que...&amp;tags=celery%2Cdjango%2Cfabric%2Cmysql%2Cnginx%2Cnosql%2Cpostgres%2Cpython%2Credis%2Cvm%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/11/nZ9b9.jpg" length="67160" type="image/jpg" />	</item>
		<item>
		<title>WARNING: File not found. Did you forget to save?</title>
		<link>http://sametmax.com/warning-file-not-found-did-you-forget-to-save/</link>
		<comments>http://sametmax.com/warning-file-not-found-did-you-forget-to-save/#comments</comments>
		<pubDate>Sat, 26 Oct 2013 07:58:23 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Administration System]]></category>
		<category><![CDATA[ipython]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[sublime text]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=7541</guid>
		<description><![CDATA[Un lecteur nous a <a href="http://sametmax.com/profiter-du-notebook-de-ipython/#comment-15166">rapporter ce problème</a> quand il utilisait la commande magique <code>%edit</code> dans IPython avec Sublime Text.]]></description>
			<content:encoded><![CDATA[<p>Un lecteur nous a <a href="http://sametmax.com/profiter-du-notebook-de-ipython/#comment-15166">rapporté ce problème</a> quand il utilisait la commande magique <code>%edit</code> dans IPython avec Sublime Text.</p>
<p>Magie d&#8217;internet, un autre lecteur lui a répondu en comment, mais je me dis que donner un peu de visibilité à la réponse peut pas faire de mal, vu que je n&#8217;ai pas trouvé facilement la solution via <del datetime="2013-10-25T12:40:42+00:00">Google</del> DuckDuckGo.</p>
<p>L&#8217;idée est tout simplement d&#8217;utiliser l&#8217;option <code>-w</code> dans la ligne de commande pour appeler l&#8217;éditeur. En effet, sans cela l&#8217;appel à ST est non bloquant, et IPython perd la référence au processus sans avoir de valeur de retour.</p>
<p>Par exemple, dans votre <em>ipython_config.py</em> :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">c.<span style="color: black;">TerminalInteractiveShell</span>.<span style="color: black;">editor</span> = <span style="color: #483d8b;">&quot;sublime_text -w&quot;</span></pre></div></div>

 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=7541&amp;md5=efc6c9f7dc228a171ec901c5c3d892ef" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/warning-file-not-found-did-you-forget-to-save/feed/</wfw:commentRss>
		<slash:comments>1</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fwarning-file-not-found-did-you-forget-to-save%2F&amp;language=en_GB&amp;category=text&amp;title=WARNING%3A+File+not+found.+Did+you+forget+to+save%3F&amp;description=Un+lecteur+nous+a+rapport%C3%A9+ce+probl%C3%A8me+quand+il+utilisait+la+commande+magique+%25edit+dans+IPython+avec+Sublime+Text.+Magie+d%26%238217%3Binternet%2C+un+autre+lecteur+lui+a+r%C3%A9pondu+en+comment%2C+mais...&amp;tags=ipython%2Cpython%2Csublime+text%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/10/tumblr_mv0imm4izr1r539hzo1_500.jpg" length="48151" type="image/jpg" />	</item>
		<item>
		<title>Afficher l&#8217;IP d&#8217;un visiteur &#8211; Django vs Nginx</title>
		<link>http://sametmax.com/afficher-la-vrai-ip-dun-visiteur-django-vs-nginx/</link>
		<comments>http://sametmax.com/afficher-la-vrai-ip-dun-visiteur-django-vs-nginx/#comments</comments>
		<pubDate>Fri, 25 Oct 2013 03:53:30 +0000</pubDate>
		<dc:creator>Max</dc:creator>
				<category><![CDATA[Administration System]]></category>
		<category><![CDATA[Programmation]]></category>
		<category><![CDATA[Web]]></category>
		<category><![CDATA[django]]></category>
		<category><![CDATA[nginx]]></category>
		<category><![CDATA[real ip]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=7525</guid>
		<description><![CDATA[dis moi quelle est ton IP et je te dirais rien.]]></description>
			<content:encoded><![CDATA[<p>Lorsque l&#8217;on veut connaitre son ip on fait souvent appel à des sites du genre: <a href="http://www.whatismyip.com/">whatismyip.com</a>, <a href="http://www.mon-ip.com/">mon-ip.com</a> ou on utilise un ifconfig en ssh.<br />
Des fois on a aussi besoin de connaître l&#8217;ip d&#8217;un visiteur sur son site, 2 petites méthodes pour le faire sous Django et Nginx.</p>
<p><strong>Sous Django:</strong> </p>
<p>Dans l&#8217;<a href="https://docs.djangoproject.com/en/dev/topics/http/urls/">Urlconf</a></p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">urlpatterns = patterns<span style="color: black;">&#40;</span><span style="color: #483d8b;">''</span>,
    <span style="color: #808080; font-style: italic;"># return client IP</span>
    url<span style="color: black;">&#40;</span>r<span style="color: #483d8b;">'^my_ip$'</span>, get_ip<span style="color: black;">&#41;</span>,
<span style="color: black;">&#41;</span></pre></div></div>

<p>Créez une <a href="https://docs.djangoproject.com/en/dev/topics/http/views/">vue</a> du nom de get_ip qui sera utilisée par l&#8217;urlconf</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">from</span> django <span style="color: #ff7700;font-weight:bold;">import</span> http
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> get_ip<span style="color: black;">&#40;</span>request<span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot;
        Vue qui retourne l'IP du client
    &quot;&quot;&quot;</span>
    <span style="color: #ff7700;font-weight:bold;">try</span>:
&nbsp;
    	<span style="color: #808080; font-style: italic;"># récupère l'ip du client</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> http.<span style="color: black;">HttpResponse</span><span style="color: black;">&#40;</span>request.<span style="color: black;">META</span><span style="color: black;">&#91;</span><span style="color: #483d8b;">&quot;REMOTE_ADDR&quot;</span><span style="color: black;">&#93;</span> <span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">Exception</span>, e:
        <span style="color: #ff7700;font-weight:bold;">return</span> http.<span style="color: black;">HttpResponse</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'error %s'</span> <span style="color: #66cc66;">%</span> e<span style="color: black;">&#41;</span></pre></div></div>

<p>Le code ci-dessus peut retourner l&#8217;adresse locale (127.0.0.1) dans ce cas il faut tester l&#8217;existence de la variable <strong>HTTP_X_REAL_IP</strong>, certains serveurs web ont besoin d&#8217;être <a href="http://rtcamp.com/tutorials/nginx/forwarding-visitors-real-ip/">configuré</a>. </p>
<p><strong>Sous Nginx:</strong></p>
<p>Dans le fichier de configuration de nginx on écrit une nouvelle <a href="http://wiki.nginx.org/HttpCoreModule#location">location</a></p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># return client ip</span>
location /my_ip <span style="color: black;">&#123;</span>
    default_type <span style="color: #483d8b;">'text/plain'</span><span style="color: #66cc66;">;</span>
    content_by_lua <span style="color: #483d8b;">'ngx.print(ngx.var.remote_addr)'</span><span style="color: #66cc66;">;</span>
<span style="color: black;">&#125;</span></pre></div></div>

<p>il suffit de se rendre à l&#8217;url http://monsite.com/my_ip pour voir s&#8217;afficher son ip. Cependant il faut avoir nginx compilé avec le module <a href="http://wiki.nginx.org/HttpLuaModule">Lua</a> ce qui peut être délicat si l&#8217;on a jamais compilé d&#8217;application.</p>
<p><strong><br />
Conclusion:</strong></p>
<p>Si l&#8217;on s&#8217;en réfère aux deux exemples ci dessus on serait tenté d&#8217;utiliser Nginx car en une seule ligne tout le bazar est réglé.<br />
Le hic c&#8217;est qu&#8217;il faut que Nginx soit compilé avec le module Lua pour afficher l&#8217;ip (sauf si quelqu&#8217;un connaît une autre façon d&#8217;afficher un message de sortie).<br />
La version Django n&#8217;est pas fiable à 100% car suivant comment est configuré votre serveur web il se peut que vous vous retrouviez avec une ip du genre 127.0.0.1.<br />
Il y a aussi la possibilité de parser le résultat des sites web cités en tout début d&#8217;article, certains proposent des Api je crois mais vous dépendez d&#8217;un autre service (on faisait ça au début) qui peuvent vous lâcher à tout moment (ce qui nous est arrivé).<br />
Personnellement je compile toujours nginx avec Lua et quelques autres modules, ça permet de s&#8217;affranchir de plus en plus du backend.</p>
<p>PS: j&#8217;ai mis à jour le titre car il laissait sous-entendre autre chose (merci à Sébastien)</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=7525&amp;md5=5db442cb353a28e02057726c4e826969" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/afficher-la-vrai-ip-dun-visiteur-django-vs-nginx/feed/</wfw:commentRss>
		<slash:comments>11</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fafficher-la-vrai-ip-dun-visiteur-django-vs-nginx%2F&amp;language=en_GB&amp;category=text&amp;title=Afficher+l%26%238217%3BIP+d%26%238217%3Bun+visiteur+%26%238211%3B+Django+vs+Nginx&amp;description=Lorsque+l%26%238217%3Bon+veut+connaitre+son+ip+on+fait+souvent+appel+%C3%A0+des+sites+du+genre%3A+whatismyip.com%2C+mon-ip.com+ou+on+utilise+un+ifconfig+en+ssh.+Des+fois+on+a+aussi+besoin...&amp;tags=django%2Cnginx%2Creal+ip%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/10/identity.jpg" length="31647" type="image/jpg" />	</item>
	</channel>
</rss>
