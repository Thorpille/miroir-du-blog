<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="fr-FR" >
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>  Files de tâches et tâches récurrentes avec Celery | Sam &amp; Max: Python, Django, Git et du cul</title>
<meta http-equiv="Content-Language" content="fr" />

<link rel="shortcut icon" href="../wp-content/uploads/2012/05/favicon.ico">

<link rel="stylesheet" href="../wp-content/themes/Minimal/style.css%3F238.css" type="text/css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="Sam &amp; Max: Python, Django, Git et du cul RSS Feed" href="../feed.1" />
<link rel="alternate" type="application/atom+xml" title="Sam &amp; Max: Python, Django, Git et du cul Atom Feed" href="../feed/atom/index.html" />
<link rel="pingback" href="../xmlrpc.php" />


<!--[if lt IE 7]>
	<link rel="stylesheet" type="text/css" href="http://sametmax.com/wp-content/themes/Minimal/css/ie6style.css" />
	<script type="text/javascript" src="http://sametmax.com/wp-content/themes/Minimal/js/DD_belatedPNG_0.0.8a-min.js"></script>
	<script type="text/javascript">DD_belatedPNG.fix('img#logo, #header #search-form, #slogan, a#left_arrow, a#right_arrow, div.slide img.thumb, div#controllers a, a.readmore, a.readmore span, #services .one-third, #services .one-third.first img.icon, #services img.icon, div.sidebar-block .widget ul li');</script>
<![endif]-->
<!--[if IE 7]>
	<link rel="stylesheet" type="text/css" href="http://sametmax.com/wp-content/themes/Minimal/css/ie7style.css" />
<![endif]-->

<script type="text/javascript">
	document.documentElement.className = 'js';
</script>

<script type="text/javascript">
(function() {
	var s = document.createElement('SCRIPT'), s1 = document.getElementsByTagName('SCRIPT')[0];
	s.type = 'text/javascript';
	s.async = true;
	s.src = 'http://widgets.digg.com/buttons.js';
	s1.parentNode.insertBefore(s, s1);
})();
</script>
<link rel="alternate" type="application/rss+xml" title="Sam &amp; Max: Python, Django, Git et du cul &raquo; Feed" href="../feed.1" />
<link rel="alternate" type="application/rss+xml" title="Sam &amp; Max: Python, Django, Git et du cul &raquo; Comments Feed" href="../comments/feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="Sam &amp; Max: Python, Django, Git et du cul &raquo; Files de tâches et tâches récurrentes avec Celery Comments Feed" href="feed/index.html" />
<meta content="Minimal v.3.3" name="generator"/><link media="screen" type="text/css" href="../wp-content/themes/Minimal/epanel/page_templates/js/fancybox/jquery.fancybox-1.3.4.css" rel="stylesheet" />
<link media="screen" type="text/css" href="../wp-content/themes/Minimal/epanel/page_templates/page_templates.css" rel="stylesheet" /><link rel='stylesheet' id='tags-page-css'  href='../wp-content/plugins/tags-page/tags-page.css%3Fver=3.3.1.css' type='text/css' media='all' />
<link rel='stylesheet' id='contact-form-7-css'  href='../wp-content/plugins/contact-form-7/includes/css/styles.css%3Fver=3.3.css' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack-widgets-css'  href='../wp-content/plugins/jetpack/modules/widgets/widgets.css%3Fver=20121003.css' type='text/css' media='all' />
<link rel='stylesheet' id='et-shortcodes-css-css'  href='../wp-content/themes/Minimal/epanel/shortcodes/shortcodes.css%3Fver=1.8.css' type='text/css' media='all' />
<link rel='stylesheet' id='sharedaddy-css'  href='../wp-content/plugins/jetpack/modules/sharedaddy/sharing.css%3Fver=2.6.1.css' type='text/css' media='all' />
<link rel='stylesheet' id='cfq-css'  href='../wp-content/plugins/comment-form-quicktags/style.css%3Fver=20110712.css' type='text/css' media='all' />
<script type='text/javascript' src='../wp-content/plugins/tags-page/webtoolkit.sortabletable.js%3Fver=3.3.1'></script>
<script type='text/javascript' src='../wp-includes/js/jquery/jquery.js%3Fver=1.7.1'></script>
<script type='text/javascript' src='../wp-includes/js/comment-reply.js%3Fver=20090102'></script>
<script type='text/javascript' src='../wp-content/themes/Minimal/epanel/shortcodes/js/et_shortcodes_frontend.js%3Fver=1.8'></script>
<script type='text/javascript' src='../wp-content/plugins/comment-form-quicktags/quicktags.php%3Fver=20121011'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../xmlrpc.php%3Frsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Ouverture du coffre : la méthode simple, bourine, mais efficace' href='../ouverture-du-coffre-la-methode-simple-bourine-mais-efficace/index.html' />
<link rel='next' title='E-ink et confiseries' href='../e-ink-et-confiseries/index.html' />
<meta name="generator" content="WordPress 3.3.1" />
<link rel='canonical' href='index.html' />
<link rel='shortlink' href='http://wp.me/p2ckfk-1MY' />
<link rel="payment" type="text/html" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Ffiles-de-taches-et-taches-recurrentes-avec-celery%2F&amp;language=en_GB&amp;category=text&amp;title=Files+de+t%C3%A2ches+et+t%C3%A2ches+r%C3%A9currentes+avec+Celery&amp;description=Partager%3AEmailMore+Pin+ItShare+on+TumblrDiggPocketNo+related+posts.&amp;tags=celery%2Cpython%2Credis%2Cblog" />

<link rel="stylesheet" href="../wp-content/plugins/wp-syntax/wp-syntax.css" type="text/css" media="screen" />

<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Files de tâches et tâches récurrentes avec Celery" />
<meta property="og:url" content="http://sametmax.com/files-de-taches-et-taches-recurrentes-avec-celery/" />
<meta property="og:description" content="Quand on a traiter des choses bloquantes, avec des dépendances, des flux complexes ou des actions répétitives, créer des files d&#039;attente peut se révéler très judicieux.
" />
<meta property="og:site_name" content="Sam &amp; Max: Python, Django, Git et du cul" />
<meta property="og:image" content="http://sametmax.com/wp-content/uploads/2013/07/zdFRjr1.jpg" />
<meta name="twitter:site" content="@jetpack" />
<meta name="twitter:image:src" content="http://sametmax.com/wp-content/uploads/2013/07/zdFRjr1.jpg?w=640" />
<meta name="twitter:card" content="summary_large_image" />
<style type="text/css" media="all">
/* <![CDATA[ */
@import url("../wp-content/plugins/wp-table-reloaded/css/plugin.css%3Fver=1.9.3.css");
@import url("../wp-content/plugins/wp-table-reloaded/css/datatables.css%3Fver=1.9.3.css");
/* ]]> */
</style>	<style type="text/css">
		#et_pt_portfolio_gallery { margin-left: -11px; }
		.et_pt_portfolio_item { margin-left: 23px; }
		.et_portfolio_small { margin-left: -39px !important; }
		.et_portfolio_small .et_pt_portfolio_item { margin-left: 35px !important; }
		.et_portfolio_large { margin-left: -20px !important; }
		.et_portfolio_large .et_pt_portfolio_item { margin-left: 14px !important; }
	</style>

</head>
<body>
	<div id="page-wrap">
			
		<div id="header">
			<!-- Start Logo -->
				<a href="../index.html">					<img src="../wp-content/uploads/2012/04/logo1.png" alt="Logo" id="logo"/></a>
				
				<p id="slogan">Deux développeurs en vadrouille qui se sortent les doigts du code</p>
					
			<!-- End Logo -->
					
			<!-- Start Searchbox -->
				<div id="search-form">
					<form method="get" id="searchform1" action="../index.html">
						<input type="text" value="search this site..." name="s" id="searchinput" />
					</form>
				</div>
								
			<!-- End Searchbox -->
				
				<div class="clear"></div>
				
				<ul id="menu-top-menu" class="superfish nav clearfix"><li id="menu-item-1702" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-1702"><a href="../category/programmation/index.html">Programmation</a></li>
<li id="menu-item-1703" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1703"><a href="../category/administration-system/index.html">Admin System</a></li>
<li id="menu-item-1704" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1704"><a href="../category/philo-et-culture/index.html">Philo et culture</a></li>
<li id="menu-item-1706" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1706"><a href="../category/cul/index.html">Cul</a></li>
<li id="menu-item-3340" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3340"><a href="../cours-et-tutos/index.html">Cours et tutos</a></li>
<li id="menu-item-2610" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2610"><a href="../nos-tweets/index.html">Nos tweets SANS twitter :-)</a></li>
<li id="menu-item-1707" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-1707"><a title="Les meilleurs blogs du Web" href="http://multiboards.net/">Multiboards</a></li>
<li id="menu-item-7439" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7439"><a href="https://github.com/sametmax/">Nos githuberies</a></li>
</ul>									
		</div> <!-- end #header -->

		<div id="breadcrumbs">
		
					<a href="../index.html">Home</a> &raquo;
				
									<a href="../category/programmation/index.html">Programmation</a> &raquo; Files de tâches et tâches récurrentes avec Celery					
</div> <!-- end #breadcrumbs -->		
	
	<div id="content" class="clearfix">
		<div id="content-area">
					<div class="entry clearfix">
				<h1 class="title">Files de tâches et tâches récurrentes avec Celery</h1>
					<p class="post-meta">
		Posted  by <a href="../author/sam/index.html" title="Posts by Sam" rel="author">Sam</a> on 27 Jul 2013 in <a href="../category/programmation/index.html" title="View all posts in Programmation" rel="category tag">Programmation</a> | <a href="index.html#comments" title="Comment on Files de tâches et tâches récurrentes avec Celery">20 comments</a>	</p>
				
							
									
						
								
				<p>Quand on a à traiter des choses bloquantes, avec des dépendances, des flux complexes ou des actions répétitives, créer des files d&#8217;attente peut se révéler très judicieux.</p>
<p>Par exemple lancer la génération d&#8217;un gros zip sur le clic d&#8217;un utilisateur, télécharger plein fichiers en parallèle pour son site de cul, lancer des calculs sur plusieurs machines et récupérer le résultat, encoder des videos en arrière plan, etc.</p>
<p>Le problème, c&#8217;est que fabriquer des files d&#8217;attente à la main, ça mène généralement à une grosse galère. La première boîte dans laquelle j&#8217;ai travaillé avait tout un système de queues à base de PHP + SQL fait à la main qui tapait dans du MySQL, c&#8217;était pas marrant du tout</p>
<p>Je fais une pause, et je note que le potentiel de jeux de mots sur cet article est fortement élevé. Mais je resterai fort.</p>
<p>Locking, priorité, dépendance, asynchronicité, concurrence, sérialisation, encoding, stockage, accessibilité, load balancing&#8230; Toutes ces problématiques sont bien vicieuses et chronophages. Il vaut mieux utiliser une lib solide et éprouvée.</p>
<p>Je resterai fort.</p>
<p><a href="https://pypi.python.org/pypi/kombu/2.2.0">Kombu</a> est une telle lib, mais elle est lourde et complexe à utiliser. J&#8217;avais fais le choix de la prendre pour un gros projet avec Max, je le regrette sur le long terme : c&#8217;est dur à maintenir et à faire évoluer. Le code est vraiment pas sympa.</p>
<p>Heureusement il existe une bibliothèque qui se met au dessus de Kombu pour et nous expose juste les fonctionnalités que l&#8217;on souhaite : <a href="http://www.celeryproject.org/">celery</a>.</p>
<p>Fort.</p>
<p>Celery est simple pour démarrer, mais très puissant si on rentre dans le détail, et croyez moi, le détail, on peut y rentrer très très profondément.</p>
<p>F&#8230;</p>
<h2>Installation</h2>
<p>Qui dit file d&#8217;attente, dit stockage. Il faut bien mettre les tâches quelque part et communiquer avec ce quelque part. En base de données ? Dans un gestionnaire de messages ? En mémoire ? Dans un cache ?</p>
<p>Celery résout le problème en proposant la même interface, quelque soit le support. Actuellement, on peut utiliser :</p>
<ul>
<li>RabbitMQ</li>
<li>Redis</li>
<li>MongoDB</li>
<li>Beanstalk CouchDB</li>
<li>SQLAlchemy ou l&#8217;ORM Django (et donc toutes les bases de données supportées comme Sqlite, MySQL, PostGres&#8230;)</li>
<li>Amazon SQS</li>
</ul>
<p>Dans notre exemple, nous allons le faire avec Redis car :</p>
<ul>
<li>Redis est très simple à installer et à configurer.</li>
<li>Nous on utilise déjà du Redis partout.</li>
<li>Aucun risque de locking.</li>
</ul>
<p>Pour ceux qui ont pas redis, c&#8217;est généralement dans les dépôts. Par exemple sur Ubuntu :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #c20cb9; font-weight: bold;">apt-get</span> <span style="color: #c20cb9; font-weight: bold;">install</span> redis-server</pre></div></div>

<p>Il n&#8217;y a rien à faire de plus, ça tourne, c&#8217;est configuré avec des valeurs par défaut qui sont saines. Je vous l&#8217;ai dis, redis, c&#8217;est fantastiquement bien foutu.</p>
<p>Ensuite on install celery et la lib d&#8217;accès à redis en Python qui porte un nom très original :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">pip <span style="color: #c20cb9; font-weight: bold;">install</span> celery redis</pre></div></div>

<p>Ca devrait compiler un peu, et comme hab avec les extensions en C, assurez vous d&#8217;avoir un compilateur et les headers en place comme indiqué dans l&#8217;article sur <a href="../votre-python-aime-les-pip/index.html">pip</a>.</p>
<p>Ensuite on peut créer ses tâches. Créez un module, par exemple <em>tasks.py</em> :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">urllib2</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">collections</span> <span style="color: #ff7700;font-weight:bold;">import</span> Counter
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> celery <span style="color: #ff7700;font-weight:bold;">import</span> Celery
&nbsp;
<span style="color: #808080; font-style: italic;"># Configuration de celery. Ceci peut aussi se faire dans un fichier de config.</span>
<span style="color: #808080; font-style: italic;"># Ici on dit à celery que pour le module 'tasks', on va utiliser redis</span>
<span style="color: #808080; font-style: italic;"># comme broker (passeur de massage) et comme result backend (stockage du</span>
<span style="color: #808080; font-style: italic;"># resultat des tâches).</span>
celery = Celery<span style="color: black;">&#40;</span><span style="color: #483d8b;">'tasks'</span>, broker=<span style="color: #483d8b;">'redis://localhost'</span>, backend=<span style="color: #483d8b;">'redis://localhost'</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;"># Et voici notre première tâche. C'est une fonction Python normale, décorée</span>
<span style="color: #808080; font-style: italic;"># avec un decorateur de celery. Elle prend une URL, et calcule le nombre</span>
<span style="color: #808080; font-style: italic;"># de lettre &quot;e&quot; qu'il y a dans la page.</span>
@celery.<span style="color: black;">task</span>
<span style="color: #ff7700;font-weight:bold;">def</span> ecount<span style="color: black;">&#40;</span>url<span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">return</span> Counter<span style="color: black;">&#40;</span><span style="color: #dc143c;">urllib2</span>.<span style="color: black;">urlopen</span><span style="color: black;">&#40;</span>url<span style="color: black;">&#41;</span>.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span><span style="color: #483d8b;">'e'</span><span style="color: black;">&#93;</span></pre></div></div>

<p>On lance ensuite le processus celery dans un terminal (en production, mettez ça dans supervisord ou systemd pour que ça démarre automatiquement) :</p>
<pre>
[test] sam ~/Bureau/celery_test $ celery -A tasks worker -B --loglevel=info

 -------------- celery@sam v3.0.21 (Chiastic Slide)
---- **** -----
--- * ***  * -- Linux-3.2.0-48-generic-x86_64-with-Ubuntu-12.04-precise
-- * - **** ---
- ** ---------- [config]
- ** ---------- .> broker:      redis://localhost:6379//
- ** ---------- .> app:         tasks:0x2a2fa50
- ** ---------- .> concurrency: 4 (processes)
- *** --- * --- .> events:      OFF (enable -E to monitor this worker)
-- ******* ----
--- ***** ----- [queues]
 -------------- .> celery:      exchange:celery(direct) binding:celery

[Tasks]
  . tasks.ecount

[2013-07-26 13:22:21,631: INFO/Beat] Celerybeat: Starting..
[2013-07-26 13:04:51,274: WARNING/MainProcess] celery@sam ready.
[2013-07-26 13:04:51,280: INFO/MainProcess] consumer: Connected to redis://localhost:6379//.
</pre>
<p><code>-A</code> précise le module à importer, <code>-B</code> démarre le beat (on verra ça plus tard), <code>worker</code> dit à celery que démarrer des processus de consommation de files d&#8217;attente (par défaut 4 qui travaillent en parallèle), et <code>--loglevel=info</code> va nous permettre d&#8217;avoir un affichage verbeux pour comprendre ce qui se passe.</p>
<p>Votre file d&#8217;attente est prête, et frétille d&#8217;impatience.</p>
<h2>Lancer une tâche</h2>
<p>A partir de là, vous pouvez envoyer des tâches dans la file d&#8217;attente, depuis n&#8217;importe où :</p>
<ul>
<li>Un script.</li>
<li>Un serveur Web (par exemple une vue Django).</li>
<li>Un programme sur un autre serveur (même si il faudrait alors configurer redis pour qu&#8217;il écoute sur les ports extérieurs, ce qui n&#8217;est pas le cas ici par simplicité).</li>
<li>etc</li>
</ul>
<p>Plusieurs programmes peuvent envoyer plein de tâches, en même temps, et elles vont se loger dans la file d&#8217;attente, sans bloquer le programme qui les a envoyé.</p>
<p>Par exemple, depuis le shell :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">from</span> tasks <span style="color: #ff7700;font-weight:bold;">import</span> ecount
<span style="color: #66cc66;">&gt;&gt;&gt;</span> res = ecount.<span style="color: black;">delay</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'http://danstonchat.com'</span><span style="color: black;">&#41;</span></pre></div></div>

<p>Ceci ne bloque pas mon shell, la ligne s&#8217;exécute immédiatement. La fonction <code>ecount</code> n&#8217;est pas appelée depuis le shell, elle est dans la file d&#8217;attente et sera appelée par un des processus (les fameux &#8216;worker&#8217;) qui consomment la queue. Du côté de la file, on peut voir dans le log :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">18</span>:08,<span style="color: #000000;">609</span>: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Got task from broker: tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>599a52ea-ef6b-<span style="color: #000000;">4499</span>-981d-cd17fab592df<span style="color: #7a0874; font-weight: bold;">&#93;</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">18</span>:09,070: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Task tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>599a52ea-ef6b-<span style="color: #000000;">4499</span>-981d-cd17fab592df<span style="color: #7a0874; font-weight: bold;">&#93;</span> succeeded <span style="color: #000000; font-weight: bold;">in</span> 0.446974039078s: <span style="color: #000000;">1242</span></pre></div></div>

<p>On a donc notre tâche qui a bien été traitée.</p>
<p>On peut récupérer le résultat dans le shell :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> res.<span style="color: black;">state</span>
<span style="color: #483d8b;">'PENDING'</span></pre></div></div>

<p>Ah&#8230; La tâche n&#8217;est pas encore terminée. Et un peu plus tard :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> res.<span style="color: black;">state</span>
<span style="color: #483d8b;">'SUCCESS'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> res.<span style="color: black;">result</span>
<span style="color: #ff4500;">1242</span></pre></div></div>

<p>Lancer une tâche est bien entendu peu intéressant, les listes d&#8217;attente sont vraiment sympa quand on a plein de tâches à lancer, par plein de processus différents :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">results = <span style="color: black;">&#91;</span>ecount.<span style="color: black;">delay</span><span style="color: black;">&#40;</span>url<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">for</span> url <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">'http://google.com'</span>, <span style="color: #483d8b;">'http://sametmax.com'</span>, <span style="color: #483d8b;">'http://sebsauvage.com'</span>, <span style="color: #483d8b;">'http://multiboards.com'</span>, <span style="color: #483d8b;">'http://0bin.net'</span>, <span style="color: #483d8b;">'http://danstonchat.com'</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span></pre></div></div>


<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">25</span>:<span style="color: #000000;">46</span>,<span style="color: #000000;">646</span>: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Got task from broker: tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>5d072a7b-29f8-4ea6-8d92-6a4c1740d724<span style="color: #7a0874; font-weight: bold;">&#93;</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">25</span>:<span style="color: #000000;">46</span>,<span style="color: #000000;">649</span>: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Got task from broker: tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>402f6a4f-6b35-4f62-a786-9a5ba27707d2<span style="color: #7a0874; font-weight: bold;">&#93;</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">25</span>:<span style="color: #000000;">46</span>,<span style="color: #000000;">650</span>: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Got task from broker: tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>bbe46b1b-<span style="color: #000000;">4719</span>-4c42-bd2f-21e4d72e613e<span style="color: #7a0874; font-weight: bold;">&#93;</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">25</span>:<span style="color: #000000;">46</span>,<span style="color: #000000;">652</span>: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Got task from broker: tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>8fb35186-66e2-4eae-a40c-fc42e500ab9d<span style="color: #7a0874; font-weight: bold;">&#93;</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">25</span>:<span style="color: #000000;">46</span>,<span style="color: #000000;">653</span>: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Got task from broker: tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>fc63f5db-8ade-<span style="color: #000000;">4383</span>-b719-c3d6390ca246<span style="color: #7a0874; font-weight: bold;">&#93;</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">25</span>:<span style="color: #000000;">46</span>,<span style="color: #000000;">654</span>: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Got task from broker: tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>8434e21d-79ea-<span style="color: #000000;">4559</span>-a90e-92e2bc2b9dc7<span style="color: #7a0874; font-weight: bold;">&#93;</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">25</span>:<span style="color: #000000;">47</span>,<span style="color: #000000;">144</span>: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Task tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>bbe46b1b-<span style="color: #000000;">4719</span>-4c42-bd2f-21e4d72e613e<span style="color: #7a0874; font-weight: bold;">&#93;</span> succeeded <span style="color: #000000; font-weight: bold;">in</span> 0.479865789413s: <span style="color: #000000;">27</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">25</span>:<span style="color: #000000;">47</span>,<span style="color: #000000;">242</span>: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Task tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>5d072a7b-29f8-4ea6-8d92-6a4c1740d724<span style="color: #7a0874; font-weight: bold;">&#93;</span> succeeded <span style="color: #000000; font-weight: bold;">in</span> 0.578661203384s: <span style="color: #000000;">609</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">25</span>:<span style="color: #000000;">47</span>,<span style="color: #000000;">501</span>: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Task tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>fc63f5db-8ade-<span style="color: #000000;">4383</span>-b719-c3d6390ca246<span style="color: #7a0874; font-weight: bold;">&#93;</span> succeeded <span style="color: #000000; font-weight: bold;">in</span> 0.35736989975s: <span style="color: #000000;">263</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">25</span>:<span style="color: #000000;">47</span>,<span style="color: #000000;">645</span>: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Task tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>8434e21d-79ea-<span style="color: #000000;">4559</span>-a90e-92e2bc2b9dc7<span style="color: #7a0874; font-weight: bold;">&#93;</span> succeeded <span style="color: #000000; font-weight: bold;">in</span> 0.403187036514s: <span style="color: #000000;">1270</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">25</span>:<span style="color: #000000;">47</span>,<span style="color: #000000;">815</span>: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Task tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>8fb35186-66e2-4eae-a40c-fc42e500ab9d<span style="color: #7a0874; font-weight: bold;">&#93;</span> succeeded <span style="color: #000000; font-weight: bold;">in</span> 1.14100408554s: <span style="color: #000000;">23</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">25</span>:<span style="color: #000000;">49</span>,010: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Task tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>402f6a4f-6b35-4f62-a786-9a5ba27707d2<span style="color: #7a0874; font-weight: bold;">&#93;</span> succeeded <span style="color: #000000; font-weight: bold;">in</span> 2.34633708s: <span style="color: #000000;">3158</span></pre></div></div>

<p>Car du coup on sait que ces multiples tâches ne vont pas bloquer le processus en cour, mais qu&#8217;en plus la charge sera répartie sur le nombre de workers qu&#8217;on a décidé au départ, ni plus (surcharge du serveur), ni moins (traitement trop lent).</p>
<h2>Comment je sais quand une tâche est terminée ?</h2>
<p>On peut attendre que la tâche soit terminée :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span> res.<span style="color: black;">wait</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #ff4500;">9999</span></pre></div></div>

<p>Mais ce n&#8217;est pas vraiment le but. On cherche avant tout à ce que les tâches soient non bloquantes, et exécutées dans un processus à part voir potentiellement distribuées sur plusieurs serveurs. </p>
<p>Par ailleurs, Celery n&#8217;est pas un remplacement d&#8217;un système de traitement asynchrone comme Tornado ou NodeJS, il n&#8217;est pas fait pour envoyer des réponses asynchrones à l&#8217;utilisateur. Il est fait pour faire des tâches en background, répartir la charge et ordonner le traitement. Bien entendu, on peut faire communiquer un système asynchrone avec celery comme <a href="https://github.com/mher/tornado-celery">ici</a> ou <a href="http://cyberfart.blogspot.fr/2012/11/tornado-celery-integration.html">ici</a>, mais c&#8217;est une autre histoire.</p>
<p>Concentrons nous sur les tâches.</p>
<p>La question de &#8220;Comment je sais quand une tâche est terminée ?&#8221; est souvent traduisible par &#8220;comment je réagis à une tâche pour lancer du code quand elle s&#8217;est terminée sans erreur ?&#8221;.</p>
<p>Et là, il y une solution toute simple :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">res = tache1.<span style="color: black;">s</span><span style="color: black;">&#40;</span>arg1, arg2<span style="color: black;">&#41;</span> | tache2.<span style="color: black;">s</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> | tache3.<span style="color: black;">s</span><span style="color: black;">&#40;</span>arg1<span style="color: black;">&#41;</span></pre></div></div>

<p>Ceci va créer une chaîne de tâches. Quand la première se termine, la deuxième se lance en recevant le résultat de la première en argument.</p>
<p><code>s()</code> fabrique une sous-tâche, c&#8217;est à dire une tâche à envoyer dans la file plus tard avec des arguments pré-enregistrés. Dans notre exemple, celery va lancer <code>tache1</code> avec deux arguments, puis si ça marche, va appeler <code>tache2</code> en lui passant le résultat de <code>tache1</code> comme argument, puis si ça marche, va appeler <code>tache3</code> avec le résultat de <code>tache2</code> en premier argument et <code>arg1</code> en second argument.</p>
<p>En fait, celery vient avec tout <a href="http://docs.celeryproject.org/en/latest/userguide/canvas.html?highlight=group">un tas d&#8217;outils</a> pour exécuter des tâches dépendantes les unes des autres : par groupes, par chaînes, par morceaux, etc. Mais de toute façon, vous pouvez appeler une tâche&#8230; à l&#8217;intérieur d&#8217;une autre tâche. Donc parti de là vous pouvez faire pas mal de choses.</p>
<h2>Comment je fais pour faire une tâche récurrente ?</h2>
<p>C&#8217;est là qu&#8217;intervient le &#8220;beat&#8221; dont j&#8217;ai parlé tout à l&#8217;heure. Avec cette option, celery va vérifier toutes les secondes si il n&#8217;y a pas une tâche répétitive à lancer, et la mettre dans une file d&#8217;attente, à la manière d&#8217;un cron.</p>
<p>Il suffit de définir une tâche comme <code>periodic_task</code> pour qu&#8217;elle soit lancée régulièrement.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">smtplib</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> celery.<span style="color: black;">schedules</span> <span style="color: #ff7700;font-weight:bold;">import</span> crontab
<span style="color: #ff7700;font-weight:bold;">from</span> celery.<span style="color: black;">decorators</span> <span style="color: #ff7700;font-weight:bold;">import</span> periodic_task
&nbsp;
<span style="color: #808080; font-style: italic;"># va executer la tâche à 5h30, 13h30 et 23h30 tous les lundi</span>
<span style="color: #808080; font-style: italic;"># run_every accepte aussi un timedelta, pour par exemple dire &quot;toutes les 10m&quot;</span>
@periodic_task<span style="color: black;">&#40;</span>run_every=crontab<span style="color: black;">&#40;</span>hour=<span style="color: #483d8b;">'5,13,23'</span>, minute=<span style="color: #ff4500;">30</span>, day_of_week=<span style="color: #483d8b;">'monday'</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">def</span> is_alive<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot;
        Vérifie que le blog est toujours en ligne, et si ce n'est pas le cas,
        envoie un mail en panique.
    &quot;&quot;&quot;</span>
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #dc143c;">urllib2</span>.<span style="color: black;">urlopen</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'http://sametmax.com'</span><span style="color: black;">&#41;</span>.<span style="color: #dc143c;">code</span> <span style="color: #66cc66;">!</span>= <span style="color: #ff4500;">200</span>:
        mail = <span style="color: #483d8b;">'lesametlemax__AT__gmail.com'</span>.<span style="color: black;">replace</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'__AT__'</span>, <span style="color: #483d8b;">'@'</span><span style="color: black;">&#41;</span>
        server = <span style="color: #dc143c;">smtplib</span>.<span style="color: black;">SMTP</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'smtp.gmail.com:587'</span><span style="color: black;">&#41;</span>
        server.<span style="color: black;">starttls</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        server.<span style="color: black;">login</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'root'</span>, <span style="color: #483d8b;">'admin123'</span><span style="color: black;">&#41;</span>
        server.<span style="color: black;">sendmail</span><span style="color: black;">&#40;</span>mail, mail, msg<span style="color: black;">&#41;</span>
        server.<span style="color: black;">quit</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>Il y a de <a href="http://docs.celeryproject.org/en/latest/userguide/periodic-tasks.html?highlight=cron">bons exemples</a> sur la syntaxe sur <code>crontab()</code> dans la doc.</p>
<p>D&#8217;une manière générale, <a href="http://docs.celeryproject.org/en/latest/getting-started/introduction.html">la doc de Celery est très très riche</a>, donc plongez vous dedans si cet article ne répond pas à vos besoins, car si ça peut être mis dans une file, ça peut être fait par Celery.</p>
<h2>Note de fin</h2>
<p>Celery n&#8217;autoreload pas le code, donc redémarrez les workers à chaque fois que vous modifiez vos tasks.</p>
<p>Attention aussi aux tâches récurrentes, la suivante peut se lancer avant que la précédente soit terminée. C&#8217;est à vous de faire des tâches <a href="https://fr.wikipedia.org/wiki/Idempotent">idempotentes</a>, ou alors de mettre en place <a href="http://docs.celeryproject.org/en/latest/tutorials/task-cookbook.html#cookbook-task-serial">un système de locking</a>.</p>
<div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-official sd-sharing"><h3 class="sd-title">Partager:</h3><div class="sd-content"><ul><li class="share-twitter"><div class="twitter_button"><iframe allowtransparency="true" frameborder="0" scrolling="no" src="http://platform.twitter.com/widgets/tweet_button.html?url=http%3A%2F%2Fsametmax.com%2Ffiles-de-taches-et-taches-recurrentes-avec-celery%2F&#038;counturl=http%3A%2F%2Fsametmax.com%2Ffiles-de-taches-et-taches-recurrentes-avec-celery%2F&#038;count=horizontal&#038;text=Files%20de%20t%C3%A2ches%20et%20t%C3%A2ches%20r%C3%A9currentes%20avec%20Celery%3A" style="width:101px; height:20px;"></iframe></div></li><li class="share-facebook"><div class="like_button"><iframe src="http://www.facebook.com/plugins/like.php?href=http%3A%2F%2Fsametmax.com%2Ffiles-de-taches-et-taches-recurrentes-avec-celery%2F&amp;layout=button_count&amp;show_faces=false&amp;action=like&amp;colorscheme=light&amp;height=21&amp;locale=en_US&amp;width=90" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:96px; height:21px;" allowTransparency="true"></iframe></div></li><li class="share-google-plus-1"><div class="googleplus1_button"><div class="g-plus" data-action="share" data-annotation="bubble" data-href="http://sametmax.com/files-de-taches-et-taches-recurrentes-avec-celery/"></div></div></li><li class="share-email"><a rel="nofollow" class="share-email sd-button" href="index.html%3Fshare=email.html" title="Click to email this to a friend"><span>Email</span></a></li><li><a href="index.html%3Fshare=email.html#" class="sharing-anchor sd-button share-more"><span>More</span></a></li><li class="share-end"></li></ul><div class="sharing-hidden"><div class="inner" style="display: none;"><ul><li class="share-reddit"><div class="reddit_button"><iframe src="http://www.reddit.com/static/button/button1.html?width=120&amp;url=http%3A%2F%2Fsametmax.com%2Ffiles-de-taches-et-taches-recurrentes-avec-celery%2F&amp;title=Files%20de%20t%C3%A2ches%20et%20t%C3%A2ches%20r%C3%A9currentes%20avec%20Celery" height="22" width="120" scrolling="no" frameborder="0"></iframe></div></li><li class="share-pinterest"><div class="pinterest_button"><a href="http://pinterest.com/pin/create/button/?url=http%3A%2F%2Fsametmax.com%2Ffiles-de-taches-et-taches-recurrentes-avec-celery%2F&#038;description=Files%20de%20t%C3%A2ches%20et%20t%C3%A2ches%20r%C3%A9currentes%20avec%20Celery&#038;media=http%3A%2F%2Fsametmax.com%2Fwp-content%2Fuploads%2F2013%2F07%2FzdFRjr1.jpg" class="pin-it-button" count-layout="horizontal"> Pin It</a></div></li><li class="share-end"></li><li class="share-tumblr"><a target="" href="http://www.tumblr.com/share/link/?url=http%3A%2F%2Fsametmax.com%2Ffiles-de-taches-et-taches-recurrentes-avec-celery%2F&name=Files%20de%20t%C3%A2ches%20et%20t%C3%A2ches%20r%C3%A9currentes%20avec%20Celery" title="Share on Tumblr" style="display:inline-block; text-indent:-9999px; overflow:hidden; width:62px; height:20px; background:url('http://platform.tumblr.com/v1/share_2.png') top left no-repeat transparent;">Share on Tumblr</a></li><li class="share-digg"><div class="digg_button"><a rel="nofollow" class="DiggThisButton DiggCompact share-digg sd-button" href="http://digg.com/submit?url=http%3A%2F%2Fsametmax.com%2Ffiles-de-taches-et-taches-recurrentes-avec-celery%2F&amp;title=Files%20de%20t%C3%A2ches%20et%20t%C3%A2ches%20r%C3%A9currentes%20avec%20Celery" title="Click to Digg this post"><span>Digg</span></a></div></li><li class="share-end"></li><li class="share-pocket"><div class="pocket_button"><a href="https://getpocket.com/save" class="pocket-btn" data-lang="en" data-save-url="http://sametmax.com/files-de-taches-et-taches-recurrentes-avec-celery/" data-pocket-count="horizontal" >Pocket</a></div></li><li class="share-end"></li></ul></div></div></div></div></div><p>No related posts.</p><p class="wp-flattr-button"><a href="../index.html%3Fflattrss_redirect&amp;id=6880&amp;md5=b63d1026ee7b0d5a9e8f73bf0347b702.html" title="Flattr" target="_blank"><img src="../wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>											</div> <!-- end .entry -->
			
					
						
			<!-- You can start editing here. -->

	<div id="comment-section" class="clearfix">
		<h3 id="comments">20 comments</h3>
		
		
			<ol class="commentlist clearfix">
			   <li class="comment even thread-even depth-1" id="li-comment-11715">
		<div class="bottom_bg">
		   <div id="comment-11715" class="comment-body clearfix">
				<div class="alignleft authordata">
					<img alt='' src='http://1.gravatar.com/avatar/fc32c6686686ecc595f05ad1885c2fb3?s=60&amp;d=retro&amp;r=X' class='avatar avatar-60 photo' height='60' width='60' />					
					<div class="clear"></div>
					<div class="comment-author vcard">
						<span class="fn">roro</span><br/>
						<div class="comment-meta commentmetadata"><a href="index.html#comment-11715">27/07/2013		</a></div>
					</div>
				</div>
				
				<div class="comment-wrap">
					
										
					<div class="comment-content"><p>Il n&#8217;y a plus qu&#8217;a ajouter que le céleri est une plante hermaphrodite&#8230;cqfd</p>
</div> <!-- end comment-content-->
									</div> <!-- end comment-wrap-->  
			</div> <!-- end comment-body-->
		</div> <!-- end .bottom_bg-->
</li>
   <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-11716">
		<div class="bottom_bg">
		   <div id="comment-11716" class="comment-body clearfix">
				<div class="alignleft authordata">
					<img alt='' src='http://0.gravatar.com/avatar/aa90c4c03161ec318afbeb65b6927bb9?s=60&amp;d=retro&amp;r=X' class='avatar avatar-60 photo' height='60' width='60' />					
					<div class="clear"></div>
					<div class="comment-author vcard">
						<span class="fn"><a href='http://kaos-idea.com/' rel='external nofollow' class='url'>Kaos Idea</a></span><br/>
						<div class="comment-meta commentmetadata"><a href="index.html#comment-11716">27/07/2013		</a></div>
					</div>
				</div>
				
				<div class="comment-wrap">
					
										
					<div class="comment-content"><p>L&#8217;article que j&#8217;attendais depuis un moment. Merci pour votre retour sur l&#8217;utilisation de python.</p>
</div> <!-- end comment-content-->
									</div> <!-- end comment-wrap-->  
			</div> <!-- end comment-body-->
		</div> <!-- end .bottom_bg-->
</li>
   <li class="comment even thread-even depth-1" id="li-comment-11726">
		<div class="bottom_bg">
		   <div id="comment-11726" class="comment-body clearfix">
				<div class="alignleft authordata">
					<img alt='' src='http://0.gravatar.com/avatar/a16497d1d99ae5ebcf3d8547a7dff9ed?s=60&amp;d=retro&amp;r=X' class='avatar avatar-60 photo' height='60' width='60' />					
					<div class="clear"></div>
					<div class="comment-author vcard">
						<span class="fn"><a href='http://www.benabi.net' rel='external nofollow' class='url'>Ali</a></span><br/>
						<div class="comment-meta commentmetadata"><a href="index.html#comment-11726">28/07/2013		</a></div>
					</div>
				</div>
				
				<div class="comment-wrap">
					
										
					<div class="comment-content"><p>Merci, excellent article meme si je ne suis pas très fan de Python.</p>
</div> <!-- end comment-content-->
									</div> <!-- end comment-wrap-->  
			</div> <!-- end comment-body-->
		</div> <!-- end .bottom_bg-->
</li>
   <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-11727">
		<div class="bottom_bg">
		   <div id="comment-11727" class="comment-body clearfix">
				<div class="alignleft authordata">
					<img alt='' src='http://1.gravatar.com/avatar/f0be159c1cf58c64f5fb6b3dbfa12e9c?s=60&amp;d=retro&amp;r=X' class='avatar avatar-60 photo' height='60' width='60' />					
					<div class="clear"></div>
					<div class="comment-author vcard">
						<span class="fn">Benjamin</span><br/>
						<div class="comment-meta commentmetadata"><a href="index.html#comment-11727">28/07/2013		</a></div>
					</div>
				</div>
				
				<div class="comment-wrap">
					
										
					<div class="comment-content"><p>Lien cassé: <a href="http://sametmax.com/files-de-taches-et-taches-recurrentes-avec-celery/tache1" rel="nofollow">http://sametmax.com/files-de-taches-et-taches-recurrentes-avec-celery/tache1</a></p>
<p>Bon article, mais ce qui reste obscure pour moi avec Celery, c&#8217;est à quoi servent le broker. Par exemple, j&#8217;utilise MongoDb et je vois les nouvelles collections <code>messages</code>, <code>messages.routing</code>, et <code>messages.broadcast</code>, mais je n&#8217;arrive toujours pas à comprendre leur fonction. Autre question, comment supprimer une tâche de la file d&#8217;attente?</p>
</div> <!-- end comment-content-->
									</div> <!-- end comment-wrap-->  
			</div> <!-- end comment-body-->
		</div> <!-- end .bottom_bg-->
</li>
   <li class="comment byuser comment-author-sam bypostauthor even thread-even depth-1" id="li-comment-11728">
		<div class="bottom_bg">
		   <div id="comment-11728" class="comment-body clearfix">
				<div class="alignleft authordata">
					<img alt='Sam' src='../wp-content/uploads/2012/02/Sam_avatar.jpg' class='avatar avatar-60 photo' height='60' width='60' />					
					<div class="clear"></div>
					<div class="comment-author vcard">
						<span class="fn">Sam</span><br/>
						<div class="comment-meta commentmetadata"><a href="index.html#comment-11728">28/07/2013		</a></div>
					</div>
				</div>
				
				<div class="comment-wrap">
					
										
					<div class="comment-content"><p>Le broken est le système qui :</p>
<p>- stocke les files d&#8217;attentes<br />
- s&#8217;assure que la bonne tache est dans la bonne file d&#8217;attente<br />
- ordonne les taches dans les files d&#8217;attentes<br />
- permet de récupérer la prochaine tâche à effectuer dans la file d&#8217;attente donnée</p>
<p>Celery ne fait qu&#8217;appeler des fonctions du broker pour fonctionner.</p>
<p>Il faut bien comprendre que le broker doit pouvoir representer une file ordonnée, y accéder de manière concurrente depuis n&#8217;importe quel système connecté en local ou à distance, mettre des labels sur les files, etc.</p>
<p>Certains système, comme AMPQ, sont spécialisés là dedans, d&#8217;autre, comme les bases de données, sont détournées pour cela.</p>
<p>Par exemple, dans le cadre de MongoDB, il y a une collection messages qui va contenir toutes les tâches (à la base, un broker est un livreur de message, et par dessus on créer des files de tâches, mais on peut s&#8217;en servir pour plein d&#8217;autre choses).<br />
Ensuite il y a une collection routing qui contient les informations pour savoir dans quelle liste mettre quelle tâche. En effet, il peut y avoir des centaines de files, avec des labels, et une tâches peut être &#8220;routée&#8221; vers une file ou une autre selon le besoin (je ne l&#8217;ai pas montré dans l&#8217;article, car c&#8217;est un usage avancé). Enfin broadcast contient les informations qui spécifient à qui propager l&#8217;information une fois qu&#8217;un message, ici notre tâche, a été traité.</p>
<p>Par contre pour supprimer une tâche, t&#8217;as vraiment fais ta feignasse, ça m&#8217;a pris 3 secondes pour trouver ça sur un moteur de recherche :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">celery.<span style="color: black;">control</span>.<span style="color: black;">revoke</span><span style="color: black;">&#40;</span>uuid, terminate=<span style="color: #008000;">True</span><span style="color: black;">&#41;</span></pre></div></div>

<p>Merci pour le signalement du lien mort.</p>
</div> <!-- end comment-content-->
									</div> <!-- end comment-wrap-->  
			</div> <!-- end comment-body-->
		</div> <!-- end .bottom_bg-->
</li>
   <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-11733">
		<div class="bottom_bg">
		   <div id="comment-11733" class="comment-body clearfix">
				<div class="alignleft authordata">
					<img alt='' src='http://1.gravatar.com/avatar/fc32c6686686ecc595f05ad1885c2fb3?s=60&amp;d=retro&amp;r=X' class='avatar avatar-60 photo' height='60' width='60' />					
					<div class="clear"></div>
					<div class="comment-author vcard">
						<span class="fn">roro</span><br/>
						<div class="comment-meta commentmetadata"><a href="index.html#comment-11733">28/07/2013		</a></div>
					</div>
				</div>
				
				<div class="comment-wrap">
					
										
					<div class="comment-content"><p>@Sam:&#8221;&#8230;et par dessus on créer&#8221; &#8211;&gt; on crée.<br />
Cela donne l&#8217;impression que ta pensée a été modifiée sur le parcours cerveau/main.<br />
Tu nous aurais pas choppé un trojan ?</p>
</div> <!-- end comment-content-->
									</div> <!-- end comment-wrap-->  
			</div> <!-- end comment-body-->
		</div> <!-- end .bottom_bg-->
</li>
   <li class="comment byuser comment-author-sam bypostauthor even thread-even depth-1" id="li-comment-11738">
		<div class="bottom_bg">
		   <div id="comment-11738" class="comment-body clearfix">
				<div class="alignleft authordata">
					<img alt='Sam' src='../wp-content/uploads/2012/02/Sam_avatar.jpg' class='avatar avatar-60 photo' height='60' width='60' />					
					<div class="clear"></div>
					<div class="comment-author vcard">
						<span class="fn">Sam</span><br/>
						<div class="comment-meta commentmetadata"><a href="index.html#comment-11738">28/07/2013		</a></div>
					</div>
				</div>
				
				<div class="comment-wrap">
					
										
					<div class="comment-content"><p>Arf, je vais pas aller jusqu&#8217;à corriger les comments, sinon je suis parti pour l&#8217;asile.</p>
</div> <!-- end comment-content-->
									</div> <!-- end comment-wrap-->  
			</div> <!-- end comment-body-->
		</div> <!-- end .bottom_bg-->
</li>
   <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-11743">
		<div class="bottom_bg">
		   <div id="comment-11743" class="comment-body clearfix">
				<div class="alignleft authordata">
					<img alt='' src='http://1.gravatar.com/avatar/56a4d86cdd42d8d72cc78d821724c7f4?s=60&amp;d=retro&amp;r=X' class='avatar avatar-60 photo' height='60' width='60' />					
					<div class="clear"></div>
					<div class="comment-author vcard">
						<span class="fn">Kad</span><br/>
						<div class="comment-meta commentmetadata"><a href="index.html#comment-11743">28/07/2013		</a></div>
					</div>
				</div>
				
				<div class="comment-wrap">
					
										
					<div class="comment-content"><p>Il manque plus qu&#8217;un article sur supervisord et on pourra gérer un système rien qu&#8217;avec du python!!</p>
</div> <!-- end comment-content-->
									</div> <!-- end comment-wrap-->  
			</div> <!-- end comment-body-->
		</div> <!-- end .bottom_bg-->
</li>
   <li class="comment even thread-even depth-1" id="li-comment-11773">
		<div class="bottom_bg">
		   <div id="comment-11773" class="comment-body clearfix">
				<div class="alignleft authordata">
					<img alt='' src='http://0.gravatar.com/avatar/4f42ed44f985c500a56a7a0b79dbfbf8?s=60&amp;d=retro&amp;r=X' class='avatar avatar-60 photo' height='60' width='60' />					
					<div class="clear"></div>
					<div class="comment-author vcard">
						<span class="fn"><a href='http://ssimp.org' rel='external nofollow' class='url'>guatar</a></span><br/>
						<div class="comment-meta commentmetadata"><a href="index.html#comment-11773">29/07/2013		</a></div>
					</div>
				</div>
				
				<div class="comment-wrap">
					
										
					<div class="comment-content"><p>En plus des files d&#8217;attentes tu peux aussi en faire de la <a href="http://www.marmiton.org/recettes/recette_celeri-remoulade_35874.aspx" rel="nofollow">remoulade de ton celeri</a></p>
</div> <!-- end comment-content-->
									</div> <!-- end comment-wrap-->  
			</div> <!-- end comment-body-->
		</div> <!-- end .bottom_bg-->
</li>
   <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-11801">
		<div class="bottom_bg">
		   <div id="comment-11801" class="comment-body clearfix">
				<div class="alignleft authordata">
					<img alt='' src='http://1.gravatar.com/avatar/72487ae39590539b9e0c305458f61cca?s=60&amp;d=retro&amp;r=X' class='avatar avatar-60 photo' height='60' width='60' />					
					<div class="clear"></div>
					<div class="comment-author vcard">
						<span class="fn">Fred</span><br/>
						<div class="comment-meta commentmetadata"><a href="index.html#comment-11801">29/07/2013		</a></div>
					</div>
				</div>
				
				<div class="comment-wrap">
					
										
					<div class="comment-content"><p>Merci :)<br />
Et +1 pour supervisord voire circus ! Perso j&#8217;utilise upstart pour lancer et manipuler mes démons (gunicorn notamment) mais je suis curieux de voir ce qui se fait à côté.</p>
</div> <!-- end comment-content-->
									</div> <!-- end comment-wrap-->  
			</div> <!-- end comment-body-->
		</div> <!-- end .bottom_bg-->
</li>
   <li class="comment even thread-even depth-1" id="li-comment-11813">
		<div class="bottom_bg">
		   <div id="comment-11813" class="comment-body clearfix">
				<div class="alignleft authordata">
					<img alt='' src='http://0.gravatar.com/avatar/027a6afe88c7e6b2bcd56e2dd31e71bb?s=60&amp;d=retro&amp;r=X' class='avatar avatar-60 photo' height='60' width='60' />					
					<div class="clear"></div>
					<div class="comment-author vcard">
						<span class="fn">VonTenia</span><br/>
						<div class="comment-meta commentmetadata"><a href="index.html#comment-11813">29/07/2013		</a></div>
					</div>
				</div>
				
				<div class="comment-wrap">
					
										
					<div class="comment-content"><p>Marrant comme timing, je viens de passer le weekend a mettre en place un systeme anti-fraude sous celery et puis je decouvre votre article maintenant&#8230;<br />
Comme vous j&#8217;ai choisis d&#8217;utiliser un broker redis par simplicité. Quelqu&#8217;un avec de l&#8217;experience pourrait argumenter sur la superiorité de rabitMQ ? Parce que ca a l&#8217;air quand meme beaucoup plus complexe.<br />
Et je plussois ce qui est dit dans ce post a propos de la superiorite de celery comparé à vouloir faire son propre systeme de traitement asynchrone : on commence par se dire que celery, un broker et tout ca c&#8217;est un peu trop compliqué pour ce qu&#8217;on veut faire et au final on se retrouve a reinventer la roue en pensant faire plus simple&#8230; Bref meme pour un petit projet n&#8217;hesitez pas, utilisez celery. Perso je fais juste des verifications de coherences et un appel à une API sur les donnees envoyées et je ne voulais pas penaliser l&#8217;experience utilisateur avec ces verifications.</p>
</div> <!-- end comment-content-->
									</div> <!-- end comment-wrap-->  
			</div> <!-- end comment-body-->
		</div> <!-- end .bottom_bg-->
</li>
   <li class="comment byuser comment-author-sam bypostauthor odd alt thread-odd thread-alt depth-1" id="li-comment-11849">
		<div class="bottom_bg">
		   <div id="comment-11849" class="comment-body clearfix">
				<div class="alignleft authordata">
					<img alt='Sam' src='../wp-content/uploads/2012/02/Sam_avatar.jpg' class='avatar avatar-60 photo' height='60' width='60' />					
					<div class="clear"></div>
					<div class="comment-author vcard">
						<span class="fn">Sam</span><br/>
						<div class="comment-meta commentmetadata"><a href="index.html#comment-11849">30/07/2013		</a></div>
					</div>
				</div>
				
				<div class="comment-wrap">
					
										
					<div class="comment-content"><p>RabbitMQ est avant tout un système de messagerie, et il est donc intéressant pour ce genre de chose. Par ailleurs, AMPQ est un protocole de PUSH, alors que sur des DB, on utilise du polling pour simuler le PUSH, du coup RabbitMQ est plus performant.</p>
<p>Pour la plupart des cas, on s&#8217;en branle.</p>
</div> <!-- end comment-content-->
									</div> <!-- end comment-wrap-->  
			</div> <!-- end comment-body-->
		</div> <!-- end .bottom_bg-->
</li>
   <li class="comment even thread-even depth-1" id="li-comment-11913">
		<div class="bottom_bg">
		   <div id="comment-11913" class="comment-body clearfix">
				<div class="alignleft authordata">
					<img alt='' src='http://1.gravatar.com/avatar/f0a185474dc7c902e88efa53ea910cd9?s=60&amp;d=retro&amp;r=X' class='avatar avatar-60 photo' height='60' width='60' />					
					<div class="clear"></div>
					<div class="comment-author vcard">
						<span class="fn">Lhassa</span><br/>
						<div class="comment-meta commentmetadata"><a href="index.html#comment-11913">30/07/2013		</a></div>
					</div>
				</div>
				
				<div class="comment-wrap">
					
										
					<div class="comment-content"><p>m***** alors, je voulais vous demander comment vous gériez les files de tâches (pas les commentaires, hein&#8230;), et vous répondez avant que je questionne, trop fort.<br />
J&#8217;ai commencé à écrire mon propre truc, mais non seulement c&#8217;est évidement réinventer la roue (comme dit plus haut) parce que si j&#8217;y pense, d&#8217;autre aussi&#8230; mais en plus c&#8217;est nul.</p>
<p>MERCI à vous, ma prochaine bouteille de rouge vous sera dédiée, en attendant de perdre du temps avec plaisir au boulot, à enfin apprendre des trucs utile&#8230;</p>
</div> <!-- end comment-content-->
									</div> <!-- end comment-wrap-->  
			</div> <!-- end comment-body-->
		</div> <!-- end .bottom_bg-->
</li>
   <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-18315">
		<div class="bottom_bg">
		   <div id="comment-18315" class="comment-body clearfix">
				<div class="alignleft authordata">
					<img alt='' src='http://0.gravatar.com/avatar/aa3fbf033d64ff6d10f07d109eb4d521?s=60&amp;d=retro&amp;r=X' class='avatar avatar-60 photo' height='60' width='60' />					
					<div class="clear"></div>
					<div class="comment-author vcard">
						<span class="fn">Seb</span><br/>
						<div class="comment-meta commentmetadata"><a href="index.html#comment-18315">14/01/2014		</a></div>
					</div>
				</div>
				
				<div class="comment-wrap">
					
										
					<div class="comment-content"><p>Merci pour cet article mais j&#8217;ai juste une question&#8230; c&#8217;est quoi la différence avec APSheduler <a href="http://pythonhosted.org/APScheduler/" rel="nofollow">http://pythonhosted.org/APScheduler/</a> ?</p>
</div> <!-- end comment-content-->
									</div> <!-- end comment-wrap-->  
			</div> <!-- end comment-body-->
		</div> <!-- end .bottom_bg-->
</li>
   <li class="comment byuser comment-author-sam bypostauthor even thread-even depth-1" id="li-comment-18457">
		<div class="bottom_bg">
		   <div id="comment-18457" class="comment-body clearfix">
				<div class="alignleft authordata">
					<img alt='Sam' src='../wp-content/uploads/2012/02/Sam_avatar.jpg' class='avatar avatar-60 photo' height='60' width='60' />					
					<div class="clear"></div>
					<div class="comment-author vcard">
						<span class="fn">Sam</span><br/>
						<div class="comment-meta commentmetadata"><a href="index.html#comment-18457">15/01/2014		</a></div>
					</div>
				</div>
				
				<div class="comment-wrap">
					
										
					<div class="comment-content"><p>C&#8217;est le même principe, mais celery support le routing, l&#8217;exécution sur plusieurs serveurs, plus de brokers, plus de support de stockages, le groupes de tâches, les tâches avec dépendances, et vient avec une grosse communauté (incluant les projets qui vont avec).</p>
<p>APScHeduler peut être intéressant pour un projet simple, et être vu comme comme bottle peut être comparé à Django.</p>
</div> <!-- end comment-content-->
									</div> <!-- end comment-wrap-->  
			</div> <!-- end comment-body-->
		</div> <!-- end .bottom_bg-->
</li>
   <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-18951">
		<div class="bottom_bg">
		   <div id="comment-18951" class="comment-body clearfix">
				<div class="alignleft authordata">
					<img alt='' src='http://1.gravatar.com/avatar/9f3c22452987f3195187c70300ae85d6?s=60&amp;d=retro&amp;r=X' class='avatar avatar-60 photo' height='60' width='60' />					
					<div class="clear"></div>
					<div class="comment-author vcard">
						<span class="fn">groug</span><br/>
						<div class="comment-meta commentmetadata"><a href="index.html#comment-18951">25/01/2014		</a></div>
					</div>
				</div>
				
				<div class="comment-wrap">
					
										
					<div class="comment-content"><p>J&#8217;adore Sam &amp; Max. J&#8217;ai un problème de tâche bloquante, je cherche un peu sur le net, je galère, je tombe finalement sur Celery sur SO, je fais ma désormais classique recherche &#8220;site:sametmax.com celery&#8221;, et là, bah oui, ils en avaient déjà parlé.<br />
Plus que le tag cloud, faudrait peut-être une page avec la liste exhaustive des tags utilisés dans les articles, ça permettrait peut-être de plus facilement chercher ce qu&#8217;on ne sait pas chercher !</p>
<p>En voyant les tags, complètement hors-sujet : c&#8217;est déjà arrivé que quelqu&#8217;un tombe sur le site en cherchant poo en anglais ? Genre &#8220;poo sex&#8221;. Ce serait géant.</p>
</div> <!-- end comment-content-->
									</div> <!-- end comment-wrap-->  
			</div> <!-- end comment-body-->
		</div> <!-- end .bottom_bg-->
</li>
   <li class="comment byuser comment-author-sam bypostauthor even thread-even depth-1" id="li-comment-18952">
		<div class="bottom_bg">
		   <div id="comment-18952" class="comment-body clearfix">
				<div class="alignleft authordata">
					<img alt='Sam' src='../wp-content/uploads/2012/02/Sam_avatar.jpg' class='avatar avatar-60 photo' height='60' width='60' />					
					<div class="clear"></div>
					<div class="comment-author vcard">
						<span class="fn">Sam</span><br/>
						<div class="comment-meta commentmetadata"><a href="index.html#comment-18952">25/01/2014		</a></div>
					</div>
				</div>
				
				<div class="comment-wrap">
					
										
					<div class="comment-content"><p>Si il y a un plugin wordpress qui fait ça automatiquement, file moi le lien.</p>
<p>Pour la recherche, tu n&#8217;imagines pas les termes qui arrivent sur notre site. C&#8217;est ubuesque.</p>
</div> <!-- end comment-content-->
									</div> <!-- end comment-wrap-->  
			</div> <!-- end comment-body-->
		</div> <!-- end .bottom_bg-->
</li>
   <li class="comment byuser comment-author-max odd alt thread-odd thread-alt depth-1" id="li-comment-18954">
		<div class="bottom_bg">
		   <div id="comment-18954" class="comment-body clearfix">
				<div class="alignleft authordata">
					<img alt='Max' src='../wp-content/uploads/2013/07/Max_avatar.gif' class='avatar avatar-60 photo' height='60' width='60' />					
					<div class="clear"></div>
					<div class="comment-author vcard">
						<span class="fn">Max</span><br/>
						<div class="comment-meta commentmetadata"><a href="index.html#comment-18954">25/01/2014		</a></div>
					</div>
				</div>
				
				<div class="comment-wrap">
					
										
					<div class="comment-content"><p>genre ça ? <a href="../les-tags/index.html" rel="nofollow">http://sametmax.com/les-tags/</a></p>
</div> <!-- end comment-content-->
									</div> <!-- end comment-wrap-->  
			</div> <!-- end comment-body-->
		</div> <!-- end .bottom_bg-->
</li>
   <li class="comment even thread-even depth-1" id="li-comment-18958">
		<div class="bottom_bg">
		   <div id="comment-18958" class="comment-body clearfix">
				<div class="alignleft authordata">
					<img alt='' src='http://1.gravatar.com/avatar/9f3c22452987f3195187c70300ae85d6?s=60&amp;d=retro&amp;r=X' class='avatar avatar-60 photo' height='60' width='60' />					
					<div class="clear"></div>
					<div class="comment-author vcard">
						<span class="fn">groug</span><br/>
						<div class="comment-meta commentmetadata"><a href="index.html#comment-18958">25/01/2014		</a></div>
					</div>
				</div>
				
				<div class="comment-wrap">
					
										
					<div class="comment-content"><p>Genre ça, oui !<br />
Faudrait peut-être aussi me filer une petite dizaine de bitcoins&#8230;</p>
</div> <!-- end comment-content-->
									</div> <!-- end comment-wrap-->  
			</div> <!-- end comment-body-->
		</div> <!-- end .bottom_bg-->
</li>
   <li class="comment byuser comment-author-sam bypostauthor odd alt thread-odd thread-alt depth-1" id="li-comment-18963">
		<div class="bottom_bg">
		   <div id="comment-18963" class="comment-body clearfix">
				<div class="alignleft authordata">
					<img alt='Sam' src='../wp-content/uploads/2012/02/Sam_avatar.jpg' class='avatar avatar-60 photo' height='60' width='60' />					
					<div class="clear"></div>
					<div class="comment-author vcard">
						<span class="fn">Sam</span><br/>
						<div class="comment-meta commentmetadata"><a href="index.html#comment-18963">25/01/2014		</a></div>
					</div>
				</div>
				
				<div class="comment-wrap">
					
										
					<div class="comment-content"><p>Pas problème, donne moi les codes d&#8217;accès de ton compte de banque en ligne, et je t&#8217;envoies autant de bitcoins que tu veux.</p>
</div> <!-- end comment-content-->
									</div> <!-- end comment-wrap-->  
			</div> <!-- end comment-body-->
		</div> <!-- end .bottom_bg-->
</li>
		</ol>
		
			
		
<div>
<p class="rss-comments">
<a href="feed/index.html" title="Flux RSS des commentaires">Flux RSS des commentaires</a>
</p>
</div>
									<div id="respond">
				<h3 id="reply-title"><span>Leave a Reply</span> <small><a rel="nofollow" id="cancel-comment-reply-link" href="index.html%3Fshare=email.html#respond" style="display:none;">Cancel reply</a></small></h3>
									<form action="http://sametmax.com/wp-comments-post.php" method="post" id="commentform">
																			<p class="comment-notes">Your email address will not be published. Required fields are marked <span class="required">*</span></p>							<p class="comment-form-author"><label for="author">Name</label> <span class="required">*</span><input id="author" name="author" type="text" value="" size="30" aria-required='true' /></p>
<p class="comment-form-email"><label for="email">Email</label> <span class="required">*</span><input id="email" name="email" type="text" value="" size="30" aria-required='true' /></p>
<p class="comment-form-url"><label for="url">Website</label><input id="url" name="url" type="text" value="" size="30" /></p>
												<p class="comment-form-comment"><label for="comment">Comment</label><script type="text/javascript">var edInserted; if (!edInserted) {edToolbar(); edInserted = true;}</script>
<textarea id="comment" name="comment" cols="45" rows="8" aria-required="true"></textarea>
<script type="text/javascript">var edCanvas = document.getElementById('comment');</script></p>						<p class="form-allowed-tags">You may use these <abbr title="HyperText Markup Language">HTML</abbr> tags and attributes:  <code>&lt;a href=&quot;&quot; title=&quot;&quot;&gt; &lt;abbr title=&quot;&quot;&gt; &lt;acronym title=&quot;&quot;&gt; &lt;b&gt; &lt;blockquote cite=&quot;&quot;&gt; &lt;cite&gt; &lt;code&gt; &lt;del datetime=&quot;&quot;&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=&quot;&quot;&gt; &lt;strike&gt; &lt;strong&gt; &lt;pre lang=&quot;&quot; line=&quot;&quot; escaped=&quot;&quot; highlight=&quot;&quot;&gt; </code></p>						<p class="form-submit">
							<input name="submit" type="submit" id="submit" value="Submit Comment" />
							<input type='hidden' name='comment_post_ID' value='6880' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
						</p>
						<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="79070d8119" /></p><script src="../index.html%3Flive-comment-preview.js" type="text/javascript"></script><div id="commentPreview"></div><p class="comment-subscription-form"><input type="checkbox" name="subscribe_comments" id="subscribe_comments" value="subscribe" style="width: auto; -moz-appearance: checkbox; -webkit-appearance: checkbox;" /> <label class="subscribe-label" id="subscribe-label" for="subscribe_comments" style="display: inline;">Notify me of follow-up comments by email.</label></p><p class="comment-subscription-form"><input type="checkbox" name="subscribe_blog" id="subscribe_blog" value="subscribe" style="width: auto; -moz-appearance: checkbox; -webkit-appearance: checkbox;" /> <label class="subscribe-label" id="subscribe-blog-label" for="subscribe_blog" style="display: inline;">Notify me of new posts by email.</label></p>					</form>
							</div><!-- #respond -->
						</div> <!-- end comment-section -->

<div>
<p><a href="index.html%3Fshare=email.html#" id="playmario">Jouer à mario en attendant que les autres répondent</a></p>





<script type="text/javascript">
    if (typeof jQuery !== 'undefined'){
        jQuery('#playmario').click(function(e){
            jQuery(this).replaceWith('<iframe src="http://www.florian-rappl.de/html5/projects/SuperMario/" style="width:500px;height:450px;overflow:hidden"></iframe><p>En HTML5 canvas :-) http://www.codeproject.com/Articles/396959/Mario5</p>');
            e.preventDefault()
        });
    }
</script>
</div>				</div> <!-- end #content-area -->	
	
<div id="sidebar" class="clearfix">
	<div id="widget-readability-buttons-id-2" class="widget sidebar-block widget-readability-buttons"><!-- This file is used to markup the public facing widget. -->
<h3 class="widgettitle">Une lecture plus fastoche ?</h3><p class="readability-wrapper"> 
  <div
    class="rdbWrapper"
    data-show-read="1"
    data-show-send-to-kindle="0"
    data-show-print="1"
    data-show-email="0"
    data-orientation="0"
    data-version="1"
    data-text-color="#"
    data-bg-color="#">
  </div>
  <script>(function() {var s = document.getElementsByTagName("script")[0],rdb = document.createElement("script"); rdb.type = "text/javascript"; rdb.async = true; rdb.src = document.location.protocol + "//www.readability.com/embed.js"; s.parentNode.insertBefore(rdb, s); })();</script>
</p></div> <!-- end .widget --><div id="text-4" class="widget sidebar-block widget_text"><h3 class="widgettitle"> </h3>			<div class="textwidget"><a href="../appel-a-contributeurs-impertinents/index.html"><img src="../wp-content/uploads/2012/07/contributeur.png" width="288px" style="vertical-align: middle;margin-top:-40px;margin-bottom:10px;"></a> </div>
		</div> <!-- end .widget --><div id="text-3" class="widget sidebar-block widget_text"><h3 class="widgettitle"> </h3>			<div class="textwidget"><a href="http://twitter.com/#!/sam_et_max"><img src="../wp-content/uploads/2012/05/twitter_icon.png" width="70px" style="vertical-align: middle;margin-top:-40px;"></a>&nbsp;Follow us <a href="http://twitter.com/sam_et_max">@sam_et_max</a></div>
		</div> <!-- end .widget --><div id="blog_subscription-3" class="widget sidebar-block jetpack_subscription_widget"><h3 class="widgettitle"><label for="subscribe-field">Souscrire à nos conneries</label></h3>
		<form action="index.html%3Fshare=email.html" method="post" accept-charset="utf-8" id="subscribe-blog-blog_subscription-3">
			<p id="subscribe-text">Entrez votre adresse mail et vous recevrez une notification à chaque nouvel article.</p><p>Join 239 other subscribers</p>

			<p id="subscribe-email"><input type="text" name="email" style="width: 95%; padding: 1px 2px" value="Email Address" id="subscribe-field" onclick="if ( this.value == 'Email Address' ) { this.value = ''; }" onblur="if ( this.value == '' ) { this.value = 'Email Address'; }" /></p>

			<p id="subscribe-submit">
				<input type="hidden" name="action" value="subscribe" />
				<input type="hidden" name="source" value="http://sametmax.com/files-de-taches-et-taches-recurrentes-avec-celery/?share=email" />
				<input type="hidden" name="sub-type" value="widget" />
				<input type="hidden" name="redirect_fragment" value="blog_subscription-3" />
								<input type="submit" value="J&#039;adhère bon dieu!" name="jetpack_subscriptions_widget" />
			</p>
		</form>

		
</div> <!-- end .widget --><div id="categories-2" class="widget sidebar-block widget_categories"><h3 class="widgettitle">Catégories</h3>		<ul>
	<li class="cat-item cat-item-7"><a href="../category/administration-system/index.html" title="View all posts filed under Administration System">Administration System</a> (103)
</li>
	<li class="cat-item cat-item-11"><a href="../category/cul/index.html" title="View all posts filed under Cul">Cul</a> (55)
</li>
	<li class="cat-item cat-item-12"><a href="../category/gadget/index.html" title="View all posts filed under Gadget">Gadget</a> (5)
</li>
	<li class="cat-item cat-item-855"><a href="../category/gadgets/index.html" title="View all posts filed under Gadgets">Gadgets</a> (2)
</li>
	<li class="cat-item cat-item-941"><a href="../category/nsfw-2/index.html" title="View all posts filed under NSFW">NSFW</a> (1)
</li>
	<li class="cat-item cat-item-38"><a href="../category/philo-et-culture/index.html" title="View all posts filed under Philo et culture">Philo et culture</a> (144)
</li>
	<li class="cat-item cat-item-3"><a href="../category/programmation/index.html" title="View all posts filed under Programmation">Programmation</a> (374)
</li>
	<li class="cat-item cat-item-1"><a href="../category/uncategorized/index.html" title="View all posts filed under Uncategorized">Uncategorized</a> (6)
</li>
	<li class="cat-item cat-item-15"><a href="../category/web/index.html" title="View all posts filed under Web">Web</a> (43)
</li>
		</ul>
</div> <!-- end .widget -->		<div id="recent-posts-3" class="widget sidebar-block widget_recent_entries">		<h3 class="widgettitle">Posts récents</h3>		<ul>
				<li><a href="../virtualenv-environmenterror-mysql_config-not-found-sous-mac-osx/index.html" title="Virtualenv EnvironmentError: mysql_config not found sous MAC OSX">Virtualenv EnvironmentError: mysql_config not found sous MAC OSX</a></li>
				<li><a href="../trouvez-lintrus/index.html" title="Trouvez l&#8217;intrus&#8230;">Trouvez l&#8217;intrus&#8230;</a></li>
				<li><a href="../les-ventes-aux-encheres-publiques/index.html" title="Les ventes aux enchères publiques">Les ventes aux enchères publiques</a></li>
				<li><a href="../python-ubiuite-multiprocessing/index.html" title="Python a le don d&#8217;Ubiquité : Multiprocessing">Python a le don d&#8217;Ubiquité : Multiprocessing</a></li>
				<li><a href="../un-objet-proxy-ce-que-cest-et-a-quoi-ca-sert/index.html" title="Un objet proxy : ce que c&#8217;est et à quoi ça sert">Un objet proxy : ce que c&#8217;est et à quoi ça sert</a></li>
				<li><a href="../python-meilleur-nul-part-excellent-partout/index.html" title="Python, meilleur nul part, excellent partout">Python, meilleur nul part, excellent partout</a></li>
				<li><a href="../error-invalid-locale-name-avec-postgres/index.html" title="ERROR:  invalid locale name avec PostGres">ERROR:  invalid locale name avec PostGres</a></li>
				<li><a href="../solution-de-lexercice-dhier-sur-shadow/index.html" title="Solution de l&#8217;exercice d&#8217;hier sur shadow">Solution de l&#8217;exercice d&#8217;hier sur shadow</a></li>
				</ul>
		</div> <!-- end .widget --> 

	<div id="popular-tabbed" class="widget"> 
		<h3 class="widgettitle">Posts Populaires</h3>
		<ul>
																						<li><a href="../on-a-un-nouveau-projet-et-on-a-besoin-dune-info-sur-vous/index.html">On a un nouveau projet et on a besoin d&#8217;UNE info sur vous</a> (254)</li>																														<li><a href="../entreprendre-en-france-autopsie-dun-echec/index.html">Entreprendre en France, Autopsie d&#8217;un échec.</a> (111)</li>																														<li><a href="../fizzbuzz-en-python/index.html">FizzBuzz en Python</a> (94)</li>																														<li><a href="../fetons-le-depart-de-max/index.html">Fêtons le départ de Max</a> (87)</li>																														<li><a href="../une-journee-dans-un-fkk-maison-close-allemande/index.html">Une journée dans un FKK (maison close Allemande)</a> (86)</li>																														<li><a href="../beaucoup-de-femmes-sont-de-mauvais-coups/index.html">Beaucoup de femmes sont de mauvais coups</a> (85)</li>																														<li><a href="../on-est-en-2013-on-a-marche-sur-la-lune-mais-on-a-toujours-pas/index.html">On est en 2013, on a marché sur la lune, mais on a toujours pas&#8230;</a> (82)</li>																														<li><a href="../il-ne-faut-pas-prendre-des-gens-pour-des-cons-mais-ne-jamais-oublier-quils-en-sont/index.html">Il ne faut pas prendre les gens pour des cons mais ne jamais oublier qu&#8217;ils en sont</a> (82)</li>													</ul>
	</div> <!-- end #recent-tabbed -->
	 
<div id="tag_cloud-3" class="widget sidebar-block widget_tag_cloud"><h3 class="widgettitle">TagCloud</h3><div class="tagcloud"><a href='../tag/bash/index.html' class='tag-link-14' title='15 topics' style='font-size: 11.520958083832pt;'>bash</a>
<a href='../tag/blog/index.html' class='tag-link-107' title='13 topics' style='font-size: 11.101796407186pt;'>blog</a>
<a href='../tag/bottle/index.html' class='tag-link-307' title='6 topics' style='font-size: 8.5868263473054pt;'>bottle</a>
<a href='../tag/cache/index.html' class='tag-link-333' title='8 topics' style='font-size: 9.4251497005988pt;'>cache</a>
<a href='../tag/comprehension-lists/index.html' class='tag-link-20' title='7 topics' style='font-size: 9.0059880239521pt;'>comprehension-lists</a>
<a href='../tag/css/index.html' class='tag-link-188' title='8 topics' style='font-size: 9.4251497005988pt;'>css</a>
<a href='../tag/cul-2/index.html' class='tag-link-33' title='10 topics' style='font-size: 10.179640718563pt;'>cul</a>
<a href='../tag/decorator/index.html' class='tag-link-265' title='7 topics' style='font-size: 9.0059880239521pt;'>decorator</a>
<a href='../tag/django/index.html' class='tag-link-28' title='67 topics' style='font-size: 16.802395209581pt;'>django</a>
<a href='../tag/email/index.html' class='tag-link-37' title='6 topics' style='font-size: 8.5868263473054pt;'>email</a>
<a href='../tag/encoding/index.html' class='tag-link-54' title='6 topics' style='font-size: 8.5868263473054pt;'>encoding</a>
<a href='../tag/error/index.html' class='tag-link-213' title='6 topics' style='font-size: 8.5868263473054pt;'>error</a>
<a href='../tag/fun/index.html' class='tag-link-44' title='6 topics' style='font-size: 8.5868263473054pt;'>fun</a>
<a href='../tag/git/index.html' class='tag-link-18' title='28 topics' style='font-size: 13.700598802395pt;'>git</a>
<a href='../tag/html/index.html' class='tag-link-486' title='6 topics' style='font-size: 8.5868263473054pt;'>html</a>
<a href='../tag/import/index.html' class='tag-link-215' title='8 topics' style='font-size: 9.4251497005988pt;'>import</a>
<a href='../tag/ipython/index.html' class='tag-link-164' title='8 topics' style='font-size: 9.4251497005988pt;'>ipython</a>
<a href='../tag/iterable/index.html' class='tag-link-217' title='9 topics' style='font-size: 9.8443113772455pt;'>iterable</a>
<a href='../tag/javascript/index.html' class='tag-link-96' title='26 topics' style='font-size: 13.449101796407pt;'>javascript</a>
<a href='../tag/jquery/index.html' class='tag-link-112' title='6 topics' style='font-size: 8.5868263473054pt;'>jquery</a>
<a href='../tag/lambda/index.html' class='tag-link-292' title='7 topics' style='font-size: 9.0059880239521pt;'>lambda</a>
<a href='../tag/mail/index.html' class='tag-link-624' title='6 topics' style='font-size: 8.5868263473054pt;'>mail</a>
<a href='../tag/meta/index.html' class='tag-link-102' title='84 topics' style='font-size: 17.640718562874pt;'>meta</a>
<a href='../tag/mysql/index.html' class='tag-link-82' title='6 topics' style='font-size: 8.5868263473054pt;'>mysql</a>
<a href='../tag/nginx/index.html' class='tag-link-183' title='12 topics' style='font-size: 10.766467065868pt;'>nginx</a>
<a href='../tag/nsfw/index.html' class='tag-link-319' title='13 topics' style='font-size: 11.101796407186pt;'>nsfw</a>
<a href='../tag/orm/index.html' class='tag-link-43' title='5 topics' style='font-size: 8pt;'>orm</a>
<a href='../tag/php/index.html' class='tag-link-199' title='6 topics' style='font-size: 8.5868263473054pt;'>php</a>
<a href='../tag/pip/index.html' class='tag-link-344' title='6 topics' style='font-size: 8.5868263473054pt;'>pip</a>
<a href='../tag/poo/index.html' class='tag-link-549' title='9 topics' style='font-size: 9.8443113772455pt;'>poo</a>
<a href='../tag/python/index.html' class='tag-link-4' title='280 topics' style='font-size: 22pt;'>python</a>
<a href='../tag/redis/index.html' class='tag-link-196' title='6 topics' style='font-size: 8.5868263473054pt;'>redis</a>
<a href='../tag/ruby/index.html' class='tag-link-325' title='7 topics' style='font-size: 9.0059880239521pt;'>ruby</a>
<a href='../tag/server/index.html' class='tag-link-185' title='6 topics' style='font-size: 8.5868263473054pt;'>server</a>
<a href='../tag/shell/index.html' class='tag-link-202' title='7 topics' style='font-size: 9.0059880239521pt;'>shell</a>
<a href='../tag/ssh/index.html' class='tag-link-206' title='6 topics' style='font-size: 8.5868263473054pt;'>ssh</a>
<a href='../tag/string/index.html' class='tag-link-35' title='5 topics' style='font-size: 8pt;'>string</a>
<a href='../tag/sublime-text/index.html' class='tag-link-76' title='6 topics' style='font-size: 8.5868263473054pt;'>sublime text</a>
<a href='../tag/twitter/index.html' class='tag-link-371' title='6 topics' style='font-size: 8.5868263473054pt;'>twitter</a>
<a href='../tag/ubuntu/index.html' class='tag-link-255' title='13 topics' style='font-size: 11.101796407186pt;'>ubuntu</a>
<a href='../tag/unicode/index.html' class='tag-link-53' title='5 topics' style='font-size: 8pt;'>unicode</a>
<a href='../tag/unit-tests/index.html' class='tag-link-302' title='6 topics' style='font-size: 8.5868263473054pt;'>unit tests</a>
<a href='../tag/unpacking/index.html' class='tag-link-180' title='6 topics' style='font-size: 8.5868263473054pt;'>unpacking</a>
<a href='../tag/virtualenv/index.html' class='tag-link-259' title='7 topics' style='font-size: 9.0059880239521pt;'>virtualenv</a>
<a href='../tag/yield/index.html' class='tag-link-287' title='8 topics' style='font-size: 9.4251497005988pt;'>yield</a><div class="tag_cloud_footer"><a href="../les-tags/index.html">All Tags</a></div></div>
</div> <!-- end .widget --><div id="archives-2" class="widget sidebar-block widget_archive"><h3 class="widgettitle">Archives</h3>		<ul>
			<li><a href='../2014/02/index.html' title='February 2014'>February 2014</a>&nbsp;(5)</li>
	<li><a href='../2014/01/index.html' title='January 2014'>January 2014</a>&nbsp;(17)</li>
	<li><a href='../2013/12/index.html' title='December 2013'>December 2013</a>&nbsp;(27)</li>
	<li><a href='../2013/11/index.html' title='November 2013'>November 2013</a>&nbsp;(25)</li>
	<li><a href='../2013/10/index.html' title='October 2013'>October 2013</a>&nbsp;(27)</li>
	<li><a href='../2013/09/index.html' title='September 2013'>September 2013</a>&nbsp;(1)</li>
	<li><a href='../2013/08/index.html' title='August 2013'>August 2013</a>&nbsp;(31)</li>
	<li><a href='../2013/07/index.html' title='July 2013'>July 2013</a>&nbsp;(32)</li>
	<li><a href='../2013/06/index.html' title='June 2013'>June 2013</a>&nbsp;(24)</li>
	<li><a href='../2013/05/index.html' title='May 2013'>May 2013</a>&nbsp;(30)</li>
	<li><a href='../2013/04/index.html' title='April 2013'>April 2013</a>&nbsp;(31)</li>
	<li><a href='../2013/03/index.html' title='March 2013'>March 2013</a>&nbsp;(33)</li>
	<li><a href='../2013/02/index.html' title='February 2013'>February 2013</a>&nbsp;(29)</li>
	<li><a href='../2013/01/index.html' title='January 2013'>January 2013</a>&nbsp;(34)</li>
	<li><a href='../2012/12/index.html' title='December 2012'>December 2012</a>&nbsp;(32)</li>
	<li><a href='../2012/11/index.html' title='November 2012'>November 2012</a>&nbsp;(36)</li>
	<li><a href='../2012/10/index.html' title='October 2012'>October 2012</a>&nbsp;(35)</li>
	<li><a href='../2012/09/index.html' title='September 2012'>September 2012</a>&nbsp;(36)</li>
	<li><a href='../2012/08/index.html' title='August 2012'>August 2012</a>&nbsp;(37)</li>
	<li><a href='../2012/07/index.html' title='July 2012'>July 2012</a>&nbsp;(33)</li>
	<li><a href='../2012/06/index.html' title='June 2012'>June 2012</a>&nbsp;(24)</li>
	<li><a href='../2012/05/index.html' title='May 2012'>May 2012</a>&nbsp;(31)</li>
	<li><a href='../2012/04/index.html' title='April 2012'>April 2012</a>&nbsp;(20)</li>
	<li><a href='../2012/03/index.html' title='March 2012'>March 2012</a>&nbsp;(10)</li>
	<li><a href='../2012/02/index.html' title='February 2012'>February 2012</a>&nbsp;(14)</li>
		</ul>
</div> <!-- end .widget --><div id="rss_links-2" class="widget sidebar-block widget_rss_links"><h3 class="widgettitle">Flux RSS</h3><p><a href="../feed.1" title="Subscribe to Posts"><img src="../wp-content/plugins/jetpack/_inc/images/rss/green-small.png" alt="RSS Feed" /></a>&nbsp;<a href="../feed.1" title="Subscribe to Posts">RSS - Posts</a></p>
</div> <!-- end .widget --><div id="text-5" class="widget sidebar-block widget_text"><h3 class="widgettitle"> Envoyez des sioux</h3>			<div class="textwidget"><p><img src="../wp-content/uploads/2013/07/bitcoin.png" width="16" height="16"/> On adooooore les bitcoins :</p>

<p>

<a href="bitcoin:19zAHPPuce4BAhsdy9KaFwVLurEJXMhMAn?amount=1X8&label=SamEtMax">19zAHPPuce4BAhsdy9KaFwVLurEJXMhMAn</a>

</p></div>
		</div> <!-- end .widget --></div> <!-- end sidebar -->	</div> <!-- end #content --> 
	
	 <div id="footer" >
		<div id="footer-content">
			
								
				<ul id="menu-bottom-menu" class="bottom-menu"><li id="menu-item-2391" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2391"><a href="../contactez-nous/index.html">Contactez-nous</a></li>
</ul>			
			<p id="copyright">Designed by  <a href="http://www.elegantthemes.com" title="Elegant Themes">Elegant WordPress Themes</a></p>
		</div> <!-- end #footer-content -->
	</div> <!-- end #footer -->
</div> <!-- end #page-wrap -->
	 
				
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/jquery-ui.min.js"></script>
	<script type="text/javascript" src="../wp-content/themes/Minimal/js/jquery.cycle.all.min.js"></script> 
	<script type="text/javascript" src="../wp-content/themes/Minimal/js/jquery.easing.1.3.js"></script>	
	<script type="text/javascript" src="../wp-content/themes/Minimal/js/superfish.js"></script>	
	<script type="text/javascript">
	//<![CDATA[
		jQuery.noConflict();
	
		jQuery('ul.superfish').superfish({ 
			delay:       200,                            // one second delay on mouseout 
			animation:   {opacity:'show',height:'show'},  // fade-in and slide-down animation 
			speed:       'fast',                          // faster animation speed 
			autoArrows:  true,                           // disable generation of arrow mark-up 
			dropShadows: false                            // disable drop shadows 
		}).find("> li > ul > li:last-child, > li > ul > li > ul > li:last-child, > li > ul > li > ul > li > ul > li:last-child").addClass("last-nav-element");
		
		jQuery(".js #featured, .js div#tabbed").css("display","block");

				
		var $featured_content = jQuery('#featured_content'),
			$tabbed_area = jQuery('div#tabbed'),
			$controllers = jQuery('div#controllers'),
			$comments = jQuery('ol.commentlist');
		
		et_search_bar();
		
		if ($featured_content.length) {
			$featured_content.cycle({
									timeout: 3000				,
				speed: 300,
				cleartypeNoBg: true,
				prev:   'a#left_arrow', 
				next:   'a#right_arrow',
				pager:  'div#controllers',
				fx: 'fade'
			});
			
			var controllersWidth = $controllers.width(),
				controllersLeft = Math.round((960 - controllersWidth) / 2);
			if (controllersWidth < 960) $controllers.css('padding-left',controllersLeft);
		};
		
		if ($tabbed_area.length) {
			$tabbed_area.tabs({ fx: { opacity: 'toggle' } });
		};
		
		if ($comments.length) {
			$comments.find(">li").after('<span class="bottom_bg"></span>');
		};
		

		<!---- Random tag line ---->		

var tagLine = function(){
    var tagLines =  [
        'Deux programmeurs qui se sortent les doigts du code',
        '10 ko de js rien que pour charger ce message',
        'Des articles pour geeks qui mettent les points sur les G',
        "Aucun hipster n'a été violenté à l'écriture de ce blog",
        'La programmation avec un grand C',
        'Ornithorynque fuchsia hydrophobe',
        'Python, Django, Git, et du Cul',
        'Nous croisons les effluves',
        'CMB DTC IRL CQFD',
        'Tuent des chatons depuis 1997',
        'Reticulating splines',
        'Error: unexpected end of stupid tag line',
        'Les bikinis et les ordinateurs épargnent les spéculations',
        'F5',
        '<3 (oYo)',
        'Rien que des obsédés du serpent !',
        "Je sers la science et c'est ma joie",
        'On peut tout génie génétiquer!',
        "Réparateurs d'harmonicas, professeurs de plongée",
        "Il faut mettre d'urgence un frein à l'immobilisme!",
        'Ho mon dieu! Ils ont tué Sam, enfoirés!',
        "L'étincelle qui fait déborder le vase",
        'A poil les putes !',
        'Bannis de Reddit !',
        "Bannis de l'AFPY !",
        'Bannis de Claire Chazal!',
        'Bannis de Jean-Pierre Pernaud !',
        'Bannis de Norton !',
        'Et si on faisait des camps pour que les gens puissent se concentrer?',
        'Article.objects.create(type=random.choice(("dev", "cul")))',
        'Le choc des mots, le poids des algos',
        'Kedzalcoilt, le serpent à poil'
    ];
    return tagLines[Math.ceil(Math.random() * 1000000000) % tagLines.length];
};

jQuery('#slogan').show().text(tagLine());

// forcer la redirection faire l'image en full size au click
jQuery('.wp-post-image').click(function(e){e.preventDefault(); window.location.href = jQuery(e.target).attr('src')});

// mettre clippy sur les comments

jQuery(function(){
    var message = "";
    var $comment = jQuery('#comment');
    topagent = null;

    $comment.keyup(function(){

        var content = jQuery(this).val();

        if (content.search(/(^|\s+)(php|vim|emacs|windows|pas?\s*libre)([.!?]|\s+)/i) != -1){
            message = "Il semble que vous teniez de propos trollesques. Attention, nous avons des tampons, et nous n'hésiterons pas à nous en servir !"
        }

        if (content.search(/(^|\s+)(me (tuer|suicider|tirer une balle|pendre|flinguer))([.!?]|\s+)/i) != -1){
            message = "Il semble que vous teniez de propos suicidaires. Sam & Max défendent la liberté d'expression. Allez aux bouts de vos idées !"
        }

        if (content.search(/(^|\s+)(connards?|enculés?|enfoirés?|fils? de pute?)([.!?]|\s+)/i) != -1){
            message = "Il semble que vous teniez des propos injurieux. Ne voulez-vous pas plutôt écrire une lettre d'insultes directement aux auteurs, via le formulaire de contact ?"
        }

        if (content.search(/(^|\s+)(culs?|nichons?|bite|chatte|sodomie|levrette|sexe)([.!?]|\s+)/i) != -1){
            message = "Il semble que vous teniez des propos graveleux. Pourriez-vous donner plus de détails ?"
        }

        if (content.search(/\>\>\>/i) != -1){
            message = "Le triple chevron ne passe pas dans les comments. Désolé :-( Utilisez »» à la place."
        }

        if (content.length > 2000){
            message = "Il semble que vous écriviez un roman. Vous réalisez que ceux qui vont répondre ne l'auront pas lu jusqu'au bout ?"
        }

        if (message){
            $comment.unbind();

            jQuery("<link/>", {
               rel: "stylesheet",
               type: "text/css",
               href: "http://sametmax.com/wp-content/uploads/2012/07/clippy.css"
            }).appendTo("head").one('load ready', function(){
                jQuery.getScript("http://sametmax.com/wp-content/uploads/2012/07/clippy.min_1.js", function(){
                    clippy.load('Clippy', function(agent) {
                        agent.show();
                        var offset = $comment.offset();
                        var left = offset.left + $comment.width() + 10;
                        var top = offset.top;

                        jQuery('.clippy').css({position:'absolute',
                                               display:'block',
                                               left: left, top: top})

                        jQuery('.clippy-balloon').css({position:'absolute',
                                                       display:'block',
                                                       left: left,
                                                       top: top - 50})

                        agent.speak(message);
                        setInterval(function(){agent.stop(); agent.animate()}, 20000);
                    });

                });

            });

        }

    });
});


		<!---- Search Bar Improvements ---->
		function et_search_bar(){
			var $searchform = jQuery('#header div#search-form'),
				$searchinput = $searchform.find("input#searchinput"),
				searchvalue = $searchinput.val();
				
			$searchinput.focus(function(){
				if (jQuery(this).val() === searchvalue) jQuery(this).val("");
			}).blur(function(){
				if (jQuery(this).val() === "") jQuery(this).val(searchvalue);
			});
		};
		
	//]]>	




<!-- Piwik -->

var pkBaseURL = (("https:" == document.location.protocol) ? "https://88.191.153.127:7777/" : "http://88.191.153.127:7777/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 1);
piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}



	</script>
<noscript>
<img src="http://88.191.153.127:7777/piwik.php?idsite=1&amp;rec=1" style="border:0" alt="" />
</noscript>
		<div style="display:none">
	<div class="grofile-hash-map-fc32c6686686ecc595f05ad1885c2fb3">
	</div>
	<div class="grofile-hash-map-aa90c4c03161ec318afbeb65b6927bb9">
	</div>
	<div class="grofile-hash-map-a16497d1d99ae5ebcf3d8547a7dff9ed">
	</div>
	<div class="grofile-hash-map-f0be159c1cf58c64f5fb6b3dbfa12e9c">
	</div>
	<div class="grofile-hash-map-bf9ecde8f5e286de6ce5c80206cf9dd6">
	</div>
	<div class="grofile-hash-map-56a4d86cdd42d8d72cc78d821724c7f4">
	</div>
	<div class="grofile-hash-map-4f42ed44f985c500a56a7a0b79dbfbf8">
	</div>
	<div class="grofile-hash-map-72487ae39590539b9e0c305458f61cca">
	</div>
	<div class="grofile-hash-map-027a6afe88c7e6b2bcd56e2dd31e71bb">
	</div>
	<div class="grofile-hash-map-f0a185474dc7c902e88efa53ea910cd9">
	</div>
	<div class="grofile-hash-map-aa3fbf033d64ff6d10f07d109eb4d521">
	</div>
	<div class="grofile-hash-map-9f3c22452987f3195187c70300ae85d6">
	</div>
	<div class="grofile-hash-map-eb8e400eec222e2b09bd901aba2cb2dc">
	</div>
	</div>
		<script type="text/javascript">
		jQuery(document).on( 'ready post-load', function(){
			jQuery( 'a.share-twitter' ).on( 'click', function() {
				window.open( jQuery(this).attr( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
				return false;
			});
		});
		</script>
				<script type="text/javascript">
		jQuery(document).on( 'ready post-load', function(){
			jQuery( 'a.share-facebook' ).on( 'click', function() {
				window.open( jQuery(this).attr( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
				return false;
			});
		});
		</script>
					<script type="text/javascript">
			  (function() {
			    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
			    po.src = 'https://apis.google.com/js/plusone.js';
			    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
			  })();
			</script>
				<div id="sharing_email" style="display: none;">
		<form action="index.html%3Fshare=email.html" method="post">
			<label for="target_email">Send to Email Address</label>
			<input type="text" name="target_email" id="target_email" value="" />

			
				<label for="source_name">Your Name</label>
				<input type="text" name="source_name" id="source_name" value="" />

				<label for="source_email">Your Email Address</label>
				<input type="text" name="source_email" id="source_email" value="" />

			
			
			<img style="float: right; display: none" class="loading" src="../wp-content/plugins/jetpack/modules/sharedaddy/images/loading.gif" alt="loading" width="16" height="16" />
			<input type="submit" value="Send Email" class="sharing_send" />
			<a href="index.html%3Fshare=email.html#cancel" class="sharing_cancel">Cancel</a>

			<div class="errors errors-1" style="display: none;">
				Post was not sent - check your email addresses!			</div>

			<div class="errors errors-2" style="display: none;">
				Email check failed, please try again			</div>

			<div class="errors errors-3" style="display: none;">
				Sorry, your blog cannot share posts by email.			</div>
		</form>
	</div>
					<script type="text/javascript">
				// Pinterest shared resources
				var s = document.createElement("script");
				s.type = "text/javascript";
				s.async = true;
				s.src = window.location.protocol + "//assets.pinterest.com/js/pinit.js";
				var x = document.getElementsByTagName("script")[0];
				x.parentNode.insertBefore(s, x);
				// if 'Pin it' button has 'counts' make container wider
				jQuery(window).load( function(){ jQuery( 'li.share-pinterest a span:visible' ).closest( '.share-pinterest' ).width( '80px' ); } );
			</script>
		<script type="text/javascript" src="http://platform.tumblr.com/v1/share.js"></script>		<script>
		// Don't use Pocket's default JS as it we need to force init new Pocket share buttons loaded via JS.
		function jetpack_sharing_pocket_init() {
			jQuery.getScript( 'https://widgets.getpocket.com/v1/j/btn.js?v=1' );
		}
		jQuery( document ).on( 'ready', jetpack_sharing_pocket_init );
		jQuery( document.body ).on( 'post-load', jetpack_sharing_pocket_init );
		</script>
		<script type='text/javascript' src='../wp-content/plugins/contact-form-7/includes/js/jquery.form.min.js%3Fver=3.15'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var _wpcf7 = {"loaderUrl":"http:\/\/sametmax.com\/wp-content\/plugins\/contact-form-7\/images\/ajax-loader.gif","sending":"Sending ..."};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/contact-form-7/includes/js/scripts.js%3Fver=3.3'></script>
<script type='text/javascript' src='http://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201406'></script>
<script type='text/javascript' src='http://s.gravatar.com/js/gprofiles.js?ver=2014Febaa'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/jetpack/modules/wpgroho.js%3Fver=3.3.1'></script>
<script type='text/javascript' src='../wp-content/themes/Minimal/epanel/page_templates/js/fancybox/jquery.easing-1.3.pack.js%3Fver=1.3.4'></script>
<script type='text/javascript' src='../wp-content/themes/Minimal/epanel/page_templates/js/fancybox/jquery.fancybox-1.3.4.pack.js%3Fver=1.3.4'></script>
<script type='text/javascript' src='../wp-content/themes/Minimal/epanel/page_templates/js/et-ptemplates-frontend.js%3Fver=1.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var recaptcha_options = {"lang":"en"};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/jetpack/modules/sharedaddy/sharing.js%3Fver=20121205'></script>

	<script src="http://stats.wordpress.com/e-201406.js" type="text/javascript"></script>
	<script type="text/javascript">
	st_go({v:'ext',j:'1:2.6.1',blog:'32490438',post:'6880',tz:'0'});
	var load_cmc = function(){linktracker_init(32490438,6880,2);};
	if ( typeof addLoadEvent != 'undefined' ) addLoadEvent(load_cmc);
	else load_cmc();
	</script>	
</body>
</html>