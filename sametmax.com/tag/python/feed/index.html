<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Sam &#38; Max: Python, Django, Git et du cul &#187; python</title>
	<atom:link href="http://sametmax.com/tag/python/feed/" rel="self" type="application/rss+xml" />
	<link>http://sametmax.com</link>
	<description>Deux développeurs en vadrouille qui se sortent les doigts du code</description>
	<lastBuildDate>Wed, 05 Feb 2014 14:20:37 +0000</lastBuildDate>
	<language>en</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.3.1</generator>
	<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2F&amp;language=en_US&amp;category=text&amp;title=Sam+%26amp%3B+Max%3A+Python%2C+Django%2C+Git+et+du+cul&amp;description=Deux+d%C3%A9veloppeurs+en+vadrouille+qui+se+sortent+les+doigts+du+code&amp;tags=blog" type="text/html" />
		<item>
		<title>Python a le don d&#8217;Ubiquité : Multiprocessing</title>
		<link>http://sametmax.com/python-ubiuite-multiprocessing/</link>
		<comments>http://sametmax.com/python-ubiuite-multiprocessing/#comments</comments>
		<pubDate>Sun, 02 Feb 2014 16:41:23 +0000</pubDate>
		<dc:creator>foxmask</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[multiprocessing]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=8939</guid>
		<description><![CDATA[Ceci est un post invité de Foxmask posté sous licence creative common 3.0 unported. Tout récemment j&#8217;ai voulu donner un coup de fouet à mon script de traitement de Trigger Happy (que je fais tourner sur ma &#8220;raspberry pi&#8221; parce que chuis un w4rl0rdZ:P) que j&#8217;estimais être trop long dans ses traitements de données. Actuellement [...]]]></description>
			<content:encoded><![CDATA[<blockquote><p>Ceci est un post invité de <a href="http://sametmax.com/author/foxmask" target="_blank">Foxmask </a>posté sous licence <a href="http://creativecommons.org/licenses/by/3.0/" target="_blank">creative common 3.0 unported</a>.</p></blockquote>
<p>Tout récemment j&#8217;ai voulu donner un coup de fouet à mon <a href="https://github.com/foxmask/django-th/blob/d91e443795429c85decf0ccf5e1f8470df7d11c4/fire.py">script de traitement</a> de <a href="http://www.foxmask.info/tag/triggerhappy/">Trigger Happy</a> (que je fais tourner sur ma &#8220;raspberry pi&#8221; parce que chuis un w4rl0rdZ:P) que j&#8217;estimais être trop long dans ses traitements de données.</p>
<p>Actuellement avec <a href="https://pypi.python.org/pypi/django_th/">Trigger Happy</a>, j&#8217;ai 30 sources de données (essentiellement des flux rss), que je parcours, et quand un nouvel item arrive, je l&#8217;envoi à pétaouchnock (Evernote ;) Le tout prend <strong>7min</strong>, soit 14secondes par source. La loose totale.</p>
<p>Voici le corps du délit :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;">#!/usr/bin/env python</span>
<span style="color: #808080; font-style: italic;"># -*- coding: utf-8 -*-</span>
<span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">__future__</span> <span style="color: #ff7700;font-weight:bold;">import</span> unicode_literals
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">os</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">datetime</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">time</span>
&nbsp;
<span style="color: #dc143c;">os</span>.<span style="color: black;">environ</span>.<span style="color: black;">setdefault</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;DJANGO_SETTINGS_MODULE&quot;</span>, <span style="color: #483d8b;">&quot;django_th.settings&quot;</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">from</span> django_th.<span style="color: black;">services</span> <span style="color: #ff7700;font-weight:bold;">import</span> default_provider
<span style="color: #ff7700;font-weight:bold;">from</span> django_th.<span style="color: black;">models</span> <span style="color: #ff7700;font-weight:bold;">import</span> TriggerService
<span style="color: #ff7700;font-weight:bold;">from</span> django.<span style="color: black;">utils</span>.<span style="color: black;">log</span> <span style="color: #ff7700;font-weight:bold;">import</span> getLogger
&nbsp;
<span style="color: #808080; font-style: italic;"># create logger</span>
logger = getLogger<span style="color: black;">&#40;</span><span style="color: #483d8b;">'django_th.trigger_happy'</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> go<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot;
        run the main process
    &quot;&quot;&quot;</span>
    trigger = TriggerService.<span style="color: black;">objects</span>.<span style="color: #008000;">filter</span><span style="color: black;">&#40;</span>status=<span style="color: #008000;">True</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">if</span> trigger:
        <span style="color: #ff7700;font-weight:bold;">for</span> service <span style="color: #ff7700;font-weight:bold;">in</span> trigger:
<span style="color: black;">&#91;</span>...<span style="color: black;">&#93;</span>
    <span style="color: #ff7700;font-weight:bold;">else</span>:
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;No trigger set by any user&quot;</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> main<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    default_provider.<span style="color: black;">load_services</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
    <span style="color: #808080; font-style: italic;"># let's go</span>
    go<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">if</span> __name__ == <span style="color: #483d8b;">&quot;__main__&quot;</span>:
&nbsp;
    main<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>Mais avant que je ne me penche sur le code du script pour l&#8217;améliorer, je me suis dit que plutôt que de chercher à corriger un problème, autant chercher la source de celui-ci d&#8217;abord (normal hein).</p>
<p>Un HTOP m&#8217;a révélé :</p>
<ol>
<li>que le CPU était à 100% tout le temps, que le script tourne ou pas</li>
<li>quye la raison était double : rabittmq et celery&#8230; </li>
</ol>
<p>Une fois shootés ces derniers, tout va pour le mieux :P<br />
Je ne dis pas que ceux ci sont de la merde, mais que, pour mon cas, la crontab se suffit à elle-même.</p>
<p>Donc une fois désinstallés c&#8217;est 2 (sur)consommateurs de ressources, je relance le script pour tomber à un temps de traitement à <strong>5mn</strong></p>

<div class="wp_syntax"><div class="code"><pre class="shell" style="font-family:monospace;">2014-02-02 14:40:51,693 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - News Sam et Max nothing new
2014-02-02 14:40:53,865 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - News de Numerama nothing new
2014-02-02 14:40:56,013 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de La Ferme du Web nothing new
2014-02-02 14:41:01,005 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - flux de Paulds nothing new
2014-02-02 14:41:20,098 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux d'un Odieux Connard nothing new
2014-02-02 14:41:22,142 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de Strict minimum nothing new
2014-02-02 14:41:25,868 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Humeurs Illustrées nothing new
2014-02-02 14:41:33,497 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux du Journalisme Total nothing new
2014-02-02 14:41:35,658 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de Kernel Panic nothing new
2014-02-02 14:41:44,897 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de AngularJS nothing new
2014-02-02 14:41:49,016 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de Odeon nothing new
2014-02-02 14:41:54,186 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de Nicolargo nothing new
2014-02-02 14:42:12,525 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de JEEK nothing new
2014-02-02 14:42:21,349 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de Recher nothing new
2014-02-02 14:42:31,266 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de Un blog d'adminsys Libres nothing new
2014-02-02 14:42:35,824 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - flux de Le bloc-notes de Gee nothing new
2014-02-02 14:42:36,647 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de mere code (atom) nothing new
2014-02-02 14:42:39,616 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de Alex Mac Caw nothing new
2014-02-02 14:42:42,985 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de Yearofmoo Articles nothing new
2014-02-02 14:43:42,732 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - News Novapost nothing new
2014-02-02 14:43:46,722 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - News Les Numériques nothing new
2014-02-02 14:43:58,303 INFO fire 5142 date 2014-02-02 13:00:00 &gt;= date triggered 2014-02-02 09:02:36 title Test du Quechua Phone 5, le smartphone des montagnards ?
2014-02-02 14:44:08,010 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - News Frandroid = 1 new data
2014-02-02 14:44:17,624 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de TechCrunch Mobile nothing new
2014-02-02 14:44:20,339 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux Django annonces nothing new
2014-02-02 14:44:20,744 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - La Hyène - Python nothing new
2014-02-02 14:44:24,237 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - News de PCInpact nothing new
2014-02-02 14:44:29,055 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - PointGPhone nothing new
2014-02-02 14:44:31,299 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - HumanCoders Python nothing new
2014-02-02 14:44:52,751 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - HauteFeuille Lab (python) nothing new
2014-02-02 14:44:58,850 INFO fire 5142 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de Python Plone Planet nothing new</pre></div></div>

<p>Comme je suis un éternel insatisfait de bibi, j&#8217;ai cherché <a href="http://sametmax.com/remplacer-les-threads-avec-le-module-multiprocessing-en-python/">des moyens</a> <a href="http://www.hautefeuille.eu/python-parallelism-multiprocessing.html">un peu partout</a>, jusqu&#8217;à ce que Sam me souffle une suggestion ;)</p>
<p>A présent donc <a href="https://github.com/foxmask/django-th/blob/master/fire.py">une version modifiée pour exploiter le multiprocessing</a> est la suivante :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;">#!/usr/bin/env python</span>
<span style="color: #808080; font-style: italic;"># -*- coding: utf-8 -*-</span>
<span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">__future__</span> <span style="color: #ff7700;font-weight:bold;">import</span> unicode_literals
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">os</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">datetime</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">time</span>
<span style="color: #dc143c;">os</span>.<span style="color: black;">environ</span>.<span style="color: black;">setdefault</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;DJANGO_SETTINGS_MODULE&quot;</span>, <span style="color: #483d8b;">&quot;th.settings&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> django_th.<span style="color: black;">services</span> <span style="color: #ff7700;font-weight:bold;">import</span> default_provider
<span style="color: #ff7700;font-weight:bold;">from</span> django_th.<span style="color: black;">models</span> <span style="color: #ff7700;font-weight:bold;">import</span> TriggerService
<span style="color: #ff7700;font-weight:bold;">from</span> django.<span style="color: black;">utils</span>.<span style="color: black;">log</span> <span style="color: #ff7700;font-weight:bold;">import</span> getLogger
&nbsp;
<span style="color: #808080; font-style: italic;"># create logger</span>
logger = getLogger<span style="color: black;">&#40;</span><span style="color: #483d8b;">'django_th.trigger_happy'</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> go<span style="color: black;">&#40;</span>service<span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot;
        run the main process
    &quot;&quot;&quot;</span>
    <span style="color: black;">&#91;</span>...<span style="color: black;">&#93;</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> main<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    default_provider.<span style="color: black;">load_services</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
    <span style="color: #808080; font-style: italic;"># let's go</span>
    trigger = TriggerService.<span style="color: black;">objects</span>.<span style="color: #008000;">filter</span><span style="color: black;">&#40;</span>status=<span style="color: #008000;">True</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">if</span> trigger:
        <span style="color: #ff7700;font-weight:bold;">from</span> multiprocessing <span style="color: #ff7700;font-weight:bold;">import</span> Pool
        pool = Pool<span style="color: black;">&#40;</span>processes=<span style="color: #ff4500;">5</span><span style="color: black;">&#41;</span>
        result = pool.<span style="color: #008000;">map</span><span style="color: black;">&#40;</span>go, trigger<span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">else</span>:
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;No trigger set by any user&quot;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">if</span> __name__ == <span style="color: #483d8b;">&quot;__main__&quot;</span>:
&nbsp;
    main<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>fait tomber le temps de traitement à &#8230; <strong>1min</strong> &#8230;:</p>

<div class="wp_syntax"><div class="code"><pre class="shell" style="font-family:monospace;">$ date &amp;&amp; ./fire.sh &amp;&amp; date 
dimanche 2 février 2014, 14:58:38 (UTC+0100)
2014-02-02 14:58:48,221 INFO fire 5334 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de La Ferme du Web nothing new
2014-02-02 14:58:48,243 INFO fire 5336 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Humeurs Illustrées nothing new
2014-02-02 14:58:48,256 INFO fire 5337 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de Kernel Panic nothing new
2014-02-02 14:58:48,283 INFO fire 5333 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - News Sam et Max nothing new
2014-02-02 14:58:48,907 INFO fire 5335 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux d'un Odieux Connard nothing new
2014-02-02 14:58:49,267 INFO fire 5334 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - flux de Paulds nothing new
2014-02-02 14:58:49,446 INFO fire 5336 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux du Journalisme Total nothing new
2014-02-02 14:58:49,713 INFO fire 5333 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - News de Numerama nothing new
2014-02-02 14:58:49,847 INFO fire 5335 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de Strict minimum nothing new
2014-02-02 14:58:50,209 INFO fire 5334 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de Odeon nothing new
2014-02-02 14:58:50,353 INFO fire 5337 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de AngularJS nothing new
2014-02-02 14:58:50,830 INFO fire 5333 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de Un blog d'adminsys Libres nothing new
2014-02-02 14:58:51,338 INFO fire 5336 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de JEEK nothing new
2014-02-02 14:58:51,396 INFO fire 5334 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de Nicolargo nothing new
2014-02-02 14:58:51,476 INFO fire 5337 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de Yearofmoo Articles nothing new
2014-02-02 14:58:51,735 INFO fire 5333 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - flux de Le bloc-notes de Gee nothing new
2014-02-02 14:58:52,148 INFO fire 5335 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de mere code (atom) nothing new
2014-02-02 14:58:52,640 INFO fire 5336 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de Recher nothing new
2014-02-02 14:58:52,971 INFO fire 5335 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de Alex Mac Caw nothing new
2014-02-02 14:58:53,416 INFO fire 5334 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - News Les Numériques nothing new
2014-02-02 14:58:53,474 INFO fire 5333 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de TechCrunch Mobile nothing new
2014-02-02 14:58:53,870 INFO fire 5337 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - News Novapost nothing new
2014-02-02 14:58:54,072 INFO fire 5335 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - PointGPhone nothing new
2014-02-02 14:58:54,316 INFO fire 5333 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux Django annonces nothing new
2014-02-02 14:58:54,853 INFO fire 5336 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - La Hyène - Python nothing new
2014-02-02 14:58:55,111 INFO fire 5335 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - HumanCoders Python nothing new
2014-02-02 14:58:55,222 INFO fire 5334 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - News Frandroid nothing new
2014-02-02 14:58:55,380 INFO fire 5337 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - HauteFeuille Lab (python) nothing new
2014-02-02 14:58:55,696 INFO fire 5336 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - News de PCInpact nothing new
2014-02-02 14:59:02,214 INFO fire 5337 user: foxmask - provider: ServiceRss - consummer: ServiceEvernote - Flux de Python Plone Planet nothing new
dimanche 2 février 2014, 14:59:02 (UTC+0100)</pre></div></div>

<p>Comme on l&#8217;aura remarqué la différence entre les 2 versions est l&#8217;appel fait à a fonction go </p>
<p>avant :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">def</span> main<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    default_provider.<span style="color: black;">load_services</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
    <span style="color: #808080; font-style: italic;"># let's go</span>
    go<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>après :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">def</span> main<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    default_provider.<span style="color: black;">load_services</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
    <span style="color: #808080; font-style: italic;"># let's go</span>
    trigger = TriggerService.<span style="color: black;">objects</span>.<span style="color: #008000;">filter</span><span style="color: black;">&#40;</span>status=<span style="color: #008000;">True</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">if</span> trigger:
        <span style="color: #ff7700;font-weight:bold;">from</span> multiprocessing <span style="color: #ff7700;font-weight:bold;">import</span> Pool
        pool = Pool<span style="color: black;">&#40;</span>processes=<span style="color: #ff4500;">5</span><span style="color: black;">&#41;</span>
        result = pool.<span style="color: #008000;">map</span><span style="color: black;">&#40;</span>go, trigger<span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">else</span>:
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;No trigger set by any user&quot;</span></pre></div></div>

<p>du coup l&#8217;appel de la fonction &#8220;go&#8221; implique de changer sa signature en lui filant comme <a href="http://sametmax.com/la-difference-entre-parametres-et-arguments/">argument</a> &#8220;trigger&#8221; (le QuerySet de l&#8217;appli Django)</p>
<p>A présent donc <strong>pool.map</strong> fait l&#8217;itération des données trouvées dans le modele <strong>TriggerService</strong> et exécute tout le tintouin. *<:o)</p>
<p>ps : @Sam : chose promise chose dûe ;)</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=8939&amp;md5=9114c0c05f7ef60e6f4fb45b22129faf" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/python-ubiuite-multiprocessing/feed/</wfw:commentRss>
		<slash:comments>6</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fpython-ubiuite-multiprocessing%2F&amp;language=en_GB&amp;category=text&amp;title=Python+a+le+don+d%26%238217%3BUbiquit%C3%A9+%3A+Multiprocessing&amp;description=Ceci+est+un+post+invit%C3%A9+de+Foxmask+post%C3%A9+sous+licence+creative+common+3.0+unported.+Tout+r%C3%A9cemment+j%26%238217%3Bai+voulu+donner+un+coup+de+fouet+%C3%A0+mon+script+de+traitement+de+Trigger...&amp;tags=multiprocessing%2Cpython%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2014/02/le-petit-serpent-albinos-a-deux-tetes-credit-photo-sunshine-serpents_35781_w250.jpg" length="16901" type="image/jpg" />	</item>
		<item>
		<title>Un objet proxy : ce que c&#8217;est et à quoi ça sert</title>
		<link>http://sametmax.com/un-objet-proxy-ce-que-cest-et-a-quoi-ca-sert/</link>
		<comments>http://sametmax.com/un-objet-proxy-ce-que-cest-et-a-quoi-ca-sert/#comments</comments>
		<pubDate>Sat, 01 Feb 2014 17:18:13 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[class]]></category>
		<category><![CDATA[objet]]></category>
		<category><![CDATA[proxy]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=8076</guid>
		<description><![CDATA[Un objet proxy est un objet qui prend un <strong>autre</strong> objet en paramètre et le sauvegarde dans un de ses attributs. Quand on appelle les méthodes du proxy, le proxy appelle la même méthode de l'objet qu'il a en attribut, et retourne le résultat. Quand on set/get/delete un attribut du proxy, il fait la même chose sur l'autre objet.]]></description>
			<content:encoded><![CDATA[<p>Un objet proxy est un objet qui prend un <strong>autre</strong> objet en paramètre et le sauvegarde dans un de ses attributs. Quand on appelle les méthodes du proxy, le proxy appelle la même méthode de l&#8217;objet qu&#8217;il a en attribut, et retourne le résultat. Quand on set/get/delete un attribut du proxy, il fait la même chose sur l&#8217;autre objet.</p>
<p>Voilà une implémentation très basique d&#8217;un objet proxy en Python :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Proxy<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, obj<span style="color: black;">&#41;</span>:
        <span style="color: #808080; font-style: italic;"># L'objet passé en paramètre est</span>
        <span style="color: #808080; font-style: italic;"># sauvegardé dans un attribut.</span>
        <span style="color: #808080; font-style: italic;"># On le fait en utilisant </span>
        <span style="color: #808080; font-style: italic;"># object.__setattr__, qui est le</span>
        <span style="color: #808080; font-style: italic;"># __setattr__ du parent, et non directement</span>
        <span style="color: #808080; font-style: italic;"># en faisant self._obj = obj</span>
        <span style="color: #808080; font-style: italic;"># afin d'éviter une boucle infinie car</span>
        <span style="color: #808080; font-style: italic;"># nous écrasons __setattr__ plus bas.</span>
        <span style="color: #008000;">object</span>.<span style="color: #0000cd;">__setattr__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #483d8b;">&quot;_obj&quot;</span>, obj<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># On écrase les méthodes magiques __getattribute__</span>
    <span style="color: #808080; font-style: italic;"># (qui est appelée quand on faire self.nom_attribut), </span>
    <span style="color: #808080; font-style: italic;"># __delattr__ (qui est appelée quand on fait </span>
    <span style="color: #808080; font-style: italic;"># del self.nom_attribut) et __setattr__ (qui est </span>
    <span style="color: #808080; font-style: italic;"># appelée quand on fait self.nom_attribut = truc)</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__getattribute__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, name<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">getattr</span><span style="color: black;">&#40;</span><span style="color: #008000;">object</span>.<span style="color: #0000cd;">__getattribute__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #483d8b;">&quot;_obj&quot;</span><span style="color: black;">&#41;</span>, name<span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__delattr__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, name<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">delattr</span><span style="color: black;">&#40;</span><span style="color: #008000;">object</span>.<span style="color: #0000cd;">__getattribute__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #483d8b;">&quot;_obj&quot;</span><span style="color: black;">&#41;</span>, name<span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__setattr__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, name, value<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">setattr</span><span style="color: black;">&#40;</span><span style="color: #008000;">object</span>.<span style="color: #0000cd;">__getattribute__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #483d8b;">&quot;_obj&quot;</span><span style="color: black;">&#41;</span>, name, value<span style="color: black;">&#41;</span></pre></div></div>

<p>Ca s&#8217;utilise comme ceci :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> UnObjetOrdinnaire<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    attribut = <span style="color: #483d8b;">'VALEUR !'</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> methode<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, param<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> param <span style="color: #66cc66;">*</span> <span style="color: #ff4500;">2</span>
&nbsp;
&nbsp;
objet_ordinnaire = UnObjetOrdinnaire<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #808080; font-style: italic;"># on passe l'objet ordinnaire au proxy</span>
objet_proxy = Proxy<span style="color: black;">&#40;</span>objet_ordinnaire<span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Accéder à des méthodes et attribut</span>
<span style="color: #808080; font-style: italic;"># du proxy accède à ceux de l'objet</span>
<span style="color: #808080; font-style: italic;"># derrière le proxy</span>
<span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>objet_proxy.<span style="color: black;">attribut</span><span style="color: black;">&#41;</span>
<span style="color: #808080; font-style: italic;">## VALEUR !</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>objet_proxy.<span style="color: black;">methode</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">3</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: #808080; font-style: italic;">## 6</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Modifier l'objet proxy modifie</span>
<span style="color: #808080; font-style: italic;"># l'objet derrière le proxy</span>
objet_proxy.<span style="color: black;">attribut</span> = <span style="color: #483d8b;">'une autre valeur'</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>objet_ordinnaire.<span style="color: black;">attribut</span><span style="color: black;">&#41;</span>
<span style="color: #808080; font-style: italic;">## une autre valeur</span></pre></div></div>

<p>Pour un exemple vraiment à l&#8217;épreuve des balles, il faut prendre en compte tout un tas de <a href="http://code.activestate.com/recipes/496741-object-proxying/">cas particuliers</a>, ce qui fait qu&#8217;il est bien plus rentable d&#8217;utiliser une <a href="https://pypi.python.org/pypi/ProxyTypes">lib solide</a> pour ça.</p>
<p><strong>Attention, un objet proxy peut très bien avoir des méthodes qui n&#8217;appellent pas celles de l&#8217;objet derrière. On même avoir des méthodes qui appellent des méthodes qui n&#8217;ont pas le même nom, ou plusieurs méthodes&#8230;</strong> Ce que vous voyez en exemple est un proxy très basique.</p>
<h2>Pourquoi voudrait-on obtenir ce résultat ?</h2>
<p>Plusieurs design patterns font appel à des objets proxy. Par exemple, le design pattern &#8220;adapter&#8221; consiste à créer un objet proxy qui accepte plusieurs types d&#8217;objets en paramètres afin de présenter toujours la même interface.</p>
<p>Imaginez que vous ayez plusieurs objets qui servent à s&#8217;authentifier :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Login<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    _is_logged = <span style="color: #008000;">False</span> 
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> is_logged<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._is_logged
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> login<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #dc143c;">email</span>, password<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>._is_logged = <span style="color: #008000;">True</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> LoginWithUsername<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    _is_logged = <span style="color: #008000;">False</span> 
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> is_logged<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._is_logged
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> login<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, username, password<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>._is_logged = <span style="color: #008000;">True</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> SignIn<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    _is_logged = <span style="color: #008000;">False</span> 
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> is_logged<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._is_logged
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> signin<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #dc143c;">email</span>, password<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>._is_logged = <span style="color: #008000;">True</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> LoginWithKey<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    _is_logged = <span style="color: #008000;">False</span> 
&nbsp;
    key = <span style="color: #483d8b;">&quot;jfjkdlmqfjdmqsjdk&quot;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> is_logged<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._is_logged
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> login<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, username<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>._is_logged = <span style="color: #008000;">True</span></pre></div></div>

<p>Et vous avez un algo de parsing, qui attend un objet d&#8217;authentification. Si vous mettez le code qui permet de choisir la bonne API dans l&#8217;algo de parsing, vous liez l&#8217;algo (qui n&#8217;a rien à voir avec l&#8217;authentification) à toutes ces implémentations.</p>
<p>Une des manières de faire, est d&#8217;utiliser un adaptateur, dont  voici une esquisse :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> AuthAdapter<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, obj<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">object</span>.<span style="color: #0000cd;">__setattr__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #483d8b;">&quot;_obj&quot;</span>, obj<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__getattribute__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, name<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            <span style="color: #808080; font-style: italic;"># Si l'attribut existe sur le proxy, on l'utilise</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">object</span>.<span style="color: #0000cd;">__getattribute__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, name<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">AttributeError</span>:
            <span style="color: #808080; font-style: italic;"># Sinon on tente le coup sur l'objet derrière le proxy</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">getattr</span><span style="color: black;">&#40;</span><span style="color: #008000;">object</span>.<span style="color: #0000cd;">__getattribute__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #483d8b;">&quot;_obj&quot;</span><span style="color: black;">&#41;</span>, name<span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> login<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, id_=<span style="color: #008000;">None</span>, secret=<span style="color: #008000;">None</span><span style="color: black;">&#41;</span>:
        <span style="color: #808080; font-style: italic;"># Le login est différent pour chaque classe,</span>
        <span style="color: #808080; font-style: italic;"># donc on s'arrange avec.</span>
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            <span style="color: #008000;">self</span>._obj.<span style="color: black;">login</span><span style="color: black;">&#40;</span>id_, secret<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">AttributeError</span>:
            <span style="color: #008000;">self</span>._obj.<span style="color: black;">signin</span><span style="color: black;">&#40;</span>id_, secret<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">TypeError</span>:
            <span style="color: #008000;">self</span>._obj.<span style="color: black;">login</span><span style="color: black;">&#40;</span>id_<span style="color: black;">&#41;</span></pre></div></div>

<p>En gros, si on essaye d&#8217;appeler <code>login()</code>, il va lisser les contours et nous donner toujours la même interface, même si derrière l&#8217;objet peut marcher complètement différement. En revanche, si on appelle n&#8217;importe quel autre attribut ou méthode (par exemple <code>is_logged</code>, mais il pourrait y en avoir des dizaines d&#8217;autres dans la vrai vie vivante), ça tape directement dans l&#8217;objet derrière le proxy.</p>
<p>Donc si j&#8217;applique l&#8217;adaptateur systématiquement, quelle que soit la classe derrière, le comportement est toujours le même : j&#8217;appelle <code>login(un id, un secret)</code>, et il se logge.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">all_auth = <span style="color: black;">&#40;</span>Login, LoginWithUsername, SignIn, LoginWithKey<span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">for</span> auth <span style="color: #ff7700;font-weight:bold;">in</span> all_auth:
    <span style="color: #808080; font-style: italic;"># 'auth' est une des 4 classes de login. On l'instancie et</span>
    <span style="color: #808080; font-style: italic;"># on met l'instance derrière le proxy</span>
    auth = AuthAdapter<span style="color: black;">&#40;</span>auth<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Testing '%s'&quot;</span> <span style="color: #66cc66;">%</span> auth.__class__.__name__<span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Is logged : %s&quot;</span> <span style="color: #66cc66;">%</span> auth.<span style="color: black;">is_logged</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
    <span style="color: #808080; font-style: italic;"># Le login se passe toujours de la même manière, quelle que soit la classe</span>
    auth.<span style="color: black;">login</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'id'</span>, <span style="color: #483d8b;">'secret'</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Is logged after logging : %s&quot;</span> <span style="color: #66cc66;">%</span> auth.<span style="color: black;">is_logged</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span></pre></div></div>

<p> Comme d&#8217;habitude, ceci est un exemple naval. Il est bateau quoi. Mais cela vous démontre le principe.</p>
<p> Le design pattern façade ressemble à l&#8217;adapter, en fait c&#8217;est une spécialisation de l&#8217;adapter. Il s&#8217;agit juste d&#8217;exposer une interface plus simple, de l&#8217;objet derrière le proxy.</p>
<p>Un proxy peut aussi servir à hacker une lib. Par exemple, la lib attend un objet d&#8217;une ancienne version d&#8217;une autre lib dont l&#8217;auteur a déprécié un attribut. Avec un proxy, vous pouvez toujours faire semblant que l&#8217;attribut est toujours là : enrobez l&#8217;objet dans un proxy qui possède cet attribut, tout le reste de l&#8217;API sera la même.</p>
<p>Un proxy peut également être utile si vous voulez effectuer des actions quand l&#8217;objet est manipulé.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">logging</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> ProxyLogger<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, obj<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">object</span>.<span style="color: #0000cd;">__setattr__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #483d8b;">&quot;_obj&quot;</span>, obj<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__getattribute__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, name<span style="color: black;">&#41;</span>:
        obj = <span style="color: #008000;">object</span>.<span style="color: #0000cd;">__getattribute__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #483d8b;">&quot;_obj&quot;</span><span style="color: black;">&#41;</span>
        <span style="color: #808080; font-style: italic;"># On lance un warning à chaque accès à un attribut de l'objet</span>
        <span style="color: #808080; font-style: italic;"># derrière le proxy</span>
        <span style="color: #dc143c;">logging</span>.<span style="color: black;">warning</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;%s.%s has been called&quot;</span> <span style="color: #66cc66;">%</span> <span style="color: black;">&#40;</span>obj.__class__.__name__, name<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">getattr</span><span style="color: black;">&#40;</span>obj, name<span style="color: black;">&#41;</span></pre></div></div>

<p>Maintenant, supposons que vous avez un objet d&#8217;une lib externe (que vous ne pouvez donc pas modifier) sur lequel vous avez besoin d&#8217;infos :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> ObjetExterne<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">def</span> ahahah<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">pass</span>
&nbsp;
o = ProxyLogger<span style="color: black;">&#40;</span>ObjetExterne<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
o.<span style="color: black;">ahahah</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #808080; font-style: italic;">## WARNING:root:ObjetExterne.ahahah has been called</span></pre></div></div>

<p>Vous pouvez refiler le proxy à n&#8217;importe quel objet de sa lib d&#8217;origine, si le proxy est bien fait, elle ne vera pas la différence.</p>
<p>On finit sur une note culture, puisque le pattern decorator utilise souvent aussi un proxy. Cette fois d&#8217;une fonction sur un autre objet (en générale une autre fonction). Mais le principe est le même. Donc quand vous voyez <a href="http://sametmax.com/comprendre-les-decorateurs-python-pas-a-pas-partie-1/">@un_decorateur</a>, il est peut être en train d&#8217;appliquer un proxy à la fonction.</p>
<p>D&#8217;ailleurs on dit souvent que le proxy <strong>décore</strong> l&#8217;objet qui est derrière. </p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=8076&amp;md5=c70995e246355b07b339e3e26fe0c923" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/un-objet-proxy-ce-que-cest-et-a-quoi-ca-sert/feed/</wfw:commentRss>
		<slash:comments>1</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fun-objet-proxy-ce-que-cest-et-a-quoi-ca-sert%2F&amp;language=en_GB&amp;category=text&amp;title=Un+objet+proxy+%3A+ce+que+c%26%238217%3Best+et+%C3%A0+quoi+%C3%A7a+sert&amp;description=Un+objet+proxy+est+un+objet+qui+prend+un+autre+objet+en+param%C3%A8tre+et+le+sauvegarde+dans+un+de+ses+attributs.+Quand+on+appelle+les+m%C3%A9thodes+du+proxy%2C+le+proxy...&amp;tags=class%2Cobjet%2Cproxy%2Cpython%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2014/02/v1sV4jN.jpg" length="128340" type="image/jpg" />	</item>
		<item>
		<title>Python, meilleur nul part, excellent partout</title>
		<link>http://sametmax.com/python-meilleur-nul-part-excellent-partout/</link>
		<comments>http://sametmax.com/python-meilleur-nul-part-excellent-partout/#comments</comments>
		<pubDate>Fri, 31 Jan 2014 13:57:51 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[et python]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=8328</guid>
		<description><![CDATA[J'aime Python parce qu'il est très bon à X. Presque tous les X. En fait, il existe très peu de X pour lequel Python n'est pas bon.]]></description>
			<content:encoded><![CDATA[<p>Je ne sais pas si vous l&#8217;aviez compris, mais <a href="http://sametmax.com/10-raisons-pour-lesquelles-je-suis-toujours-marie-a-python/">j&#8217;aime bien Python</a>. J&#8217;ai essayé de vous le cacher jusqu&#8217;ici, mais je sais que mon secret ne tiendra pas longtemps, alors j&#8217;avoues tout.</p>
<p>Je n&#8217;aime pas Python parce que c&#8217;est le meilleur langage pour X. Je ne pense pas que Python soit le meilleur langage pour quoi que ce soit. Regex ? Perl est meilleur ? IA ? Lisp est meilleur. Embarqué ? C est meilleur. Asynchrone ? Javascript est meilleur.</p>
<p>Non. J&#8217;aime Python parce qu&#8217;il est très bon à X. Presque tous les X. En fait, il existe très peu de X pour lequel Python n&#8217;est pas bon.</p>
<p>Python est excellent pour analyser du texte, pour faire un site Web (même asynchrone), de l&#8217;administration système, des interfaces graphiques, du calcul scientifique, de la 3D, des crawlers, etc. Pas le meilleur. Mais très bon.</p>
<p>Et ceci est fantastique. Cela veut dire que si je commence un projet, n&#8217;importe quel projet, je sais que je peux le commencer en Python. Je ne serai pas bloqué plus tard par tel ou tel besoin. Je sais que je pourrai m&#8217;en sortir agréablement avec Python.</p>
<p>Vous faites un site en JS ? Pour le sysadmin, il va falloir un autre langage.</p>
<p>Des scripts de maintenance en Perl ? J&#8217;espère que vous n&#8217;aurez pas besoin d&#8217;une UI.</p>
<p>Un crawler en PHP ? Pour l&#8217;analyse des données récupérer, vous aller vous amuser&#8230;</p>
<p>De l&#8217;extraction de data en Ruby ? Pourvu qu&#8217;il ne faille pas traiter plusieurs To.</p>
<p>Ce n&#8217;est pas que vous ne pourrez pas. Ils sont tous Turring complet après tout. Mais vous allez vraiment galérer.</p>
<p>Aucun langage n&#8217;est parfait, et Python n&#8217;est pas une exception. </p>
<p>Mais ce qui est génial, c&#8217;est que dans 90% des cas, vous pouvez avoir une solution propre et efficace en Python au problématique que vous ne savez même pas encore que vous aurez. Et le jour où vous atteindrez la limite, alors oui, vous pourrez utiliser une autre techno pour le faire. Mais juste pour cette partie. La plupart du temps ce sera une partie très réduite. En en plus, Python pourra probablement s&#8217;interfacer nativement avec le code de l&#8217;autre langage.</p>
<p>Il y a des tas de raisons de ne pas choisir Python bien entendu, mais probablement la meilleure raison de le choisir, c&#8217;est qu&#8217;il y a peu de chance de se planter.</p>
<p>Bon, évidement si vous voulez écrire un driver de carte graphique&#8230;</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=8328&amp;md5=b40c02594ee4a3fe706c3f4f7474a092" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/python-meilleur-nul-part-excellent-partout/feed/</wfw:commentRss>
		<slash:comments>26</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fpython-meilleur-nul-part-excellent-partout%2F&amp;language=en_GB&amp;category=text&amp;title=Python%2C+meilleur+nul+part%2C+excellent+partout&amp;description=Je+ne+sais+pas+si+vous+l%26%238217%3Baviez+compris%2C+mais+j%26%238217%3Baime+bien+Python.+J%26%238217%3Bai+essay%C3%A9+de+vous+le+cacher+jusqu%26%238217%3Bici%2C+mais+je+sais+que+mon+secret+ne+tiendra+pas+longtemps%2C+alors...&amp;tags=et+python%2Cpython%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2014/01/L8LThTm.jpg" length="46727" type="image/jpg" />	</item>
		<item>
		<title>Solution de l&#8217;exercice d&#8217;hier sur shadow</title>
		<link>http://sametmax.com/solution-de-lexercice-dhier-sur-shadow/</link>
		<comments>http://sametmax.com/solution-de-lexercice-dhier-sur-shadow/#comments</comments>
		<pubDate>Wed, 29 Jan 2014 15:25:53 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[exercice]]></category>
		<category><![CDATA[password]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[unix]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=8917</guid>
		<description><![CDATA[Ça va de soit, mais ça va mieux en le disant, ceci n'est pas la solution unique, mais une solution possible parmi d'autres.]]></description>
			<content:encoded><![CDATA[<p>Ça va de soit, mais ça va mieux en le disant, ceci n&#8217;est pas la solution unique de l&#8217;<a href="http://sametmax.com/cest-lheure-de-faire-de-lexercice/#comment-19118">exercice d&#8217;hier</a>, mais une solution possible parmi d&#8217;autres.</p>
<p>On note l&#8217;usage de <a href="http://docs.python.org/2/library/crypt.html?highlight=crypt#crypt">crypt</a>, qui évite de se faire chier à trouver le bon algo de hashing et gère le salt automatiquement. <a href="http://docs.python.org/2/library/spwd.html?highlight=spwd#spwd">spwd</a>, c&#8217;est vraiment pour le grosses larves comme moi qui veulent même pas faire un <code>split</code>.</p>
<p>Et c&#8217;est du Python 3, yo dog !</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> io
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">os</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">crypt</span>
<span style="color: #ff7700;font-weight:bold;">import</span> spwd
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">urllib</span>.<span style="color: black;">request</span> <span style="color: #ff7700;font-weight:bold;">import</span> FancyURLopener
<span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">zipfile</span> <span style="color: #ff7700;font-weight:bold;">import</span> ZipFile
&nbsp;
PASSWORDS_SOURCE = <span style="color: #483d8b;">&quot;http://xato.net/files/10k%20most%20common.zip&quot;</span>
PASSWORDS_LIST = <span style="color: #483d8b;">'10k most common.txt'</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Le fichier ZIP est derrière cloudflare, qui vous ferme la porte au nez si</span>
<span style="color: #808080; font-style: italic;"># vous n'avez pas de User-Agent. On va donc créer un UrlOpener, un objet qui</span>
<span style="color: #808080; font-style: italic;"># ouvre des ressources en utilisant leurs URLs, qui a un User-Agent 'TA MERE'.</span>
<span style="color: #808080; font-style: italic;"># CloudFlare ne check pas que le UA est valide.</span>
<span style="color: #ff7700;font-weight:bold;">class</span> FFOpener<span style="color: black;">&#40;</span>FancyURLopener<span style="color: black;">&#41;</span>:
   version = <span style="color: #483d8b;">'TA MERE'</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Si le dictionnaire de passwords n'est pas là, on le télécharge</span>
<span style="color: #808080; font-style: italic;"># via FFOpener().open(PASSWORDS_SOURCE).read(). C'est verbeux, c'est urllib.</span>
<span style="color: #808080; font-style: italic;"># Normalement je ferais ça avec requests. Ensuite on lui donne une interface</span>
<span style="color: #808080; font-style: italic;"># file-like object avec io.BytesIO pour que ZipFile puisse le traiter en mémoire</span>
<span style="color: #808080; font-style: italic;"># sans avoir à le sauvegarder dans un vrai fichier sur le disque, et on</span>
<span style="color: #808080; font-style: italic;"># extrait le ZIP.</span>
<span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #dc143c;">os</span>.<span style="color: black;">path</span>.<span style="color: black;">isfile</span><span style="color: black;">&#40;</span>PASSWORDS_LIST<span style="color: black;">&#41;</span>:
    ZipFile<span style="color: black;">&#40;</span>io.<span style="color: black;">BytesIO</span><span style="color: black;">&#40;</span>FFOpener<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: #008000;">open</span><span style="color: black;">&#40;</span>PASSWORDS_SOURCE<span style="color: black;">&#41;</span>.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>.<span style="color: black;">extractall</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># On extrait les mots de passe de la liste sous forme de tuple car c'est rapide</span>
<span style="color: #808080; font-style: italic;"># à lire. Un petit rstrip vire les sauts de ligne.</span>
passwords = <span style="color: #008000;">tuple</span><span style="color: black;">&#40;</span>l.<span style="color: black;">rstrip</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">for</span> l <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">open</span><span style="color: black;">&#40;</span>PASSWORDS_LIST<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># spwd.getspall() nous évite de parser le fichier shadow à la main.</span>
<span style="color: #ff7700;font-weight:bold;">for</span> entry <span style="color: #ff7700;font-weight:bold;">in</span> spwd.<span style="color: black;">getspall</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'Processing password for user &quot;%s&quot;: '</span> <span style="color: #66cc66;">%</span> entry.<span style="color: black;">sp_nam</span>, end=<span style="color: #483d8b;">''</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Pas de hash ? On gagne du temps avec 'continue'</span>
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #483d8b;">'$'</span> <span style="color: #ff7700;font-weight:bold;">in</span> entry.<span style="color: black;">sp_pwd</span>:
        <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'no password hash to process.'</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">continue</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># On teste chaque password avec la fonction crypt, qui accepte en deuxième</span>
    <span style="color: #808080; font-style: italic;"># paramètre le hash du mot de passe complet. Pas besoin de se faire chier</span>
    <span style="color: #808080; font-style: italic;"># à le spliter, il va analyser les '$' et se démerder avec ça. On a juste</span>
    <span style="color: #808080; font-style: italic;"># à comparer le résultat avec le hash d'origine.</span>
    <span style="color: #ff7700;font-weight:bold;">for</span> <span style="color: #dc143c;">pwd</span> <span style="color: #ff7700;font-weight:bold;">in</span> passwords:
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #dc143c;">crypt</span>.<span style="color: #dc143c;">crypt</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">pwd</span>, entry.<span style="color: black;">sp_pwd</span><span style="color: black;">&#41;</span> == entry.<span style="color: black;">sp_pwd</span>:
            <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'password is &quot;%s&quot;.'</span> <span style="color: #66cc66;">%</span> <span style="color: #dc143c;">pwd</span><span style="color: black;">&#41;</span>
            <span style="color: #808080; font-style: italic;"># On break pour gagner quelques tours de boucles, et pouvoir</span>
            <span style="color: #808080; font-style: italic;"># utiliser la condition 'else'.</span>
            <span style="color: #ff7700;font-weight:bold;">break</span>
    <span style="color: #ff7700;font-weight:bold;">else</span>:
        <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'fail to break password.'</span><span style="color: black;">&#41;</span></pre></div></div>

<p><a href="https://github.com/sametmax/codes-des-articles/blob/master/2014/janvier/crack_shadow.py">Télécharger le code.</a></p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=8917&amp;md5=a1783918d5efb8552ac4659f4ae50c32" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/solution-de-lexercice-dhier-sur-shadow/feed/</wfw:commentRss>
		<slash:comments>9</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fsolution-de-lexercice-dhier-sur-shadow%2F&amp;language=en_GB&amp;category=text&amp;title=Solution+de+l%26%238217%3Bexercice+d%26%238217%3Bhier+sur+shadow&amp;description=%C3%87a+va+de+soit%2C+mais+%C3%A7a+va+mieux+en+le+disant%2C+ceci+n%26%238217%3Best+pas+la+solution+unique+de+l%26%238217%3Bexercice+d%26%238217%3Bhier%2C+mais+une+solution+possible+parmi+d%26%238217%3Bautres.+On+note+l%26%238217%3Busage+de...&amp;tags=exercice%2Cpassword%2Cpython%2Cunix%2Cblog" type="text/html" />
	</item>
		<item>
		<title>C&#8217;est l&#8217;heure de faire de l&#8217;exercice</title>
		<link>http://sametmax.com/cest-lheure-de-faire-de-lexercice/</link>
		<comments>http://sametmax.com/cest-lheure-de-faire-de-lexercice/#comments</comments>
		<pubDate>Tue, 28 Jan 2014 16:19:48 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[bcrypt]]></category>
		<category><![CDATA[mot de pass]]></category>
		<category><![CDATA[password]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[sha]]></category>
		<category><![CDATA[unix]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=8910</guid>
		<description><![CDATA[Créer un script de brute force de passwords Unix par dictionnaire.]]></description>
			<content:encoded><![CDATA[<p>Le <a href="http://sametmax.com/petit-exercice-en-python/">dernier exercice</a> avait bien été apprécié, alors je remet ça.</p>
<p>Consigne :</p>
<p><em><br />
Créer un script de brute force de passwords Unix par dictionnaire.</p>
<p>Puisqu&#8217;on est pas non plus des Kevin Mitnick en puissance, on va supposer que vous êtes connectés sur la machine, que vous avez les droits root dessus et que vous avez localisé les mots de passe comme étant dans &#8220;/etc/shadow&#8221;.</p>
<p>Votre script va vérifier si il possède un dictionnaire de mots de passe. Si ce n&#8217;est pas le cas, il va télécharger celui-ci et le décompresser : <a href="http://xato.net/files/10k%20most%20common.zip">http://xato.net/files/10k%20most%20common.zip.</a></p>
<p>Ensuite vous parcourez le fichier shadow, et vous essayez de trouver quel mot de passe se cache  derrière chaque hash. Si il n&#8217;y a pas de hash, vous pouvez ignorer l&#8217;utilisateur.</p>
<p>Exemple de sortie:</p>
<pre>
Processing password for user "root": no password hash to process.
Processing password for user "daemon": no password hash to process.
Processing password for user "bin": no password hash to process.
Processing password for user "sys": no password hash to process.
Processing password for user "www-data": no password hash to process.
Processing password for user "sam": fail to break password.
Processing password for user "test": password is "cheese".
Processing password for user "messagebus": no password hash to process.
Processing password for user "avahi-autoipd": no password hash to process.
Processing password for user "avahi": no password hash to process.
...</pre>
<p></em></p>
<p>Afin de simplifier l&#8217;exercice, il n&#8217;est pas demandé de gestion d&#8217;erreur ou de passage en a paramètre du script.</p>
<p>Comme d&#8217;habitude, il n&#8217;y a pas de solution ultimate de la mort qui tue, c&#8217;est juste pour le fun.</p>
<p><a href="http://sametmax.com/solution-de-lexercice-dhier-sur-shadow/">La soluce demain.</a></p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=8910&amp;md5=31cd416f11850ac5dcbd198c2c995342" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/cest-lheure-de-faire-de-lexercice/feed/</wfw:commentRss>
		<slash:comments>28</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fcest-lheure-de-faire-de-lexercice%2F&amp;language=en_GB&amp;category=text&amp;title=C%26%238217%3Best+l%26%238217%3Bheure+de+faire+de+l%26%238217%3Bexercice&amp;description=Le+dernier+exercice+avait+bien+%C3%A9t%C3%A9+appr%C3%A9ci%C3%A9%2C+alors+je+remet+%C3%A7a.+Consigne+%3A+Cr%C3%A9er+un+script+de+brute+force+de+passwords+Unix+par+dictionnaire.+Puisqu%26%238217%3Bon+est+pas+non+plus+des...&amp;tags=bcrypt%2Cmot+de+pass%2Cpassword%2Cpython%2Csha%2Cunix%2Cblog" type="text/html" />
	</item>
		<item>
		<title>Cog, l&#8217;anti langage de template Python</title>
		<link>http://sametmax.com/cog-lanti-langage-de-template-python/</link>
		<comments>http://sametmax.com/cog-lanti-langage-de-template-python/#comments</comments>
		<pubDate>Mon, 27 Jan 2014 17:45:38 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[cog]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[template]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=8903</guid>
		<description><![CDATA[<a href="http://nedbatchelder.com/code/cog/">Cog</a> est un outil Python en ligne de commande qui permet d'insérer du code Python dans un fichier, afin qu'il génère une partie de ce fichier]]></description>
			<content:encoded><![CDATA[<p><a href="http://nedbatchelder.com/code/cog/">Cog</a> est un outil Python en ligne de commande qui permet d&#8217;insérer du code Python dans un fichier, afin qu&#8217;il génère une partie de ce fichier.</p>
<p>A priori, ça ressemble à un langage de template. Là où ça diffère, c&#8217;est que cog ne cherche pas à générer un fichier différent, il insère le code généré dans le fichier original, et garde le code de génération.</p>
<p>Exemple, vous avez envie d&#8217;insérer un warning en haut de plusieurs fichiers de code. Vos choix :</p>
<ul>
<li>Copier-coller le warning.</li>
<li>Créer un script de build qui insère le warning.</li>
</ul>
<p>L&#8217;alternative des bricoleurs qui ont juste besoin de quelques insertions, c&#8217;est Cog. Par exemple, votre fichier contient :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># [[[cog for l in open('warning.txt'): cog.out(&quot;# &quot; + l) ]]]</span>
<span style="color: #808080; font-style: italic;"># [[[end]]]</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">import</span> vostrucs
&nbsp;
vostrucs.<span style="color: black;">faire_vos_machins</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>Après un <code>cog.py -r votre_fichier.py</code>, votre fichier sera :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># [[[cog for l in open('warning.txt'): cog.out(&quot;# &quot; + l) ]]]</span>
<span style="color: #808080; font-style: italic;"># Attention, ceci est un avertissmement super important.</span>
<span style="color: #808080; font-style: italic;"># Ce logiciel ne vient avec aucune garantie. Il vomira dans votre salon.</span>
<span style="color: #808080; font-style: italic;"># Violera votre femme, lui collera l'hépatite C et offrira un CD de one direction</span>
<span style="color: #808080; font-style: italic;"># à vos enfants.</span>
<span style="color: #808080; font-style: italic;"># [[[end]]]</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">import</span> vostrucs
&nbsp;
vostrucs.<span style="color: black;">faire_vos_machins</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>cog vient avec plusieurs options, par exemple la possibilité de retirer le code de génération ou de lire le précédent texte généré depuis le code de génération.</p>
<p>La véritable force de l&#8217;outil c&#8217;est qu&#8217;il peut utiliser n&#8217;importe quel module Python, et donc générer du texte à partir d&#8217;un contenu en ligne ou un fichier CSV. Il est d&#8217;ailleurs né parce que l&#8217;auteur était codeur C et avait besoin de générer du code à partir d&#8217;un fichier XML.</p>
<p>Le seul défaut de Cog, c&#8217;est que c&#8217;est verbeux. Et moche.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=8903&amp;md5=c0ca287d24dbc08e6b0640087a6ec7fa" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/cog-lanti-langage-de-template-python/feed/</wfw:commentRss>
		<slash:comments>4</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fcog-lanti-langage-de-template-python%2F&amp;language=en_GB&amp;category=text&amp;title=Cog%2C+l%26%238217%3Banti+langage+de+template+Python&amp;description=Cog+est+un+outil+Python+en+ligne+de+commande+qui+permet+d%26%238217%3Bins%C3%A9rer+du+code+Python+dans+un+fichier%2C+afin+qu%26%238217%3Bil+g%C3%A9n%C3%A8re+une+partie+de+ce+fichier.+A+priori%2C+%C3%A7a+ressemble...&amp;tags=cog%2Cpython%2Ctemplate%2Cblog" type="text/html" />
	</item>
		<item>
		<title>Wheel installs require setuptools &gt;= 0.8 for dist-info support.</title>
		<link>http://sametmax.com/wheel-installs-require-setuptools-0-8-for-dist-info-support/</link>
		<comments>http://sametmax.com/wheel-installs-require-setuptools-0-8-for-dist-info-support/#comments</comments>
		<pubDate>Wed, 22 Jan 2014 19:24:51 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[pip]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[setuptools]]></category>
		<category><![CDATA[wheel]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=8745</guid>
		<description><![CDATA[Je ne sais pas pourquoi, mais une fois j'ai eu cette erreur en essayant d'installer un truc avec pip.]]></description>
			<content:encoded><![CDATA[<p>Je ne sais pas pourquoi, mais une fois j&#8217;ai eu cette erreur en essayant d&#8217;installer un truc avec pip.</p>
<p>La solution est de lancer :</p>
<p><code>sudo pip install setuptools --no-use-wheel --upgrade</code></p>
<p>Et on peut réutiliser pip sans problème.</p>
<p>Zarb.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=8745&amp;md5=bd12ac3c7794653e675bc73b7643b82c" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/wheel-installs-require-setuptools-0-8-for-dist-info-support/feed/</wfw:commentRss>
		<slash:comments>2</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fwheel-installs-require-setuptools-0-8-for-dist-info-support%2F&amp;language=en_GB&amp;category=text&amp;title=Wheel+installs+require+setuptools+%3E%3D+0.8+for+dist-info+support.&amp;description=Je+ne+sais+pas+pourquoi%2C+mais+une+fois+j%26%238217%3Bai+eu+cette+erreur+en+essayant+d%26%238217%3Binstaller+un+truc+avec+pip.+La+solution+est+de+lancer+%3A+sudo+pip+install+setuptools+--no-use-wheel...&amp;tags=pip%2Cpython%2Csetuptools%2Cwheel%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2014/01/23348273.jpg" length="47277" type="image/jpg" />	</item>
		<item>
		<title>La fin du mystère du binaire (nananère)</title>
		<link>http://sametmax.com/la-fin-du-mystere-du-binaire-nananere/</link>
		<comments>http://sametmax.com/la-fin-du-mystere-du-binaire-nananere/#comments</comments>
		<pubDate>Tue, 21 Jan 2014 15:01:56 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[base 10]]></category>
		<category><![CDATA[base 2]]></category>
		<category><![CDATA[binaire]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=8808</guid>
		<description><![CDATA[Le binaire c'est simple. Tout le monde peut le comprendre. Par contre, il y a beaucoup de choses à savoir.]]></description>
			<content:encoded><![CDATA[<p>Quand mon voisin de table en cours de SVT a commencé à m&#8217;expliquer le binaire (il programmait en assembleur sur sa TI89), j&#8217;ai pas bien pigé. Des années plus tard, en cours d&#8217;archi, un prof nous a fait un cours magistral sur la question. Je n&#8217;ai définitivement rien pigé. J&#8217;ai regardé des tutos sur le net. RIEN P-I-G-É.</p>
<p>J&#8217;ai mis presque 10 ans (littéralement) avant que mon cerveau tilte. Non pas que je n&#8217;avais pas compris le principe, mais le détails, comment on faisait la conversion, ce qu&#8217;on pouvait faire avec, etc&#8230; Ca me passait au dessus de la tête.</p>
<p>Je râle beaucoup sur le manque de pédagogie d’autrui, et après tout, d&#8217;autres ont compris le truc à partir de ces explications. Mais je vais me répéter : leurs explications étaient merdiques.</p>
<p>Le binaire c&#8217;est simple. Tout le monde peut le comprendre.</p>
<p>Si vous ne pigez pas, c&#8217;est que le mec en face de vous est une grosse pine.</p>
<p>Par contre, il y a beaucoup de choses à savoir, alors à long article, loooooooooooongue musique :</p>

<!-- iframe plugin v:2.3 - wordpress.org/extend/plugins/iframe/ -->
<iframe width="420" height="315" src="//www.youtube.com/embed/6XIpR59xeEU" frameborder="0" scrolling="no" class="iframe-class"></iframe>
<p>Long article car j&#8217;ai vu des connards mélanger tout et n&#8217;importe quoi dans leurs explications du binaire, et je vais devoir démêler le sac de nœuds qu&#8217;ils ont fait dans votre tête.</p>
<h2>Pourquoi apprendre le binaire ?</h2>
<p>Pour le sport, essentiellement. La culture G. Parce qu&#8217;en toute honnêteté, aujourd&#8217;hui, ça ne sert plus à grand chose, tellement vous avez de couches d&#8217;abstraction entre les manipulations binaires et vous.</p>
<p>Il y a toujours quelques grincheux qui vous diront des trucs de grincheux comme &#8220;oui, mais pour comprendre les erreurs de flottant en arithmétique, il faut comprendre le binaire&#8221; comme mon père qui me disait qu&#8217;il fallait apprendre le latin au lycée. Meh.</p>
<p>D&#8217;abord, on a pas plus besoin d&#8217;apprendre le binaire pour comprendre les erreurs de flottant qu&#8217;on a besoin de comprendre la composition moléculaire de l&#8217;essence pour savoir pourquoi une voiture tombe en panne quand il y en a plus. Ensuite, vous n&#8217;avez même pas besoin de comprendre pourquoi il y a des erreurs de flottant, juste à savoir comment les éviter (ce que des tas de gens &#8220;qui les comprennent&#8221; ne sont pas foutu de faire).</p>
<p>Bref, c&#8217;est l&#8217;éternel bataille de l&#8217;arrière garde qui veut défendre le savoir aujourd&#8217;hui obsolète &#8211; qu&#8217;il a accumulé parce qu&#8217;a son époque c&#8217;était indispensable &#8211; à grand renfort de pédanterie. On voit ça dans tous les domaines. Généralement avec  force exemples de niches et enculage de mouche.</p>
<p>Mais au delà de ça, le binaire est encore utilisé dans certains domaines, comme la programmation de micro-contrôleurs (si vous planifiez de bosser chez Intel, Nvidia ou la NASA, ça peut servir), la cryptographie ou la programmation de calculatrices en cours de bio. Ce dernier point étant semble-t-il, un sujet intemporel qui ne se démode jamais.</p>
<p>Néanmoins ça reste 0.00001 % de l&#8217;informatique actuelle. Vous n&#8217;aurez pas besoin du binaire pour vos tâches de Sys Admin, vos GUI, votre app mobile, votre site Web, votre algo de simulation, etc. Bref, les trucs pour lesquels les gens sont payés dans les années 2000.</p>
<p>Maintenant que j&#8217;ai bien été désagréable avec une partie du lectorat, précisons tout de même que savoir 2, 3 trucs sur le binaire, ça ne fait pas de mal. Vous êtes informaticiens, ça fait un peu partie du folklore.</p>
<h2>Valeur et représentation</h2>
<p>En informatique, il y a le problème sans fond de la dualité valeur / représentation. L&#8217;écriture des nombres est un exemple parfait de cela.</p>
<p>Par exemple, j&#8217;ai ce nombre d&#8217;étoiles :</p>
<pre>* * * * *</pre>
<p>Il y a la valeur du nombre d&#8217;étoiles. Cette valeur ne peut pas être manipulée, elle existe, c&#8217;est tout. On ne peut que constater le nombre d&#8217;étoiles en interprétant ce que l&#8217;on voit.</p>
<p>Si on veut manipuler cette valeur (parler d&#8217;une valeur, c&#8217;est déjà manipuler la valeur), il faut lui donner une représentation.</p>
<p>Les arabes nous ont donné une représentation : 5.</p>
<p>Les romains avaient une autre représentation : V.</p>
<p>La valeur derrière ces deux représentations est strictement la même.</p>
<p>Le binaire est juste une autre représentation. Il n&#8217;y a rien de magique derrière le binaire.</p>
<p>Par exemple, la valeur que l&#8217;on représentante par 5, se représente ainsi en binaire : 101.</p>
<p>C&#8217;est la même valeur de nombre d&#8217;étoiles. Juste écrit différemment. Cela n&#8217;a aucun impact sur la réalité, ne change rien sur la nature des étoiles ou la valeur manipulée. C&#8217;est une manière de transmettre une information.</p>
<h2>A la base de la base</h2>
<p>La raison pour laquelle on s&#8217;embrouille facilement avec le binaire, c&#8217;est que la plupart d&#8217;entre nous ont appris à lire les nombres par cœur. On lit un nombre comme un tout.</p>
<p>En vérité, un nombre est une notation qui obéit à des règles très strictes, et non seulement chaque chiffre donne une information, mais <strong>sa place</strong> dans le nombre donne une information. Ce qu&#8217;on appelle &#8220;centaine&#8221;, &#8220;millier&#8221;, etc, sont des notions qu&#8217;on manipule sans y penser, mais derrière, il y a en fait un système.</p>
<p>Le système des bases.</p>
<p>Quand on utilise les chiffres arabes pour écrire un nombre, on utilise une série de symboles, et on les aligne dans un ordre précis. <strong>Selon la base utilisée, l&#8217;ordre implique une valeur différente.</strong></p>
<p>On ne s&#8217;en rend pas compte, mais on utilise tous les jours l&#8217;ordre de la base 10. On pense en base 10. On a tellement l&#8217;habitude de tout calculer en base 10 qu&#8217;on ne se rend pas compte qu&#8217;on suit une règle précise pour cela.</p>
<p>Que signifie le fait d&#8217;utiliser une base 10 ?</p>
<p>Deux choses.</p>
<p>La première, c&#8217;est que l&#8217;on a DIX symboles pour représenter DIX valeurs. On ne sait représenter directement que ces DIX valeurs là.</p>
<pre>
          0
*         1
**        2
***       3
****      4
*****     5
******    6
*******   7
********  8
********* 9</pre>
<p>On a des valeurs (un nombre d&#8217;étoiles), et on fait correspondre <strong>complètement arbitrairement</strong> dix symboles pour ces valeurs. On connait ces symboles par cœur, ce sont des conventions. Ils ne signifient rien par eux-même, nous leur avons donné cette signification.</p>
<p>Ça c&#8217;est la première règle. La deuxième règle, c&#8217;est que quand on tombe à cours de symboles parceque la valeur est trop grande, on utilise <strong>la position</strong> des symboles pour dire combien de groupes de dizaines de symboles il y a.</p>
<p>Par exemple avec ce nombre :</p>
<pre>10</pre>
<p>10 veut dire (en lisant de droite à gauche, ce sont des chiffres arabes, je le rappelle), 0 unité, et 1 groupe d&#8217;une dizaine.</p>
<p>Si on a 587, on dit (toujours de droite à gauche) : il y a 7 unités et 8 groupes d&#8217;une dizaine et 5 groupes d&#8217;une <strong>dizaine de dizaines</strong>.</p>
<p>La position du chiffre dit si l&#8217;on parle d&#8217;un groupe de 1, de 10, de 10 groupes de 10 (cent), de 10 groupes de 10 groupes de 10 (1000), etc.</p>
<p>C&#8217;est pour ça qu&#8217;on parle de base 10. Tout est en groupe de 10. On fait des paquets de 10. Puis des paquets de 10 paquets de 10. Puis des paquets de 10 paquets de 10 paquets de 10&#8230;</p>
<p>Exemple avec le nombre 1982 :</p>
<pre>
[1][9][8][2]
 |  |  |  |
 |  |  |  2 unités
 |  |  8 groupes de 10
 |  9 groupes de 10 groupes de 10 (10 x 10 = 100)
1 groupe de 10 groupes de 10 groupes de 10 (10 x 10 x 10 = 1000)</pre>
<p>Si on lit un chiffre comme un tableau en informatique (donc en commençant par 0), mais de droite à gauche, on peut utiliser les puissances pour noter ça de manière propre :</p>
<pre>
[1][9][8][2]
 |  |  |  |
 |  |  |  2 est à la place 0, sa "valeur" est 2 x 10^0 = 2 * 1 = 2
 |  |  8 est à la place 1, sa "valeur" est 8 x 10^1 = 8 * 10 = 80
 |  9 est à la place 2, sa "valeur" est 9 x 10^2 = 9 x 10 x 10 = 9 x 100 = 900
1 est à la place 3, sa "valeur" est 1 x 10^3 = 1 x 10 x 10 x 10 = 1 x 1000 = 1000</pre>
<p>Ça vous parait évident sans avoir à faire le calcul ? C&#8217;est parce que vous êtes tellement habitué à compter en base 10 que c&#8217;est automatique pour vous. Pourtant, en base 2, c&#8217;est <strong>exactement la même chose.</strong></p>
<p>On a DEUX symboles pour représenter DEUX valeurs. On ne sait représenter que ces DEUX valeurs là.</p>
<pre>
  0
* 1</pre>
<p>Quand on tombe à cours de symbole parce qu&#8217;une valeur est trop grande, on utilise <strong>la position</strong> des symboles pour dire combien de groupes de deux symboles il y a.</p>
<p>Par exemple avec ce nombre :</p>
<pre>10</pre>
<p>10, <strong>qui ne se prononce PAS dix</strong>, veut dire (en lisant de droite à gauche), 0 unité, et 1 groupe d&#8217;une paire. Donc deux en base 10 :-).</p>
<p>Pour les chiffres plus longs, c&#8217;est kiff, kiff :</p>
<pre>
[1][1][1][0]
 |  |  |  |
 |  |  |  0 unité
 |  |  1 groupes de 2
 |  1 groupes de 2 groupes de 2 (2 x 2 = 4 en base 10)
1 groupe de 2 groupes de 2 groupes de 2 (2 x 2 x 2 = 8 en base 10)</pre>
<p>Donc en base 10 : 8 + 4 + 2, soit 14.</p>
<p>Si on le représente en puissance de 2 :</p>
<pre>
[1][1][1][0]
 |  |  |  |
 |  |  |  0 est à la place 0, sa "valeur" est 0 x 2^0 = 0 * 1 = 0
 |  |  1 est à la place 1, sa "valeur" est 1 x 2^1 = 1 * 2 = 2
 |  1 est à la place 2, sa "valeur" est 1 x 2^2 = 1 x 2 x 2 = 1 x 4 = 4
1 est à la place 3, sa "valeur" est 1 x 2^3 = 1 x 2 x 2 x 2 = 1 x 8 = 8</pre>
<p>En gros pour convertir du binaire en base 10, il suffit de réciter les puissances de deux dans sa tête :</p>
<p>2, 4, 8, 16, 32&#8230; (2 fois 2 = 4, 2 fois 4 = 8, 2 fois 8 = 16, 2 fois 16 = 32&#8230;)</p>
<p>Et les appliquer de droite à gauche :</p>
<pre>[1][0][1][1][1][0] => [1 * 32] + [0 * 16] + [1 * 8] + [1 * 4] + [1 * 2] + [O * 1] => 46 en base 10</pre>
<p>Une illustration graphique ?</p>
<p>Voici quarante-six étoiles :</p>
<pre>**********************************************</pre>
<p>Si je les représente en base 10, je noterais ça 46, soit 4 groupes de dizaines, et 6 unités :</p>
<pre>
    4          6

**********   ******
**********
**********
**********
</pre>
<p>Si je le représente en base 2, je le note 101110: soit 1 groupe de trente-deux, 0 groupe de seize, 1 groupe de huit, 1 groupe de quatre, 1 groupe de deux, et 0 unité.</p>
<pre>
                1                  0      1        1     1    0

********************************   -   ********   ****   **   -</pre>
<p>On peut faire ça avec n&#8217;importe quelle base. On peut compter en base 3 (ternaire) ou en base 4, 5, 6&#8230; On utilise notamment parfois en informatique la base 8 (octale) et la base 16 (hexadécimale). Pour cette base, il y a 16 symboles : 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, A, B, C, D, E, F, représentant chacun une valeur, puis, quand on a plus de symbole, on utilise la position pour signaler un paquet de 16.</p>
<h2>Passons au code</h2>
<p>En Python on peut écrire un nombre en binaire en le préfixant de &#8217;0b&#8217;:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> 0b101110
<span style="color: #ff4500;">46</span></pre></div></div>

<p>Mais par défaut Python <strong>représente</strong> toujours à l&#8217;affichage ce nombre en base 10. La valeur derrière est la même de toute façon (qui, de manière amusante, est sockée en binaire).</p>
<p>Si vous voulez forcer <strong>l&#8217;affichage</strong> du nombre en binaire, vous pouvez utilisez <code>bin()</code> ou <code>format()</code> :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #483d8b;">'Le nombre {0} en binaire donne : {0:b}'</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">46</span><span style="color: black;">&#41;</span>
u<span style="color: #483d8b;">'Le nombre 46 en binaire donne : 101110'</span>
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> bin<span style="color: black;">&#40;</span><span style="color: #ff4500;">46</span><span style="color: black;">&#41;</span>
<span style="color: #483d8b;">'0b101110'</span></pre></div></div>

<p>A l&#8217;inverse, si vous avez une représentation textuelle d&#8217;un chiffre binaire, vous pouvez préciser la base via le second paramètre de <code>int()</code> :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">int</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'101110'</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># la base 10 est le réglage par défaut...</span>
<span style="color: #ff4500;">101110</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">int</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'101110'</span>, <span style="color: #ff4500;">10</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># ...donc on récupère cent un mille cent dix.</span>
<span style="color: #ff4500;">101110</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">int</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'101110'</span>, <span style="color: #ff4500;">2</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># si on précise la base 2, on récupère quarante-six.</span>
<span style="color: #ff4500;">46</span></pre></div></div>

<p>Mais si on n&#8217;a pas codé sa petite fonction pour faire pareil à la main à 50 ans, on a raté sa vie. Donc, voici un exemple simple d&#8217;une fonction qui convertit une représentation textuelle d&#8217;un chiffre binaire en int Python :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">def</span> bin2dec<span style="color: black;">&#40;</span>s<span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #808080; font-style: italic;"># on rejette les chaînes vides</span>
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> s:
        <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">ValueError</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'The string cannot be empty'</span><span style="color: black;">&#41;</span>
&nbsp;
    total = <span style="color: #ff4500;">0</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># on itère sur la chaîne, de droite à gauche</span>
    reversed_number = s<span style="color: black;">&#91;</span>::-<span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span>
    <span style="color: #ff7700;font-weight:bold;">for</span> pos, num <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">enumerate</span><span style="color: black;">&#40;</span>reversed_number<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #808080; font-style: italic;"># on multiplie le chiffre en cours par la puissance de 2</span>
        <span style="color: #808080; font-style: italic;"># qui correspond à sa position</span>
        total += <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>num<span style="color: black;">&#41;</span> <span style="color: #66cc66;">*</span> <span style="color: black;">&#40;</span><span style="color: #ff4500;">2</span> <span style="color: #66cc66;">**</span> pos<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">return</span> total
&nbsp;
<span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>bin2dec<span style="color: black;">&#40;</span><span style="color: #483d8b;">'0'</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>bin2dec<span style="color: black;">&#40;</span><span style="color: #483d8b;">'1'</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>bin2dec<span style="color: black;">&#40;</span><span style="color: #483d8b;">'10'</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>bin2dec<span style="color: black;">&#40;</span><span style="color: #483d8b;">'101'</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>bin2dec<span style="color: black;">&#40;</span><span style="color: #483d8b;">'10011100'</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">## 0</span>
<span style="color: #808080; font-style: italic;">## 1</span>
<span style="color: #808080; font-style: italic;">## 2</span>
<span style="color: #808080; font-style: italic;">## 5</span>
<span style="color: #808080; font-style: italic;">## 156</span></pre></div></div>

<p>Et la fonction inverse :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">__future__</span> <span style="color: #ff7700;font-weight:bold;">import</span> division <span style="color: #808080; font-style: italic;"># pour être tous d'accord sur la division entière</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> dec2bin<span style="color: black;">&#40;</span>i<span style="color: black;">&#41;</span>:
&nbsp;
    numbers = <span style="color: black;">&#91;</span><span style="color: black;">&#93;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> i == <span style="color: #ff4500;">0</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> i
&nbsp;
    <span style="color: #808080; font-style: italic;"># On divise (avec la division entière) par deux jusqu'à ce qu'il ne reste</span>
    <span style="color: #808080; font-style: italic;"># plus rien à diviser (on fait des paquets de 2, quoi).</span>
    <span style="color: #808080; font-style: italic;"># Avant chaque division par deux, on regarde si il y aura un reste</span>
    <span style="color: #808080; font-style: italic;"># pour la prochaine division. Si oui, on met 1 pour le paquet de 2 actuel,</span>
    <span style="color: #808080; font-style: italic;"># sinon on met 0.</span>
    <span style="color: #808080; font-style: italic;"># C'est comme pour la multiplication à la main (&quot;je met 2 et je retiens 1&quot;),</span>
    <span style="color: #808080; font-style: italic;"># mais à l'envers.</span>
    <span style="color: #ff7700;font-weight:bold;">while</span> i <span style="color: #66cc66;">!</span>= <span style="color: #ff4500;">0</span>:
        numbers.<span style="color: black;">append</span><span style="color: black;">&#40;</span><span style="color: #008000;">str</span><span style="color: black;">&#40;</span>i <span style="color: #66cc66;">%</span> <span style="color: #ff4500;">2</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
        i = i // <span style="color: #ff4500;">2</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Ensuite on inverse tout ça et on join() tout en une belle string</span>
    <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">''</span>.<span style="color: black;">join</span><span style="color: black;">&#40;</span>numbers<span style="color: black;">&#91;</span>::-<span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>dec2bin<span style="color: black;">&#40;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>dec2bin<span style="color: black;">&#40;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>dec2bin<span style="color: black;">&#40;</span><span style="color: #ff4500;">2</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>dec2bin<span style="color: black;">&#40;</span><span style="color: #ff4500;">5</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>dec2bin<span style="color: black;">&#40;</span><span style="color: #ff4500;">156</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">## 0</span>
<span style="color: #808080; font-style: italic;">## 1</span>
<span style="color: #808080; font-style: italic;">## 10</span>
<span style="color: #808080; font-style: italic;">## 101</span>
<span style="color: #808080; font-style: italic;">## 10011100</span></pre></div></div>

<h2>Et les opérateurs bitwise ?</h2>
<p>Dans les tutos on voit souvent mélanger la notion de binaire, avec la représentation des nombres, du texte, et les opérateurs spécialisés dans la manipulation du binaire : </p>
<pre>|, ^, ~, >>, <<, >>>, &#038;, etc</pre>
<p>C&#8217;est le bordel.</p>
<p>On les appelle ces opérateurs &#8220;bitwise&#8221;, et ils sont essentiellement de deux types : les shifts, et les opérateurs logiques.</p>
<p>Les shifts, souvent notés <code>&gt;&gt;</code>, <code>&lt;&lt;</code>, etc, décalent d&#8217;un bit. Un bit, c&#8217;est une case dans un nombre binaire, une d&#8217;un chiffre position, qui prend donc la valeur 0 ou 1.</p>
<p>Ex: 1010 est un nombre de 4 bits. 10100 est un nombre de 5 bits.</p>
<p>Par décaler, j&#8217;entends qu&#8217;ils poussent littéralement les bits dans un sens ou dans l&#8217;autre :</p>
<p>1010 &gt;&gt; 1 va donner 101 (les bits se sont décalés vers la droite d&#8217;un cran, c&#8217;est le rshift). Ca fait disparaitre un bit à droite.<br />
1010 &lt;&lt; 1 va donner 10100 (les bits se sont décalés vers la gauche d&#8217;un cran, c&#8217;est le lshift). Ca rajoute un bit à droite.</p>
<p>Si on met un plus grand nombre, on décale de plusieurs bits :</p>
<p>1010 &lt;&lt; 3 va donner 1010000 (les bits se sont décalés vers la gauche de 3 crans)</p>
<p>C&#8217;est une opération très rapide, puisqu&#8217;il suffit de décaler les chiffres, sans faire de calculs complexes. Pourtant, c&#8217;est l&#8217;équivalent de certaines opérations mathématiques.</p>
<p>Par exemple, un lshift peut être équivalent à une multiplication par une puissance de 2.</p>
<p>Ainsi, si je prends le chiffre 10 en (binaire 1010), et que je lui applique un lshift de 3, c&#8217;est comme si je le multipliais par 2^3 (soit 8). Démo en Python :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> 0b1010
<span style="color: #ff4500;">10</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> 0b1010 <span style="color: #66cc66;">&lt;&lt;</span> <span style="color: #ff4500;">3</span>
<span style="color: #ff4500;">80</span></pre></div></div>

<p>Mais l&#8217;opération prend beaucoup moins de cycles CPU qu&#8217;une multiplication. C&#8217;est une astuce d&#8217;optimisation qui a été beaucoup utilisée au paléolithique et qui reste en vigueur chez les cryptonerds. Néanmoins ne l&#8217;utilisez pas en Python, les gains sont minimes. C&#8217;est surtout utile pour les codes C ou assembleur qui sont déjà sur optimisés et ont besoin de ce petit coup de pouce supplémentaire.</p>
<p>Ensuite il y a les opérateurs logiques. Ils appliquent tout simplement la logique booléenne à chaque bit d&#8217;un nombre avec chaque bit d&#8217;un autre nombre dont la position correspond. Par exemple :</p>
<p>Si je fais &#8220;1101 ET (représenté souvent par &#8216;&#038;&#8217;) 110&#8243;, je vais obtenir :</p>
<pre>
[1][1][0][1]
 |  |  |  |
 &#038;  &#038;  &#038;  &#038;
 |  |  |  |
[ ][1][1][0]
 |  |  |  |
 v  v  v  v
 0  1  0  0

1 et rien => vrai ET faux ? => faux => 0
1 et 1 => vrai ET vrai ? => vrai => 1
0 et 1 => faux ET vrai ? => faux => 0
1 et 0 => faux ET vrai ? => faux => 0
</pre>
<p>C&#8217;est de la logique booléenne de base, vous pouvez la tester avec <code>True</code>, <code>False</code>, <code>and</code> et <code>or</code> dans votre shell si ça ne vous parle pas.</p>
<p>En code Python :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> bin<span style="color: black;">&#40;</span>0b1101 <span style="color: #66cc66;">&amp;</span> 0b100<span style="color: black;">&#41;</span>
<span style="color: #483d8b;">'0b100'</span></pre></div></div>

<p>On l&#8217;utilise parfois pour faire ce qu&#8217;on appelle des &#8220;masques&#8221;, c&#8217;est à dire représenter une série d&#8217;états sous forme de grille de bits, et changer un état de cette grille en appliquant une opération logique avec une autre grille.</p>
<p>Je sais, ça fait flou comme ça. Un exemple peut-être ?</p>
<p>Les permissions d&#8217;un fichiers Unix sont Read (lire), Write (écrire) et Execute (exécuter). Soit &#8220;rwx&#8221;. Elles s&#8217;appliquent à User (utilisateur), Group (groupe), Other (autre), soit &#8220;ugo&#8221;.</p>
<p>Cela est peut être représenté par 3 groupes de 3 bits, soit 9 bits :</p>
<pre>
    U         G         O
[r][w][x] [r][w][x] [r][w][x]</pre>
<p>1 veut dire que la permission est donnée, 0 veut dire qu&#8217;elle n&#8217;est pas donnée.</p>
<p>Ainsi :</p>
<pre>
[1][1][1] [1][0][1] [1][0][1]</pre>
<p>Veut dire que l&#8217;utilisateur à le droit de lire, écrire et exécuter le fichier. Le groupe et les autres n&#8217;ont que le droit de le lire et exécuter le fichier.</p>
<p>Si vous mettez ça en base 10, ça donne 7/5/5 (et NON sept-cent-cinquante-cinq car il y a 3 valeurs). Cela  explique le fameux <code>chmod 755</code> que vous voyez dans tous les tutos bash.</p>
<p>Si vous faites :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">chmod</span> g+<span style="color: #c20cb9; font-weight: bold;">w</span> fichier</pre></div></div>

<p>Le programme va rajouter la permission d&#8217;écrire au groupe. On peut représenter cette opération par l&#8217;application d&#8217;une opération &#8220;OU&#8221; (représentée par &#8216;|&#8217;) :</p>
<p>En effet on a 101 pour les permissions du groupe et on veut obtenir 111. Il suffit d&#8217;appliquer le masque 010 (qui correspond pile poil à un 1 à la case de la permission voulue) :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> bin<span style="color: black;">&#40;</span>0b101 | 0b010<span style="color: black;">&#41;</span>
<span style="color: #483d8b;">'0b111'</span></pre></div></div>

<h2>Représentation des nombres dans un ordinateur</h2>
<p>Cette partie c&#8217;est vraiment pour vos beaux yeux hein, ne vous en faites pas si vous ne pigez pas tout. Je ne vais pas dans le détail car ça demanderait un autre article complet, plus un comparatif des archis, des notions, des systèmes de typages des langages, etc. Et j&#8217;ai vraiment pas envie de le faire.</p>
<p>Bon, déjà, la représentation des nombres dans un ordi, c&#8217;est une grande source de confusion : en effet, <strong>l’ordinateur ne stocke pas la représentation binaire directe d&#8217;un nombre</strong>.</p>
<p>On pourrait se dire : l’ordinateur manipule du binaire, on traduit nos nombres en binaire, on fout tout tel quel dedans, et yala.</p>
<p>Mais un ordinateur a des limitations techniques. Notamment, il possède des plages de mémoires d&#8217;un nombre de bits limité. Il faut donc faire tenir la représentation de la valeur sur cet espace limité.</p>
<p>Si votre espace de mémoire pour représenter une valeur est limité à 16 bits et que vous devez stocker un nombre entier dedans, il pourra être au maximum 2^16 &#8211; 1 = 65535.</p>
<p>C&#8217;est pour cela qu&#8217;en C on déclare le type d&#8217;une variable qui va contenir un nombre qu&#8217;on va manipuler. On dit clairement, &#8220;alloue moi cet espace mémoire, mon nombre ne sera jamais plus grand que ça&#8221;. En Python, c&#8217;est automatiquement et transparent.</p>
<p>(C&#8217;est aussi pour ça qu&#8217;on parle de processeur 16bits, 32bits, 64bits, etc. C&#8217;est la taille des jeux d&#8217;instructions qu&#8217;ils sont capables de traiter en un cycle.)</p>
<p>Mais il se rajoute une autre complexité : un entier peut avoir un signe plus ou un signe moins. Il faut bien le représenter quelque part. On peut le faire en utilisant le premier bit, mais aussi avec un format appelé &#8220;le complément à deux&#8221;. Comme cet article est déjà super long, je vais pas me lancer dans l&#8217;explication. J&#8217;ai mal aux doigts. Sachez juste qu&#8217;on utilise en quelque sorte &#8220;l&#8217;inverse&#8221; du nombre.</p>
<p>Encore une fois, en C, on déclare que l&#8217;on va utiliser un &#8220;signed int&#8221; ou un &#8220;unsigned int&#8221; à l&#8217;initialisation d&#8217;une variable.</p>
<p>Enfin, il y a les nombres à virgule, aussi appelés &#8220;flottants&#8221; (d&#8217;où le type &#8220;float&#8221; en Python).</p>
<p>On pourrait se dire qu&#8217;on utilise les puissances de deux négatives :</p>
<p>0.92 se lit en base 10 &#8220;0 x 1 + 9 x 10^-1 + 2 x 10^-2&#8243;</p>
<p>On garderait la logique des positions.</p>
<p>Donc :</p>
<p>0.11 se lit en base 2 &#8220;0 x 1 + 1 x 2^-1 + 1 x 2^-1 + 1 x 2^-2&#8243;</p>
<p>A priori on pourrait stocker le nombre en utilisant ce principe. Mais ça ne permet pas de présenter les nombres très grands (tendant vers l&#8217;infini) ou très petit (tendant vers zéro). Alors on utilise un autre principe : on représente un nombre avec la formule <code>m x 2^n</code>, très couramment sur 64 bits (ce que fait le type float Python, mais on peut avoir <a href="http://docs.scipy.org/doc/numpy/user/basics.types.html">plus de choix</a> de manoeuvre en utilisant numpy).</p>
<p><code>m</code> est un nombre à virgule compris entre 1 et 2 (ce dernier étant exclus). On appelle ça la mantisse. Ce sera stocké sur 52 bits en utilisant une représentation binaire littérale.</p>
<p><code>n</code> est l&#8217;exposant, c&#8217;est un nombre entier compris entre -1022 et 1023, stocké sur 11 bits.</p>
<p>On garde le premier bit pour le signe.</p>
<p>Et il y a des exceptions pour 0, l&#8217;infini et NaN.</p>
<p>(et je n&#8217;ai pas la moindre putain d&#8217;idée de comment sont représentés les complexes)</p>
<p>Si vous êtes en manque d&#8217;aspirine, tout ça est codifié dans la norme <a href="http://fr.wikipedia.org/wiki/IEEE_754">IEEE 754</a>, que Python respecte scrupuleusement.</p>
<p>Mais ça vous fait une belle jambe pas vrai ?</p>
<p>Tout ça pour dire que même avec une belle précision, le nombre de chiffres stockés après la virgule est limité. Du coup, on a une valeur <strong>approximative</strong> stockée dans l&#8217;ordi, ce qui fait que les calculs se font sur des approximations :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #483d8b;">&quot;{0:.35f}&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">0.9999999999999999999999999999999999999999999999999999999</span> + <span style="color: #ff4500;">0.000000000000000000001</span><span style="color: black;">&#41;</span>
u<span style="color: #483d8b;">'1.00000000000000000000000000000000000'</span></pre></div></div>

<p>En Python on peut gagner en précision en utilisant le module <code>decimal</code>:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">decimal</span> <span style="color: #ff7700;font-weight:bold;">import</span> Decimal
<span style="color: #66cc66;">&gt;&gt;&gt;</span> Decimal<span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;0.9999999999999999999999999999999999999999999999999999999&quot;</span><span style="color: black;">&#41;</span> + Decimal<span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;0.000000000000000000001&quot;</span><span style="color: black;">&#41;</span>
Decimal<span style="color: black;">&#40;</span><span style="color: #483d8b;">'1.000000000000000000001000000'</span><span style="color: black;">&#41;</span></pre></div></div>

<p>C&#8217;est plus lent, mais plus intuitif. Quand on manipule des sous, du temps, des unités de poids, de température, de longueur, etc, c&#8217;est utile.</p>
<h2>Représentation du texte</h2>
<p>Pour le texte, c&#8217;est encore autre chose. Et là je vous renvoie à l&#8217;<a href="http://sametmax.com/lencoding-en-python-une-bonne-fois-pour-toute/">article sur les encodings</a>.</p>
<p>En résumé, le stockage du texte n&#8217;a rien à avoir avec l&#8217;arithmétique binaire, c&#8217;est juste qu&#8217;on fait correspondre un nombre (on montre souvent sa représentation binaire pour l&#8217;ASCII et sa représentation hexa pour l&#8217;unicode, mais ça reste un nombre, point) à un caractère. Il y a un grand tableau en mémoire qui fait cette correspondance de manière totalement arbitraire. </p>
<p><strong>C&#8217;est une norme arbitraire de correspondance, c&#8217;est tout.</strong></p>
<p>Donc quand on vous dit &#8220;ecrivez les mots &#8216;glory hole&#8217; en binaire&#8221;, <strong>ça ne veut rien dire</strong>.</p>
<p>Une bonne consigne serait de dire : &#8220;donnez moi la suite de nombres, représentés sous forme binaire, qui corresponde aux caractères qui compose les mots &#8216;glory hole&#8217; selon l&#8217;encoding ASCII&#8221;.</p>
<p>On peut obtenir la valeur numérique ASCII en utilisant <code>ord()</code> en Python :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #483d8b;">'glory hole'</span>:
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #008000;">ord</span><span style="color: black;">&#40;</span>x<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
...
<span style="color: #ff4500;">103</span>
<span style="color: #ff4500;">108</span>
<span style="color: #ff4500;">111</span>
<span style="color: #ff4500;">114</span>
<span style="color: #ff4500;">121</span>
<span style="color: #ff4500;">32</span>
<span style="color: #ff4500;">104</span>
<span style="color: #ff4500;">111</span>
<span style="color: #ff4500;">108</span>
<span style="color: #ff4500;">101</span></pre></div></div>

<p>Après, c&#8217;est juste du formatage pour afficher le binaire :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #483d8b;">'glory hole'</span>:
...     <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;{:b}&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: #008000;">ord</span><span style="color: black;">&#40;</span>x<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
...
<span style="color: #ff4500;">1100111</span>
<span style="color: #ff4500;">1101100</span>
<span style="color: #ff4500;">1101111</span>
<span style="color: #ff4500;">1110010</span>
<span style="color: #ff4500;">1111001</span>
<span style="color: #ff4500;">100000</span>
<span style="color: #ff4500;">1101000</span>
<span style="color: #ff4500;">1101111</span>
<span style="color: #ff4500;">1101100</span>
<span style="color: #ff4500;">1100101</span></pre></div></div>

 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=8808&amp;md5=d36e3a0ab4132d5ca90d332dc6b67d99" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/la-fin-du-mystere-du-binaire-nananere/feed/</wfw:commentRss>
		<slash:comments>46</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fla-fin-du-mystere-du-binaire-nananere%2F&amp;language=en_GB&amp;category=text&amp;title=La+fin+du+myst%C3%A8re+du+binaire+%28nanan%C3%A8re%29&amp;description=Quand+mon+voisin+de+table+en+cours+de+SVT+a+commenc%C3%A9+%C3%A0+m%26%238217%3Bexpliquer+le+binaire+%28il+programmait+en+assembleur+sur+sa+TI89%29%2C+j%26%238217%3Bai+pas+bien+pig%C3%A9.+Des+ann%C3%A9es+plus+tard%2C...&amp;tags=base+10%2Cbase+2%2Cbinaire%2Cpython%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2014/01/JQXdcds.gif" length="511572" type="image/jpg" />	</item>
		<item>
		<title>Django, une app à la fois &#8211; faire une app de base</title>
		<link>http://sametmax.com/django-une-app-a-la-fois-faire-une-app-de-base/</link>
		<comments>http://sametmax.com/django-une-app-a-la-fois-faire-une-app-de-base/#comments</comments>
		<pubDate>Sat, 18 Jan 2014 15:22:24 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[django]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[template]]></category>
		<category><![CDATA[view]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=8789</guid>
		<description><![CDATA[Voici un nouveau morceau qui montre comment écrire une petite app de base avec un template et une vue réutilisable qui serviront donc dans les prochaines apps du projets.
]]></description>
			<content:encoded><![CDATA[<p>Ca faisait longtemps que je n&#8217;avais pas fait avancer le projet <a href="http://sametmax.com/django-une-app-a-la-fois/">django, an app at a time</a>.</p>
<p>Voici donc un nouveau morceau qui montre comment écrire une petite app de base avec un template et une vue réutilisables qui serviront donc dans les prochaines apps du projet.</p>
<p>Comme d&#8217;hab, vous pouvez récupérer le code sur <a href="https://github.com/sametmax/Django--an-app-at-a-time">la teub de Guy</a> et il y a une version française et anglaise.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=8789&amp;md5=5af69319290f2c2a9532c4eebdaf3d40" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/django-une-app-a-la-fois-faire-une-app-de-base/feed/</wfw:commentRss>
		<slash:comments>2</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fdjango-une-app-a-la-fois-faire-une-app-de-base%2F&amp;language=en_GB&amp;category=text&amp;title=Django%2C+une+app+%C3%A0+la+fois+%26%238211%3B+faire+une+app+de+base&amp;description=Ca+faisait+longtemps+que+je+n%26%238217%3Bavais+pas+fait+avancer+le+projet+django%2C+an+app+at+a+time.+Voici+donc+un+nouveau+morceau+qui+montre+comment+%C3%A9crire+une+petite+app+de...&amp;tags=django%2Cpython%2Ctemplate%2Cview%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2014/01/vghvgMc.jpg" length="111945" type="image/jpg" />	</item>
		<item>
		<title>En attendant asyncio</title>
		<link>http://sametmax.com/en-attendant-asyncio/</link>
		<comments>http://sametmax.com/en-attendant-asyncio/#comments</comments>
		<pubDate>Fri, 17 Jan 2014 14:09:59 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[asynchrone]]></category>
		<category><![CDATA[asyncio]]></category>
		<category><![CDATA[future]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=8781</guid>
		<description><![CDATA[La programmation asynchrone arrive en force avec la version 3.4, mais celle-ci n'est pas encore en version stable. En attendant, Python 3 possède déjà de quoi faire de la programmation asynchrone, et même parallèle, avec une bien plus grande facilité qu'en Python 2.]]></description>
			<content:encoded><![CDATA[<p>La programmation asynchrone arrive en force avec la version 3.4, mais celle-ci n&#8217;est pas encore en version stable. En attendant, Python 3 possède déjà de quoi faire de la programmation asynchrone, et même parallèle, avec une bien plus grande facilité qu&#8217;en Python 2.</p>
<p>Si vous avez oublié le principe ou l’intérêt de la programmation asynchrone, <a href="http://sametmax.com/la-difference-entre-la-programmation-asynchrone-parallele-et-concurrente/">il y a un article pour ça</a> ©.</p>
<p>Pour montrer l’intérêt de la chose, nous allons utiliser un bout de code pour télécharger le code HTML de pages Web.</p>
<h2>Sans programmation asynchrone</h2>
<p>Le code est simple et sans chichi :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># -*- coding: utf-8 -*-</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">datetime</span>
<span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">urllib</span>.<span style="color: black;">request</span> <span style="color: #ff7700;font-weight:bold;">import</span> urlopen
&nbsp;
start_time = <span style="color: #dc143c;">datetime</span>.<span style="color: #dc143c;">datetime</span>.<span style="color: black;">now</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
URLS = <span style="color: black;">&#91;</span><span style="color: #483d8b;">'http://sebsauvage.net/'</span>,
        <span style="color: #483d8b;">'http://github.com/'</span>,
        <span style="color: #483d8b;">'http://sametmax.com/'</span>,
        <span style="color: #483d8b;">'http://duckduckgo.com/'</span>,
        <span style="color: #483d8b;">'http://0bin.net/'</span>,
        <span style="color: #483d8b;">'http://bitstamp.net/'</span><span style="color: black;">&#93;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">for</span> url <span style="color: #ff7700;font-weight:bold;">in</span> URLS:
    <span style="color: #ff7700;font-weight:bold;">try</span>:
        <span style="color: #808080; font-style: italic;"># j'ignore volontairement toute gestion d'erreur évoluée</span>
        result = urlopen<span style="color: black;">&#40;</span>url<span style="color: black;">&#41;</span>.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'%s page: %s bytes'</span> <span style="color: #66cc66;">%</span> <span style="color: black;">&#40;</span>url, <span style="color: #008000;">len</span><span style="color: black;">&#40;</span>result<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">Exception</span> <span style="color: #ff7700;font-weight:bold;">as</span> e:
        <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'%s generated an exception: %s'</span> <span style="color: #66cc66;">%</span> <span style="color: black;">&#40;</span>url, e<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
elsapsed_time = <span style="color: #dc143c;">datetime</span>.<span style="color: #dc143c;">datetime</span>.<span style="color: black;">now</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> - start_time
&nbsp;
<span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Elapsed time: %ss&quot;</span> <span style="color: #66cc66;">%</span> elsapsed_time.<span style="color: black;">total_seconds</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>Ce qui nous donne:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">python sans_future.py
http:<span style="color: #000000; font-weight: bold;">//</span>sebsauvage.net<span style="color: #000000; font-weight: bold;">/</span> page: <span style="color: #000000;">9036</span> bytes
http:<span style="color: #000000; font-weight: bold;">//</span>github.com<span style="color: #000000; font-weight: bold;">/</span> page: <span style="color: #000000;">12582</span> bytes
http:<span style="color: #000000; font-weight: bold;">//</span>sametmax.com<span style="color: #000000; font-weight: bold;">/</span> generated an exception: HTTP Error <span style="color: #000000;">502</span>: Bad Gateway
http:<span style="color: #000000; font-weight: bold;">//</span>duckduckgo.com<span style="color: #000000; font-weight: bold;">/</span> page: <span style="color: #000000;">8826</span> bytes
http:<span style="color: #000000; font-weight: bold;">//</span>0bin.net<span style="color: #000000; font-weight: bold;">/</span> page: <span style="color: #000000;">5551</span> bytes
http:<span style="color: #000000; font-weight: bold;">//</span>bitstamp.net<span style="color: #000000; font-weight: bold;">/</span> page: <span style="color: #000000;">51996</span> bytes
Elapsed <span style="color: #000000; font-weight: bold;">time</span>: 25.536095s</pre></div></div>

<p>Erreur 500 sur S&#038;M&#8230; Mon script qui se fout de ma gueule en plus&#8230;</p>
<h2>Avec programmation asynchrone</h2>
<p>On utilise le module <a href="http://docs.python.org/3.2/library/concurrent.futures.html">future</a>, qui, comme sont nom l&#8217;indique, implémente des outils pour manipuler des &#8220;futures&#8221; en Python. Il inclut notamment un context manager pour créer, lancer et arrêter des workers automatiquement, et leur envoyer des tâches, puis récupérer les résultats de ces tâches sous forme de &#8220;futures&#8221;.</p>
<p>Pour rappel, une &#8220;future&#8221; est juste un objet qui représente le résultat d&#8217;une opération asynchrone (puisqu&#8217;on ne sait pas quand elle se termine). Cet objet contient des méthodes pour vérifier si le résultat est disponible à un instant t, et obtenir ce résultat si c&#8217;est le cas.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># -*- coding: utf-8 -*-</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">datetime</span>
<span style="color: #ff7700;font-weight:bold;">import</span> concurrent.<span style="color: black;">futures</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">urllib</span>.<span style="color: black;">request</span> <span style="color: #ff7700;font-weight:bold;">import</span> urlopen
<span style="color: #ff7700;font-weight:bold;">from</span> concurrent.<span style="color: black;">futures</span> <span style="color: #ff7700;font-weight:bold;">import</span> ProcessPoolExecutor, as_completed
&nbsp;
start_time = <span style="color: #dc143c;">datetime</span>.<span style="color: #dc143c;">datetime</span>.<span style="color: black;">now</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
URLS = <span style="color: black;">&#91;</span><span style="color: #483d8b;">'http://sebsauvage.net/'</span>,
        <span style="color: #483d8b;">'http://github.com/'</span>,
        <span style="color: #483d8b;">'http://sametmax.com/'</span>,
        <span style="color: #483d8b;">'http://duckduckgo.com/'</span>,
        <span style="color: #483d8b;">'http://0bin.net/'</span>,
        <span style="color: #483d8b;">'http://bitstamp.net/'</span><span style="color: black;">&#93;</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> load_url<span style="color: black;">&#40;</span>url<span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot;
        Le callback que vont appeler les workers pour télécharger le contenu
        d'un site. On peut appeler cela une 'tâche'
    &quot;&quot;&quot;</span>
    <span style="color: #ff7700;font-weight:bold;">return</span> urlopen<span style="color: black;">&#40;</span>url<span style="color: black;">&#41;</span>.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Un pool executor est un context manager qui va automatiquement créer des</span>
<span style="color: #808080; font-style: italic;"># processus Python séparés et répartir les tâches qu'on va lui envoyer entre</span>
<span style="color: #808080; font-style: italic;"># ces processus (appelés workers, ici on en utilise 5).</span>
<span style="color: #ff7700;font-weight:bold;">with</span> ProcessPoolExecutor<span style="color: black;">&#40;</span>max_workers=<span style="color: #ff4500;">5</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> e:
&nbsp;
    <span style="color: #808080; font-style: italic;"># On e.submit() envoie les tâches à l'executor qui les dispatch aux</span>
    <span style="color: #808080; font-style: italic;"># workers. Ces derniers appelleront &quot;load_url(url)&quot;. &quot;e.submit()&quot; retourne</span>
    <span style="color: #808080; font-style: italic;"># une structure de données appelées &quot;future&quot;, qui représente  un accès au</span>
    <span style="color: #808080; font-style: italic;"># résultat asynchrone, qu'il soit résolu ou non.</span>
    futures_and_url = <span style="color: black;">&#123;</span>e.<span style="color: black;">submit</span><span style="color: black;">&#40;</span>load_url, url<span style="color: black;">&#41;</span>: url <span style="color: #ff7700;font-weight:bold;">for</span> url <span style="color: #ff7700;font-weight:bold;">in</span> URLS<span style="color: black;">&#125;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># &quot;as_completed()&quot; prend un iterable de future, et retourne un générateur</span>
    <span style="color: #808080; font-style: italic;"># qui itère sur les futures au fur et à mesures que celles</span>
    <span style="color: #808080; font-style: italic;"># ci sont résolues. Les premiers résultats sont donc les premiers arrivés,</span>
    <span style="color: #808080; font-style: italic;"># donc on récupère le contenu des sites qui ont été les premiers à répondre</span>
    <span style="color: #808080; font-style: italic;"># en premier, et non dans l'ordre des URLS.</span>
    <span style="color: #ff7700;font-weight:bold;">for</span> future <span style="color: #ff7700;font-weight:bold;">in</span> as_completed<span style="color: black;">&#40;</span>futures_and_url<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #808080; font-style: italic;"># Une future est hashable, et peut donc être une clé de dictionnaire.</span>
        <span style="color: #808080; font-style: italic;"># On s'en sert ici pour récupérer l'URL correspondant à cette future.</span>
        url = futures_and_url<span style="color: black;">&#91;</span>future<span style="color: black;">&#93;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># On affiche le résultats contenu des sites si les futures le contienne.</span>
        <span style="color: #808080; font-style: italic;"># Si elles contiennent une exception, on affiche l'exception.</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> future.<span style="color: black;">exception</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #008000;">None</span>:
            <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'%s generated an exception: %s'</span> <span style="color: #66cc66;">%</span> <span style="color: black;">&#40;</span>url, future.<span style="color: black;">exception</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'%s page: %s bytes'</span> <span style="color: #66cc66;">%</span> <span style="color: black;">&#40;</span>url, <span style="color: #008000;">len</span><span style="color: black;">&#40;</span>future.<span style="color: black;">result</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
elsapsed_time = <span style="color: #dc143c;">datetime</span>.<span style="color: #dc143c;">datetime</span>.<span style="color: black;">now</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> - start_time
&nbsp;
<span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Elapsed time: %ss&quot;</span> <span style="color: #66cc66;">%</span> elsapsed_time.<span style="color: black;">total_seconds</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>Et c&#8217;est quand même vachement plus rapide :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">python3 avec_future.<span style="color: black;">py</span> <span style="color: #808080; font-style: italic;"># notez qu'on utilise Python 3 cette fois</span>
http://duckduckgo.<span style="color: black;">com</span>/ page: <span style="color: #ff4500;">8826</span> <span style="color: #dc143c;">bytes</span>
http://sebsauvage.<span style="color: black;">net</span>/ page: <span style="color: #ff4500;">9036</span> <span style="color: #dc143c;">bytes</span>
http://github.<span style="color: black;">com</span>/ page: <span style="color: #ff4500;">12582</span> <span style="color: #dc143c;">bytes</span>
http://sametmax.<span style="color: black;">com</span>/ page: <span style="color: #ff4500;">50998</span> <span style="color: #dc143c;">bytes</span>
http://0bin.<span style="color: black;">net</span>/ page: <span style="color: #ff4500;">5551</span> <span style="color: #dc143c;">bytes</span>
http://bitstamp.<span style="color: black;">net</span>/ page: <span style="color: #ff4500;">52001</span> <span style="color: #dc143c;">bytes</span>
Elapsed <span style="color: #dc143c;">time</span>: 3.480596s</pre></div></div>

<p>Même si vous retirez les commentaires, le code est encore très verbeux, ce qui explique pourquoi j&#8217;attends avec impatience <a href="http://www.python.org/dev/peps/pep-3156/">asyncio</a> qui, grâce à <code>yield from</code>, va intégrer l&#8217;asynchrone de manière plus naturelle au langage.</p>
<p>Mais ça reste beaucoup plus simple que de créer son process à la main, créer une queue, envoyer les tâches dans la queue, s&#8217;assurer que le process est arrêté, gérer les erreurs et le clean up, etc.</p>
<p>Notez qu&#8217;on peut remplacer <code>ProcessPoolExecutor</code> par <code>ThreadPoolExecutor</code> si vous n&#8217;avez pas besoin d&#8217;un process séparé mais juste de l&#8217;IO non bloquant.</p>
<hr />
<p>Télécharger le code de larticle : <a href="https://github.com/sametmax/codes-des-articles/blob/master/2014/janvier/avec_future.py">avec future</a> / <a href="https://github.com/sametmax/codes-des-articles/blob/master/2014/janvier/sans_future.py">sans future</a>.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=8781&amp;md5=edd20d1bc83a2cbb327cddfcb1fb3116" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/en-attendant-asyncio/feed/</wfw:commentRss>
		<slash:comments>14</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fen-attendant-asyncio%2F&amp;language=en_GB&amp;category=text&amp;title=En+attendant+asyncio&amp;description=La+programmation+asynchrone+arrive+en+force+avec+la+version+3.4%2C+mais+celle-ci+n%26%238217%3Best+pas+encore+en+version+stable.+En+attendant%2C+Python+3+poss%C3%A8de+d%C3%A9j%C3%A0+de+quoi+faire+de+la+programmation...&amp;tags=asynchrone%2Casyncio%2Cfuture%2Cpython%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2014/01/IMG_7832.jpg" length="84993" type="image/jpg" />	</item>
	</channel>
</rss>
