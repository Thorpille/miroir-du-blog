<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Sam &#38; Max: Python, Django, Git et du cul &#187; lettuce</title>
	<atom:link href="http://sametmax.com/tag/lettuce/feed/" rel="self" type="application/rss+xml" />
	<link>http://sametmax.com</link>
	<description>Deux développeurs en vadrouille qui se sortent les doigts du code</description>
	<lastBuildDate>Wed, 05 Feb 2014 14:20:37 +0000</lastBuildDate>
	<language>en</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.3.1</generator>
	<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2F&amp;language=en_US&amp;category=text&amp;title=Sam+%26amp%3B+Max%3A+Python%2C+Django%2C+Git+et+du+cul&amp;description=Deux+d%C3%A9veloppeurs+en+vadrouille+qui+se+sortent+les+doigts+du+code&amp;tags=blog" type="text/html" />
		<item>
		<title>Lettuce (and cucumber) is bullshit</title>
		<link>http://sametmax.com/lettuce-and-cucumber-is-bullshit/</link>
		<comments>http://sametmax.com/lettuce-and-cucumber-is-bullshit/#comments</comments>
		<pubDate>Thu, 23 Aug 2012 12:58:54 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[cucumber]]></category>
		<category><![CDATA[lettuce]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[ruby]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=1845</guid>
		<description><![CDATA[La bonne nouvelle, c'est qu'il y a de plus en plus de mecs qui se mettent au <a href="https://fr.wikipedia.org/wiki/Behavior_Driven_Development">BDD</a> (le développement orienté par le comportement).

La mauvaise nouvelle, c'est que comme tout mouvement, il vient avec son lot de trucs hype super cool.]]></description>
			<content:encoded><![CDATA[<p>La bonne nouvelle, c&#8217;est qu&#8217;il y a de plus en plus de mecs qui se mettent au <a href="https://fr.wikipedia.org/wiki/Behavior_Driven_Development">BDD</a> (le développement orienté par le comportement), qui est une forme de <a href="https://fr.wikipedia.org/wiki/TDD">TDD</a> (le développement orienté par les tests) mais dans lequel on test les fonctionnalités en priorité.</p>
<p>La mauvaise nouvelle, c&#8217;est que comme tout mouvement, il vient avec son lot de trucs hype super cool, et notamment <a href="http://cukes.info/">cucumber</a> de chez les rubystes. Bah oui, c&#8217;est fashion, ça vient forcément de Ruby. Évidement, comme les pythonistes peuvent pas supporter que les codeurs Ruby aient un truc qu&#8217;ils aient pas, même si c&#8217;est un truc parfaitement inutile, ils se sont dit qu&#8217;ils allaient pondre un équivalent : <a href="http://packages.python.org/lettuce/index.html">lettuce</a>.</p>
<p>Les deux outils sont aussi inutiles l&#8217;un que l&#8217;autre, même si ont fait abstraction de leurs noms douteux, car après tout, c&#8217;est une marque de fabrique dans notre métier.</p>
<h2>
Le principe</h2>
<p>Vous écrivez un scénario de tests:</p>
<pre>Feature: Manipulate strings
  In order to have some fun
  As a programming beginner
  I want to manipulate strings

  Scenario: Uppercased strings
    Given I have the string "lettuce leaves"
    When I put it in upper case
    Then I see the string is "LETTUCE LEAVES</pre>
<p>Vous écrivez des étapes:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">from</span> lettuce <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #66cc66;">*</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> @step<span style="color: black;">&#40;</span><span style="color: #483d8b;">'I have the string &quot;(.*)&quot;'</span><span style="color: black;">&#41;</span>
... <span style="color: #ff7700;font-weight:bold;">def</span> have_the_string<span style="color: black;">&#40;</span>step, <span style="color: #dc143c;">string</span><span style="color: black;">&#41;</span>:
...     <span style="color: black;">world</span>.<span style="color: #dc143c;">string</span> = <span style="color: #dc143c;">string</span>
...
<span style="color: #66cc66;">&gt;&gt;&gt;</span> @step<span style="color: black;">&#40;</span><span style="color: #483d8b;">'I put it in upper case'</span><span style="color: black;">&#41;</span>
... <span style="color: #ff7700;font-weight:bold;">def</span> put_it_in_upper<span style="color: black;">&#40;</span>step<span style="color: black;">&#41;</span>:
...     <span style="color: black;">world</span>.<span style="color: #dc143c;">string</span> = world.<span style="color: #dc143c;">string</span>.<span style="color: black;">upper</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
...
<span style="color: #66cc66;">&gt;&gt;&gt;</span> @step<span style="color: black;">&#40;</span><span style="color: #483d8b;">'I see the string is &quot;(.*)&quot;'</span><span style="color: black;">&#41;</span>
... <span style="color: #ff7700;font-weight:bold;">def</span> see_the_string_is<span style="color: black;">&#40;</span>step, expected<span style="color: black;">&#41;</span>:
...     <span style="color: #ff7700;font-weight:bold;">assert</span> world.<span style="color: #dc143c;">string</span> == expected, \
...         <span style="color: #483d8b;">&quot;Got %s&quot;</span> <span style="color: #66cc66;">%</span> world.<span style="color: #dc143c;">string</span></pre></div></div>

<p>Et pour chaque scénar, lettuce va rejouer chaque étape et voir si ça se passe bien. Avantages annoncés par rapport à la manière des pauvres mortels de coder les tests:</p>
<ul>
<li>c&#8217;est élégant;</li>
<li>un non technicien peut comprendre les tests.</li>
</ul>
<h2>
La faille</h2>
<p>En plus d&#8217;être <a href="http://www.allocine.fr/film/fichefilm_gen_cfilm=112274.html">un excellent film dans lequel brille Anthony Hopkins</a>, la faille est le détail qui caractérise la plupart de ces merveilles technologiques, à savoir: on rajoute une surcouche sur un truc que les gens ont déjà du mal à faire.</p>
<p>Concentrez-vous: rassemblez dans votre tête la liste de tous les gens que vous connaissez qui ont jamais écris du code.</p>
<p>Éliminez <strong>la majorité</strong> qui ne sait même pas ce qu&#8217;est un test unittaire.</p>
<p>Dans cette liste, combien écrivent des tests unittaires par eux même ? (je ne le fais pas systématiquement moi-même)</p>
<p>Dans cet échantillon réduit, combien écrivent des tests unittaires AVANT d&#8217;écrire le code testé (je le fais rarement moi-même) ?</p>
<p>Dans ce microrésidu d&#8217;individus éparse mais dont la volubilité bucolique nous incite à nous poser la question &#8220;Pourquoi Dieu a-t-il créé la limule&#8221;&#8230; Pardon je m&#8217;égare.</p>
<p>Donc dans ce qu&#8217;il reste, combien il y en a qui écrivent les tests en les orientant comportement en priorité, volontairement ?</p>
<p>Bien.</p>
<p>So&#8230; On va écrire tout un outil pour rajouter en travail et en complexité pour faire des tests que déjà il est terriblement difficile de motiver le dev lambda à faire (je n&#8217;ai pas dis que c&#8217;était une bonne chose, je constate, c&#8217;tou).</p>
<p>Parce que &#8220;c&#8217;est élégant&#8221; ? Ahem.</p>
<p>Parce que &#8220;un non technicien peut comprendre les tests&#8221; ?</p>
<p>Laissez-moi démonter ces assertions avec plaisir.</p>
<h2>Les tests, dans la vraie vie vivante (ou VVV)</h2>
<p>Évidement, si vous allez sur les sites des deux outils cités. Dans le premier, trouver un tuto clair prend 20 minutes (normal, c&#8217;est une communauté Ruby, c&#8217;est souvent comme ça). Dans la version Python, leur tuto fait un test sur <a href="http://packages.python.org/lettuce/tutorial/simple.html">la fonction factoriel</a>.</p>
<p>Excusez-moi messieurs mais:<br />
<strong><br />
1 &#8211; si c&#8217;est un code aussi simple qu&#8217;une fonction factorielle, une doctest règle le problème facilement, sans avoir à apprendre une techno en plus, tout en contribuant à la documentation.</strong></p>
<p>Entre <a href="http://packages.python.org/lettuce/tutorial/simple.html#tutorial-simple">leur exemple</a> qui implique <strong>deux</strong> fichiers, dont l&#8217;un contient ça:</p>
<pre>Feature: Compute factorial
  In order to play with Lettuce
  As beginners
  We'll implement factorial

  Scenario: Factorial of 0
    Given I have the number 0
    When I compute its factorial
    Then I see the number 1

  Scenario: Factorial of 1
    Given I have the number 1
    When I compute its factorial
    Then I see the number 1

  Scenario: Factorial of 2
    Given I have the number 2
    When I compute its factorial
    Then I see the number 2

  Scenario: Factorial of 3
    Given I have the number 3
    When I compute its factorial
    Then I see the number 6

  Scenario: Factorial of 4
    Given I have the number 4
    When I compute its factorial
    Then I see the number 24</pre>
<p>Et une version de tests en doctests propre, pythonique, concise et qui ajoute de la doc (faudra d&#8217;ailleurs faire un article&#8230;):</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">def</span> factorial<span style="color: black;">&#40;</span>number<span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot;
        Calculate the factorial of a number.
&nbsp;
        E.g:
&nbsp;
        &gt;&gt;&gt; factorial(0)
        1
        &gt;&gt;&gt; factorial(1)
        1
        &gt;&gt;&gt; factorial(2)
        2
        &gt;&gt;&gt; factorial(3)
        6
        &gt;&gt;&gt; factorial(4)
        24
    &quot;&quot;&quot;</span>
    number = <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>number<span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: black;">&#40;</span>number == <span style="color: #ff4500;">0</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">or</span> <span style="color: black;">&#40;</span>number == <span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #ff4500;">1</span>
    <span style="color: #ff7700;font-weight:bold;">else</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> number<span style="color: #66cc66;">*</span>factorial<span style="color: black;">&#40;</span>number-<span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span></pre></div></div>

<p>J&#8217;ai comme un doute sur l&#8217;efficacité de leur truc.</p>
<p>J&#8217;en profite au passage pour signaler qu&#8217;une factorielle en Python, ce serait plutôt ça:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">def</span> factorial<span style="color: black;">&#40;</span>number<span style="color: black;">&#41;</span>:
    number = <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>number<span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">if</span> number <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: black;">&#40;</span><span style="color: #ff4500;">0</span>, <span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #ff4500;">1</span>
    <span style="color: #ff7700;font-weight:bold;">return</span> number <span style="color: #66cc66;">*</span> factorial<span style="color: black;">&#40;</span>number - <span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span></pre></div></div>

<p>Mais là je mérite vraiment le tampon drosophilia fucker.</p>
<p><strong>2 &#8211; moi dans la vraie vie vivante, mes tests ils ressemblent plutôt à ça:</strong></p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">    <span style="color: #ff7700;font-weight:bold;">def</span> test_get_tasks_chain_status<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        states = <span style="color: black;">&#40;</span><span style="color: #483d8b;">'PENDING'</span>, <span style="color: #483d8b;">'PROGRESS'</span>, <span style="color: #483d8b;">'SUCCESS'</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            celery.<span style="color: black;">conf</span>.<span style="color: black;">CELERY_ALWAYS_EAGER</span> = <span style="color: #008000;">False</span>
            res = chain<span style="color: black;">&#40;</span>full_chain.<span style="color: black;">s</span><span style="color: black;">&#40;</span><span style="color: black;">&#123;</span><span style="color: #483d8b;">'subject_url'</span>: <span style="color: #483d8b;">'http://www.service.com/?id=tPEE9ZwTmy0'</span>,
                                          <span style="color: #483d8b;">'subject_id'</span>: <span style="color: #483d8b;">'test'</span>,
                                          <span style="color: #483d8b;">'service'</span>: <span style="color: #483d8b;">&quot;service_name&quot;</span><span style="color: black;">&#125;</span><span style="color: black;">&#41;</span>,
                   task_1.<span style="color: black;">s</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>, task_2.<span style="color: black;">s</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>.<span style="color: black;">apply_async</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
            tasks_id_list = get_task_id_list<span style="color: black;">&#40;</span>res<span style="color: black;">&#41;</span>
&nbsp;
            tasks = <span style="color: #008000;">set</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">while</span> res.<span style="color: black;">state</span> <span style="color: #66cc66;">!</span>= <span style="color: #483d8b;">'SUCCESS'</span>:
                task_status = get_tasks_chain_status<span style="color: black;">&#40;</span>tasks_id_list<span style="color: black;">&#41;</span>
                tasks.<span style="color: black;">add</span><span style="color: black;">&#40;</span>task_status<span style="color: black;">&#91;</span><span style="color: #483d8b;">'name'</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>
                <span style="color: #008000;">self</span>.<span style="color: black;">assertTrue</span><span style="color: black;">&#40;</span>task_status<span style="color: black;">&#91;</span><span style="color: #483d8b;">'state'</span><span style="color: black;">&#93;</span> <span style="color: #ff7700;font-weight:bold;">in</span> states<span style="color: black;">&#41;</span>
&nbsp;
            task_status = get_tasks_chain_status<span style="color: black;">&#40;</span>tasks_id_list<span style="color: black;">&#41;</span>
            tasks.<span style="color: black;">add</span><span style="color: black;">&#40;</span>task_status<span style="color: black;">&#91;</span><span style="color: #483d8b;">'name'</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>
            <span style="color: #008000;">self</span>.<span style="color: black;">assertTrue</span><span style="color: black;">&#40;</span>task_status<span style="color: black;">&#91;</span><span style="color: #483d8b;">'state'</span><span style="color: black;">&#93;</span> <span style="color: #ff7700;font-weight:bold;">in</span> states<span style="color: black;">&#41;</span>
&nbsp;
            <span style="color: #008000;">self</span>.<span style="color: black;">assertEqual</span><span style="color: black;">&#40;</span>tasks,
                             <span style="color: #008000;">set</span><span style="color: black;">&#40;</span><span style="color: black;">&#91;</span><span style="color: #483d8b;">&quot;tasks.full_chain&quot;</span>,
                                  <span style="color: #483d8b;">&quot;tasks.task_1&quot;</span>,
                                  <span style="color: #483d8b;">&quot;tasks.task_2&quot;</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">finally</span>:
            celery.<span style="color: black;">conf</span>.<span style="color: black;">CELERY_ALWAYS_EAGER</span> = <span style="color: #008000;">True</span>
            <span style="color: #808080; font-style: italic;"># Since we are using a separate celery process for this one with</span>
            <span style="color: #808080; font-style: italic;"># a different set of settings, we have to remove the generated file</span>
            <span style="color: #808080; font-style: italic;"># manually</span>
            <span style="color: #ff7700;font-weight:bold;">try</span>:
                <span style="color: #dc143c;">shutil</span>.<span style="color: black;">rmtree</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span>.<span style="color: black;">path</span>.<span style="color: black;">join</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">OLD_CONTENT_FILE_ROOT</span>, <span style="color: #483d8b;">'test'</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">except</span>:
                <span style="color: #ff7700;font-weight:bold;">pass</span></pre></div></div>

<p>On est loin de la factorielle: c&#8217;est un test de récupération de statu d&#8217;une chaîne de tâches asynchrones. Désolé les gars mais on arrête de coder des factorielles à la sortie de la fac.</p>
<p> Allez me décrire ça dans le DSL de lettuce/cucumber. Oh, c&#8217;est possible, ça va juste me prendre du temps. Beaucoup de temps. Parce que ce test, j&#8217;ai mis une demi-heure à l&#8217;écrire tel qu&#8217;il est: c&#8217;est la résultante de moult essais, sans compter les modifs a posteriori, car le code qu&#8217;il teste n&#8217;est pas resté en jachère.</p>
<p>Donc j&#8217;ai appris à me servir des tests unitaire, incluant les doctests, j&#8217;ai rajouté unittests2 et nose à ma boîte à outil, je connais le tests runner de Django, et par dessus, on voudrait rajouter une surcouche, qui me rajoute du travail dans l&#8217;écriture de mes tests. Tests déjà bien chiant à faire, j&#8217;ai vraiment PAS besoin d&#8217;un démotivateur supplémentaire.</p>
<p>Mais z&#8217;attendez, si encore le coût se faisait uniquement à l&#8217;écriture du test&#8230;</p>
<p>Ces libs, c&#8217;est une doc à lire, puis du temps sur leurs fora, et une transposition du concept pour des vrais tests et pas des fonctions playmobiles. Plus le débuggage, plus la dépendance, plus le fait que toute personne qui passe derrière moi devra perdre le même temps.</p>
<h2>Tout ça parce que &#8220;c&#8217;est élégant&#8221; ?</h2>
<p>Nan, le code est un langage naturel pour moi, le langage ordinaire pour écrire du code n&#8217;est pas naturel pour moi. Je suis un dev, je lis du Python au pti dej, <strong>c&#8217;est Python qui est naturel pour moi</strong>, pas un DSL boiteux qui me limite dans ce que je peux écrire histoire de se la toucher en ressemblant à un haïku. Ce n&#8217;est pas élégant.</p>
<h2>Alors tout ça parceque &#8220;un non technicien peut comprendre les tests&#8221; ?</h2>
<p>Vous croyez qu&#8217;une quelconque explication va permettre à une personne lambda de comprendre l&#8217;essence du test <code>test_get_tasks_chain_status</code> ? Je ne parle même pas de l&#8217;écrire, hein (ce que suggère la doc des outils).</p>
<p>Parce que si c&#8217;est juste pour que le stagiaire regarde un tableau et soit capable de citer le nom du test qui a chié, un serveur Jenkins fait très bien l&#8217;affaire, merci.</p>
<p>Donc, chers développeurs qui bossez sur ces outils, vous êtes brillant, compétant et vous avez la foi de faire ce faire un dev si énorme. Par pitié, transposez ce potentiel sur des trucs utiles pour la majorité des gens comme une version asynchrone de Django qui puisse concurrencer NodeJs et qui soit plus facile que Twisted, une interface Git humainement acceptable, l&#8217;édition de code collaborative qui marche out of the box pour Sublime Text, un blog qui mélange shaarli + status net + wiki + wordpress en une seule interface, un lecteur de flux RSS destop qui ait un historique des articles lus et une recherche qui marche, un jeu video de course de bagnoles qui fasse s&#8217;affronter la batmobile, la doloréanne et Bumbo, un film sur le voyage dans le temps qui ait un scénario cohérent, un téléphone non smartphone avec un lecteur mp3 décent et un clavier AZERTY, la paix dans le monde et la disparition des black mambas qui décidément ne servent vraiment à rien.</p>
<p>Merci</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=1845&amp;md5=7e9f7b2809fa68cbcc26b2099eb388f7" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/lettuce-and-cucumber-is-bullshit/feed/</wfw:commentRss>
		<slash:comments>22</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Flettuce-and-cucumber-is-bullshit%2F&amp;language=en_GB&amp;category=text&amp;title=Lettuce+%28and+cucumber%29+is+bullshit&amp;description=La+bonne+nouvelle%2C+c%26%238217%3Best+qu%26%238217%3Bil+y+a+de+plus+en+plus+de+mecs+qui+se+mettent+au+BDD+%28le+d%C3%A9veloppement+orient%C3%A9+par+le+comportement%29%2C+qui+est+une+forme+de+TDD...&amp;tags=cucumber%2Clettuce%2Cpython%2Cruby%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2012/08/bullshitbingo.jpg" length="39811" type="image/jpg" />	</item>
	</channel>
</rss>
