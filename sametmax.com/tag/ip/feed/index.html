<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Sam &#38; Max: Python, Django, Git et du cul &#187; ip</title>
	<atom:link href="http://sametmax.com/tag/ip/feed/" rel="self" type="application/rss+xml" />
	<link>http://sametmax.com</link>
	<description>Deux développeurs en vadrouille qui se sortent les doigts du code</description>
	<lastBuildDate>Wed, 05 Feb 2014 14:20:37 +0000</lastBuildDate>
	<language>en</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.3.1</generator>
	<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2F&amp;language=en_US&amp;category=text&amp;title=Sam+%26amp%3B+Max%3A+Python%2C+Django%2C+Git+et+du+cul&amp;description=Deux+d%C3%A9veloppeurs+en+vadrouille+qui+se+sortent+les+doigts+du+code&amp;tags=blog" type="text/html" />
		<item>
		<title>You are deprecated</title>
		<link>http://sametmax.com/you-are-deprecated/</link>
		<comments>http://sametmax.com/you-are-deprecated/#comments</comments>
		<pubDate>Mon, 18 Nov 2013 08:20:47 +0000</pubDate>
		<dc:creator>Toniob</dc:creator>
				<category><![CDATA[Administration System]]></category>
		<category><![CDATA[ifconfig]]></category>
		<category><![CDATA[ip]]></category>
		<category><![CDATA[route]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=7985</guid>
		<description><![CDATA[Oh oui, je sais ce que vous allez me dire, et vous avez parfaitement raison. Oui, il m'arrive d'être un peut obtus sur certaines choses, surtout quand il s'agit d'un domaine que je connais. Bref, aujourd'hui nous allons parler de ifconfig et de route.]]></description>
			<content:encoded><![CDATA[<p style="text-align: center;"><em><small>Ceci est un post invité de <a href="http://sametmax.com/author/toniob/">Toniob</a> posté sous licence <a href="http://creativecommons.org/licenses/by/3.0/">creative common 3.0 unported</a>.</small></em></p>
<p>Oh oui, je sais ce que vous allez me dire, et vous avez parfaitement raison. Oui, il m&#8217;arrive d&#8217;être un peu obtus sur certaines choses, surtout quand il s&#8217;agit d&#8217;un domaine que je connais. Bref, aujourd&#8217;hui nous allons parler de ifconfig et de route.</p>
<p>Soyons clair tout de suite : arrêtez d&#8217;utiliser ces merdes, elles sont dépréciées depuis longtemps ! Je sais comment sont les informaticiens de manière générale, et les administrateurs systèmes en particulier. Il est difficile de changer leurs habitudes. Mais si on vous proposait Scarlett Johansson, vous resteriez fidèle à Régine ou Jonathan Rhys Meyers si vous aviez Mickey Rourke ? Je vois à vos yeux lubriques que vous m&#8217;avez saisi. Alors c&#8217;est parti.</p>
<div id="attachment_7987" class="wp-caption alignnone" style="width: 490px"><a href="http://sametmax.com/you-are-deprecated/ifconfig-deprecated/" rel="attachment wp-att-7987"><img src="http://sametmax.com/wp-content/uploads/2013/11/ifconfig-deprecated.jpg" alt="" title="ifconfig-deprecated" width="480" height="288" class="size-full wp-image-7987" /></a><p class="wp-caption-text">- ifconfig ? - ouiiiii ** tum tum tum tum **</p></div>
<p><strong>Les interfaces</strong></p>
<p>Utilisez la commande ip, c&#8217;est un ordre. Elle remplacera avantageusement ifconfig. Dans la suite de ce billet, je mettrai des exemples de commandes avec ifconfig et leur équivalent avec ip. Commençons avec du simple, afficher la liste des interfaces disponibles :</p>
<p><code>
<pre># ifconfig -a
eth0      Link encap:Ethernet  HWaddr 00:90:f5:ee:62:31
          UP BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 lg file transmission:1000
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
          Interruption:20 Mémoire:f7e00000-f7e20000

lo        Link encap:Boucle locale
          inet adr:127.0.0.1  Masque:255.0.0.0
          adr inet6: ::1/128 Scope:Hôte
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:12 errors:0 dropped:0 overruns:0 frame:0
          TX packets:12 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 lg file transmission:0
          RX bytes:720 (720.0 B)  TX bytes:720 (720.0 B)
$ ip addr
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: eth0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc pfifo_fast state DOWN mode DEFAULT group default qlen 1000
    link/ether 00:90:f5:ee:62:31 brd ff:ff:ff:ff:ff:ff</pre>
<p></code></p>
<p>Vous voyez, pour le moment ce n&#8217;est pas si compliqué, vous économisez même de précieuses lettres. Vous constatez que la sortie est différente, mais vous y trouverez globalement les mêmes informations. C&#8217;est une question d&#8217;habitude. Personnellement, ça m&#8217;a pris un peu de temps, mais je ne reviendrais en arrière pour rien au monde.</p>
<p>On va maintenant assigner une adresse ip. Bon, j&#8217;avoue, c&#8217;est un peu plus long cette fois avec la commande ip :</p>
<p><code>
<pre># ifconfig eth0 192.168.1.1/24
# ip addr add 192.168.1.1/24 dev eth0</pre>
<p></code></p>
<p>Et si maintenant nous ajoutions une adresse ipv4 ? Sauf qu&#8217;avec ifconfig, ce n&#8217;est pas possible, on ne peut le faire qu&#8217;avec ip :</p>
<p><code>
<pre># ip addr add 192.168.1.2/32 dev eth0</pre>
<p></code></p>
<p>Si on affiche la configuration de l&#8217;interface réseau :</p>
<p><code>
<pre># ifconfig eth0
eth0      Link encap:Ethernet  HWaddr 00:90:f5:ee:62:31
          inet adr:192.168.1.1  Bcast:0.0.0.0  Masque:255.255.255.0
          UP BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 lg file transmission:1000
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
          Interruption:20 Mémoire:f7e00000-f7e20000
$ ip addr show eth0
2: eth0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc pfifo_fast state DOWN group default qlen 1000
    link/ether 00:90:f5:ee:62:31 brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.1/24 scope global eth0
       valid_lft forever preferred_lft forever
    inet 192.168.1.2/32 scope global eth0
       valid_lft forever preferred_lft forever</pre>
<p></code></p>
<p>Et oui, rien du côté de ifconfig. Il ne voit pas que l&#8217;interface dispose de deux adresses différentes. Alors qu&#8217;il fallait utiliser des alias d&#8217;interface avec ifconfig, plus de souci de ce côté là avec ip. Voici maintenant quelques exemples d&#8217;autres commandes pouvant être utiles :</p>
<p><code>
<pre># ifconfig eth0 mtu 9000
# ip link set eth0 mtu 9000</pre>
<p></code></p>
<p><code>
<pre># ifconfig eth0 up
# ip link set eth0 up</pre>
<p></code></p>
<p><strong>Les routes</strong></p>
<p>Passons maintenant aux routes. Si vous utilisez ifconfig, vous vous servez aussi probablement de route. C&#8217;est fini les conneries maintenant ! Commençons par les afficher :</p>
<p><code>
<pre># route -n
Table de routage IP du noyau
Destination     Passerelle      Genmask         Indic Metric Ref    Use Iface
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 eth0
$ ip route
192.168.1.0/24 dev eth0  proto kernel  scope link  src 192.168.1.1</pre>
<p></code></p>
<p>Oui, la sortie est moins verbeuse par défaut. Ça devrait vous plaire pour vos scripts shell. Ajoutons maintenant une route par défaut :</p>
<p><code>
<pre># route add default gw 192.168.1.254
# ip route add defaut via 192.168.1.254</pre>
<p></code></p>
<p>Et si on regarde le résultat de la commande ip route maintenant :</p>
<p><code>
<pre>$ ip route
default via 192.168.1.254 dev eth0
192.168.1.0/24 dev eth0  proto kernel  scope link  src 192.168.1.1</pre>
<p></code></p>
<p>Contrairement à route, ip route génère une sortie qui peut être copiée / collée dans un ip route add. Pratique pour dupliquer une conf sur un autre serveur. Pour ajouter une route vers un hôte ou un réseau en particulier :</p>
<p><code>
<pre># route add -net 192.168.2.0 netmask 255.255.255.0 gw 192.168.1.253
# ip route add 192.168.2.0/24 via 192.168.1.253</pre>
<p></code></p>
<p>C&#8217;est une affaire de goût, mais je préfère largement la syntaxe de ip à celle de route.</p>
<p><strong>Conclusion</strong></p>
<p>Voilà cette petite introduction à la commande ip est terminée. Essayez de remplacer ifconfig dans vos usages au quotidien. Ça prend un peu de temps pour s&#8217;y faire, mais la syntaxe plus claire et les fonctionnalités disponibles permettent vite d&#8217;être plus rapide dans la configuration réseau d&#8217;une machine. Les exemples que j&#8217;ai donnés dans cet article devraient être suffisants pour 90% des usages. Si vous cherchez à vouloir en faire plus, il suffit d&#8217;ajouter l&#8217;option help à votre ligne de commande pour avoir des informations. Plus pratique que d&#8217;avoir à taper dans le man sans arrêt.</p>
<p>Si cet article vous plaît (merci de me faire des commentaires élogieux, c&#8217;est mon premier ici), j&#8217;essaierai de vous faire découvrir un peu plus la stack réseau sous Linux. Si les vlans sont connus, les bondings un peu moins, je pense que les macvtaps sont un mystère pour la plupart d&#8217;entre vous. Et tout se fait avec l&#8217;aide d&#8217;ip en plus, que demande le peuple ?</p>
<p>Et si la conf réseau ça vous saoule, je trouverai à m&#8217;énerver sur d&#8217;autres choses (le larousse n&#8217;a qu&#8217;à bien se tenir).</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=7985&amp;md5=7688f2e615a39a55e2be8fb8328f7629" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/you-are-deprecated/feed/</wfw:commentRss>
		<slash:comments>18</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fyou-are-deprecated%2F&amp;language=en_GB&amp;category=text&amp;title=You+are+deprecated&amp;description=Ceci+est+un+post+invit%C3%A9+de+Toniob+post%C3%A9+sous+licence+creative+common+3.0+unported.+Oh+oui%2C+je+sais+ce+que+vous+allez+me+dire%2C+et+vous+avez+parfaitement+raison.+Oui%2C...&amp;tags=ifconfig%2Cip%2Croute%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/11/terminator_02_connor.jpg" length="27630" type="image/jpg" />	</item>
		<item>
		<title>Récupérer l&#8217;IP client avec Nginx en proxy sous CherryPy/Django/Bottle &#8211; proxy_set_header</title>
		<link>http://sametmax.com/recuperer-lip-client-avec-nginx-en-proxy-sous-cherrypy-proxy_set_header/</link>
		<comments>http://sametmax.com/recuperer-lip-client-avec-nginx-en-proxy-sous-cherrypy-proxy_set_header/#comments</comments>
		<pubDate>Thu, 06 Sep 2012 02:11:26 +0000</pubDate>
		<dc:creator>Max</dc:creator>
				<category><![CDATA[Administration System]]></category>
		<category><![CDATA[bottle]]></category>
		<category><![CDATA[cherrypy]]></category>
		<category><![CDATA[django]]></category>
		<category><![CDATA[ip]]></category>
		<category><![CDATA[nginx]]></category>
		<category><![CDATA[proxy]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=2041</guid>
		<description><![CDATA[Si vous utilisez Nginx en proxy, vous allez vous heurter à son IP lorsque votre script tentera de récupérer l'IP du client soit 127.0.0.1. Voici comment récupérer la bonne IP.]]></description>
			<content:encoded><![CDATA[<p>Si vous utilisez Nginx en proxy, vous allez vous heurter à son IP lorsque votre script tentera de récupérer l&#8217;IP du client soit 127.0.0.1.</p>
<p>En rajoutant ces quelques lignes à votre config <a href="http://wiki.nginx.org/HttpProxyModule#proxy_set_header">Nginx</a>:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">location <span style="color: #000000; font-weight: bold;">/</span> <span style="color: #7a0874; font-weight: bold;">&#123;</span> 
 <span style="color: #666666; font-style: italic;"># ici un proxy pass quelconque</span>
 proxy_pass http:<span style="color: #000000; font-weight: bold;">//</span>cherrypy;
&nbsp;
 <span style="color: #666666; font-style: italic;"># et ici la magie opère</span>
 proxy_set_header Host <span style="color: #007800;">$host</span>;
 proxy_set_header X-Real-IP <span style="color: #007800;">$remote_addr</span>;
 proxy_set_header X-Forwarded-For <span style="color: #007800;">$proxy_add_x_forwarded_for</span>;
<span style="color: #7a0874; font-weight: bold;">&#125;</span></pre></div></div>

<p><strong>Dans votre script python (ici Bottle), vous pouvez du coup la récupérer:<br />
</strong></p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">#get user IP</span>
user_ip = request.remote_addr</pre></div></div>

 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=2041&amp;md5=15883c3d0c851553154ccaa72d80d8fc" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/recuperer-lip-client-avec-nginx-en-proxy-sous-cherrypy-proxy_set_header/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Frecuperer-lip-client-avec-nginx-en-proxy-sous-cherrypy-proxy_set_header%2F&amp;language=en_GB&amp;category=text&amp;title=R%C3%A9cup%C3%A9rer+l%26%238217%3BIP+client+avec+Nginx+en+proxy+sous+CherryPy%2FDjango%2FBottle+%26%238211%3B+proxy_set_header&amp;description=Si+vous+utilisez+Nginx+en+proxy%2C+vous+allez+vous+heurter+%C3%A0+son+IP+lorsque+votre+script+tentera+de+r%C3%A9cup%C3%A9rer+l%26%238217%3BIP+du+client+soit+127.0.0.1.+En+rajoutant+ces+quelques+lignes+%C3%A0...&amp;tags=bottle%2Ccherrypy%2Cdjango%2Cip%2Cnginx%2Cproxy%2Cpython%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2012/09/Proxy-Sheen-Cloud.jpeg" length="15043" type="image/jpg" />	</item>
		<item>
		<title>nginx et limitation de connexion par IP avec limit_conn_zone</title>
		<link>http://sametmax.com/nginx-et-limitation-de-connexion-par-ip-avec-limit_conn_zone/</link>
		<comments>http://sametmax.com/nginx-et-limitation-de-connexion-par-ip-avec-limit_conn_zone/#comments</comments>
		<pubDate>Fri, 06 Jul 2012 13:54:20 +0000</pubDate>
		<dc:creator>Max</dc:creator>
				<category><![CDATA[Administration System]]></category>
		<category><![CDATA[connexion]]></category>
		<category><![CDATA[ip]]></category>
		<category><![CDATA[limitation]]></category>
		<category><![CDATA[limit_conn]]></category>
		<category><![CDATA[limit_conn_zone]]></category>
		<category><![CDATA[nginx]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=921</guid>
		<description><![CDATA[Limiter une IP à une ou plusieurs connexion avec nginx, pratique si vous voulez proposer par exemple un seul téléchargement de fichier à la fois par IP sur votre serveur.]]></description>
			<content:encoded><![CDATA[<p>Limiter une IP à une ou plusieurs connexion avec <a href="http://wiki.nginx.org/Main">nginx</a> peut s&#8217;averer utile si vous voulez proposer par exemple un seul téléchargement de fichier à la fois par IP sur votre serveur (économie de bande passante, éviter de se faire aspirer tout le site d&#8217;un coup, etc.)</p>
<p>Nginx rappelons le est actuellement l&#8217;un des serveurs web les plus performant, gratuit qui plus est.</p>
<p>L&#8217;exemple ci-dessous va limiter une IP à 5 connexions sur l&#8217;ensemble des images servies par votre serveur. On peut bien sur modifier la regex Location pour limiter aux videos, pdf, etc&#8230;</p>
<p><strong><br />
dans le fichier de config de nginx:</strong><br />
<strong><br />
Dans http:</strong></p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">http <span style="color: #7a0874; font-weight: bold;">&#123;</span>
limit_conn_zone <span style="color: #007800;">$binary_remote_addr</span> <span style="color: #007800;">zone</span>=limit:10m; 
<span style="color: #7a0874; font-weight: bold;">&#125;</span></pre></div></div>

<p>10m veut dire qu&#8217;il va logguer les IPs connectées dans 10 MB de mémoire après il efface et recommence, ça permet de stocker les IPs connectées récement.</p>
<p><strong><br />
Dans server:</strong></p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">server <span style="color: #7a0874; font-weight: bold;">&#123;</span>
    location ~ \.<span style="color: #7a0874; font-weight: bold;">&#40;</span>jpg<span style="color: #000000; font-weight: bold;">|</span>jpeg<span style="color: #000000; font-weight: bold;">|</span>gif<span style="color: #000000; font-weight: bold;">|</span>png<span style="color: #7a0874; font-weight: bold;">&#41;</span>$ <span style="color: #7a0874; font-weight: bold;">&#123;</span>
      limit_conn limit <span style="color: #000000;">5</span>; <span style="color: #666666; font-style: italic;"># limit to 5 cnx by IP</span>
    <span style="color: #7a0874; font-weight: bold;">&#125;</span> 
<span style="color: #7a0874; font-weight: bold;">&#125;</span></pre></div></div>

<p>PS: limit est le nom de zone que vous donnez à votre règle, ça peut prendre la forme que ça veut comme dirait Egon dans Ghostbusters&#8230;</p>
<p>Pour en savoir plus : <a href="http://wiki.nginx.org/HttpLimitZoneModule">Doc nginx HttpLimitZoneModule</a></p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=921&amp;md5=ec8b911383ae8e96e15df8b4e1261289" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/nginx-et-limitation-de-connexion-par-ip-avec-limit_conn_zone/feed/</wfw:commentRss>
		<slash:comments>2</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fnginx-et-limitation-de-connexion-par-ip-avec-limit_conn_zone%2F&amp;language=en_GB&amp;category=text&amp;title=nginx+et+limitation+de+connexion+par+IP+avec+limit_conn_zone&amp;description=Limiter+une+IP+%C3%A0+une+ou+plusieurs+connexion+avec+nginx+peut+s%26%238217%3Baverer+utile+si+vous+voulez+proposer+par+exemple+un+seul+t%C3%A9l%C3%A9chargement+de+fichier+%C3%A0+la+fois+par+IP+sur...&amp;tags=connexion%2Cip%2Climitation%2Climit_conn%2Climit_conn_zone%2Cnginx%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2012/06/feu-rouge.jpeg" length="37223" type="image/jpg" />	</item>
	</channel>
</rss>
