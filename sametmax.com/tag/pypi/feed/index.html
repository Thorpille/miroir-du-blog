<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Sam &#38; Max: Python, Django, Git et du cul &#187; pypi</title>
	<atom:link href="http://sametmax.com/tag/pypi/feed/" rel="self" type="application/rss+xml" />
	<link>http://sametmax.com</link>
	<description>Deux développeurs en vadrouille qui se sortent les doigts du code</description>
	<lastBuildDate>Wed, 05 Feb 2014 14:20:37 +0000</lastBuildDate>
	<language>en</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.3.1</generator>
	<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2F&amp;language=en_US&amp;category=text&amp;title=Sam+%26amp%3B+Max%3A+Python%2C+Django%2C+Git+et+du+cul&amp;description=Deux+d%C3%A9veloppeurs+en+vadrouille+qui+se+sortent+les+doigts+du+code&amp;tags=blog" type="text/html" />
		<item>
		<title>Crate.io, une alternative à Pypi</title>
		<link>http://sametmax.com/create-io-une-alternative-a-pypi/</link>
		<comments>http://sametmax.com/create-io-une-alternative-a-pypi/#comments</comments>
		<pubDate>Thu, 22 Nov 2012 15:14:49 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[pip]]></category>
		<category><![CDATA[pypi]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=3163</guid>
		<description><![CDATA[Si vous avez lu l'article sur <a href="http://sametmax.com/votre-python-aime-les-pip/">pip</a>, vous savez que le listing officiel des libs Python est <a href="http://pypi.python.org/pypi">Pypi</a>, un site for pratique, mais qui commence à dater.
]]></description>
			<content:encoded><![CDATA[<p>Si vous avez lu l&#8217;article sur <a href="http://sametmax.com/votre-python-aime-les-pip/">pip</a>, vous savez que le listing officiel des libs Python est <a href="http://pypi.python.org/pypi">Pypi</a>, un site fort pratique, mais qui commence à dater.</p>
<p>Apparemment certains ont eu envie de changer ça, en créant <a href="https://crate.io/">crate.io</a>, une alternative moderne à Pypi: interface plus léchée et présentant des stats sympathiques, il est un mirroir complet de Pypi et contient donc les <a href="https://crate.io/packages/zerobin/">mêmes packages</a>.</p>
<p>On peut demander à pip d&#8217;utiliser <a href="https://create.io/">create.io</a> comme source. Par exemple pour installer Django:</p>
<p><code> pip install --index-url=https://simple.crate.io django </code></p>
<p>Pratique si Pypi n&#8217;est pas disponible, ou juste pour ne pas mettre tous ses oeufs dans le même panier.</p>
<p>Il est important de noter que c&#8217;est une initiative privée, alors que Pypi est gérée par la Python fondation, les buts ne sont pas les mêmes. Cela dit, les sources sont disponibles sur <a href="https://github.com/crateio">github</a>, donc ça met en confiance. On peut d&#8217;ailleurs voir que le bouzin tourne avec Django/Postgesql/Redis/Celery.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=3163&amp;md5=0bdbb579ee6c8868c4da4be02013180d" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/create-io-une-alternative-a-pypi/feed/</wfw:commentRss>
		<slash:comments>5</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fcreate-io-une-alternative-a-pypi%2F&amp;language=en_GB&amp;category=text&amp;title=Crate.io%2C+une+alternative+%C3%A0+Pypi&amp;description=Si+vous+avez+lu+l%26%238217%3Barticle+sur+pip%2C+vous+savez+que+le+listing+officiel+des+libs+Python+est+Pypi%2C+un+site+fort+pratique%2C+mais+qui+commence+%C3%A0+dater.+Apparemment+certains+ont...&amp;tags=pip%2Cpypi%2Cpython%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2012/11/Stine-Robert-Lawrence-Jumeau-Diabolique-Livre-368001230_ML.jpg" length="15157" type="image/jpg" />	</item>
		<item>
		<title>Créer un setup.py et mettre sa bibliothèque Python en ligne sur Pypi</title>
		<link>http://sametmax.com/creer-un-setup-py-et-mettre-sa-bibliotheque-python-en-ligne-sur-pypi/</link>
		<comments>http://sametmax.com/creer-un-setup-py-et-mettre-sa-bibliotheque-python-en-ligne-sur-pypi/#comments</comments>
		<pubDate>Fri, 16 Nov 2012 18:06:09 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[pip]]></category>
		<category><![CDATA[pypi]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=3102</guid>
		<description><![CDATA[Je crois que ce sujet est dans le top 10 des trucs qui paraissent mystiques même après avoir passé des heures sur les docs sur le net. Et si ça prend effectivement un peu de temps CPU neuronale pour s'en sortir, on est loin de la montagne qu'on s'en est fait.

Scénario: vous avez écrit une lib. Elle est belle, elle sent bon le sable chaud. Vous voulez la partager.]]></description>
			<content:encoded><![CDATA[<p>Je crois que ce sujet est dans le top 10 des trucs qui paraissent mystiques même après avoir passé des heures sur les docs sur le net. Et si ça prend effectivement un peu de temps CPU neuronale pour s&#8217;en sortir, on est loin de la montagne qu&#8217;on s&#8217;en est fait.</p>
<p>Scénario: vous avez écrit une lib. Elle est belle, elle sent bon le sable chaud. Vous voulez la partager.</p>
<p>La première étape, c&#8217;est de créer une fichier setup.py qui permettra aux gens de l&#8217;installer. La seconde, c&#8217;est de la mettre en ligne sur le site Pypi pour que les gens puissent l&#8217;installer avec <a href="http://sametmax.com/votre-python-aime-les-pip/">pip</a>.</p>
<p>Nous allons donc créer un <em>setup.py</em> pour une lib incroyable: la &#8220;sm_lib&#8221;.</p>
<h2>Arborescence</h2>
<p>Généralement, quand on développe une petite lib au fil de l&#8217;eau, on une forte tendance à tout mettre en vrac dans un dossier. Cependant pour créer un paquet installable, il est beaucoup plus simple et propre d&#8217;avoir une organisation de fichiers standards. On peut faire sans, mais c&#8217;est prise de tête.</p>
<p>Prenons notre lib exceptionnelle&#8230;</p>
<p><a href="http://sametmax.com/wp-content/uploads/2012/11/Capture-du-2012-11-16-1058501.png"><img src="http://sametmax.com/wp-content/uploads/2012/11/Capture-du-2012-11-16-1058501.png" alt="" title="" width="313" height="386" class="aligncenter size-full wp-image-3108" /></a></p>
<p>Pour le moment, elle est composée d&#8217;un dossier &#8220;sm_lib&#8221; avec 3 fichiers:</p>
<ul>
<li>une photo des auteurs (suite aux plaintes reçues, nous avons une nouvelle ligne de conduite concernant les photographies. Demain, les bébés !);</li>
<li>l&#8217;indispensable <em>__init__.py</em>, qui est vide;</li>
<li>un fichier <em>core.py</em> (qui peut avoir n&#8217;importe quel nom) qui contient le code de notre lib dont le but est de diffuser un message hautement subversif:</li>
</ul>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;">#!/usr/bin/env python</span>
<span style="color: #808080; font-style: italic;"># -*- coding: utf-8 -*-</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">datetime</span> <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">datetime</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> proclamer<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;[%s] Sam et Max, c'est bien&quot;</span> <span style="color: #66cc66;">%</span> <span style="color: #dc143c;">datetime</span>.<span style="color: black;">now</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">if</span> __name__ == <span style="color: #483d8b;">&quot;__main__&quot;</span>:
    proclamer<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>Maintenant que nous avons changé de mentalité, nous voulons absolument propager notre nouveau message et ton du blog partout, donc on va distribuer cette bibliothèque.</p>
<p>Premièrement, on va réorganiser les fichiers et en rajouter quelques uns:</p>
<p><a href="http://sametmax.com/wp-content/uploads/2012/11/Capture-du-2012-11-16-111239.png"><img src="http://sametmax.com/wp-content/uploads/2012/11/Capture-du-2012-11-16-111239.png" alt="On met sm_lib dans un dossier sm_lib" title="" width="376" height="779" class="aligncenter size-full wp-image-3109" /></a></p>
<p>Vous noterez qu&#8217;on a mis notre dossier de lib, dans un autre dossier, et que les deux dossiers portent le même nom &#8220;sm_lib&#8221;. C&#8217;est redondant, mais c&#8217;est normal. Le dossier qui contient tout est le dossier de distribution, c&#8217;est l&#8217;emballage de notre lib. Le dossier qui contient notre code, c&#8217;est le dossier d&#8217;installation, c&#8217;est celui qui sera copié sur le système, et qui doit avoir un nom de package importable (uniquement des lettres et des _ dans le nom, ou un chiffre mais pas en premier caractère).</p>
<p>Les noms peuvent être différents, mais généralement on donne le même nom aux deux, car c&#8217;est plus simple.</p>
<p>On rajoute 3 fichiers:</p>
<ul>
<li>setup.py: un fichier de code Python qui est notre installeur.</li>
<li>MANIFEST.in: un fichier texte qui liste les fichiers non Python qu&#8217;on inclura dans l&#8217;installation.</li>
<li>README.md: un fichier markdown (c&#8217;est du texte, juste un peu formaté) contiendra une présentation du package.</li>
</ul>
<p>Pour le moment nos trois fichiers sont vides.</p>
<h2>Choix des outils</h2>
<p>Une des difficultés principales dans la distribution d&#8217;un code Python, c&#8217;est l&#8217;abondance de solutions. Pour l&#8217;installeur, on peut choisir entre <code>distribute</code>, <code>setuptools</code>, <code>distutils</code> ou <code>Distutils2</code>.</p>
<p>Je vous passe les détails, mais j&#8217;ai essayé les 4. <code>distutils</code> est trop vieux. <code>distribute</code> va être remplacé par <code>distutils2</code> qui lui est encore très jeune. La seule solution qui passe partout pour le moment c&#8217;est <code>setuptools</code>. Tarek Ziade va faire la gueule, mais c&#8217;est ce que je recommande d&#8217;utiliser pour le moment. Je metterai à jour cet article pour utiliser un <em>setup.cfg</em> et des moyens plus modernes quand tout ça sera devenu la solution de facto, mais je ne vais pas pousser à la migration.</p>
<p>Donc vous allez utiliser <code>setuptools</code>.</p>
<p>Ensuite on utilise un fichier <em>MANIFEST.in</em> pour lister les fichiers non Python. On pourrait tout passer en paramètres à la main, mais le manifeste est la solution la plus productive.</p>
<p>Enfin on utilise un fichier markdown. ReST est le standard en Python, mais il est compliqué (je me suis tapé suffisament de doc sphynx pour témoigner), et pas géré par Github par défaut. Markdown ressort bien sur Pypi même sans conversion en HTML, donc on va garder ce format.</p>
<p>Oh, et ça va sans dire, mais ça va mieux en le disant, on va distribuer les fichiers sous forme de source pure, pas sous forme d&#8217;exe ou d&#8217;egg. C&#8217;est installable avec pip sur toutes les plateformes, et ça évite bien des prises de tête.</p>
<h2>Rendez votre paquets user friendly</h2>
<p>La première chose à faire, avant de mettre en ligne, c&#8217;est de rendre votre paquets facile à utiliser. Assurez-vous d&#8217;avoir les docstrings qui vont bien, et faciliter les imports.</p>
<p>Par exemple, dans notre <em>__init__.py</em>, on va rajouter:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">from</span> core <span style="color: #ff7700;font-weight:bold;">import</span> proclamer</pre></div></div>

<p>Ainsi, l&#8217;utilisateur pourra faire:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">from</span> sm_lib <span style="color: #ff7700;font-weight:bold;">import</span> proclamer</pre></div></div>

<p>au lieu de :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">from</span> sm_lib.<span style="color: black;">core</span> <span style="color: #ff7700;font-weight:bold;">import</span> proclamer</pre></div></div>

<p>Faites cela uniquement pour les fonctions et classes les plus utiles. C&#8217;est un détail, mais ça rend l&#8217;expérience plus agréable.</p>
<p>Ensuite, si l&#8217;utilisateur est dans son shell, il va utiliser l&#8217;autocompletion pour découvrir votre lib. Il va se balader, et spammer &#8220;tab&#8221; pour voir &#8220;ce qu&#8217;il y a dedans&#8221;.</p>
<p>Pour faciliter ce process, limitez ce qui est importable avec <code>__all__</code>:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;">#!/usr/bin/env python</span>
<span style="color: #808080; font-style: italic;"># -*- coding: utf-8 -*-</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">datetime</span> <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">datetime</span>
&nbsp;
__all__ = <span style="color: black;">&#91;</span><span style="color: #483d8b;">'proclamer'</span><span style="color: black;">&#93;</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> proclamer<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;[%s] Sam et Max, c'est bien&quot;</span> <span style="color: #66cc66;">%</span> <span style="color: #dc143c;">datetime</span>.<span style="color: black;">now</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">if</span> __name__ == <span style="color: #483d8b;">&quot;__main__&quot;</span>:
    proclamer<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>Ainsi, seul<code> proclamer()</code> sera importable depuis le module <code>core</code> si quelqu&#8217;un fait un <code>import *</code>. En effet, en important <code>datetime</code>, vous l&#8217;insérer dans le namespace de <code>core</code>, et donc il sera importable en faisant <code>from sm_lib.core import datetime</code>, et il apparaîtra dans l&#8217;autocompletion. Ici ça parait dérisoire, mais sur les grosses libs, ça fait beaucoup de bruit.</p>
<p><code>__all__</code> est une liste strings qui contient les noms de tout ce qu&#8217;on autorise à importer depuis ce module. Utilisez le pour rendre votre API d&#8217;import propre comme la chatte de&#8230; comme un sous neuf pardon. Désolé, par encore habitué à parler la novlang. On s&#8217;y met. On s&#8217;y met.</p>
<p>Pour finir on met les docstrings qui vont bien:</p>
<ul>
<li>une dans <em>__init__.py</em> pour décrire le package;</li>
<li>une au sommet de <em>core.py</em> pour décrire module;</li>
<li>une dans <code>proclamer()</code> pour décrire la fonction.</li>
</ul>
<p>Ainsi l&#8217;utilisateur qui va installer votre lib s&#8217;y retrouvera très facilement en utilisant la fonction <code>help()</code>. Même sans doc et hors ligne.</p>
<p><em>__init__.py</em> (on rajoute aussi l&#8217;en-tête d&#8217;encoding vu que la docstring contient des caractères non-ASCII):</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;">#!/usr/bin/env python</span>
<span style="color: #808080; font-style: italic;"># -*- coding: utf-8 -*-</span>
&nbsp;
<span style="color: #483d8b;">&quot;&quot;&quot;
    Ce module proclame la bonne parole de sieurs Sam et Max. Puissent-t-ils
    retrouver une totale liberté de pensée cosmique vers un nouvel age
    reminiscent.
&quot;&quot;&quot;</span>
&nbsp;
__version__ = <span style="color: #483d8b;">&quot;0.0.1&quot;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> core <span style="color: #ff7700;font-weight:bold;">import</span> proclamer</pre></div></div>

<p>On a aussi rajouté la version, car il n&#8217;y a rien de plus chiant que d&#8217;avoir un bug sur une lib et de ne pas savoir de quelle version il s&#8217;agit. Il va falloir maintenir cette variable à jour.</p>
<p>Et <em>core.py</em>:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;">#!/usr/bin/env python</span>
<span style="color: #808080; font-style: italic;"># -*- coding: utf-8 -*-</span>
&nbsp;
<span style="color: #483d8b;">&quot;&quot;&quot;
    Implémentation de la proclamation de la bonne parole.
&nbsp;
    Usage:
&nbsp;
    &gt;&gt;&gt; from sm_lib import proclamer
    &gt;&gt;&gt; proclamer()
&quot;&quot;&quot;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">datetime</span> <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">datetime</span>
&nbsp;
__all__ = <span style="color: black;">&#91;</span><span style="color: #483d8b;">'proclamer'</span><span style="color: black;">&#93;</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> proclamer<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot;
        Fonction de proclamation de la bonne parole. Aucun paramètre, et
        retourne None, car tout le monde say que &quot;Ex nihilo nihil&quot;
    &quot;&quot;&quot;</span>
    <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;[%s] Sam et Max, c'est bien&quot;</span> <span style="color: #66cc66;">%</span> <span style="color: #dc143c;">datetime</span>.<span style="color: black;">now</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">if</span> __name__ == <span style="color: #483d8b;">&quot;__main__&quot;</span>:
    proclamer<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>Je vous passe le pamphlet sur les tests, c&#8217;est plusieurs articles rien que pour expliquer le pourquoi du comment. C&#8217;est mieux si vous en avez, mais si vous n&#8217;en avez pas, ne vous empêchez pas de publier, ça peut se rajouter au fur et à mesure.</p>
<p>Petite remarque en passant: je met toute la doc en français pour que vous compreniez le principe, mais si vous publiez un truc, je vous recommande chaudement de tout écrire en anglais de A à Z (variables, fonctions, modules, docstrings, comments, readme, doc, tests, etc). Sans quoi votre audience sera limitée au nombre de francophones qui programment, et en Python, et qui ont le niveau pour intéresser aux libs externes. Autant dire l&#8217;équivalent de l&#8217;audience ridicule de ce blog.</p>
<h2>README</h2>
<p>Dans le fichier README.md, qui est un fichier texte ordinnaire, assurez-vous de mettez les choses suivante:</p>
<ul>
<li>A quoi sert la lib.</li>
<li>Comment l&#8217;installer.</li>
<li>Un exempe concret d&#8217;utilisation.</li>
<li>La licence d&#8217;utilisation.</li>
<li>Un lien vers la doc si elle existe.</li>
</ul>
<p>Nous allons mettre le texte au format markdown. C&#8217;est <a href="http://daringfireball.net/projects/markdown/basics">un format très simple</a> qui a le double avantage d&#8217;être automatiquement transformé en HTML par Github, et qui est bien lisible même quand il reste brut, tel qu&#8217;il sera affiché sur Pypi.</p>
<p>Dans notre cas, README.md va ressembler à un mélange des docstrings, un peu amélioré:</p>
<pre>SM Lib - Proclame la bonne parole de sieurs Sam et Max
========================================================

Ce module proclame la bonne parole de sieurs Sam et Max. Puissent-t-ils
retrouver une totale liberté de pensée cosmique vers un nouvel age
reminiscent.

Vous pouvez l'installer avec pip:

    pip install sm_lib

Exemple d'usage:

    >>> from sm_lib import proclamer
    >>> proclamer()

Ce code est sous licence <a href="https://en.wikipedia.org/wiki/WTFPL">WTFPL</a>.</pre>
<h2>MANIFEST.in</h2>
<p>Le fichier va contenir une liste de tous les fichiers non Python qu&#8217;on veut inclure dans le package. Dans notre cas, la photo et le README.</p>
<pre>include *.md
recursive-include sm_lib *.jpg</pre>
<p>La syntaxe est elle aussi très simple, et utilise la notation des globs &#8220;*&#8221;.</p>
<p>La première ligne dit d&#8217;inclure tout fichier dans le nom est &#8220;n&#8217;importe quoi&#8221;.md. Il va inclure le README.<br />
La seconde ligne dit d&#8217;inclure récursivement tout fichier dans le dossier sm_lib et ses sous-dossiers qui est nommé &#8220;n&#8217;importe quoi&#8221;.jpg. Il va inclure notre photo.</p>
<p>On peut mettre plusieurs lignes, et plusieurs motifs sur chaque ligne. Il n&#8217;est donc pas rare de voir des fichiers qui ressemblent à ça:</p>
<pre>include *.txt *.rst
recursive-include dir1 *.txt *.rst
recursive-include dir2 *.png *.jpg *.gif
recursive-include dir2 *.css *.js *.coffee</pre>
<h2>Setup.py</h2>
<p>C&#8217;est la partie difficile. Le fichier <em>setup.py</em> contient une fonction qui va magiquement installer votre lib, et il faut lui passer des paramètres et l&#8217;appeler. Le problème c&#8217;est que cette fonction compte 34 (à ma connaissance) arguments.</p>
<p>Vous pouvez mettre n&#8217;importe quel code Python dans le <em>setup.py</em>, mais généralement la fonction <code>setup()</code> suffit.</p>
<p>Je vais mettre dans ce <em>setup.py</em> les paramètres que vous utiliserez les plus souvent:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;">#!/usr/bin/env python</span>
<span style="color: #808080; font-style: italic;"># -*- coding: utf-8 -*-</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> setuptools <span style="color: #ff7700;font-weight:bold;">import</span> setup, find_packages
&nbsp;
<span style="color: #808080; font-style: italic;"># notez qu'on import la lib</span>
<span style="color: #808080; font-style: italic;"># donc assurez-vous que l'importe n'a pas d'effet de bord</span>
<span style="color: #ff7700;font-weight:bold;">import</span> sm_lib
&nbsp;
<span style="color: #808080; font-style: italic;"># Ceci n'est qu'un appel de fonction. Mais il est trèèèèèèèèèèès long</span>
<span style="color: #808080; font-style: italic;"># et il comporte beaucoup de paramètres</span>
setup<span style="color: black;">&#40;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># le nom de votre bibliothèque, tel qu'il apparaitre sur pypi</span>
    name=<span style="color: #483d8b;">'sm_lib'</span>,
&nbsp;
    <span style="color: #808080; font-style: italic;"># la version du code</span>
    version=sm_lib.__version__,
&nbsp;
    <span style="color: #808080; font-style: italic;"># Liste les packages à insérer dans la distribution</span>
    <span style="color: #808080; font-style: italic;"># plutôt que de le faire à la main, on utilise la foncton</span>
    <span style="color: #808080; font-style: italic;"># find_packages() de setuptools qui va cherche tous les packages</span>
    <span style="color: #808080; font-style: italic;"># python recursivement dans le dossier courant.</span>
    <span style="color: #808080; font-style: italic;"># C'est pour cette raison que l'on a tout mis dans un seul dossier:</span>
    <span style="color: #808080; font-style: italic;"># on peut ainsi utiliser cette fonction facilement</span>
    packages=find_packages<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>,
&nbsp;
    <span style="color: #808080; font-style: italic;"># votre pti nom</span>
    author=<span style="color: #483d8b;">&quot;Sam et Max&quot;</span>,
&nbsp;
    <span style="color: #808080; font-style: italic;"># Votre email, sachant qu'il sera publique visible, avec tous les risques</span>
    <span style="color: #808080; font-style: italic;"># que ça implique.</span>
    author_email=<span style="color: #483d8b;">&quot;lesametlemax@gmail.com&quot;</span>,
&nbsp;
    <span style="color: #808080; font-style: italic;"># Une description courte</span>
    description=<span style="color: #483d8b;">&quot;Proclame la bonne parole de sieurs Sam et Max&quot;</span>,
&nbsp;
    <span style="color: #808080; font-style: italic;"># Une description longue, sera affichée pour présenter la lib</span>
    <span style="color: #808080; font-style: italic;"># Généralement on dump le README ici</span>
    long_description=<span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'README.md'</span><span style="color: black;">&#41;</span>.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>,
&nbsp;
    <span style="color: #808080; font-style: italic;"># Vous pouvez rajouter une liste de dépendances pour votre lib</span>
    <span style="color: #808080; font-style: italic;"># et même préciser une version. A l'installation, Python essayera de</span>
    <span style="color: #808080; font-style: italic;"># les télécharger et les installer.</span>
    <span style="color: #808080; font-style: italic;">#</span>
    <span style="color: #808080; font-style: italic;"># Ex: [&quot;gunicorn&quot;, &quot;docutils &gt;= 0.3&quot;, &quot;lxml==0.5a7&quot;]</span>
    <span style="color: #808080; font-style: italic;">#</span>
    <span style="color: #808080; font-style: italic;"># Dans notre cas on en a pas besoin, donc je le commente, mais je le</span>
    <span style="color: #808080; font-style: italic;"># laisse pour que vous sachiez que ça existe car c'est très utile.</span>
    <span style="color: #808080; font-style: italic;"># install_requires= ,</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Active la prise en compte du fichier MANIFEST.in</span>
    include_package_data=<span style="color: #008000;">True</span>,
&nbsp;
    <span style="color: #808080; font-style: italic;"># Une url qui pointe vers la page officielle de votre lib</span>
    url=<span style="color: #483d8b;">'http://github.com/sametmax/sm_lib'</span>,
&nbsp;
    <span style="color: #808080; font-style: italic;"># Il est d'usage de mettre quelques metadata à propos de sa lib</span>
    <span style="color: #808080; font-style: italic;"># Pour que les robots puissent facilement la classer.</span>
    <span style="color: #808080; font-style: italic;"># La liste des marqueurs autorisées est longue, alors je vous</span>
    <span style="color: #808080; font-style: italic;"># l'ai mise sur 0bin: http://is.gd/AajTjj</span>
    <span style="color: #808080; font-style: italic;">#</span>
    <span style="color: #808080; font-style: italic;"># Il n'y a pas vraiment de règle pour le contenu. Chacun fait un peu</span>
    <span style="color: #808080; font-style: italic;"># comme il le sent. Il y en a qui ne mettent rien.</span>
    classifiers=<span style="color: black;">&#91;</span>
        <span style="color: #483d8b;">&quot;Programming Language :: Python&quot;</span>,
        <span style="color: #483d8b;">&quot;Development Status :: 1 - Planning&quot;</span>,
        <span style="color: #483d8b;">&quot;License :: OSI Approved&quot;</span>,
        <span style="color: #483d8b;">&quot;Natural Language :: French&quot;</span>,
        <span style="color: #483d8b;">&quot;Operating System :: OS Independent&quot;</span>,
        <span style="color: #483d8b;">&quot;Programming Language :: Python :: 2.7&quot;</span>,
        <span style="color: #483d8b;">&quot;Topic :: Communications&quot;</span>,
    <span style="color: black;">&#93;</span>,
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;"># C'est un système de plugin, mais on s'en sert presque exclusivement</span>
    <span style="color: #808080; font-style: italic;"># Pour créer des commandes, comme &quot;django-admin&quot;.</span>
    <span style="color: #808080; font-style: italic;"># Par exemple, si on veut créer la fabuleuse commande &quot;proclame-sm&quot;, on</span>
    <span style="color: #808080; font-style: italic;"># va faire pointer ce nom vers la fonction proclamer(). La commande sera</span>
    <span style="color: #808080; font-style: italic;"># créé automatiquement. </span>
    <span style="color: #808080; font-style: italic;"># La syntaxe est &quot;nom-de-commande-a-creer = package.module:fonction&quot;.</span>
    entry_points = <span style="color: black;">&#123;</span>
        <span style="color: #483d8b;">'console_scripts'</span>: <span style="color: black;">&#91;</span>
            <span style="color: #483d8b;">'proclame-sm = sm_lib.core:proclamer'</span>,
        <span style="color: black;">&#93;</span>,
    <span style="color: black;">&#125;</span>,
&nbsp;
    <span style="color: #808080; font-style: italic;"># A fournir uniquement si votre licence n'est pas listée dans &quot;classifiers&quot;</span>
    <span style="color: #808080; font-style: italic;"># ce qui est notre cas</span>
    license=<span style="color: #483d8b;">&quot;WTFPL&quot;</span>,
&nbsp;
    <span style="color: #808080; font-style: italic;"># Il y a encore une chiée de paramètres possibles, mais avec ça vous</span>
    <span style="color: #808080; font-style: italic;"># couvrez 90% des besoins</span>
&nbsp;
<span style="color: black;">&#41;</span></pre></div></div>

<h2>Tester si tout marche bien</h2>
<p>Si vous publiez du code, je vais partir du principe que vous utilisez au moins un <a href="http://sametmax.com/les-environnement-virtuels-python-virtualenv-et-virtualenvwrapper/">virtualenv</a> :-)</p>
<p>Donc, activez un environnement de test, et dans le dossier contenant <em>setup.py</em>, faites:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">python setup.py <span style="color: #c20cb9; font-weight: bold;">install</span></pre></div></div>

<p>Normalement votre lib devrait s&#8217;insaller dans votre env proprement. Vous devriez pouvoir faire dans un shell Python:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">from</span> sm_lib <span style="color: #ff7700;font-weight:bold;">import</span> proclamer
<span style="color: #66cc66;">&gt;&gt;&gt;</span> proclamer<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: black;">&#91;</span><span style="color: #ff4500;">2012</span>-<span style="color: #ff4500;">11</span>-<span style="color: #ff4500;">16</span> <span style="color: #ff4500;">13</span>:06:<span style="color: #ff4500;">58.128545</span><span style="color: black;">&#93;</span> Sam et Max, c<span style="color: #483d8b;">'est bien</span></pre></div></div>

<p>Et comme on a créé une commande, on doit aussi pouvoir faire depuis un terminal:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">$ proclame-sm
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2012</span>-<span style="color: #000000;">11</span>-<span style="color: #000000;">16</span> <span style="color: #000000;">13</span>:08:<span style="color: #000000;">18.763732</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> Sam et Max, c<span style="color: #ff0000;">'est bien</span></pre></div></div>

<p>Si vous regardez dans votre virtualenv, vous verrez que votre package a été ajouté. Sur ma machine il se trouve par exemple à <em>~/.virtualenvs/test/lib/python2.7/site-packages/sm_lib-0.0.1-py2.7.egg/sm_lib</em>.</p>
<p>La photo doit-être dedans, ainsi que le code Python. La photo est un exemple important à comprendre et à faire marcher car c&#8217;est le manifeste que vous utiliserez pour tous les fichiers non Python: CSS, Javascript, Documentation, Images, Xml, Json, etc. </p>
<h2>Publier sur Pypi</h2>
<p>Cela va vous paraitre étonnant, mais tout le monde peut publier sur Pypi. Pourvu que le nom soit disponible, vous pouvez en fait uploader n&#8217;importe quoi. Même une lib de test comme celle-ci.</p>
<p>Entrez la commande (il faut avoir accès à internet):</p>
<p><code>$ python setup.py register</code></p>
<p>Ceci va inscrire votre lib dans leur listing. Et donnera une sortie qui ressemble à ça:</p>
<pre>running register
running egg_info
writing sm_lib.egg-info/PKG-INFO
writing top-level names to sm_lib.egg-info/top_level.txt
writing dependency_links to sm_lib.egg-info/dependency_links.txt
writing entry points to sm_lib.egg-info/entry_points.txt
reading manifest file 'sm_lib.egg-info/SOURCES.txt'
reading manifest template 'MANIFEST.in'
writing manifest file 'sm_lib.egg-info/SOURCES.txt'
running check
We need to know who you are, so please choose either:
 1. use your existing login,
 2. register as a new user,
 3. have the server generate a new password for you (and email it to you), or
 4. quit
Your selection [default 1]: </pre>
<p>Choissisez 2. Il va vous permettre de créer un compte. Quand il vous demandera de sauvegarder vos identifiants pour un usage future, répondre oui vous permettra de ne pas rentrer votre mot de passe à chaque upload.</p>
<p>La prochaine fois vous pourrez choisir 1, puisque vous aurez un compte.</p>
<p>Si ça se coupe, relancez juste la commande. Le but étant d&#8217;obtenir ça:</p>
<pre>Registering sm_lib to http://pypi.python.org/pypi
Server response (200): OK</pre>
<p>Ce qui signifie que votre lib est inscrite sur Pypi (et que donc le nom était disponible, sinon il vous enverra chier et vous avez plus qu&#8217;à renommer votre lib).</p>
<p>Puis, il faut créer une distribution source (sdist) et le mettre en ligne (upload):</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">python setup.py sdist upload</pre></div></div>

<p>Et voilà, votre lib est en ligne et installable avec pip !</p>
<p>Voici la <a href="http://pypi.python.org/pypi/sm_lib/">page pypi</a>, et <a href="https://github.com/sametmax/sm_lib">la page gitub</a> (ce qui n&#8217;a rien à voir, mais si vous voulez le code source&#8230;).</p>
<p>C&#8217;est finit. Si vous voulez uploader une nouvelle version de votre lib, il faut changer <code>__version__</code> car Pypi n&#8217;accepte pas deux fois la même version.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=3102&amp;md5=1f79ca96ddf35400a31f46f66cc96e9b" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/creer-un-setup-py-et-mettre-sa-bibliotheque-python-en-ligne-sur-pypi/feed/</wfw:commentRss>
		<slash:comments>47</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fcreer-un-setup-py-et-mettre-sa-bibliotheque-python-en-ligne-sur-pypi%2F&amp;language=en_GB&amp;category=text&amp;title=Cr%C3%A9er+un+setup.py+et+mettre+sa+biblioth%C3%A8que+Python+en+ligne+sur+Pypi&amp;description=Je+crois+que+ce+sujet+est+dans+le+top+10+des+trucs+qui+paraissent+mystiques+m%C3%AAme+apr%C3%A8s+avoir+pass%C3%A9+des+heures+sur+les+docs+sur+le+net.+Et+si+%C3%A7a...&amp;tags=pip%2Cpypi%2Cpython%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2012/11/holy-book.jpg" length="73560" type="image/jpg" />	</item>
		<item>
		<title>Votre Python aime les pip</title>
		<link>http://sametmax.com/votre-python-aime-les-pip/</link>
		<comments>http://sametmax.com/votre-python-aime-les-pip/#comments</comments>
		<pubDate>Sat, 08 Sep 2012 13:42:27 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[easy_install]]></category>
		<category><![CDATA[git]]></category>
		<category><![CDATA[github]]></category>
		<category><![CDATA[pip]]></category>
		<category><![CDATA[pypi]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[setuptools]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=2014</guid>
		<description><![CDATA[<code>Pip install</code> par-ci, <code>pip install</code> par là. "Pour installer cette lib, il vous suffit de faire pip install".

Mais merde, c'est quoi <code>pip</code> ?]]></description>
			<content:encoded><![CDATA[<p><code>Pip install</code> par-ci, <code>pip install</code> par là. &#8220;Pour installer cette lib, il vous suffit de faire pip install&#8221;.</p>
<p>Mais merde, c&#8217;est quoi <code>pip</code> ?</p>
<h2>Python et les libs externes</h2>
<p>La beauté avec Python, c&#8217;est qu&#8217;on peut prendre une lib, la balancer dans le répertoire courant, et l&#8217;importer. Rien à faire, ça marche tout seul.</p>
<p>Mais.</p>
<p>Car oui, il y a toujours un mais (souvent après le mois de mars).</p>
<p>Quand il faut mettre à jour ses libs, c&#8217;est chiant. Quand il faut recréer un environnement complet en prod, c&#8217;est chiant. Quand il faut trouver la dernière version, avec le bon site Web, et le lien de téléchargement, c&#8217;est chiant. Quand on veut installer une lib automatiquement, vous l&#8217;avez deviné, c&#8217;est chiant.</p>
<p>Mais surtout, quand on a une lib qui a des parties en C à compiler comme les libs de crypto, d&#8217;accès à la base de données, de traitement XML, de parsing ou de sérialisation, de calculs scientifiques, etc. ça ne marche tout simplement pas.</p>
<p>Là, il y a deux écoles. Les mecs qui utilisent les packages *.exe ou *.deb precompilés et qui se retrouvent avec d&#8217;autres problèmes.</p>
<p>Et les mecs qui utilisent setuptools (et qui se retrouvent avec encore d&#8217;autres problèmes, mais c&#8217;est mieux parce que je le dis).</p>
<h2>Setuptools, la solution de skippy à tous vos soucis</h2>
<p>setuptools est une lib et un outil de distribution de code Python, et elle permet notament d&#8217;installer des libs externes automatiquement en les téléchargeant depuis le grand InterBoule.</p>
<p>Comme <code>gem install</code> sous ruby, <code>npm</code> pour NodeJs, Python possède sa commande d&#8217;installation appelée <code>easy_install</code>, qui va piocher dans le site Web <a href="http://pypi.python.org/pypi">pypi.python.org</a>, un équivalent de <a href="http://www.cpan.org/">Cpan</a> de Perl ou des <a href="http://pear.php.net/channels/">channels pear</a> pour PHP.</p>
<p>Bien entendu, ça serait trop simple sinon, Python ne vient pas par défaut installé avec cet outil pourtant indispensable.</p>
<p>Sous Ubuntu c&#8217;est facile:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #c20cb9; font-weight: bold;">apt-get</span> <span style="color: #c20cb9; font-weight: bold;">install</span> python-setuptools</pre></div></div>

<p>Et il existe un paquet similaire sur toutes les distribs.</p>
<p>Sous windows, c&#8217;est <a href="http://pypi.python.org/pypi/setuptools#downloads">un exe</a> à installer. Choisissez la bonne version selon votre version de Python (<code>python --version</code>). Généralement, la 2.7. </p>
<p>Sous mac, il faut télécharger <a href="http://pypi.python.org/pypi/setuptools#downloads">l&#8217;egg correspondant à sa version</a> puis:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">sh</span> setuptools-votre_version.egg <span style="color: #660033;">--prefix</span>=~</pre></div></div>

<p>Et vous avez alors accès à la commande magique, <code>easy_install</code>. Par exemple, pour installer Django:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">easy_install django <span style="color: #660033;">--user</span></pre></div></div>

<p>(ou <code>easy_install django</code> en mode administrateur &#8211; ou avec <code>sudo</code> &#8211; pour l&#8217;installer pour tout le système et pas juste l&#8217;utilisateur courant)</p>
<p>Il faut bien entendu être connecté à internet pour que ça marche. Notez par ailleurs que la recherche est insensible à la casse, et que tout underscore sera automatiquement remplacé par un tiret.</p>
<p>Sous Windows, si la commande n&#8217;est pas trouvée, il vous faudra rajouter le répertoire qui contient la commande <code>easy_install</code> (le plus souvent <em>C:\Python27\Scripts</em>) à la main dans le <a href="http://sametmax.com/ajouter-un-chemin-a-la-variable-denvironnement-path-sous-windows/">PATH</a>.</p>
<h2>Vous avez <code>easy_install</code> ? Oubliez-le !</h2>
<p>Vous n&#8217;utiliserez normalement <code>easy_install</code> que pour une seule chose: installer <code>pip</code>.</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">easy_install pip <span style="color: #660033;">--user</span></pre></div></div>

<p><code>pip</code> est un <code>easy_install</code> en plus court à taper, plus puissant, plus souple, plus mieux.</p>
<p>Il s&#8217;utilise comme <code>easy_install</code> :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">pip <span style="color: #c20cb9; font-weight: bold;">install</span> <span style="color: #660033;">--user</span> bottle</pre></div></div>

<p>(ou <code>sudo pip install bottle</code>, ou en root, mais je sauterai ce genre de détails pour la suite)</p>
<p>Grâce à <code>pip</code>, vous allez avoir accès à des milliers de libs Python en quelques frappes, et donc pouvoir beaucoup plus facilement expérimenter avec des nouveaux bidules.</p>
<p>Mais <code>pip</code> va plus loin qu&#8217;<code>easy_install</code>, et permet carrément de gérer toutes les dépendances de son projet.</p>
<h2>Ce que fait <code>pip</code> que <code>easy_install</code> ne fait pas</h2>
<p>Déjà, <code>pip</code> télécharge toutes les dépendances avant de lancer l&#8217;installation, ce qui évite une installation partielle.</p>
<p>Mais surtout, <code>pip</code> ajoute des opérations qu&#8217;on pourrait attendre de base, notamment, la désinstallation :-)</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">pip uninstall bottle</pre></div></div>

<p>Évidement, on peut choisir d&#8217;installer une version particulière:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">pip <span style="color: #c20cb9; font-weight: bold;">install</span> <span style="color: #007800;">bottle</span>==<span style="color: #000000;">0.9</span></pre></div></div>

<p>Et mettre à jour une lib à la dernière version :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">pip <span style="color: #c20cb9; font-weight: bold;">install</span> bottle <span style="color: #660033;">--upgrade</span></pre></div></div>

<p>Ou downgrader vers une version précédente:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">pip <span style="color: #c20cb9; font-weight: bold;">install</span> <span style="color: #007800;">bottle</span>==<span style="color: #000000;">0.9</span> <span style="color: #660033;">--upgrade</span></pre></div></div>

<p>Cependant, le plus intéressant avec <code>pip</code>, c&#8217;est sa capacité à recréer tout un environnement de développement en une commande:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">$ pip freeze
<span style="color: #007800;">Axiom</span>==0.6.0
<span style="color: #007800;">BeautifulSoup</span>==3.2.0
<span style="color: #007800;">Brlapi</span>==0.5.6
<span style="color: #007800;">BzrTools</span>==2.5.0
<span style="color: #007800;">CherryPy</span>==3.2.2
<span style="color: #007800;">Coherence</span>==0.6.6.2
<span style="color: #7a0874; font-weight: bold;">&#91;</span>...<span style="color: #7a0874; font-weight: bold;">&#93;</span></pre></div></div>

<p><code>pip freeze</code> liste toutes les librairies installées et leurs versions. On peut ensuite les réinstaller sur une autre machine facilement:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">pip freeze <span style="color: #000000; font-weight: bold;">&gt;</span> requirements.txt</pre></div></div>

<p>Et sur l&#8217;autre machine:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">pip <span style="color: #c20cb9; font-weight: bold;">install</span> <span style="color: #660033;">-r</span> requirements.txt</pre></div></div>

<p>On est garanti d&#8217;avoir les mêmes libs, avec les mêmes versions. Ca marche de la même manière sous tous les OS, et comme des milliers de libs ne sont pas disponibles en paquets *.deb, *.rpm ou *.exe, c&#8217;est extrêmement pratique.</p>
<p>Si vous vous attendez à être privé de connexion internet ou juste pour accélérer le procédé, <code>pip</code> permet de créer un bundle, c&#8217;est à dire un gros zip qui contient toutes les dépendances et qui peut être installé indépendamment :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">pip bundle nom_du_projet.pybundle <span style="color: #660033;">-r</span> requirements.txt</pre></div></div>

<p>Et sur l&#8217;autre machine:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">pip <span style="color: #c20cb9; font-weight: bold;">install</span> nom_du_projet.pybundle</pre></div></div>

<h2>Quelques astuces pour être productif avec <code>pip</code></h2>
<p>Si vous installez beaucoup de fois les mêmes paquets, par exemple dans de nombreux <a href="sametmax.com/les-environnement-virtuels-python-virtualenv-et-virtualenvwrapper">virtualenvs</a> j&#8217;installe toujours ipython + ipdb + requests + clize + peewee, les télécharger à chaque fois est une perte de temps. On peut demander à <code>pip</code> de mettre en cache les paquets déjà installés, pour de futures installations:</p>
<p><code>export PIP_DOWNLOAD_CACHE='~/.pip/cache';</code> dans le <em>.bashrc</em></p>
<p>Pour les windowsiens, je ne sais pas du tout où mettre ça&#8230;</p>
<p>Sachez cependant que le cache ne dispense pas d&#8217;être connecté à Internet.</p>
<p>Si une bibliothèque n&#8217;est pas encore sur pypi, <code>pip</code> est capable, pourvu que le code source vienne avec un fichier <em>setup.py</em>, de l&#8217;installer depuis un fichier local, une URL, ou même un simple repo git. Donc si vous trouvez une lib chouette sur github, on peut l&#8217;installer ainsi:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">pip <span style="color: #c20cb9; font-weight: bold;">install</span> <span style="color: #c20cb9; font-weight: bold;">git</span>+<span style="color: #c20cb9; font-weight: bold;">git</span>:<span style="color: #000000; font-weight: bold;">//</span>github.com<span style="color: #000000; font-weight: bold;">/</span>sametmax<span style="color: #000000; font-weight: bold;">/</span>0bin.git</pre></div></div>

<p>Et elle sera même référencée par le <code>pip freeze</code> !</p>
<p>Remarquez qu&#8217;il faut avoir Git installé, et que le protocole doit être changé pour <em>git+git</em>.</p>
<p>Parfois, pypi est indisponible: un problème sur le site, un problème de dns, un problème de votre FAI&#8230; Dans ce cas là on est un peu désemparé. Heureusement, <code>pip</code> permet aussi de faire un fallback sur des miroirs:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">pip <span style="color: #c20cb9; font-weight: bold;">install</span> <span style="color: #660033;">--use-mirrors</span> requests</pre></div></div>

<p>Dans ce cas pip essayera de trouver le paquet sur une liste de sites miroirs de pypi qu&#8217;il possède en interne. Il va les essayer un par un jusqu&#8217;à en trouver un de disponible.</p>
<p>Dans le cas les plus extrêmes, certains vont jusqu&#8217;à créer leur propre miroir en local. Mais c&#8217;est un article à part entière.</p>
<h2>Installer des bibliothèques avec des extensions en C</h2>
<p>Les bibliothèques avec des extensions en C sont très courantes dans les domaines qui ont besoin de performances: drivers de base de données (m<code>ysql-python</code>), calculs scientifiques (<code>numpy</code>), parsing (<code>lxml</code>), cryptographie (<code>pycrypto</code>), etc.</p>
<p>Pip ne fonctionnera que partiellement pour installer ces libs: il devra en effet lancer la compilation de l&#8217;extension. Bien que le processus soit automatique et bien fait, il arrive souvent qu&#8217;il manque des dépendances.</p>
<p>Pour ce genre de lib, soit vous utilisez un paquet tout fait (*.deb, *.exe, *.rpm, etc.), soit vous tentez d&#8217;installer les dépendances.</p>
<p>La première chose à faire, c&#8217;est installer les headers de Python. Sous Ubuntu, c&#8217;est:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">sudo apt-get install python-dev</pre></div></div>

<p>(et sous CentOs, c&#8217;est un <code>yum install python-devel</code>. Pour Mac, aucune idée.)</p>
<p>Ensuite, on lance l&#8217;installation une fois de la lib, et on voit ce qui plante, pour installer les dépendances en conséquence. Par exemple, <code>lxml</code> a besoin des headers de <code>libxml2</code> et <code>libxslt1</code>. Donc on va installer <code>libxml2-dev</code> et <code>libxslt1-dev</code>. Pour <code>python-mysql</code>, il va falloir installer <code>libmysqlclient-dev</code>.</p>
<p>Quand on est une grosse feignasse, mais que l&#8217;on a quand même envie d&#8217;installer la lib avec <code>pip</code> (typiquement, dans le cas d&#8217;un virtualenv). on peut faire le compromis de l&#8217;installer sur le système avec un paquet, et ensuite de l&#8217;installer avec <code>pip</code>. Ca évite de faire la chasse aux dépendances, mais ça fait double installation.</p>
<p>Enfin, il y a des libs qui ne s&#8217;installeront jamais avec <code>pip</code>. Par exemple, un mastodonte genre <code>PyQT</code>. Oubliez, c&#8217;est tout.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=2014&amp;md5=2044fbd1393cb3932678a1fe3e7096ec" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/votre-python-aime-les-pip/feed/</wfw:commentRss>
		<slash:comments>25</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fvotre-python-aime-les-pip%2F&amp;language=en_GB&amp;category=text&amp;title=Votre+Python+aime+les+pip&amp;description=Pip+install+par-ci%2C+pip+install+par+l%C3%A0.+%26%238220%3BPour+installer+cette+lib%2C+il+vous+suffit+de+faire+pip+install%26%238221%3B.+Mais+merde%2C+c%26%238217%3Best+quoi+pip+%3F+Python+et+les+libs+externes+La...&amp;tags=easy_install%2Cgit%2Cgithub%2Cpip%2Cpypi%2Cpython%2Csetuptools%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2012/09/4_original.jpg" length="85720" type="image/jpg" />	</item>
	</channel>
</rss>
