<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Sam &#38; Max: Python, Django, Git et du cul &#187; poo</title>
	<atom:link href="http://sametmax.com/tag/poo/feed/" rel="self" type="application/rss+xml" />
	<link>http://sametmax.com</link>
	<description>Deux développeurs en vadrouille qui se sortent les doigts du code</description>
	<lastBuildDate>Mon, 02 Dec 2013 10:02:45 +0000</lastBuildDate>
	<language>en</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.3.1</generator>
	<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2F&amp;language=en_US&amp;category=text&amp;title=Sam+%26amp%3B+Max%3A+Python%2C+Django%2C+Git+et+du+cul&amp;description=Deux+d%C3%A9veloppeurs+en+vadrouille+qui+se+sortent+les+doigts+du+code&amp;tags=blog" type="text/html" />
		<item>
		<title>Ecrire un code pour les autres en Python</title>
		<link>http://sametmax.com/ecrire-un-code-pour-les-autres-en-python/</link>
		<comments>http://sametmax.com/ecrire-un-code-pour-les-autres-en-python/#comments</comments>
		<pubDate>Sat, 17 Aug 2013 13:15:07 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[context manager]]></category>
		<category><![CDATA[poo]]></category>
		<category><![CDATA[property]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=7122</guid>
		<description><![CDATA[Cet article s'adresse à des développeurs qui commencent à être bien dans leurs chaussettes en Python et qui se sentent de relever le défi d'écrire du code pour d'autres personnes.
]]></description>
			<content:encoded><![CDATA[<p>Cet article s&#8217;adresse à des développeurs qui commencent à être bien dans leurs chaussettes en Python et qui se sentent de relever le défi d&#8217;écrire du code pour d&#8217;autres personnes.</p>
<p>Car quand vous allez publier du code, un script, une lib voire, Dieu ait pitié de vous, un framework, les gens qui vont les utiliser vont avoir des besoins auxquels vous n&#8217;aviez pas pensé. Or, ils ne voudront pas modifier votre code. L&#8217;interêt d&#8217;utiliser le code d&#8217;un autre, c&#8217;est justement de s&#8217;éviter la maintenance. Ils voudront aussi prendre en main rapidement votre outil pour faire des choses simples sans avoir à tout comprendre.</p>
<p>Ainsi, il va vous falloir intégrer divers moyens d&#8217;étendre les fonctionnalités de votre code, afin que les autres dev puissent l&#8217;utiliser dans le cadre de leurs besoins.</p>
<p>Nous allons donc construire un projet bidon : une barre de progression en ASCII dont la sortie va ressembler à ceci :</p>
<p>Starting [=========================================     ] 93%</p>
<p>L&#8217;idée est de pouvoir l&#8217;utiliser ainsi :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">    <span style="color: #ff7700;font-weight:bold;">with</span> ProgressBar<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> pb:
        <span style="color: #ff7700;font-weight:bold;">for</span> progres <span style="color: #ff7700;font-weight:bold;">in</span> faire_un_truc<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
            pb.<span style="color: black;">progress</span> = progres</pre></div></div>

<p>Nous allons le proposer ce projet sous forme de classe importable, et nous allons voir plusieurs manières de rendre ce code facile à prendre en main, configurable et extensible :</p>
<ul>
<li>Paramètres, avec un ordre intelligent et des valeurs par défaut saines.</li>
<li>Templating de l&#8217;ouput.</li>
<li>Methodes pouvant être écrasée par héritage.</li>
<li>Getter and setter (ici via des propriétés)</li>
<li>Exposition intelligente des attributs de la classe.</li>
<li>Callbacks et passage réfléchi de paramètres à ceux-ci.</li>
</ul>
<p>J&#8217;aurais pu ajouter l&#8217;injection de dépendance, mais j&#8217;ai déjà traité ce sujet dans un autre article, et je ne voulais pas charger celui-ci. Il est déjà bien gras.</p>
<p>J&#8217;ai aussi volontairement omis la docstring et les comments. Écrire une bonne doc est un article à part entière.</p>
<p>Pré-requis : être parfaitement à l&#8217;aise avec le <a href="http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-1/">POO</a> et les références, comprendre le principe des context managers, avoir pigé les <a href="http://sametmax.com/quest-ce-quun-callback/">callbacks</a>.</p>
<p>Et roulez jeunesse !</p>

<!-- iframe plugin v:2.3 - wordpress.org/extend/plugins/iframe/ -->
<iframe width="560" height="315" src="//www.youtube.com/embed/zoF7qxapnSA" frameborder="0" scrolling="no" class="iframe-class"></iframe>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># -*- coding: utf-8 -*-</span>
&nbsp;
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">sys</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> io <span style="color: #ff7700;font-weight:bold;">import</span> IOBase
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;"># On hérite d'IOBase pour permettre le détournement de stdout. Voir plus bas.</span>
<span style="color: #ff7700;font-weight:bold;">class</span> ProgressBar<span style="color: black;">&#40;</span>IOBase<span style="color: black;">&#41;</span>:
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;"># On met les paramètres par ordre de fréquence d'utilisation. Il est</span>
    <span style="color: #808080; font-style: italic;"># plus probable que les programmeurs changent le total que la sortie</span>
    <span style="color: #808080; font-style: italic;"># du programme.</span>
    <span style="color: #808080; font-style: italic;"># Mettre des valeurs par défaut saines permet à l'utilisateur de faire</span>
    <span style="color: #808080; font-style: italic;"># des essais sans trop regarder la doc. Par ailleurs, des valeurs par</span>
    <span style="color: #808080; font-style: italic;"># défaut servent de documentation en soit, et apparaitront si help()</span>
    <span style="color: #808080; font-style: italic;"># est appelé.</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, total=<span style="color: #ff4500;">100</span>,  percent_per_sign=<span style="color: #ff4500;">1</span>,
                 progress_sign=<span style="color: #483d8b;">'='</span>, callbacks=<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>,
                 template=<span style="color: #483d8b;">'Starting [{bar}] {progress}%'</span>,
                 output=<span style="color: #dc143c;">sys</span>.<span style="color: black;">stdout</span>, intercept_stdout=<span style="color: #008000;">True</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #808080; font-style: italic;"># Par défaut le total est 100, afin que l'utilisateur passe un</span>
        <span style="color: #808080; font-style: italic;"># pourcentage, ce qui est le plus naturel. Néanmoins, si il souhaite</span>
        <span style="color: #808080; font-style: italic;"># s'affranchir de calculs, on lui permet de passer une autre valeur</span>
        <span style="color: #808080; font-style: italic;"># qui sera ramenée à un pourcentage automatiquement à l'affichage</span>
        <span style="color: #808080; font-style: italic;"># de toute façon.</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">total</span> = total
&nbsp;
        <span style="color: #808080; font-style: italic;"># Customisation de base : changer le symbole de progrès. Par défaut</span>
        <span style="color: #808080; font-style: italic;"># un égal, mais certains aiment les ., les - ou autre.</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">progress_sign</span> = progress_sign
&nbsp;
        <span style="color: #808080; font-style: italic;"># Idem, si la personne veut une barre plus ou moins longue.</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">percent_per_sign</span> = percent_per_sign
&nbsp;
        <span style="color: #808080; font-style: italic;"># la longueur de la barre de progression</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">bar_len</span> = <span style="color: #ff4500;">100</span> / percent_per_sign <span style="color: #66cc66;">*</span> <span style="color: #008000;">len</span><span style="color: black;">&#40;</span>progress_sign<span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Le formatage de la progress bar se fait à l'aide d'une chaîne</span>
        <span style="color: #808080; font-style: italic;"># ordinaire qui sert de template (avec le langage de formatage de Python)</span>
        <span style="color: #808080; font-style: italic;"># et peut facilement être changée pour obtenir plus de contrôle</span>
        <span style="color: #808080; font-style: italic;"># sur l'aspect de la bar.</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">template</span> = template
&nbsp;
        <span style="color: #808080; font-style: italic;"># On peut aussi passer un tuple de fonctions qui permettent de réagir</span>
        <span style="color: #808080; font-style: italic;"># à chaque fois que le progrès change. On utilise nous-même notre</span>
        <span style="color: #808080; font-style: italic;"># système de callback pour que la methode print_progress() soit</span>
        <span style="color: #808080; font-style: italic;"># appelée à chaque fois, mettant à jour l'affichage de la bar.</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">callbacks</span> = callbacks + <span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">print_progress</span>,<span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Initialisation de 3 variables à vide. 'buffer' va contenir</span>
        <span style="color: #808080; font-style: italic;"># tout ce qui va être écrit avec write() pour éviter de perturber</span>
        <span style="color: #808080; font-style: italic;"># l'affichage de la bar, et '_progress' va contenir le progrès, mais</span>
        <span style="color: #808080; font-style: italic;"># le '_' signale que c'est une variable à usage interne. Nous allons</span>
        <span style="color: #808080; font-style: italic;"># en effet l'enrober dans une propriété. Enfin cursor_shift est</span>
        <span style="color: #808080; font-style: italic;"># le nombre de caractères à effacer pour redessiner la bar à chaque</span>
        <span style="color: #808080; font-style: italic;"># mise à jour.</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">buffer</span> = <span style="color: #483d8b;">''</span>
        <span style="color: #008000;">self</span>._progress = <span style="color: #ff4500;">0</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">cursor_shift</span> = <span style="color: #ff4500;">0</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Par défaut, on s'attend à ce que l'utilisateur affiche cette</span>
        <span style="color: #808080; font-style: italic;"># bar directement dans le terminal, sur la sortie standard. Mais</span>
        <span style="color: #808080; font-style: italic;"># il peut vouloir déporter l'affichage ailleurs (par exemple stderr).</span>
        <span style="color: #808080; font-style: italic;"># Pour cette raison, on permet de passer le stream sur lequel</span>
        <span style="color: #808080; font-style: italic;"># l'utilisateur va écrire, même si par défaut on prend sys.stdout,</span>
        <span style="color: #808080; font-style: italic;"># donc la sortie standard.</span>
        <span style="color: #808080; font-style: italic;"># Si l'utilisateur ne souhaite rien de tout cela, il peut également</span>
        <span style="color: #808080; font-style: italic;"># retirer 'self.print_progress' de la liste des callbacks puisque</span>
        <span style="color: #808080; font-style: italic;"># l'attribut est public.</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">out</span> = output
&nbsp;
        <span style="color: #808080; font-style: italic;"># Comme on utilise la sortie standard par défaut, la barre peut</span>
        <span style="color: #808080; font-style: italic;"># facilement être cassée par un autre code écrivant aussi sur la sortie</span>
        <span style="color: #808080; font-style: italic;"># standard. Puisqu'un débutant ne comprendra pas rour se suite ce qui se</span>
        <span style="color: #808080; font-style: italic;"># passe, par défaut on va intercepter stdout et mettre tout ce qui est</span>
        <span style="color: #808080; font-style: italic;"># écrit dessus dans un buffer. Si jamais il y a des prints fait durant</span>
        <span style="color: #808080; font-style: italic;"># l'affichage, il seront cachés, et stockés. Ce comportement n'est pas</span>
        <span style="color: #808080; font-style: italic;"># forcément désirable, et peut donc être désactivé par un paramètre pour</span>
        <span style="color: #808080; font-style: italic;"># l'utilisateur qui sait ce qu'il fait notamment dans le cadre</span>
        <span style="color: #808080; font-style: italic;"># d'utilisation des threads.</span>
        <span style="color: #008000;">self</span>._intercept_stdout = intercept_stdout <span style="color: #ff7700;font-weight:bold;">and</span> <span style="color: #008000;">self</span>.<span style="color: black;">out</span> == <span style="color: #dc143c;">sys</span>.<span style="color: black;">stdout</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>._intercept_stdout:
            <span style="color: #808080; font-style: italic;"># L'interception de la sortie standard se fait en remplaçant</span>
            <span style="color: #808080; font-style: italic;"># sys.stdout par soi-même. C'est pour cette raison que ProgressBar</span>
            <span style="color: #808080; font-style: italic;"># hérite de IOBase. En effet, de cette manière, on possède</span>
            <span style="color: #808080; font-style: italic;"># l'interface d'un objet stream et tout écriture sur 'self' semblera</span>
            <span style="color: #808080; font-style: italic;"># fonctionner comme sur sys.stdout. Cela permet de faire des prints</span>
            <span style="color: #808080; font-style: italic;"># ou de lancer un shell et d'utiliser la barre, bien que</span>
            <span style="color: #808080; font-style: italic;"># dans un shell cela monopolisera le prompt.</span>
            <span style="color: #dc143c;">sys</span>.<span style="color: black;">stdout</span> = <span style="color: #008000;">self</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;"># Afficher la barre à la création de l'objet retire de la flexibilité à</span>
    <span style="color: #808080; font-style: italic;"># l'utilisateur qui peut vouloir le créer d'un côté, le stocker, et</span>
    <span style="color: #808080; font-style: italic;"># démarrer l'affichage plus tard. L'affichage est donc conditionné</span>
    <span style="color: #808080; font-style: italic;"># par cette méthode.</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> show<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        bar = <span style="color: #008000;">self</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">out</span>.<span style="color: black;">write</span><span style="color: black;">&#40;</span>bar<span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">cursor_shift</span> = <span style="color: #008000;">len</span><span style="color: black;">&#40;</span>bar<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Comme le plus souvent on voudra tout de même afficher la barre juste après</span>
    <span style="color: #808080; font-style: italic;"># la création, on transforme cette classe en context manager. Pour cela on</span>
    <span style="color: #808080; font-style: italic;"># créer un alias de la method show() qu'on appelle __enter__, puisque tout</span>
    <span style="color: #808080; font-style: italic;"># objet qui a une méthode nommée __enter__ peut être utilisé comme context</span>
    <span style="color: #808080; font-style: italic;"># manager. Si vous ne vous souvenez pas de ce que c'est, il y a un article</span>
    <span style="color: #808080; font-style: italic;"># sur le blog à ce sujet. Mais en résumé, ce sont les objets utilisables</span>
    <span style="color: #808080; font-style: italic;"># avec &quot;with&quot;.</span>
    <span style="color: #808080; font-style: italic;"># Notez qu'on ne fait pas __enter__ = show, ce qui serait un moyen plus</span>
    <span style="color: #808080; font-style: italic;"># court d'aliaser, car il empêcherait __enter__ d'appeler le bon show()</span>
    <span style="color: #808080; font-style: italic;"># en cas d'héritage, si show() est écrasé.</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> __enter__<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">show</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;"># Une petit méthode de nettoyage, qui ici va simplement remettre sys.stdout</span>
    <span style="color: #808080; font-style: italic;"># à sa place.</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> stop<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #66cc66;">*</span>args, <span style="color: #66cc66;">**</span>kwargs<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>._intercept_stdout:
            <span style="color: #dc143c;">sys</span>.<span style="color: black;">stdout</span> = <span style="color: #008000;">self</span>.<span style="color: black;">out</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Même topo, on alias stop en __exit__ pour avoir la sortie du context</span>
    <span style="color: #808080; font-style: italic;"># manager. On a pas appelé directement ces méthodes __enter__ et __exit__</span>
    <span style="color: #808080; font-style: italic;"># car l'utilisateur peut vouloir les appeler manuellement.</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> __exit__<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #66cc66;">*</span>args, <span style="color: #66cc66;">**</span>kwargs<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">stop</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;"># Une simple propriété qui donne accès au progres en lecture...</span>
    @<span style="color: #008000;">property</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> progress<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._progress
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;"># ... et en écriture. La différence étant qu'à l'écriture, on vérifie</span>
    <span style="color: #808080; font-style: italic;"># que la valeur est bien comprise entre 0 et le total. On appelle aussi</span>
    <span style="color: #808080; font-style: italic;"># les callbacks, et donc l'affichage se mettra à jour.</span>
    @progress.<span style="color: black;">setter</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> progress<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, value<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #ff4500;">0</span> <span style="color: #66cc66;">&lt;</span>= value <span style="color: #66cc66;">&lt;</span>= <span style="color: #008000;">self</span>.<span style="color: black;">total</span>:
            <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">ValueError</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;'value' is %s and should be set between 0 &quot;</span>
                             <span style="color: #483d8b;">&quot;and 'total' (%s)&quot;</span> <span style="color: #66cc66;">%</span> <span style="color: black;">&#40;</span>value, <span style="color: #008000;">self</span>.<span style="color: black;">total</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># On le fait avant car les callbacks doivent être appelés</span>
        <span style="color: #808080; font-style: italic;"># avec un état propre.</span>
        previous_progress = <span style="color: #008000;">self</span>._progress
        <span style="color: #008000;">self</span>._progress = value
&nbsp;
        <span style="color: #808080; font-style: italic;"># Ce que l'on va passer en paramètres aux callbacks est un choix</span>
        <span style="color: #808080; font-style: italic;"># important. Déjà en premier paramètre, on passe self. Ainsi le callback</span>
        <span style="color: #808080; font-style: italic;"># aura accès à presque tout, et on est certain qu'il ne se trouvera</span>
        <span style="color: #808080; font-style: italic;"># pas dépourvu d'informations. Ensuite on passe le progrès. Normalement</span>
        <span style="color: #808080; font-style: italic;"># il peut le récupérer à travers self.progress, mais comme on sait</span>
        <span style="color: #808080; font-style: italic;"># que c'est une information très utilisée, on la passe par politesse,</span>
        <span style="color: #808080; font-style: italic;"># pour faciliter la vie de l'utilisateur. Enfin, une information qu'il</span>
        <span style="color: #808080; font-style: italic;"># ne pourrait pas avoir autrement est le progrès précédent. Bien que</span>
        <span style="color: #808080; font-style: italic;"># nous ne l'utilisons pas dans notre callback, on peut imaginer que</span>
        <span style="color: #808080; font-style: italic;"># c'est le genre d'info qui peut être utile, et qui ne peut être trouvée</span>
        <span style="color: #808080; font-style: italic;"># dans self.</span>
        <span style="color: #ff7700;font-weight:bold;">for</span> callback <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">self</span>.<span style="color: black;">callbacks</span>:
            callback<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #008000;">self</span>._progress, previous_progress<span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Si on arrive au bout, on appelle stop() automatiquement. Stop()</span>
        <span style="color: #808080; font-style: italic;"># étant idempotente, ce n'est pas grave si elle est appelée plusieurs</span>
        <span style="color: #808080; font-style: italic;"># fois.</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> value == <span style="color: #008000;">self</span>.<span style="color: black;">total</span>:
            <span style="color: #008000;">self</span>.<span style="color: black;">stop</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Un cas intéressant : pourquoi on ne fait pas self.template directement au</span>
    <span style="color: #808080; font-style: italic;"># lieu de créer une property à vide ? Tout simplement parce qu'un template</span>
    <span style="color: #808080; font-style: italic;"># est typiquement quelque chose que quelqu'un peut vouloir créer</span>
    <span style="color: #808080; font-style: italic;"># dynamiquement (par exemple pour y ajouter une notion de temps qui passe).</span>
    <span style="color: #808080; font-style: italic;"># Donc, on propose de passer le template en paramètre  dans __init__ car la</span>
    <span style="color: #808080; font-style: italic;"># plupart du temps, c'est juste ce qu'on voudra faire : un simple changement</span>
    <span style="color: #808080; font-style: italic;"># cosmétique statique. Mais afin de permettre plus d'extensibilité, on en</span>
    <span style="color: #808080; font-style: italic;"># fait une propriété, qui, comme toute méthode, peut être écrasée avec de</span>
    <span style="color: #808080; font-style: italic;"># l'héritage et permettrait à l'utilisateur de vraiment personnaliser son</span>
    <span style="color: #808080; font-style: italic;"># affichage de manière poussée.</span>
    @<span style="color: #008000;">property</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> template<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._template
&nbsp;
    @template.<span style="color: black;">setter</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> template<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, value<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>._template = value
&nbsp;
    <span style="color: #808080; font-style: italic;"># C'est cette méthode qui est appelée si on a détourné sys.stdout quand</span>
    <span style="color: #808080; font-style: italic;"># l'utilisateur va faire un print. Elle doit s'appeler write(), car c'est</span>
    <span style="color: #808080; font-style: italic;"># l'interface connue des objets stream. Grosso modo, on va juste</span>
    <span style="color: #808080; font-style: italic;"># tout stocker dans une variable plutôt que d'afficher quoique ce soit</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> write<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, value<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">buffer</span> += value
&nbsp;
    <span style="color: #808080; font-style: italic;"># Pour une progrès donné, retourne la barre de progrès sous forme de</span>
    <span style="color: #808080; font-style: italic;"># string ASCII. Elle est mise à part car elle peut ainsi être facilement</span>
    <span style="color: #808080; font-style: italic;"># utilisée dans un callback.</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> format<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, progress=<span style="color: #ff4500;">0</span><span style="color: black;">&#41;</span>:
        progress = progress <span style="color: #66cc66;">*</span> <span style="color: #ff4500;">100</span> / <span style="color: #008000;">self</span>.<span style="color: black;">total</span>
        bar = progress / <span style="color: #008000;">self</span>.<span style="color: black;">percent_per_sign</span> <span style="color: #66cc66;">*</span> <span style="color: #008000;">self</span>.<span style="color: black;">progress_sign</span>
        bar += <span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">bar_len</span> - <span style="color: #008000;">len</span><span style="color: black;">&#40;</span>bar<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: #66cc66;">*</span> <span style="color: #483d8b;">' '</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">template</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span>bar=bar, progress=progress<span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;"># Notre callback que l'on utilise pour afficher la barre. C'est une méthode</span>
    <span style="color: #808080; font-style: italic;"># statique car cela nous permet de nous mettre dans les conditions exacte</span>
    <span style="color: #808080; font-style: italic;"># d'un callback d'un utilisateur, qui ne sera qu'une fonction, sans self.</span>
    @<span style="color: #008000;">staticmethod</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> print_progress<span style="color: black;">&#40;</span>progress_bar, progress, previous_progress<span style="color: black;">&#41;</span>:
        <span style="color: #808080; font-style: italic;"># '\b' permet de reculer le curseur dans le terminal, ce qui va</span>
        <span style="color: #808080; font-style: italic;"># nous permettre de réécrire par dessus l'ancienne bar, et la mettre</span>
        <span style="color: #808080; font-style: italic;"># à jour. Si vous tenez à faire un display multi ligne, sachez que '\b'</span>
        <span style="color: #808080; font-style: italic;"># ne permet pas de reculer sur un saut de ligne, pour ça il faut</span>
        <span style="color: #808080; font-style: italic;"># utiliser '\033[1A'</span>
        progress_bar.<span style="color: black;">out</span>.<span style="color: black;">write</span><span style="color: black;">&#40;</span>progress_bar.<span style="color: black;">cursor_shift</span> <span style="color: #66cc66;">*</span> <span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\b</span>'</span><span style="color: black;">&#41;</span>
        bar = progress_bar.<span style="color: black;">format</span><span style="color: black;">&#40;</span>progress<span style="color: black;">&#41;</span>
        progress_bar.<span style="color: black;">out</span>.<span style="color: black;">write</span><span style="color: black;">&#40;</span>bar<span style="color: black;">&#41;</span>
        <span style="color: #808080; font-style: italic;"># flush est nécessaire pour vider le buffer et obtenir un affichage</span>
        <span style="color: #808080; font-style: italic;"># immédiat quand on écrit en direct sur un stream.</span>
        progress_bar.<span style="color: black;">out</span>.<span style="color: black;">flush</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #808080; font-style: italic;"># on met à jour l'avancement du curseur, qui nous permettra de reculer</span>
        <span style="color: #808080; font-style: italic;"># d'autant au prochain print_progress()</span>
        progress_bar.<span style="color: black;">cursor_shift</span> = <span style="color: #008000;">len</span><span style="color: black;">&#40;</span>bar<span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">if</span> __name__ == <span style="color: #483d8b;">&quot;__main__&quot;</span>:
&nbsp;
    <span style="color: #808080; font-style: italic;"># voici une utilisation standard de la barre :</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">time</span>
&nbsp;
    total = <span style="color: #ff4500;">1000</span>
    <span style="color: #808080; font-style: italic;"># L'utilisation du context manager permet de ne pas se soucier d'appeler</span>
    <span style="color: #808080; font-style: italic;"># show() ou stop() et autre détails d'implémentation.</span>
    <span style="color: #808080; font-style: italic;"># On note aussi qu'avoir des valeurs par défaut pour l'initialisation de la</span>
    <span style="color: #808080; font-style: italic;"># barre la rend très facile à utiliser sans trop se prendre la tête, et</span>
    <span style="color: #808080; font-style: italic;"># ce malgré un code derrière assez complexe. On aurait même pu se passer</span>
    <span style="color: #808080; font-style: italic;"># de &quot;total&quot;.</span>
    <span style="color: #ff7700;font-weight:bold;">with</span> ProgressBar<span style="color: black;">&#40;</span>total<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> pb:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">for</span> i <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">&#40;</span>total<span style="color: black;">&#41;</span>:
            <span style="color: #dc143c;">time</span>.<span style="color: black;">sleep</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">0.001</span><span style="color: black;">&#41;</span>
            <span style="color: #808080; font-style: italic;"># on voir l'interêt d'utiliser une property ici, ça rend la mise</span>
            <span style="color: #808080; font-style: italic;"># à jour du progrès très simple</span>
            pb.<span style="color: black;">progress</span> = i
            <span style="color: #ff7700;font-weight:bold;">if</span> i == total / <span style="color: #ff4500;">2</span>:
                <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>Half the work already !&quot;</span><span style="color: black;">&#41;</span>
                half = <span style="color: #008000;">True</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> i == total <span style="color: #66cc66;">*</span> <span style="color: #ff4500;">0.7</span>:
                <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Almost done&quot;</span><span style="color: black;">&#41;</span>
                almost = <span style="color: #008000;">True</span>
&nbsp;
        pb.<span style="color: black;">progress</span> = total
&nbsp;
    <span style="color: #808080; font-style: italic;"># On peut afficher tout ce qui a été printé durant la progression de la</span>
    <span style="color: #808080; font-style: italic;"># barre si besoin.</span>
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>pb.<span style="color: black;">buffer</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">datetime</span> <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">datetime</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Et une utilisation custo où on compte les secondes depuis le départ</span>
    <span style="color: #808080; font-style: italic;"># et on les affiches dans le template</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">class</span> MaProgressBar<span style="color: black;">&#40;</span>ProgressBar<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">def</span> show<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
            <span style="color: #008000;">self</span>.<span style="color: black;">start</span> = <span style="color: #dc143c;">datetime</span>.<span style="color: black;">now</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">super</span><span style="color: black;">&#40;</span>MaProgressBar, <span style="color: #008000;">self</span><span style="color: black;">&#41;</span>.<span style="color: black;">show</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Comme on a template en tant que méthode, on peut l'overrider et</span>
        <span style="color: #808080; font-style: italic;"># obtenir un comportement</span>
        @<span style="color: #008000;">property</span>
        <span style="color: #ff7700;font-weight:bold;">def</span> template<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
            seconds = <span style="color: black;">&#40;</span><span style="color: #dc143c;">datetime</span>.<span style="color: black;">now</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> - <span style="color: #008000;">self</span>.<span style="color: black;">start</span><span style="color: black;">&#41;</span>.<span style="color: black;">seconds</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #483d8b;">'{bar} (running for %s seconds)'</span> <span style="color: #66cc66;">%</span> seconds
&nbsp;
        @template.<span style="color: black;">setter</span>
        <span style="color: #ff7700;font-weight:bold;">def</span> template<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, value<span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">pass</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Notre système de callback va se trouver utile :</span>
    <span style="color: #808080; font-style: italic;"># on met un callback de plus qui va écrire dans un fichier (mais</span>
    <span style="color: #808080; font-style: italic;"># il pourrait faire n'importe quoi, envoyer un post sur un site Web,</span>
    <span style="color: #808080; font-style: italic;"># un mail, formatter le disque...)</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> update_progress<span style="color: black;">&#40;</span>progress_bar, progress, previous_progress<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">with</span> <span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'/tmp/progress.log'</span>, <span style="color: #483d8b;">'w'</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> log:
            log.<span style="color: black;">write</span><span style="color: black;">&#40;</span><span style="color: #008000;">str</span><span style="color: black;">&#40;</span>progress<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># On change aussi le signe de progrès pour quelque chose de plus pro</span>
    pb = MaProgressBar<span style="color: black;">&#40;</span>progress_sign=<span style="color: #483d8b;">':-) '</span>, percent_per_sign=<span style="color: #ff4500;">10</span>,
                       callbacks=<span style="color: black;">&#40;</span>update_progress,<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Au besoin, on peut passer à l'affichage en manuel.</span>
    pb.<span style="color: black;">show</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">for</span> i <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">100</span><span style="color: black;">&#41;</span>:
        <span style="color: #dc143c;">time</span>.<span style="color: black;">sleep</span><span style="color: black;">&#40;</span>.1<span style="color: black;">&#41;</span>
        pb.<span style="color: black;">progress</span> = i
&nbsp;
    pb.<span style="color: black;">progress</span> = <span style="color: #ff4500;">100</span>
&nbsp;
    pb.<span style="color: black;">stop</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></div></div>

<hr />
<p><a href="https://github.com/sametmax/codes-des-articles/blob/master/2013/aout/progress_bar.py">Télécharger le code de l&#8217;article</a></p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=7122&amp;md5=4b21a908ab2fd1d97205099c6faa2b64" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/ecrire-un-code-pour-les-autres-en-python/feed/</wfw:commentRss>
		<slash:comments>10</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fecrire-un-code-pour-les-autres-en-python%2F&amp;language=en_GB&amp;category=text&amp;title=Ecrire+un+code+pour+les+autres+en+Python&amp;description=Cet+article+s%26%238217%3Badresse+%C3%A0+des+d%C3%A9veloppeurs+qui+commencent+%C3%A0+%C3%AAtre+bien+dans+leurs+chaussettes+en+Python+et+qui+se+sentent+de+relever+le+d%C3%A9fi+d%26%238217%3B%C3%A9crire+du+code+pour+d%26%238217%3Bautres+personnes....&amp;tags=context+manager%2Cpoo%2Cproperty%2Cpython%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/08/PagndOb.gif" length="32768" type="image/jpg" />	</item>
		<item>
		<title>Objets proxy et pattern adapter en Python</title>
		<link>http://sametmax.com/objets-proxy-et-pattern-adapter-en-python/</link>
		<comments>http://sametmax.com/objets-proxy-et-pattern-adapter-en-python/#comments</comments>
		<pubDate>Fri, 16 Aug 2013 19:40:02 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[adapter]]></category>
		<category><![CDATA[poo]]></category>
		<category><![CDATA[proxy]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=7112</guid>
		<description><![CDATA[En informatique, le vocabulaire c'est une bonne partie du travail. On a des tas de termes comme polymorphisme, récursivité, idempotent ou closure. Certains sont des termes mathématiques, d'autres sont des anglicismes, mais la majorité sont juste des mots compliqués pour décrire des choses simples.

Vous connaissez mon manque d'attrait pour ça, on va donc clarifier.]]></description>
			<content:encoded><![CDATA[<p>En informatique, le vocabulaire c&#8217;est une bonne partie du travail. On a des tas de termes comme polymorphisme, récursivité, idempotent ou closure. Certains sont des termes mathématiques, d&#8217;autres sont des anglicismes, mais la majorité sont juste des mots compliqués pour décrire des choses simples.</p>
<p>Vous connaissez mon manque d&#8217;attrait pour ça, on va donc clarifier.</p>
<p>Pour comprendre cet article, il vous faut les pré-requis suivants :</p>
<ul>
<li>Être à l&#8217;aise avec avec la programmation orientée objet : héritage, property&#8230;</li>
<li>Bien comprendre la notion de référence.</li>
<li>Avoir un peu de temps devant soi.</li>
</ul>
<p>Et pour une fois, on va mettre un morceau qui colle bien au blog :</p>

<!-- iframe plugin v:2.3 - wordpress.org/extend/plugins/iframe/ -->
<iframe width="420" height="315" src="//www.youtube.com/embed/lqXRk-cmXwM" frameborder="0" scrolling="no" class="iframe-class"></iframe>
<h2>S&#8217;il vous plait, dessine moi un objet proxy</h2>
<p>Un proxy, en anglais, c&#8217;est un mandataire, c&#8217;est à dire grosso merdo un intermédiaire. Un objet proxy est donc tout simplement un objet qui fait l&#8217;intermédiaire, généralement entre un objet et un autre.</p>
<p>Exemple, on a des enseignants qui vont avoir besoin d&#8217;une autorisation de sortie pour des enfants dans leur classe. Un enfant ne peut pas décider de cela, ses parents décident de ce genre de chose :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Enseignant<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #808080; font-style: italic;"># la demande d'autorisation attend un objet enfant en paramètre</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> demande_autorisation_de_sortie<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, enfant<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> enfant.<span style="color: black;">peut_sortir</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Enfant<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, age<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">age</span> = age
&nbsp;
    <span style="color: #808080; font-style: italic;"># mais un enfant ne peut pas donner cette information</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> peut_sortir<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">NotImplementedError</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'Un enfant ne peut decider de cela'</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Parent<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #808080; font-style: italic;"># le parent va faire proxy sur l'objet enfant</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, enfant<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">enfant</span> = enfant
&nbsp;
    <span style="color: #808080; font-style: italic;"># et propose la même méthode que l'objet enfant afin de pouvoir</span>
    <span style="color: #808080; font-style: italic;"># être passé en paramètre à sa place à la méthode</span>
    <span style="color: #808080; font-style: italic;"># demande_autorisation_de_sortie()</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> peut_sortir<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">enfant</span>.<span style="color: black;">age</span> <span style="color: #66cc66;">&gt;</span> <span style="color: #ff4500;">10</span></pre></div></div>

<p>Ici, si la classe <code>Enseignant</code> appelle directement la méthode <code>peut_sortir()</code> de la classe <code>Enfant</code>, on obtient une erreur. :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> prof = Enseignant<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> enfant = Enfant<span style="color: black;">&#40;</span><span style="color: #ff4500;">11</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> prof.<span style="color: black;">demande_autorisation_de_sortie</span><span style="color: black;">&#40;</span>enfant<span style="color: black;">&#41;</span>
Traceback <span style="color: black;">&#40;</span>most recent call last<span style="color: black;">&#41;</span>:
  File <span style="color: #483d8b;">&quot;&lt;ipython-input-23-6d509f016e40&gt;&quot;</span>, line <span style="color: #ff4500;">1</span>, <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #66cc66;">&lt;</span>module<span style="color: #66cc66;">&gt;</span>
    prof.<span style="color: black;">demande_autorisation_de_sortie</span><span style="color: black;">&#40;</span>enfant<span style="color: black;">&#41;</span>
  File <span style="color: #483d8b;">&quot;&lt;ipython-input-18-e8d34178df4c&gt;&quot;</span>, line <span style="color: #ff4500;">4</span>, <span style="color: #ff7700;font-weight:bold;">in</span> demande_autorisation_de_sortie
    <span style="color: #ff7700;font-weight:bold;">return</span> enfant.<span style="color: black;">peut_sortir</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
  File <span style="color: #483d8b;">&quot;&lt;ipython-input-18-e8d34178df4c&gt;&quot;</span>, line <span style="color: #ff4500;">13</span>, <span style="color: #ff7700;font-weight:bold;">in</span> peut_sortir
    <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">NotImplementedError</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'Un enfant ne peut decider de cela'</span><span style="color: black;">&#41;</span>
<span style="color: #008000;">NotImplementedError</span>: Un enfant ne peut decider de cela</pre></div></div>

<p>Nous avons créé un système où on est obligé de créer une instance de <code>Parent</code>, qui va se placer entre la classe <code>Enseignant</code> et la classe <code>Enfant</code>, et qui va retourner la valeur pour cette méthode :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> parent = Parent<span style="color: black;">&#40;</span>enfant<span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># on passe l'enfant en paramètre au parent</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> prof.<span style="color: black;">demande_autorisation_de_sortie</span><span style="color: black;">&#40;</span>parent<span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># et le parent remplace l'enfant</span>
<span style="color: #008000;">True</span></pre></div></div>

<p>Ceci est un objet proxy, c&#8217;est à dire un objet qui se place entre deux objets, et fait l&#8217;intermédiaire. <strong>Pour que cela marche, il faut que l&#8217;objet proxy, ici l&#8217;instance de <code>Parent</code>, ait la même interface (les mêmes méthodes, avec les mêmes paramètres et noms) que l&#8217;objet derrière le proxy, ici l&#8217;instance de <code>Enfant</code>.</strong></p>
<p>Dans notre cas, c&#8217;est académique, ça ne sert pas à grand chose. Mais il y a des tas de cas utiles pour les objets proxy.</p>
<p>Ainsi, on veut parfois créer des objets dit &#8220;lazy&#8221;, littéralement &#8220;paresseux&#8221;, c&#8217;est à dire pas évalués tout de suite. C&#8217;est ce que fait Django dans le cadre de certaines chaînes de caractères traduites. En effet, en Django, il existe une fonction <code>lazy_gettex()</code> que l&#8217;on peut appliquer sur les chaînes à traduire. Mais elle ne retourne pas une string, car on ne connait pas encore la langue dans laquelle il faut traduire la chaîne : la langue dépend de l&#8217;utilisateur qui viendra demander la page Web en question. <code>lazy_gettex()</code> retourne un objet proxy, et quand, à l&#8217;appel de la page Web, on tente de manipuler cet objet comme une string pour l&#8217;afficher, le proxy va chercher la traduction, et retourne la bonne chaîne. Pour que ça marche, <strong>il faut que l&#8217;interface de l&#8217;objet lazy ressemble trait pour trait à celui d&#8217;une chaîne</strong>.</p>
<p>Dans d&#8217;autres cas on veut mettre un proxy pour gérer des permissions, et selon le niveau de permission, l&#8217;objet proxy donne accès ou non à l&#8217;objet derrière lui.</p>
<p>Le design pattern décorateur, le fameux <code>@truc</code> en Python, n&#8217;est jamais qu&#8217;un objet fonction qui fait proxy vers une autre fonction qu&#8217;on a enrobé.</p>
<p>Mais la raison majeur pour laquelle on va utiliser un objet proxy est le design pattern &#8220;adapter&#8221;.</p>
<h2>Ce n&#8217;est pas un chapeau, c&#8217;est un boa qui a avalé un éléphant</h2>
<p>En informatique, on aime bien les traitements généralistes.</p>
<p>Par exemple, imaginez cet objet qui dit si on a le droit de se bourrer la gueule :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Videur<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> tu_peux_rentrer<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, personne<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot;
            Cette fonction n'est pas réaliste, puisque bien entendu une mineure
            à gros nichons rentrerait, et un arabe en short lacoste non,
            mais heureusement l'informatique est plus simple que notre société.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> personne.<span style="color: black;">age</span> <span style="color: #66cc66;">&gt;</span>= <span style="color: #ff4500;">18</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Personne<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, age<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">age</span> = age</pre></div></div>

<p>Et tant que vous avez la main sur le système, tout va bien dans le meilleur des mondes :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">random</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> clients = <span style="color: black;">&#91;</span>Personne<span style="color: black;">&#40;</span><span style="color: #dc143c;">random</span>.<span style="color: black;">randint</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">12</span>, <span style="color: #ff4500;">65</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">xrange</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">random</span>.<span style="color: black;">randint</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">0</span>, <span style="color: #ff4500;">100</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> videur = Videur<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">for</span> client <span style="color: #ff7700;font-weight:bold;">in</span> clients:
...     <span style="color: #ff7700;font-weight:bold;">if</span> videur.<span style="color: black;">tu_peux_rentrer</span><span style="color: black;">&#40;</span>client<span style="color: black;">&#41;</span>:
...         <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Glouglou&quot;</span><span style="color: black;">&#41;</span>
...
<span style="color: black;">Glouglou</span>
Glouglou
Glouglou
Glouglou
Glouglou
...</pre></div></div>

<p>Mais malheureusement la vie n&#8217;est pas toujours pleine de licornes et de bisounours, et votre collègue, lui, il a codé une lib en C qui a extrait les clients d&#8217;un XML, et quand vous vous mappez directement dessus avec ctype, vous obtenez des clients comme ça:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Client<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, majeur<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">majeur</span> = majeur</pre></div></div>

<p>Bon, vous vous dites que c&#8217;est pas grave. Après tout, c&#8217;est juste une condition à rajouter :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Videur<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> tu_peux_rentrer<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, personne<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span>personne, <span style="color: #483d8b;">'age'</span><span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> personne.<span style="color: black;">age</span> <span style="color: #66cc66;">&gt;</span>= <span style="color: #ff4500;">18</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> personne.<span style="color: black;">majeur</span></pre></div></div>

<p>Ouai mais votre commercial arrive avec un super contrat avec pillierdebar.com, et il faut s&#8217;interfacer avec leur API SOAP de 1997, dont la deserialisation vous retourne :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Prospect<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #dc143c;">datetime</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">date_de_naissance</span> = <span style="color: #dc143c;">datetime</span></pre></div></div>

<p>Les connards. Ah les connards.</p>
<p>Mais bon, c&#8217;est pas grave, c&#8217;est juste une petite condition à rajouter.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">datetime</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Videur<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> tu_peux_rentrer<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, personne<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span>personne, <span style="color: #483d8b;">'age'</span><span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> personne.<span style="color: black;">age</span> <span style="color: #66cc66;">&gt;</span>= <span style="color: #ff4500;">18</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span>personne, <span style="color: #483d8b;">'date_de_naissance'</span><span style="color: black;">&#41;</span>:
            <span style="color: #808080; font-style: italic;"># TODO: prendre en compte les années bisextiles</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#40;</span><span style="color: #dc143c;">datetime</span>.<span style="color: #dc143c;">datetime</span>.<span style="color: black;">now</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> - personne.<span style="color: black;">date_de_naissance</span><span style="color: black;">&#41;</span> / <span style="color: #ff4500;">365</span> <span style="color: #66cc66;">&gt;</span> <span style="color: #ff4500;">18</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> personne.<span style="color: black;">majeur</span></pre></div></div>

<p>Bon, vous allez enfin pouvoir soufll&#8230;. Ahhhh ! Votre boss appelle, il a oublié de vous dire, le stagiaire travaille aussi sur une feature, et a fait son propre objet <code>Prospect</code>, c&#8217;est comme l&#8217;objet <code>Client</code> mais pas pareil. Non on ne peut pas changer. Oui il a fait de la merde mais si on change tout son code pête. Il se barre demain. Il n&#8217;a pas fait de test. Démerde toi.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> LeClient<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, majeur_de_combien<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.__majeur_de_combien = majeur_de_combien
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> get_majeur_de_combien<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.__majeur_de_combien</pre></div></div>

<p>A ce stade là, le code est tellement moche de toute façon, vous vous en branlez complètement. Vous allez rentrer jouer Left4Dead avec un mod qui transforme les zombies pour qu&#8217;ils aient la tête de votre patron. Le reste n&#8217;est que détail d&#8217;implémentation.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Videur<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> tu_peux_rentrer<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, personne<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span>personne, <span style="color: #483d8b;">'age'</span><span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> personne.<span style="color: black;">age</span> <span style="color: #66cc66;">&gt;</span>= <span style="color: #ff4500;">18</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span>personne, <span style="color: #483d8b;">'date_de_naissance'</span><span style="color: black;">&#41;</span>:
            <span style="color: #808080; font-style: italic;"># TODO: prendre en compte les années bisextiles</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#40;</span><span style="color: #dc143c;">datetime</span>.<span style="color: #dc143c;">datetime</span>.<span style="color: black;">now</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> - personne.<span style="color: black;">date_de_naissance</span><span style="color: black;">&#41;</span> / <span style="color: #ff4500;">365</span> <span style="color: #66cc66;">&gt;</span> <span style="color: #ff4500;">18</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span>personne, <span style="color: #483d8b;">'get_majeur_de_combien'</span><span style="color: black;">&#41;</span>:
            <span style="color: #808080; font-style: italic;"># retourne le nombre d'années après 18 ans ou -1. Don't ask...</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> personne.<span style="color: black;">get_majeur_de_combien</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #66cc66;">&gt;</span> -<span style="color: #ff4500;">1</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> personne.<span style="color: black;">majeur</span></pre></div></div>

<p>Quelque moi(s) plus tard, les specs changent. Il faut maintenant pouvoir vérifier la carte d&#8217;identité des clients. Ou la carte de membre. Et garder l&#8217;ancien système compatible bien entendu. Ah, et il y a aussi des controleurs, c&#8217;est comme des videurs, mais qui doivent vérifier si les personnes dans le bar sont majeurs, sauf qu&#8217;il n&#8217;acceptent pas la carte de membre ou la date de naissance donnée à l&#8217;oral.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> CarteDeMembre<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">pass</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> CarteIdentité<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, date_de_naissance<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">date_de_naissance</span> = date_de_naissance
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Client<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, majeur=<span style="color: #008000;">None</span>, carte_identite=<span style="color: #008000;">None</span>, carte_membre=<span style="color: #008000;">None</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">majeur</span> = majeur
        <span style="color: #008000;">self</span>.<span style="color: black;">carte_identite</span> = carte_identite
        <span style="color: #008000;">self</span>.<span style="color: black;">carte_membre</span> = <span style="color: #008000;">None</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Videur<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> tu_peux_rentrer<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, personne<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span>personne, <span style="color: #483d8b;">'age'</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">and</span> personne.<span style="color: black;">age</span> <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #008000;">None</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> personne.<span style="color: black;">age</span> <span style="color: #66cc66;">&gt;</span>= <span style="color: #ff4500;">18</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span>personne, <span style="color: #483d8b;">'carte_membre'</span><span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">True</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span>personne, <span style="color: #483d8b;">'carte_identite'</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">and</span> personne.<span style="color: black;">carte_identite</span> <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #008000;">None</span>:
            now = <span style="color: #dc143c;">datetime</span>.<span style="color: #dc143c;">datetime</span>.<span style="color: black;">now</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#40;</span>now - personne.<span style="color: black;">carte_identite</span>.<span style="color: black;">date_de_naissance</span><span style="color: black;">&#41;</span> / <span style="color: #ff4500;">365</span> <span style="color: #66cc66;">&gt;</span> <span style="color: #ff4500;">18</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span>personne, <span style="color: #483d8b;">'date_de_naissance'</span><span style="color: black;">&#41;</span>:
            <span style="color: #808080; font-style: italic;"># TODO: prendre en compte les années bisextiles</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#40;</span><span style="color: #dc143c;">datetime</span>.<span style="color: #dc143c;">datetime</span>.<span style="color: black;">now</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> - personne.<span style="color: black;">date_de_naissance</span><span style="color: black;">&#41;</span> / <span style="color: #ff4500;">365</span> <span style="color: #66cc66;">&gt;</span> <span style="color: #ff4500;">18</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span>personne, <span style="color: #483d8b;">'get_majeur_de_combien'</span><span style="color: black;">&#41;</span>:
            <span style="color: #808080; font-style: italic;"># retourne le nombre d'années après 18 ans ou -1. Don't ask...</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> personne.<span style="color: black;">get_majeur_de_combien</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #66cc66;">&gt;</span> -<span style="color: #ff4500;">1</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> personne.<span style="color: black;">majeur</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Controleur<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> est_autorise<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, personne<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span>personne, <span style="color: #483d8b;">'age'</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">and</span> personne.<span style="color: black;">age</span> <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #008000;">None</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> personne.<span style="color: black;">age</span> <span style="color: #66cc66;">&gt;</span>= <span style="color: #ff4500;">18</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span>personne, <span style="color: #483d8b;">'carte_identite'</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">and</span> personne.<span style="color: black;">carte_identite</span> <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #008000;">None</span>:
            now = <span style="color: #dc143c;">datetime</span>.<span style="color: #dc143c;">datetime</span>.<span style="color: black;">now</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#40;</span>now - personne.<span style="color: black;">carte_identite</span>.<span style="color: black;">date_de_naissance</span><span style="color: black;">&#41;</span> / <span style="color: #ff4500;">365</span> <span style="color: #66cc66;">&gt;</span> <span style="color: #ff4500;">18</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span>personne, <span style="color: #483d8b;">'date_de_naissance'</span><span style="color: black;">&#41;</span>:
            <span style="color: #808080; font-style: italic;"># TODO: prendre en compte les années bisextiles</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#40;</span><span style="color: #dc143c;">datetime</span>.<span style="color: #dc143c;">datetime</span>.<span style="color: black;">now</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> - personne.<span style="color: black;">date_de_naissance</span><span style="color: black;">&#41;</span> / <span style="color: #ff4500;">365</span> <span style="color: #66cc66;">&gt;</span> <span style="color: #ff4500;">18</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span>personne, <span style="color: #483d8b;">'get_majeur_de_combien'</span><span style="color: black;">&#41;</span>:
            <span style="color: #808080; font-style: italic;"># retourne le nombre d'années après 18 ans ou -1. Don't ask...</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> personne.<span style="color: black;">get_majeur_de_combien</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #66cc66;">&gt;</span> -<span style="color: #ff4500;">1</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> personne.<span style="color: black;">majeur</span></pre></div></div>

<p>Bon, là c&#8217;est la merde. Vous le sentez, demain il va y avoir un portail électronique qui check uniquement les cartes de membres. Quand il va falloir faire une modif quelque part, ça va être galère. La maintenance va être un enfer. Le debuggage, bien relou. Il faut trouver un moyen de faire plus propre.</p>
<p>C&#8217;est ici qu&#8217;entre en jeu le pattern &#8220;adapter&#8221;. Un adapter, c&#8217;est comme les adaptateurs pour prises, mais pour les objets. C&#8217;est un proxy qu&#8217;on met devant pour que la prise ressemble à une autre.</p>
<p>Dans le domaine du code, ça veut dire qu&#8217;on va enrober chaque objet dans un autre pour qu&#8217;ils aient tous la même interface. Le traitement du coup sera de nouveau très simple, et la complexité sera répartie dans les adapters.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">&nbsp;
<span style="color: #808080; font-style: italic;"># on met le code commun dans un parent abstrait, notamment le check pour</span>
<span style="color: #808080; font-style: italic;"># savoir si un adapter convient a un objet donné</span>
<span style="color: #ff7700;font-weight:bold;">class</span> Adapteur<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    cls = <span style="color: #008000;">None</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, objet<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">objet</span> = objet
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> peut_adapter<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, objet<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">cls</span> == <span style="color: #008000;">type</span><span style="color: black;">&#40;</span>objet<span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;"># un adapter, c'est juste un objet proxy qui arrondit les angles</span>
<span style="color: #ff7700;font-weight:bold;">class</span> PersonneAdapteur<span style="color: black;">&#40;</span>Adapteur<span style="color: black;">&#41;</span>:
&nbsp;
    cls = Personne
&nbsp;
    <span style="color: #808080; font-style: italic;"># on va réduire la complexité en faisant en sorte que tous les checks</span>
    <span style="color: #808080; font-style: italic;"># soient cachés derrière une simple property</span>
    @<span style="color: #008000;">property</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> majeur<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">objet</span> <span style="color: #66cc66;">&gt;</span>= <span style="color: #ff4500;">18</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> ProspectAdapteur<span style="color: black;">&#40;</span>Adapteur<span style="color: black;">&#41;</span>:
&nbsp;
    cls = Prospect
&nbsp;
    @<span style="color: #008000;">property</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> majeur<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #808080; font-style: italic;"># TODO: prendre en compte les années bisextiles</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#40;</span><span style="color: #dc143c;">datetime</span>.<span style="color: #dc143c;">datetime</span>.<span style="color: black;">now</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> - <span style="color: #008000;">self</span>.<span style="color: black;">objet</span>.<span style="color: black;">date_de_naissance</span><span style="color: black;">&#41;</span> / <span style="color: #ff4500;">365</span> <span style="color: #66cc66;">&gt;</span> <span style="color: #ff4500;">18</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> LeClientAdapteur<span style="color: black;">&#40;</span>Adapteur<span style="color: black;">&#41;</span>:
&nbsp;
    cls = LeClient
&nbsp;
    @<span style="color: #008000;">property</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> majeur<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #808080; font-style: italic;"># retourne le nombre d'années après 18 ans ou -1. Don't ask...</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">objet</span>.<span style="color: black;">get_majeur_de_combien</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #66cc66;">&gt;</span> -<span style="color: #ff4500;">1</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> ClientAdapteur<span style="color: black;">&#40;</span>Adapteur<span style="color: black;">&#41;</span>:
&nbsp;
    cls = Client
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, objet<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">objet</span> = objet
&nbsp;
    @<span style="color: #008000;">property</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> majeur<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">accepte_carte_membre</span> <span style="color: #ff7700;font-weight:bold;">and</span> <span style="color: #008000;">self</span>.<span style="color: black;">objet</span>.<span style="color: black;">carte_membre</span> <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #008000;">None</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">True</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">objet</span>.<span style="color: black;">majeur</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">True</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: #008000;">object</span>.<span style="color: black;">carte_identite</span> <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #008000;">None</span>:
            now = <span style="color: #dc143c;">datetime</span>.<span style="color: #dc143c;">datetime</span>.<span style="color: black;">now</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
            <span style="color: #808080; font-style: italic;"># TODO: prendre en compte les années bisextiles</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#40;</span>now - personne.<span style="color: black;">carte_identite</span>.<span style="color: black;">date_de_naissance</span><span style="color: black;">&#41;</span> / <span style="color: #ff4500;">365</span> <span style="color: #66cc66;">&gt;</span> <span style="color: #ff4500;">18</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">False</span></pre></div></div>

<p>Le contrôleur et le videur deviennent du coup beaucoup plus simples, maintenant que la logique est normalisée :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> VerificateurDeMajorite<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">def</span> check_majorite<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, personne<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">for</span> adapteur <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">self</span>.<span style="color: black;">adapteurs</span>:
            <span style="color: #ff7700;font-weight:bold;">if</span> adapteur.<span style="color: black;">peut_adapter</span><span style="color: black;">&#40;</span>personne<span style="color: black;">&#41;</span>:
                <span style="color: #ff7700;font-weight:bold;">return</span> adapteur<span style="color: black;">&#40;</span>personne<span style="color: black;">&#41;</span>.<span style="color: black;">majeur</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># du coup un vérificateur, c'est très déclaratif</span>
<span style="color: #ff7700;font-weight:bold;">class</span> Videur<span style="color: black;">&#40;</span>VerificateurDeMajorite<span style="color: black;">&#41;</span>:
&nbsp;
    adapteurs = <span style="color: black;">&#40;</span>
        PersonneAdapteur,
        ClientAdapteur,
        ProspectAdapteur,
        LeClientAdapteur,
    <span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> tu_peux_rentrer<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, personne<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">check_majorite</span><span style="color: black;">&#40;</span>personne<span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Controleur<span style="color: black;">&#40;</span>VerificateurDeMajorite<span style="color: black;">&#41;</span>:
&nbsp;
    adapteurs = <span style="color: black;">&#40;</span>
        PersonneAdapteur,
        <span style="color: #808080; font-style: italic;"># ProspectAdapteur()</span>
        LeClientAdapteur<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>,
    <span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> est_autorise<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, personne<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">check_majorite</span><span style="color: black;">&#40;</span>personne<span style="color: black;">&#41;</span></pre></div></div>

<p>Si il faut ajouter un autre format de client, il suffit de coder un adapteur. Si il faut ajouter une autre classe de vérification, il suffit de lui donner les bons adapteurs.</p>
<p>Et le traitement est aussi simple, car si vous avez une liste qui contient plein de clients différents :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> clients = <span style="color: black;">&#91;</span>Client<span style="color: black;">&#40;</span>majeur=<span style="color: #008000;">True</span><span style="color: black;">&#41;</span>, Client<span style="color: black;">&#40;</span>carte_de_membre=CarteDeMembre<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>, Client<span style="color: black;">&#40;</span>carte_identite=CarteIdentité<span style="color: black;">&#40;</span><span style="color: #dc143c;">datetime</span>.<span style="color: #dc143c;">datetime</span>.<span style="color: black;">now</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>, LeClient<span style="color: black;">&#40;</span>-<span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>, Personne<span style="color: black;">&#40;</span>age=<span style="color: #ff4500;">16</span><span style="color: black;">&#41;</span>...<span style="color: black;">&#93;</span></pre></div></div>

<p>Vous pouvez quand même vérifier tout ça sans y réfléchir:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> videur = Videur<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">for</span> client <span style="color: #ff7700;font-weight:bold;">in</span> clients:
...     <span style="color: #ff7700;font-weight:bold;">if</span> videur.<span style="color: black;">tu_peux_rentrer</span><span style="color: black;">&#40;</span>client<span style="color: black;">&#41;</span>:
...         <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Glouglou&quot;</span><span style="color: black;">&#41;</span>
...
<span style="color: black;">Glouglou</span>
Glouglou
...
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> controlleur = Controleur<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">for</span> client <span style="color: #ff7700;font-weight:bold;">in</span> clients:
...     <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> controlleur.<span style="color: black;">est_autorise</span><span style="color: black;">&#40;</span>client<span style="color: black;">&#41;</span>:
...         <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Ahhhh !&quot;</span><span style="color: black;">&#41;</span>
...
<span style="color: black;">Ahhhh</span> <span style="color: #66cc66;">!</span>
Ahhhh <span style="color: #66cc66;">!</span>
...</pre></div></div>

<p>Dans un cas comme celui de notre exemple, l&#8217;adapter est un peu overkill, on s&#8217;en tirerait aussi bien avec une liste de fonctions, et le code serait plus léger et lisible.</p>
<p> Mais quand les objets et la logique deviennent très complexes, tout ramener à une interface commune permet de simplifier énormément le code.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=7112&amp;md5=dd69aed35d7a04dab21ab6d6601e104e" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/objets-proxy-et-pattern-adapter-en-python/feed/</wfw:commentRss>
		<slash:comments>11</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fobjets-proxy-et-pattern-adapter-en-python%2F&amp;language=en_GB&amp;category=text&amp;title=Objets+proxy+et+pattern+adapter+en+Python&amp;description=En+informatique%2C+le+vocabulaire+c%26%238217%3Best+une+bonne+partie+du+travail.+On+a+des+tas+de+termes+comme+polymorphisme%2C+r%C3%A9cursivit%C3%A9%2C+idempotent+ou+closure.+Certains+sont+des+termes+math%C3%A9matiques%2C+d%26%238217%3Bautres+sont+des...&amp;tags=adapter%2Cpoo%2Cproxy%2Cpython%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/08/LF4zJ3x.png" length="420644" type="image/jpg" />	</item>
		<item>
		<title>Le guide ultime et définitif sur la programmation orientée objet en Python à l’usage des débutants qui sont rassurés par les textes détaillés qui prennent le temps de tout expliquer. Partie 8.</title>
		<link>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-8/</link>
		<comments>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-8/#comments</comments>
		<pubDate>Tue, 02 Jul 2013 07:31:26 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[metaclass]]></category>
		<category><![CDATA[poo]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=6524</guid>
		<description><![CDATA[Vous n'avez absolument pas besoin des métaclasses. Mais quand même, ça serait tellement cool de savoir vous en servir.]]></description>
			<content:encoded><![CDATA[<p>8ème et dernier chapitre sur la programmation orientée objet en Python. Nous allons voir l&#8217;ultime réalité, le secret cosmique de nirvana Pythonique, le truc dont personne ne se sert avant d&#8217;avoir au moins codé 3 moteurs de blogs, un bot twitter et une IA de real doll.</p>
<p>J&#8217;ai nommé&#8230;</p>
<p>Les métaclasses.</p>
<p>Comme tous les articles sur la question, je commence avec la citation standard :</p>
<blockquote><p>Les métaclasses sont une magie trop obscure pour que 99% des utilisateurs s&#8217;en préoccupe. Si vous vous demandez si vous en avez besoin, ce n&#8217;est pas le cas (les gens qui en ont vraiment besoin le savent avec certitude et n&#8217;ont pas besoin d&#8217;explications sur la raison).
    </p></blockquote>
<p>    <em>Tim Peters, les mec qui <a href="http://www.python.org/dev/peps/pep-0020/">a écrit le PEP20</a>.</em></p>
<p>En résumé, cet article ne vous servira probablement pas. Je me suis servi, en 10 ans, deux fois des métaclasses dans ma vie. C&#8217;est pour le sport, quoi.</p>
<p>Pré-requis:</p>
<ul>
<li>Avoir lu la <a href="http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-7/">partie précédente</a> et bien tout compris. Mais alors bien tout. Si il subsiste un doute dans votre esprit, relisez toute la série car vous ne vous en sortirez pas.</li>
<li>Notamment, avoir bien pigé le principe de <code>object</code>, car les metaclasses ne fonctionnent qu&#8217;avec les New Style classes.</li>
<li>Comprendre le principe de références, callable, lambdas et dictionnaires en Python. En fait à peu prêt tout sauf les métaclasses parce que ce truc est ce que vous voulez apprendre en dernier de toute façon.</li>
<li>Être bien reposé et avoir du temps devant soi. Pas la peine de lire en diagonal. Vraiment.</li>
</ul>
<p>Musique.</p>

<!-- iframe plugin v:2.3 - wordpress.org/extend/plugins/iframe/ -->
<iframe width="420" height="315" src="//www.youtube.com/embed/AfNdyoNfPi8" frameborder="0" scrolling="no" class="iframe-class"></iframe>
<h2>Au début, il y avait les objets</h2>
<p>Et <del>Dieu</del> Guido vit que cela était bon, et qu&#8217;il n&#8217;y avait pas de raison de ne pas se marrer un bon coup, alors il décida que les classes, qui servaient à fabriquer les objets, seraient aussi des objets.</p>
<p>Dans la plupart des langages, une classe est vraiment juste un plan pour produire un objet, un bout de code, une syntaxe élaborée pour dire &#8220;voici ma classe&#8221;. On peut l&#8217;imaginer comme cela en Python également, et vivre très heureux et avoir beaucoup de bons moments :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">class</span> CreateurDObject<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
...     <span style="color: #ff7700;font-weight:bold;">pass</span>
...
<span style="color: #66cc66;">&gt;&gt;&gt;</span> mon_objet = CreateurDObject<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>mon_objet<span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&lt;</span>__main__.<span style="color: black;">CreateurDObject</span> <span style="color: #008000;">object</span> at 0x1c22fd0<span style="color: #66cc66;">&gt;</span></pre></div></div>

<p>Sauf qu&#8217;en Python, les classes sont aussi des objets.</p>
<p>Je vous laisse maturer ça 1 minute. Prenez une inspiration.</p>
<p>Quand l&#8217;interpréteur Python lit le mot <code>class</code>, il crée un objet. Dans le code ci-dessus, en mémoire, Python crée un objet <code>CreateurDObject</code>.</p>
<p>Cet objet est une classe, il permet de créer d&#8217;autres objets &#8211; ses instances &#8211; mais ça reste un objet. Et comme tous les objets&#8230;</p>
<p>On peut l&#8217;assigner à une variable :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> ReferenceACreateurDObjet = CreateurDObject
<span style="color: #66cc66;">&gt;&gt;&gt;</span> ReferenceACreateurDObjet<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&lt;</span>__main__.<span style="color: black;">CreateurDObject</span> <span style="color: #008000;">object</span> at 0x1c320d0<span style="color: #66cc66;">&gt;</span></pre></div></div>

<p>On peut le passer en paramètre :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">def</span> afficher_une_class<span style="color: black;">&#40;</span>cls<span style="color: black;">&#41;</span>:
...     <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Hey, on m'a passé la classe %s&quot;</span> <span style="color: #66cc66;">%</span> cls<span style="color: black;">&#41;</span>
...
<span style="color: #66cc66;">&gt;&gt;&gt;</span> afficher_une_class<span style="color: black;">&#40;</span>CreateurDObject<span style="color: black;">&#41;</span>
Hey, on m<span style="color: #483d8b;">'a passé la classe &lt;class '</span><span style="color: #dc143c;">__main__</span>.<span style="color: black;">CreateurDObject</span><span style="color: #483d8b;">'&gt;</span></pre></div></div>

<p>On peut lui ajouter des attributs à la volée :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> CreateurDObject.<span style="color: black;">nouvel_attribut</span> = <span style="color: #483d8b;">'nouvelle valeur'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span>CreateurDObject, <span style="color: #483d8b;">'nouvel_attribut'</span><span style="color: black;">&#41;</span>
<span style="color: #008000;">True</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> CreateurDObject.<span style="color: black;">nouvel_attribut</span>
u<span style="color: #483d8b;">'nouvelle valeur'</span></pre></div></div>

<h2>Le 7eme jour, on se faisait grave chier alors on a créé des classes dynamiquement</h2>
<p>Peut être vous souvenez-vous qu&#8217;on peut <a href="http://sametmax.com/comprendre-les-decorateurs-python-pas-a-pas-partie-1/">créer des fonctions à la volée </a>?</p>
<p>Parce qu&#8217;on peut faire pareil avec les classes :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">def</span> fabriquer_une_class<span style="color: black;">&#40;</span>nom<span style="color: black;">&#41;</span>:
...     <span style="color: #ff7700;font-weight:bold;">if</span> nom == <span style="color: #483d8b;">'bulbizarre'</span>:
...         <span style="color: #ff7700;font-weight:bold;">class</span> Bulbizarre<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
...             <span style="color: #ff7700;font-weight:bold;">pass</span>
...         <span style="color: #ff7700;font-weight:bold;">return</span> Bulbizarre <span style="color: #808080; font-style: italic;"># je retourne Bulbizarre, PAS Bulbizarre()</span>
...     <span style="color: #ff7700;font-weight:bold;">else</span>:
...         <span style="color: #ff7700;font-weight:bold;">class</span> Salameche<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>: <span style="color: #808080; font-style: italic;"># qui prenait carapuce, sérieux ?</span>
...             <span style="color: #ff7700;font-weight:bold;">pass</span>
...         <span style="color: #ff7700;font-weight:bold;">return</span> Salameche
<span style="color: #66cc66;">&gt;&gt;&gt;</span> Pokemon = fabriquer_une_class<span style="color: black;">&#40;</span><span style="color: #483d8b;">'autre'</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">type</span><span style="color: black;">&#40;</span>Pokemon<span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># Pokemon est une CLASSE, pas une instance</span>
<span style="color: #66cc66;">&lt;</span>type <span style="color: #483d8b;">'type'</span><span style="color: #66cc66;">&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> nouveau_pokemon = Pokemon<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># la je créer une instance</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">type</span><span style="color: black;">&#40;</span>nouveau_pokemon<span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&lt;</span>class <span style="color: #483d8b;">'__main__.Salameche'</span><span style="color: #66cc66;">&gt;</span></pre></div></div>

<p>Une classe n&#8217;est pas quelque chose de figé dans le marbre, comme tout le reste en  Python, on peut les fabriquer dynamiquement, les modifier en cours de route, les malmener, etc.</p>
<p>Aucun pokemon n&#8217;a cependant été blessé pendant la rédaction de cet article. Tiens je me demande si il y a des sites zoophiles spécialisés dans les Pokemons. Qu&#8217;est-ce que je raconte ? Évidement qu&#8217;il y en a. D&#8217;ailleurs Pikachu est comme une shocking flech torch avec piles incluses quand on y pense. Ou un appareil à abdos. Il faut que je fasse des abdos, j&#8217;ai pris du bide. Heu&#8230; où j&#8217;en étais ?</p>
<p>A oui. Classes. Dynamiques.</p>
<p>Comme toutes les <del>opérations courantes</del> idées à la con, Python vous permet de faire ça complètement à la main. Maintenant vient la troisième Révélation Des Métaclasses : la fonction <code>type()</code> a deux usages.</p>
<p>Dans une première vie <code>type()</code> est une fonction ordinaire, elle sert à retourner le type d&#8217;un objet :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #008000;">type</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&lt;</span>type <span style="color: #483d8b;">'int'</span><span style="color: #66cc66;">&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #008000;">type</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;1&quot;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&lt;</span>type <span style="color: #483d8b;">'str'</span><span style="color: #66cc66;">&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #008000;">type</span><span style="color: black;">&#40;</span>CreateurDObject<span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&lt;</span>type <span style="color: #483d8b;">'type'</span><span style="color: #66cc66;">&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #008000;">type</span><span style="color: black;">&#40;</span>CreateurDObject<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&lt;</span>class <span style="color: #483d8b;">'__main__.CreateurDObject'</span><span style="color: #66cc66;">&gt;</span></pre></div></div>

<p>Et propose à sa logeuse de descendre ses poubelles. Mais elle a une autre vie électronique, elle est aussi capable de créer une classe.</p>
<p>Oui c&#8217;est très con d&#8217;avoir choisit la même PUTAIN DE FONCTION pour faire deux trucs qui n&#8217;ont rien à voir. Mais les deux usages ont un avenir et il va falloir faire avec, se caler ça où je pense et oubliez votre avocat.</p>
<p>Bref, ça marche comme ça :</p>
<p><code>type(nom de la classe, tuple des parents de la classe, dictionnaire contenant les attributs)</code></p>
<p>Le nom de la classe, je pense que vous avez pigé.</p>
<p>Le tuple des parents, il peut être vide. C&#8217;est dans le cas où vous souhaitez un héritage : vous pouvez passer des références aux classes parentes.</p>
<p>Le dictionnaire est assez simple : chaque clé est un nom d&#8217;attribut, chaque valeur est une valeur d&#8217;attribut.</p>
<p>Exemple, cette classe :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">class</span> Pokeball<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
...     <span style="color: #ff7700;font-weight:bold;">pass</span></pre></div></div>

<p>Peut se créer ainsi :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> Pokeball = <span style="color: #008000;">type</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'Pokeball'</span>, <span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>, <span style="color: black;">&#123;</span><span style="color: black;">&#125;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>Et s&#8217;utiliser tout pareil :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>Pokeball<span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&lt;</span>class <span style="color: #483d8b;">'__main__.Pokeball'</span><span style="color: #66cc66;">&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>Pokeball<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&lt;</span>__main__.<span style="color: black;">Pokeball</span> <span style="color: #008000;">object</span> at 0x1c32450<span style="color: #66cc66;">&gt;</span></pre></div></div>

<p>Vous aurez noté que le nom de classe passé en paramètre est le même que celui de la variable qui va recevoir la classe ainsi créée. Oui, ils peuvent être différents. Non, ça ne sert à rien.</p>
<p>Et je sais que certains auraient préféré MyLittlePoney, mais je fais avec ma maigre culture G. Faudrait que je tente avec des noms de Pogs.</p>
<p>Un petit exemple avec des attributs :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">class</span> Pokeball<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
...     <span style="color: black;">couleurs</span> = <span style="color: black;">&#40;</span><span style="color: #483d8b;">'rouge'</span>, <span style="color: #483d8b;">'blanc'</span><span style="color: black;">&#41;</span></pre></div></div>

<p>Ce qui donne :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> Pokeball = <span style="color: #008000;">type</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'Pokeball'</span>, <span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>, <span style="color: black;">&#123;</span><span style="color: #483d8b;">'couleurs'</span>: <span style="color: black;">&#40;</span><span style="color: #483d8b;">'rouge'</span>, <span style="color: #483d8b;">'blanc'</span><span style="color: black;">&#41;</span><span style="color: black;">&#125;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> Pokeball.<span style="color: black;">couleurs</span>
<span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'rouge'</span>, u<span style="color: #483d8b;">'blanc'</span><span style="color: black;">&#41;</span></pre></div></div>

<p>Étant donné que les méthodes sont des attributs&#8230;</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">class</span> Pokeball<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
  ...     <span style="color: #ff7700;font-weight:bold;">def</span> attraper<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
  ...         <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;ratééééééééééééé&quot;</span><span style="color: black;">&#41;</span>
  ...</pre></div></div>

<p>Peut se traduire par :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">def</span> out<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;ratéééééééééééé&quot;</span>
...
<span style="color: #66cc66;">&gt;&gt;&gt;</span> Pokeball = <span style="color: #008000;">type</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'Pokeball'</span>, <span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>, <span style="color: black;">&#123;</span><span style="color: #483d8b;">'attraper'</span>: out<span style="color: black;">&#125;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> Pokeball<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">attraper</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
ratéééééééééééé</pre></div></div>

<p>Au passage, toute classe créée par <code>type</code> hérite automatiquement de <code>object</code>, pas besoin de le préciser.</p>
<p>Petite démo avec de l&#8217;héritage  :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">class</span> Masterball<span style="color: black;">&#40;</span>Pokeball<span style="color: black;">&#41;</span>:
...     <span style="color: #ff7700;font-weight:bold;">def</span> attraper<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
...         <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;yeahhhhhhhhhh&quot;</span><span style="color: black;">&#41;</span>
...</pre></div></div>

<p>Se transforme en :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">def</span> out<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;yeahhhhhhhhhh&quot;</span>
...
<span style="color: #66cc66;">&gt;&gt;&gt;</span> Masterball = <span style="color: #008000;">type</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'Masterball'</span>, <span style="color: black;">&#40;</span>Pokeball,<span style="color: black;">&#41;</span>, <span style="color: black;">&#123;</span><span style="color: #483d8b;">'attraper'</span>: out<span style="color: black;">&#125;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> Masterball<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">attraper</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
yeahhhhhhhhhh</pre></div></div>

<p>Je répète les Révélations Divines :</p>
<ol>
<li>
Les classes sont des objets.
</li>
<li>On peut créer les classes à la volée.</li>
<li><code>type()</code> permet de créer une classe manuellement.</li>
<li>Keanu Reeves est un mauvais acteur.</li>
</ol>
<p>Vous voyez où je veux en venir, là, non ?</p>
<h2>Et le tout puissant déclara : tu créeras des classes avec des classes</h2>
<p>Et tu n&#8217;aimeras pas ça. Alors au début tu le feras avec des fonctions parce que c&#8217;est plus facile.</p>
<p>Une métaclasse, c&#8217;est seulement le nom du &#8220;truc&#8221; qui fabrique une classe. C&#8217;est tout.</p>
<p>C&#8217;est pour ça qu&#8217;on appelle les métaclasses, les classes des classes.</p>
<p>Puisque les classes sont des objets ?</p>
<p>Vous suivez ?</p>
<p>Non ?</p>
<p>Ah.</p>
<p>o</p>
<p>En deux lignes alors :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">UneClasse = MetaClass<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
un_objet = UneClasse<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>Mieux ?</p>
<p>Vous avez vu la fonction <code>type()</code> créer des classes ? En fait la fonction <code>type()</code> est une métaclasse. C&#8217;est la métaclasse dont Python se sert pour créer tous les objets classes, quand vous tapez le keyword <code>class</code>.</p>
<p>Il est facile de voir ça en regardant l&#8217;attribut <code>__class__</code>, qui indique quelle classe a servi à créer un objet :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> pokemon_capture = <span style="color: #ff4500;">149</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> pokemon_capture.__class__
<span style="color: #66cc66;">&lt;</span>type <span style="color: #483d8b;">'int'</span><span style="color: #66cc66;">&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> nom = <span style="color: #483d8b;">'magicarp'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> nom.__class__
<span style="color: #66cc66;">&lt;</span>type <span style="color: #483d8b;">'str'</span><span style="color: #66cc66;">&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">def</span> attrapez_les_presque_tous<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">pass</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> attrapez_les_presque_tous.__class__
<span style="color: #66cc66;">&lt;</span>type <span style="color: #483d8b;">'function'</span><span style="color: #66cc66;">&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">class</span> Pokedex<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">pass</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> gadget = Pokedex<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> gadget.__class__
<span style="color: #66cc66;">&lt;</span>class <span style="color: #483d8b;">'__main__.Pokedex'</span><span style="color: #66cc66;">&gt;</span></pre></div></div>

<p>Mais quelle est le <code>__class__</code> de tout <code>__class__</code> ?</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> attrapez_les_presque_tous.__class__.__class__
<span style="color: #66cc66;">&lt;</span>type <span style="color: #483d8b;">'type'</span><span style="color: #66cc66;">&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> pokemon_capture.__class__.__class__
<span style="color: #66cc66;">&lt;</span>type <span style="color: #483d8b;">'type'</span><span style="color: #66cc66;">&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> nom.__class__.__class__
<span style="color: #66cc66;">&lt;</span>type <span style="color: #483d8b;">'type'</span><span style="color: #66cc66;">&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> gadget.__class__.__class__
<span style="color: #66cc66;">&lt;</span>type <span style="color: #483d8b;">'type'</span><span style="color: #66cc66;">&gt;</span></pre></div></div>

<p>Normalement c&#8217;est à ce moment là que vous avez la Grande Révélation.</p>
<p>Faites &#8220;Ahhhhhhhhhhhhhhhhh&#8221;.</p>
<p>Donc la métaclasse, c&#8217;est le machin qui fabrique les classes, c&#8217;est une factory de classe. <code>type</code> est la métaclasse utilisée par défaut, mais vous pensez bien, chers amis, qu&#8217;on peut fabriquer ses propres métaclasses. Sinon ça serait pas marrant.</p>
<p>Ça marche comme ça :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> UneClasse<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
  <span style="color: #0000cd;">__metaclass__</span> = votre métaclasse
  <span style="color: black;">&#91;</span> le reste du <span style="color: #dc143c;">code</span> de la classe <span style="color: black;">&#93;</span></pre></div></div>

<p>Quand Python va voir ça, il ne va pas créer la classe immédiatement, il d&#8217;abord suivre le chaîne d&#8217;héritage pour trouver qu&#8217;elle métaclasse utiliser pour fabriquer la classe :</p>
<p>Il va regarder d&#8217;abord vérifier si il y a <code>__metaclass__</code> de déclarée. Si ce n&#8217;est pas le cas, il va chercher dans les parents si ils ont un attribut <code>__metaclass__</code>. Si ce n&#8217;est pas le cas, il va utiliser <code>type</code>. Si Python trouve <code>__metaclass__</code>, alors il utilisera son contenu à la place de <code>type</code>.</p>
<p>Dans les deux cas, il va collecter toutes les informations sur la classe (le nom, les parents, les attributs), et les passer en paramètres à <code>type</code> ou votre métaclasse, et récupérer le résultat. Puis, seulement à ce moment là, il enregistre votre classe en mémoire.</p>
<p>Prenez votre temps sur ces paragraphes, c&#8217;est un peu la clé de tout le tuto.</p>
<p>Bon, nouvelle révélation : une métaclasse n&#8217;a pas besoin d&#8217;être une classe.</p>
<p>Je sais, c&#8217;est idiot d&#8217;appeler un truc &#8220;métaclass&#8221; si ça n&#8217;a pas besoin d&#8217;être une classe. Mais on parle de la fonctionnalité qui utilise <code>type</code> pour un truc qui n&#8217;a rien à avoir. Ça devait être le jour du beaujolais nouveau quand ils ont introduit la feature.</p>
<p>En fait, une métaclasse peut être n&#8217;importe quel callable qui retourne une classe, donc une fonction toute conne fait très bien l&#8217;affaire.</p>
<p>Le but de la métaclasse, c&#8217;est d&#8217;intercepter la création de la classe afin de la modifier, et voici ce que ça donne :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># une métaclasse DOIT avoir la même signature que type() puisque</span>
<span style="color: #808080; font-style: italic;"># Python va lui passer tout ça automatiquement en paramètre</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> prefixer<span style="color: black;">&#40;</span>nom, parents, attributs<span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot;
        On va créer une métaclasse qui prend tous les noms de méthodes,
        et les prefixe du mot &quot;attaque&quot;. Oui ça ne sert à rien. Mais
        les usages des métaclasses qui servent à quelques choses sont
        généralement très compliqués.
    &quot;&quot;&quot;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># On crée un nouveau dictionnaire d'attributs avec les noms préfixés</span>
    <span style="color: #808080; font-style: italic;"># On fait gaffe à pas modifier les __méthodes_magique__.</span>
    nouveaux_attributs = <span style="color: black;">&#123;</span><span style="color: black;">&#125;</span>
    <span style="color: #ff7700;font-weight:bold;">for</span> nom, val <span style="color: #ff7700;font-weight:bold;">in</span> attributs.<span style="color: black;">items</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> nom.<span style="color: black;">startswith</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'__'</span><span style="color: black;">&#41;</span>:
            nouveaux_attributs<span style="color: black;">&#91;</span><span style="color: #483d8b;">'attaque_'</span> + nom<span style="color: black;">&#93;</span> = val
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            nouveaux_attributs<span style="color: black;">&#91;</span>nom<span style="color: black;">&#93;</span> = val
&nbsp;
    <span style="color: #808080; font-style: italic;"># On délègue la création de la classe à type() :</span>
    <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">type</span><span style="color: black;">&#40;</span>nom, parents, nouveaux_attributs<span style="color: black;">&#41;</span></pre></div></div>

<p>L&#8217;utilisation est toute simple, on écrit une classe normale, et on lui rajoute <code>__metaclass__</code>:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">class</span> Ronflex<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #0000cd;">__metaclass__</span> = prefixer
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> armure<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;defense +15&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> dodo<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;zzzzzz&quot;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> r = Ronflex<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> r.<span style="color: black;">attaque_armure</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
defense +<span style="color: #ff4500;">15</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> r.<span style="color: black;">attaque_dodo</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
zzzzzz
<span style="color: #66cc66;">&gt;&gt;&gt;</span> r.<span style="color: black;">dodo</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
Traceback <span style="color: black;">&#40;</span>most recent call last<span style="color: black;">&#41;</span>:
  File <span style="color: #483d8b;">&quot;&lt;ipython-input-58-90dd54234d5d&gt;&quot;</span>, line <span style="color: #ff4500;">1</span>, <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #66cc66;">&lt;</span>module<span style="color: #66cc66;">&gt;</span>
    r.<span style="color: black;">dodo</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #008000;">AttributeError</span>: <span style="color: #483d8b;">'armure'</span> <span style="color: #008000;">object</span> has no attribute <span style="color: #483d8b;">'dodo'</span></pre></div></div>

<p>Voilà, c&#8217;est à peut prêt tout ce qu&#8217;il y a à comprendre des métaclasses :</p>
<ol>
<li>On intercepte la création classe.</li>
<li>On modifie les paramètres.</li>
<li>On retourne la classe customisée.</li>
</ol>
<p>Maintenant, la grande question : à quoi ça sert ?</p>
<p>Généralement, ça sert à faire de jolies APIs. Par exemple, les ORM (<a href="http://sametmax.com/sept-petites-libs-qui-changent-la-vie-dun-dev-python/">peewee</a>, SQLAlchemy, l&#8217;ORM de Django) utilisent les métaclasses pour avoir un style déclaratif :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Article<span style="color: black;">&#40;</span>Model<span style="color: black;">&#41;</span>:
    titre = model.<span style="color: black;">CharField</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>Ici, <code>Model</code> va contenir une métaclasse, comme c&#8217;est un parent, la métaclasse sera aussi appelée pour <code>Article</code>, et elle peut donc agir pour modifier <code>titre</code> à la volée.</p>
<p>En effet, quand vous faites :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> art = Article.<span style="color: black;">get</span><span style="color: black;">&#40;</span><span style="color: #008000;">id</span>=<span style="color: #ff4500;">13</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> art.<span style="color: black;">titre</span>
u<span style="color: #483d8b;">'Python pour les méca-scriptophiles'</span></pre></div></div>

<p>Avec un ORM, vous récupérez la valeur de <code>titre</code> dans la base de données et non un <code>CharField()</code>. C&#8217;est le but : cacher des requêtes SQL et donner l&#8217;impression de manipuler des objets.</p>
<p>Ici le rôle de la métaclasse, c&#8217;est de prendre tous les attributs de types <code>xxxField()</code>, et modifier la classe pour qu&#8217;accéder à l&#8217;attribut fasse la requête voulue à la base de données.</p>
<p>On peut aussi utiliser les métaclasses pour faire des vérifications : s&#8217;assurer que la classe n&#8217;utilise pas un nom que vous voulez réserver, ou qu&#8217;elle contient bien un attribut.</p>
<p>Il y a même des <a href="http://docs.python.org/2/library/abc.html?highlight=abc#abc">implémentations</a> d&#8217;interfaces (ou plutôt de l&#8217;équivalent des classes abstraites en Java) pour Python utilisant les métaclasses. Je ne suis pas convaincus par leur utilité, mais c&#8217;est possible.</p>
<h2>Soyez prophètes</h2>
<p>C&#8217;est pas le tout, mais maintenant que vous avez compris, il est temps de limer les bords pour que vous alliez porter la bonne parole.</p>
<p>Donc déjà, bon à savoir : <code>metaclass</code> est un paramètre de classe en Python 3. Ca donne ça:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> DePython3<span style="color: black;">&#40;</span>metaclass=votre_metaclasse<span style="color: black;">&#41;</span></pre></div></div>

<p>Ensuite, il y des conventions de nommage. Tout comme on nomme <code>self</code> le premier paramètre des méthodes, et <code>*args</code> / <code>**kwargs</code> les paramètres dynamiques, les paramètres des métaclasses ont des noms conventionels. La métaclasse précédente s&#8217;écrirait donc plus proprement :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">def</span> prefixer<span style="color: black;">&#40;</span>name, bases, dct<span style="color: black;">&#41;</span>:
    nouveaux_attributs = <span style="color: black;">&#123;</span><span style="color: black;">&#125;</span>
    <span style="color: #ff7700;font-weight:bold;">for</span> nom, val <span style="color: #ff7700;font-weight:bold;">in</span> dct.<span style="color: black;">items</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> nom.<span style="color: black;">startswith</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'__'</span><span style="color: black;">&#41;</span>:
            nouveaux_attributs<span style="color: black;">&#91;</span><span style="color: #483d8b;">'attaque_'</span> + nom<span style="color: black;">&#93;</span> = val
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            nouveaux_attributs<span style="color: black;">&#91;</span>nom<span style="color: black;">&#93;</span> = val
&nbsp;
    <span style="color: #808080; font-style: italic;"># On délègue la création de la classe à type() :</span>
    <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">type</span><span style="color: black;">&#40;</span>name, bases, nouveaux_attributs<span style="color: black;">&#41;</span></pre></div></div>

<p>Enfin, souvenez-vous que les métaclasses ne fonctionnent qu&#8217;avec les New Style classes, donc celles qui héritent de <code>object</code>.</p>
<p>Par ailleurs, vous croisez peut être des fois <code>__metaclass__</code> en plein milieu d&#8217;un module (pas dans une classe donc). C&#8217;est une vieille façon de faire, qui affecte toutes les classes du module. Ce n&#8217;est plus recommandé.</p>
<p>Terminons sur une version de métaclasse qui fait la même chose que <code>prefixer()</code>, mais sous forme de classe. Parce que sinon à quoi ça sert que ça s&#8217;appelle une métaclasse, hein ?</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># Oui, on peut hériter de type(), car c'est une classe, enfin une métaclasse.</span>
<span style="color: #808080; font-style: italic;"># Mais pas sous forme de fonction. Sous forme de classe. Mais son nom</span>
<span style="color: #808080; font-style: italic;"># est en minuscule, comme celui des classes int() et str(). Qui ne sont</span>
<span style="color: #808080; font-style: italic;"># pas des métaclasses. Souvenez-vous : Beaujolais.</span>
<span style="color: #ff7700;font-weight:bold;">class</span> Prefixer<span style="color: black;">&#40;</span><span style="color: #008000;">type</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #808080; font-style: italic;"># __new__ est le vrai constructeur en Python, et il retourne l'instance</span>
    <span style="color: #808080; font-style: italic;"># en cours d'une classe. Or, qu'elle est l'instance d'une métaclasse ?</span>
    <span style="color: #808080; font-style: italic;"># Une classe !</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__new__</span><span style="color: black;">&#40;</span>cls, name, bases, dct<span style="color: black;">&#41;</span>:
&nbsp;
        nouveaux_attributs = <span style="color: black;">&#123;</span><span style="color: black;">&#125;</span>
        <span style="color: #ff7700;font-weight:bold;">for</span> nom, val <span style="color: #ff7700;font-weight:bold;">in</span> dct.<span style="color: black;">items</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> nom.<span style="color: black;">startswith</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'__'</span><span style="color: black;">&#41;</span>:
                nouveaux_attributs<span style="color: black;">&#91;</span><span style="color: #483d8b;">'attaque_'</span> + nom<span style="color: black;">&#93;</span> = val
            <span style="color: #ff7700;font-weight:bold;">else</span>:
                nouveaux_attributs<span style="color: black;">&#91;</span>nom<span style="color: black;">&#93;</span> = val
&nbsp;
        <span style="color: #808080; font-style: italic;"># On délègue la création de la classe à son parent.</span>
        <span style="color: #808080; font-style: italic;"># Notez que cls doit être passé de bout en bout, ce qui n'est pas</span>
        <span style="color: #808080; font-style: italic;"># le cas d'habitude avec 'self'</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">super</span><span style="color: black;">&#40;</span>Prefixer, cls<span style="color: black;">&#41;</span>.<span style="color: #0000cd;">__new__</span><span style="color: black;">&#40;</span>cls, name, bases, nouveaux_attributs<span style="color: black;">&#41;</span></pre></div></div>

<p>Et ça s&#8217;utilise pareil</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">class</span> Ronflex<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    <span style="color: #0000cd;">__metaclass__</span> = Prefixer
    <span style="color: #ff7700;font-weight:bold;">def</span> armure<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;defense +15&quot;</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> dodo<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;zzzzzz&quot;</span><span style="color: black;">&#41;</span>
...
<span style="color: #66cc66;">&gt;&gt;&gt;</span> r = Ronflex<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> r.<span style="color: black;">attaque_dodo</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
zzzzzz
<span style="color: #66cc66;">&gt;&gt;&gt;</span> r.<span style="color: black;">attaque_armure</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
defense +<span style="color: #ff4500;">15</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> r.<span style="color: black;">dodo</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
Traceback <span style="color: black;">&#40;</span>most recent call last<span style="color: black;">&#41;</span>:
  File <span style="color: #483d8b;">&quot;&lt;ipython-input-66-90dd54234d5d&gt;&quot;</span>, line <span style="color: #ff4500;">1</span>, <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #66cc66;">&lt;</span>module<span style="color: #66cc66;">&gt;</span>
    r.<span style="color: black;">dodo</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #008000;">AttributeError</span>: <span style="color: #483d8b;">'Ronflex'</span> <span style="color: #008000;">object</span> has no attribute <span style="color: #483d8b;">'dodo'</span></pre></div></div>

<p>Pourquoi utiliser une classe plutôt qu&#8217;une fonction alors que c&#8217;est vraiment plus compliqué ?</p>
<p>Et bien l&#8217;avantage d&#8217;utiliser une classe est qu&#8217;elle peut avoir des attributs et hériter. Car bien entendu, on peut avoir des metaclasses, qui héritent de metaclasses, et ainsi de suite, jusqu&#8217;à ce que du Lisp paraisse avoir du sens en comparaison.</p>
<p>On peut même faire plus vicieux et utiliser <code>__call__</code> au lieu de <code>__new__</code>:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># on hérite plus de type, rien à foutre</span>
<span style="color: #ff7700;font-weight:bold;">class</span> Prefixer<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, prefix=<span style="color: #483d8b;">'attaque'</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">prefix</span> = prefix
&nbsp;
    <span style="color: #808080; font-style: italic;"># __call__ est la méthode appelée automatiquement quand on ajoute () après</span>
    <span style="color: #808080; font-style: italic;"># un nom d'objet. Ca permet de rendre un objet callable. En gros, ça nous</span>
    <span style="color: #808080; font-style: italic;"># permet d'utiliser une instance de Prefixer() comme une fonction</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__call__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, name, bases, dct<span style="color: black;">&#41;</span>:
&nbsp;
        nouveaux_attributs = <span style="color: black;">&#123;</span><span style="color: black;">&#125;</span>
        <span style="color: #ff7700;font-weight:bold;">for</span> nom, val <span style="color: #ff7700;font-weight:bold;">in</span> dct.<span style="color: black;">items</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> nom.<span style="color: black;">startswith</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'__'</span><span style="color: black;">&#41;</span>:
                nouveaux_attributs<span style="color: black;">&#91;</span><span style="color: #008000;">self</span>.<span style="color: black;">prefix</span> + nom<span style="color: black;">&#93;</span> = val
            <span style="color: #ff7700;font-weight:bold;">else</span>:
                nouveaux_attributs<span style="color: black;">&#91;</span>nom<span style="color: black;">&#93;</span> = val
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">type</span><span style="color: black;">&#40;</span>name, bases, nouveaux_attributs<span style="color: black;">&#41;</span></pre></div></div>

<p>Et c&#8217;est sympa car du coup on peut passer des paramètres à notre métaclasse :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">class</span> Ronflex<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    <span style="color: #0000cd;">__metaclass__</span> = Prefixer<span style="color: black;">&#40;</span>prefix=<span style="color: #483d8b;">'tatayoyo_'</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> armure<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;defense +15&quot;</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> dodo<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;zzzzzz&quot;</span><span style="color: black;">&#41;</span>
...         
<span style="color: #66cc66;">&gt;&gt;&gt;</span> r = Ronflex<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> r.<span style="color: black;">tatayoyo_dodo</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
zzzzzz</pre></div></div>

<p>Voilà, vous avez vu le visage de Dieu en face. C&#8217;est comme ça qu&#8217;il fabrique le monde.</p>
<p>Ah mais attendez ? Si <code>type()</code> est la métaclasse de tous les objets ? Qu&#8217;est-ce qui et la métaclasse de <code>type()</code> ?</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">type</span>.__class__
<span style="color: #66cc66;">&lt;</span>type <span style="color: #483d8b;">'type'</span><span style="color: #66cc66;">&gt;</span></pre></div></div>

<p>Je vous laisse méditer sur cette découverte métaphysique.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=6524&amp;md5=d8e07460f74d9528ca38e6d90fdf4d35" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-8/feed/</wfw:commentRss>
		<slash:comments>17</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fle-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-8%2F&amp;language=en_GB&amp;category=text&amp;title=Le+guide+ultime+et+d%C3%A9finitif+sur+la+programmation+orient%C3%A9e+objet+en+Python+%C3%A0+l%E2%80%99usage+des+d%C3%A9butants+qui+sont+rassur%C3%A9s+par+les+textes+d%C3%A9taill%C3%A9s+qui+prennent+le+temps+de+tout+expliquer.+Partie+8.&amp;description=8%C3%A8me+et+dernier+chapitre+sur+la+programmation+orient%C3%A9e+objet+en+Python.+Nous+allons+voir+l%26%238217%3Bultime+r%C3%A9alit%C3%A9%2C+le+secret+cosmique+de+nirvana+Pythonique%2C+le+truc+dont+personne+ne+se+sert+avant...&amp;tags=metaclass%2Cpoo%2Cpython%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/07/tumblr_mkdufxjm9L1qfpgjto1_500.jpg" length="34995" type="image/jpg" />	</item>
		<item>
		<title>Le guide ultime et définitif sur la programmation orientée objet en Python à l’usage des débutants qui sont rassurés par les textes détaillés qui prennent le temps de tout expliquer. Partie 7.</title>
		<link>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-7/</link>
		<comments>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-7/#comments</comments>
		<pubDate>Sun, 28 Apr 2013 05:47:17 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[classe]]></category>
		<category><![CDATA[classes]]></category>
		<category><![CDATA[heritage]]></category>
		<category><![CDATA[path.py]]></category>
		<category><![CDATA[poo]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=5912</guid>
		<description><![CDATA[L'orienté object est particulièrement adapté à la création de belles APIs. Nous allons donc étudier aujourd'hui un cas réel de mise en pratique réussi avec la lib <a href="https://github.com/jaraco/path.py">path.py</a>.]]></description>
			<content:encoded><![CDATA[<p>Un peu de rock à l&#8217;anglaise pour faire passer la pilule :</p>

<!-- iframe plugin v:2.3 - wordpress.org/extend/plugins/iframe/ -->
<iframe width="420" height="315" src="http://www.youtube.com/embed/wcb4gCJ9da0" frameborder="0" scrolling="no" class="iframe-class"></iframe>
<p>Après avoir lu <a href="http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-6">la partie précédente</a>, vous avez dû vous demander comment mettre tout ça en application.</p>
<p>Comme je vous l&#8217;avais expliqué, l&#8217;orienté object est particulièrement adapté à la création de belles APIs. Nous allons donc étudier aujourd&#8217;hui un cas réel de mise en pratique réussi avec la lib <a href="https://github.com/jaraco/path.py">path.py</a>.</p>
<p>J&#8217;ai choisi cette lib car :</p>
<ul>
<li>Le code tient dans un seul fichier.</li>
<li>Il y a plein de patterns utilisés dedans qui sont intéressants à expliquer.</li>
<li>C&#8217;est une source propre qui suit globalement les bonnes pratiques.</li>
<li>Path.py a une API élégante, donc le résultat à l&#8217;usage est un bon exemple.</li>
</ul>
<p>Petit rappel, path.py est une surcouche au dessus des modules <a href="http://docs.python.org/2/library/tempfile.html?highlight=tempfile#tempfile">tempfile</ ahref=>, <a href="http://docs.python.org/2/library/os.html?highlight=os#os">os</a> ou encore <a href="http://docs.python.org/2/library/shutil.html?highlight=shutils">shutil</a>, c&#8217;est à dire qu&#8217;elle permet de faire exactement la même chose, en plus pratique.</p>
<p>C&#8217;est donc typiquement un bibliothèque de confort, et elle n&#8217;aurait aucun intérêt si elle n&#8217;était pas agréable à utiliser puisque l&#8217;on peut déjà faire tout ce qu&#8217;elle fait avec Python en standard. Son attractivité réside dans la beauté de son interface qui rend la manipulation de fichiers très intuitive :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># elle permet de manipuler des chemins facilement</span>
<span style="color: #ff7700;font-weight:bold;">from</span> path <span style="color: #ff7700;font-weight:bold;">import</span> path
dossier = path<span style="color: black;">&#40;</span><span style="color: #483d8b;">'/etc'</span><span style="color: black;">&#41;</span>
fichier = dossier / <span style="color: #483d8b;">'postgresql/9.1/main/pg_hba.conf'</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># d'obtenir des informations sur le fichier</span>
fichier.<span style="color: black;">exists</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #808080; font-style: italic;">## True</span>
fichier.<span style="color: black;">parent</span>
<span style="color: #808080; font-style: italic;">## path(u'/etc/postgresql/9.1/main')</span>
fichier.<span style="color: black;">basename</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #808080; font-style: italic;">## path(u'pg_hba.conf')</span>
fichier.<span style="color: black;">dirname</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #808080; font-style: italic;">## path(u'/etc/postgresql/9.1/main')</span>
fichier.<span style="color: black;">spli</span>
fichier.<span style="color: black;">split</span>       fichier.<span style="color: black;">splitall</span>    fichier.<span style="color: black;">splitdrive</span>  fichier.<span style="color: black;">splitext</span>    fichier.<span style="color: black;">splitlines</span>  fichier.<span style="color: black;">splitpath</span>   fichier.<span style="color: black;">splitunc</span>
fichier.<span style="color: black;">splitext</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #808080; font-style: italic;">## (path(u'/etc/postgresql/9.1/main/pg_hba'), u'.conf')</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;"># lister les fichiers dans un dossiers</span>
<span style="color: #ff7700;font-weight:bold;">for</span> fichier <span style="color: #ff7700;font-weight:bold;">in</span> dossier.<span style="color: black;">listdir</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
...     <span style="color: #ff7700;font-weight:bold;">print</span> fichier
...
<span style="color: #808080; font-style: italic;">## /etc/thunderbird</span>
<span style="color: #808080; font-style: italic;">## /etc/libpaper.d</span>
<span style="color: #808080; font-style: italic;">## /etc/mtools.conf</span>
<span style="color: #808080; font-style: italic;">## ...</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># lister récursivement les fichiers dans un dossier</span>
<span style="color: #ff7700;font-weight:bold;">for</span> fichier <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: black;">&#40;</span>dossier / <span style="color: #483d8b;">'apt/'</span><span style="color: black;">&#41;</span>.<span style="color: black;">walkfiles</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">print</span> fichier
...
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.save</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/trusted.gpg</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/trusted.gpg~</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/indicator-brightness-ppa-raring.list.save</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/tualatrix-ppa-raring.list</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/webupd8team-sublime-text-2-raring.list</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/fossfreedom-byzanz-raring.list.save</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/hotot-team-ppa-raring.list.save</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/webupd8team-y-ppa-manager-raring.list</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/pitti-postgresql-raring.list.save</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/pitti-postgresql-raring.list</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/yorba-ppa-raring.list.save</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/indicator-brightness-ppa-raring.list</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/webupd8team-sublime-text-2-raring.list.save</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/yorba-ppa-raring.list</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/webupd8team-y-ppa-manager-raring.list.save</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/sources.list.d/fossfreedom-byzanz-raring.list</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/trustdb.gpg</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/20dbus</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/10periodic</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/99synaptic</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/70debconf</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/05aptitude</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/20archive</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/01autoremove</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/50unattended-upgrades</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/00aptitude</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/99update-notifier</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/15update-stamp</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/00trustcdrom</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/20changelog</span>
<span style="color: #808080; font-style: italic;">## /etc/apt/apt.conf.d/01autoremove-kernels</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># et bien d'autres choses</span></pre></div></div>

<p>Nous allons donc commenter son code, dans le cadre du tuto (on ne va pas voir les algos en détails). Je mettrai mes commentaires entre <code>#< sm ></ sm ></code> afin de les distinguer du reste.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">&nbsp;
<span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
<span style="color: #808080; font-style: italic;"># On commence par un bon gros bloc de copyright, sachant que path.py est</span>
<span style="color: #808080; font-style: italic;"># sous MIT License. Le plus inhabituel c'est l'absence de déclaration</span>
<span style="color: #808080; font-style: italic;"># d'encoding en en-tête, qui s'explique par le fait que toute la lib est</span>
<span style="color: #808080; font-style: italic;"># écrite uniquement avec des caractères ASCII, ce qui est l'encodage par</span>
<span style="color: #808080; font-style: italic;"># défaut de Python 2.7. Python 3 a UTF8 en encodage par défaut, mais ASCII</span>
<span style="color: #808080; font-style: italic;"># est un sous-ensemble de UTF8, donc ça ne pose pas de problème.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Notez qu'avec mes commentaires en plus, ça ferait planter le script puisque</span>
<span style="color: #808080; font-style: italic;"># j'utilise des accents.</span>
<span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">#</span>
<span style="color: #808080; font-style: italic;"># Copyright (c) 2010 Mikhail Gusarov</span>
<span style="color: #808080; font-style: italic;">#</span>
<span style="color: #808080; font-style: italic;"># Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span style="color: #808080; font-style: italic;"># of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span style="color: #808080; font-style: italic;"># in the Software without restriction, including without limitation the rights</span>
<span style="color: #808080; font-style: italic;"># to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span style="color: #808080; font-style: italic;"># copies of the Software, and to permit persons to whom the Software is</span>
<span style="color: #808080; font-style: italic;"># furnished to do so, subject to the following conditions:</span>
<span style="color: #808080; font-style: italic;">#</span>
<span style="color: #808080; font-style: italic;"># The above copyright notice and this permission notice shall be included in all</span>
<span style="color: #808080; font-style: italic;"># copies or substantial portions of the Software.</span>
<span style="color: #808080; font-style: italic;">#</span>
<span style="color: #808080; font-style: italic;"># THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span style="color: #808080; font-style: italic;"># IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span style="color: #808080; font-style: italic;"># FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span style="color: #808080; font-style: italic;"># AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span style="color: #808080; font-style: italic;"># LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span style="color: #808080; font-style: italic;"># OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<span style="color: #808080; font-style: italic;"># SOFTWARE.</span>
<span style="color: #808080; font-style: italic;">#</span>
&nbsp;
<span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
<span style="color: #808080; font-style: italic;"># La docstring du module qui documente l'usage général du module. En</span>
<span style="color: #808080; font-style: italic;"># l'occurence au moins l'existence de la classe principale et son usage. Les</span>
<span style="color: #808080; font-style: italic;"># symboles comme '\x40' sont juste une autre représentation d'un caractères</span>
<span style="color: #808080; font-style: italic;"># via sa valeur dans la table ASCII.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Par exemple, '@' est à la case 64 dans la table ASCII, et 64 se note 40 en</span>
<span style="color: #808080; font-style: italic;"># hexadecimal:</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># &gt;&gt;&gt; ord('@')</span>
<span style="color: #808080; font-style: italic;"># 64</span>
<span style="color: #808080; font-style: italic;"># &gt;&gt;&gt; int('40', base=16)</span>
<span style="color: #808080; font-style: italic;"># 64</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Du coup on peut écrire '@' juste avec un caractère d’échappement en Python</span>
<span style="color: #808080; font-style: italic;"># qui va faire le lien. Cette technique est utile si on peut faire passer</span>
<span style="color: #808080; font-style: italic;"># du texte avec des caractères spéciaux dans certains protocole, par exemple</span>
<span style="color: #808080; font-style: italic;"># quand on veut rentrer un email dans une URL. En l'occurence je ne vois</span>
<span style="color: #808080; font-style: italic;"># absolument pas ce que ça vient foutre ici.</span>
<span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
&nbsp;
<span style="color: #483d8b;">&quot;&quot;&quot; path.py - An object representing a path to a file or directory.
&nbsp;
Original author:
 Jason Orendorff &lt;jason.orendorff<span style="color: #000099; font-weight: bold;">\x</span>40gmail<span style="color: #000099; font-weight: bold;">\x</span>2ecom&gt;
&nbsp;
Current maintainer:
 Jason R. Coombs &lt;jaraco@jaraco.com&gt;
&nbsp;
Contributors:
 Mikhail Gusarov &lt;dottedmag@dottedmag.net&gt;
 Marc Abramowitz &lt;marc@marc-abramowitz.com&gt;
 Jason R. Coombs &lt;jaraco@jaraco.com&gt;
 Jason Chu &lt;jchu@xentac.net&gt;
 Vojislav Stojkovic &lt;vstojkovic@syntertainment.com&gt;
&nbsp;
Example::
&nbsp;
    from path import path
    d = path('/home/guido/bin')
    for f in d.files('*.py'):
        f.chmod(0755)
&nbsp;
path.py requires Python 2.5 or later.
&quot;&quot;&quot;</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
<span style="color: #808080; font-style: italic;"># Import du mot clé with, car cette lib est compatible avec Python 2.5</span>
<span style="color: #808080; font-style: italic;"># et le keyword est apparu en 2.6. Il a été backporté dans __future__</span>
<span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">__future__</span> <span style="color: #ff7700;font-weight:bold;">import</span> with_statement
&nbsp;
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">sys</span> <span style="color: #808080; font-style: italic;">#&lt;sm&gt;Informations sur le système&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">warnings</span> <span style="color: #808080; font-style: italic;">#&lt;sm&gt;Alertes techniques à d'autres dev&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">os</span> <span style="color: #808080; font-style: italic;">#&lt;sm&gt;Manipulation du FS&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">fnmatch</span> <span style="color: #808080; font-style: italic;">#&lt;sm&gt;Pattern matching comme dans un shell&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">glob</span> <span style="color: #808080; font-style: italic;">#&lt;sm&gt;Lister des fichier avec la syntax shell&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">shutil</span> <span style="color: #808080; font-style: italic;">#&lt;sm&gt;Manipulation de fichiers de haut niveau&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">codecs</span> <span style="color: #808080; font-style: italic;">#&lt;sm&gt;Encoding&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">import</span> hashlib <span style="color: #808080; font-style: italic;">#&lt;sm&gt;Sommes de controle&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">errno</span> <span style="color: #808080; font-style: italic;">#&lt;sm&gt;Les code d'erreurs liées au fichier.&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">tempfile</span> <span style="color: #808080; font-style: italic;">#&lt;sm&gt;Création de fichiers temporaires&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">import</span> functools <span style="color: #808080; font-style: italic;">#&lt;sm&gt;Manipulation des fonctions&lt;/sm&gt;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
<span style="color: #808080; font-style: italic;"># Tentative d'utilisation de la lib win32security qui sert à gérer</span>
<span style="color: #808080; font-style: italic;"># des aspects sécuritaires du FS sous Windows. C'est une lib tièrce partie,</span>
<span style="color: #808080; font-style: italic;"># et une dépendance ooptionelle, donc l'import est géré pour ne pas faire</span>
<span style="color: #808080; font-style: italic;"># d'erreur si la lib n'est pas disponible.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Idem pour pwd qui est dans la lib standard mais uniquement sur les distribs</span>
<span style="color: #808080; font-style: italic;"># unix et qui donne accès aux infos sur l'utilisateur du système, tester</span>
<span style="color: #808080; font-style: italic;"># son mot de passe, etc.</span>
<span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">try</span>:
    <span style="color: #ff7700;font-weight:bold;">import</span> win32security
<span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">ImportError</span>:
    <span style="color: #ff7700;font-weight:bold;">pass</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">try</span>:
    <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">pwd</span>
<span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">ImportError</span>:
    <span style="color: #ff7700;font-weight:bold;">pass</span>
&nbsp;
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
<span style="color: #808080; font-style: italic;"># Manière standard de lister la version de la lib dans un module Python.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># __all__ est une variable magique qui peut contenir une liste des noms de</span>
<span style="color: #808080; font-style: italic;"># tout ce qui est importable dans le module, de telle sorte que si</span>
<span style="color: #808080; font-style: italic;"># quelqu'un fait : from path import *, seul le contenu de __all__ soit</span>
<span style="color: #808080; font-style: italic;"># importé.</span>
<span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
__version__ = <span style="color: #483d8b;">'3.0'</span>
__all__ = <span style="color: black;">&#91;</span><span style="color: #483d8b;">'path'</span><span style="color: black;">&#93;</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
<span style="color: #808080; font-style: italic;"># Les warning ressemblent beaucoup aux exceptions excepté qu'ils ne font</span>
<span style="color: #808080; font-style: italic;"># pas planter le programme. Ici donc, ou hérite de la base des warnings</span>
<span style="color: #808080; font-style: italic;"># comme on le ferait pour créer son Exception personnalisée, ce qui va</span>
<span style="color: #808080; font-style: italic;"># permettre à l'utilisateur de la lib path.py de, plus tard, pouvoir filter</span>
<span style="color: #808080; font-style: italic;"># ce warning en particulier.</span>
<span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> TreeWalkWarning<span style="color: black;">&#40;</span><span style="color: #008000;">Warning</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">pass</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
<span style="color: #808080; font-style: italic;"># Un decorateur de mémorisation, c'est à dire qui va mettre en cache les</span>
<span style="color: #808080; font-style: italic;"># résultats de la fonction sur lequel il est appliqué afin que les prochains</span>
<span style="color: #808080; font-style: italic;"># appels avec les mêmes paramètres lisent les valeurs du cache en mémoire</span>
<span style="color: #808080; font-style: italic;"># plutôt que de refaire l'opération.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Il est utilisé plus bas sur :</span>
&nbsp;
<span style="color: #808080; font-style: italic;">#     @classmethod</span>
<span style="color: #808080; font-style: italic;">#     @simple_cache</span>
<span style="color: #808080; font-style: italic;">#     def using_module(cls, module):</span>
<span style="color: #808080; font-style: italic;">#         subclass_name = cls.__name__ + '_' + module.__name__</span>
<span style="color: #808080; font-style: italic;">#         bases = (cls,)</span>
<span style="color: #808080; font-style: italic;">#         ns = {'module': module}</span>
<span style="color: #808080; font-style: italic;">#         return type(subclass_name, bases, ns)</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Ça évitera plusieurs traitements de using_module() si le paramètre de</span>
<span style="color: #808080; font-style: italic;"># 'module' ne change pas.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Et oui, on peut mélanger plusieurs classes et fonctions dans un même module,</span>
<span style="color: #808080; font-style: italic;"># ça n'a pas d'importance.</span>
&nbsp;
<span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">def</span> simple_cache<span style="color: black;">&#40;</span>func<span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot;
    Save results for the 'using_module' classmethod.
    When Python 3.2 is available, use functools.lru_cache instead.
    &quot;&quot;&quot;</span>
    saved_results = <span style="color: black;">&#123;</span><span style="color: black;">&#125;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> wrapper<span style="color: black;">&#40;</span>cls, module<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">if</span> module <span style="color: #ff7700;font-weight:bold;">in</span> saved_results:
            <span style="color: #ff7700;font-weight:bold;">return</span> saved_results<span style="color: black;">&#91;</span>module<span style="color: black;">&#93;</span>
        saved_results<span style="color: black;">&#91;</span>module<span style="color: black;">&#93;</span> = func<span style="color: black;">&#40;</span>cls, module<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> saved_results<span style="color: black;">&#91;</span>module<span style="color: black;">&#93;</span>
    <span style="color: #ff7700;font-weight:bold;">return</span> wrapper
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
<span style="color: #808080; font-style: italic;"># Nous avons vu que les propriétés permettaient de déguiser une méthode</span>
<span style="color: #808080; font-style: italic;"># en attribut. Cela ne marche pas sur une méthode de classe car dans ce cas</span>
<span style="color: #808080; font-style: italic;"># la propriété va se retourner elle-même.</span>
<span style="color: #808080; font-style: italic;"># Cette classe hérite de property pour écraser ce comportement et bien</span>
<span style="color: #808080; font-style: italic;"># retourner la valeur de la méthode de classe.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Elle est utilisée plus loin dans:</span>
&nbsp;
<span style="color: #808080; font-style: italic;">#     @ClassProperty</span>
<span style="color: #808080; font-style: italic;">#     @classmethod</span>
<span style="color: #808080; font-style: italic;">#     def _next_class(cls):</span>
<span style="color: #808080; font-style: italic;">#         &quot;&quot;&quot;</span>
<span style="color: #808080; font-style: italic;">#         What class should be used to construct new instances from this class</span>
<span style="color: #808080; font-style: italic;">#         &quot;&quot;&quot;</span>
<span style="color: #808080; font-style: italic;">#         return cls</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Ce qui va permettre de faire path._next_class au lieu de path._next_class().</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># C'est cosmétique, mais c'est le but de la lib d'être jolie.</span>
<span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">class</span> ClassProperty<span style="color: black;">&#40;</span><span style="color: #008000;">property</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__get__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, cls, owner<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">fget</span>.<span style="color: #0000cd;">__get__</span><span style="color: black;">&#40;</span><span style="color: #008000;">None</span>, owner<span style="color: black;">&#41;</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
<span style="color: #808080; font-style: italic;"># Encore un décorateur, cette fois sous forme de classe (on ne les a pas vu)</span>
<span style="color: #808080; font-style: italic;"># Celui-ci, quand il est appliqué, sert à ce qu'une méthode soit à la fois</span>
<span style="color: #808080; font-style: italic;"># une méthode d'instance et une méthode de classe, le choix se faisant</span>
<span style="color: #808080; font-style: italic;"># dynamiquement selon la situation.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Par exemple dans:</span>
&nbsp;
<span style="color: #808080; font-style: italic;">#     @multimethod</span>
<span style="color: #808080; font-style: italic;">#     def joinpath(cls, first, *others):</span>
<span style="color: #808080; font-style: italic;">#         &quot;&quot;&quot;</span>
<span style="color: #808080; font-style: italic;">#         Join first to zero or more path components, adding a separator</span>
<span style="color: #808080; font-style: italic;">#         character (first.module.sep) if needed.  Returns a new instance of</span>
<span style="color: #808080; font-style: italic;">#         first._next_class.</span>
<span style="color: #808080; font-style: italic;">#         &quot;&quot;&quot;</span>
<span style="color: #808080; font-style: italic;">#         if not isinstance(first, cls):</span>
<span style="color: #808080; font-style: italic;">#             first = cls(first)</span>
<span style="color: #808080; font-style: italic;">#         return first._next_class(first.module.join(first, *others))</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># 'cls' sera une instance ou une classe selon que l'appel se fasse depuis la</span>
<span style="color: #808080; font-style: italic;"># classe ou l'instance.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Notez le nom de la classe qui n'est pas en CamelCase (pas de majuscule)</span>
<span style="color: #808080; font-style: italic;"># alors qu'il s'agit bien d'un classe. Comme c'est un décorateur, on a</span>
<span style="color: #808080; font-style: italic;"># l'habitude de les voire en minuscule, donc on laisse ce nom en minuscule.</span>
<span style="color: #808080; font-style: italic;"># C'est une des rares exceptions au PEP8 (on en verra d'autres plus bas)</span>
<span style="color: #808080; font-style: italic;"># qu'on peut se permettre quand on sait ce qu'on fait :-)</span>
<span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">class</span> multimethod<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot;
    Acts like a classmethod when invoked from the class and like an
    instancemethod when invoked from the instance.
    &quot;&quot;&quot;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, func<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">func</span> = func
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__get__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, instance, owner<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#40;</span>
            functools.<span style="color: black;">partial</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">func</span>, owner<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">if</span> instance <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #008000;">None</span>
            <span style="color: #ff7700;font-weight:bold;">else</span> functools.<span style="color: black;">partial</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">func</span>, owner, instance<span style="color: black;">&#41;</span>
        <span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
<span style="color: #808080; font-style: italic;"># La classe principale, et le plus gros morceau de code. Une classe peut</span>
<span style="color: #808080; font-style: italic;"># tout à fait faire plusieurs centaines de lignes.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># En général je recommande de ne pas avoir de fichiers qui fait plus de 500</span>
<span style="color: #808080; font-style: italic;"># lignes en Python, mais ici le but est clairement de faire une lib qui tient</span>
<span style="color: #808080; font-style: italic;"># dans un fichier pour l'auteur.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># La classe hérite du type unicode (hé oui, on peut hériter des types</span>
<span style="color: #808080; font-style: italic;"># built-in !); ainsi le path peut être manipulé comme une chaîne et reste</span>
<span style="color: #808080; font-style: italic;"># compatible avec tous les outils de manipulation de nom de fichiers existant</span>
<span style="color: #808080; font-style: italic;"># car ils utilisent les chaînes.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># L'héritage est une techno qui sert donc aussi à conserver des compatibilités</span>
<span style="color: #808080; font-style: italic;"># et des comportements existant / attendus.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Encore une fois le nom est en minuscule alors que c'est une classe, c'est une</span>
<span style="color: #808080; font-style: italic;"># autre exception : quand on créer un type de base, on le met en minuscule</span>
<span style="color: #808080; font-style: italic;"># car c'est ce que fait la lib standard (int(), str(), list(), datetime(),</span>
<span style="color: #808080; font-style: italic;"># unicode, etc, sont en fait des classes).</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># La docstring pourrait être meilleure.</span>
<span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
<span style="color: #ff7700;font-weight:bold;">class</span> path<span style="color: black;">&#40;</span><span style="color: #008000;">unicode</span><span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot; Represents a filesystem path.
&nbsp;
    For documentation on individual methods, consult their
    counterparts in os.path.
    &quot;&quot;&quot;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Probablement mon désaccord principal avec cette lib, l'init vérifie</span>
    <span style="color: #808080; font-style: italic;"># qu'on lui passe bien une chaîne alors que j'aurais choisit le duck typing.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, other<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #008000;">isinstance</span><span style="color: black;">&#40;</span>other, <span style="color: #008000;">basestring</span><span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">TypeError</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;path must be a string&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># L'auteur stocke la référence de os.path ici, et l'utilise partout à la</span>
    <span style="color: #808080; font-style: italic;"># place d'utiliser os.path directement. Cela permet de changer ce module à</span>
    <span style="color: #808080; font-style: italic;"># la volée, par exemple pour utiliser spécifiquement le module dédié à</span>
    <span style="color: #808080; font-style: italic;"># Windows ou à unix au lieu de celui choisit automatiquement.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># C'est un exemple de pattern stratégie.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Et non, la docstring n'a aucun effet. Ça pourrait être un comment.</span>
    <span style="color: #808080; font-style: italic;"># En revanche, comme spécifié en comment, certains outils comme sphinx</span>
    <span style="color: #808080; font-style: italic;"># prend les docstring en compte sur les variables.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    module = <span style="color: #dc143c;">os</span>.<span style="color: black;">path</span>
    <span style="color: #483d8b;">&quot;The path module to use for path operations.&quot;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Une méthode retourne une classe path dont le module est</span>
    <span style="color: #808080; font-style: italic;"># celui passé en paramètre. Pratique si vous voulez</span>
    <span style="color: #808080; font-style: italic;"># utiliser un module de spécifique à un OS depuis un autre</span>
    <span style="color: #808080; font-style: italic;"># mais juste ponctuellement.</span>
    <span style="color: #808080; font-style: italic;"># Par exemple sous Windows, vous voulez traiter un chemin</span>
    <span style="color: #808080; font-style: italic;"># (mais un seul, le reste est sous Windows) Unix, vous</span>
    <span style="color: #808080; font-style: italic;"># pouvez faire :</span>
    <span style="color: #808080; font-style: italic;">#</span>
    <span style="color: #808080; font-style: italic;"># &gt;&gt;&gt; import posixpath</span>
    <span style="color: #808080; font-style: italic;"># &gt;&gt;&gt; p = path.using_module(posixpath)('/etc')</span>
    <span style="color: #808080; font-style: italic;"># &gt;&gt;&gt; print p</span>
    <span style="color: #808080; font-style: italic;"># /etc</span>
    <span style="color: #808080; font-style: italic;"># &gt;&gt;&gt; p</span>
    <span style="color: #808080; font-style: italic;"># path_posixpath(u'/etc')</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># ce qui crée un objet path() dont l'attribut 'module' est le module</span>
    <span style="color: #808080; font-style: italic;">#  posixpath. C'est une application concrète de l'injection de dépendance.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
    @<span style="color: #008000;">classmethod</span>
    @simple_cache
    <span style="color: #ff7700;font-weight:bold;">def</span> using_module<span style="color: black;">&#40;</span>cls, module<span style="color: black;">&#41;</span>:
        subclass_name = cls.__name__ + <span style="color: #483d8b;">'_'</span> + module.__name__
        bases = <span style="color: black;">&#40;</span>cls,<span style="color: black;">&#41;</span>
        ns = <span style="color: black;">&#123;</span><span style="color: #483d8b;">'module'</span>: module<span style="color: black;">&#125;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">type</span><span style="color: black;">&#40;</span>subclass_name, bases, ns<span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Une propriété qui retourne la classe (oui, on peut retourner une CLASSE)</span>
    <span style="color: #808080; font-style: italic;"># à utiliser si on veut créer une nouvelle instance de cette classe.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># C'est très abstrait, vous n'aurez pas à faire ça tous les jours.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># C'est une méthode placée là pour permettre un maximum de configurabilité</span>
    <span style="color: #808080; font-style: italic;"># : si vous changez cette classe, certaines méthodes renverront un autre</span>
    <span style="color: #808080; font-style: italic;"># type plutôt que le type en cours. Utile pour certains cas où vous voulez</span>
    <span style="color: #808080; font-style: italic;"># hériter de path() mais désirez un comportement spécial pour la création</span>
    <span style="color: #808080; font-style: italic;"># de nouveaux path.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
    @ClassProperty
    @<span style="color: #008000;">classmethod</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> _next_class<span style="color: black;">&#40;</span>cls<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot;
        What class should be used to construct new instances from this class
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> cls
&nbsp;
    <span style="color: #808080; font-style: italic;"># --- Special Python methods.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Là on attaque la définition de toutes les méthodes magiques.</span>
    <span style="color: #808080; font-style: italic;"># Essentiellement pour overrider le comportement par défaut des chaines</span>
    <span style="color: #808080; font-style: italic;"># unicode et exposer une API sympas.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Dans le shell, un path s'affichera path('chemin') et non 'chemin'</span>
    <span style="color: #808080; font-style: italic;"># L'auteur affiche en fait le nom du type en cours (en cas d'héritage</span>
    <span style="color: #808080; font-style: italic;"># cela changera) et ensuite la representation du parent, en l'occurence</span>
    <span style="color: #808080; font-style: italic;"># la classe unicode().</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__repr__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #483d8b;">'%s(%s)'</span> <span style="color: #66cc66;">%</span> <span style="color: black;">&#40;</span><span style="color: #008000;">type</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>.__name__, <span style="color: #008000;">super</span><span style="color: black;">&#40;</span>path, <span style="color: #008000;">self</span><span style="color: black;">&#41;</span>.<span style="color: #0000cd;">__repr__</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Override l'addition.</span>
    <span style="color: #808080; font-style: italic;"># path('truc') + 'machin' donne path('trucmachin')</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Adding a path and a string yields a path.</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__add__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, more<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #008000;">super</span><span style="color: black;">&#40;</span>path, <span style="color: #008000;">self</span><span style="color: black;">&#41;</span>.<span style="color: #0000cd;">__add__</span><span style="color: black;">&#40;</span>more<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">TypeError</span>:  <span style="color: #808080; font-style: italic;"># Python bug</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">NotImplemented</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># 'machin' + path('truc') donne path('trucmachin')</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__radd__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, other<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #008000;">isinstance</span><span style="color: black;">&#40;</span>other, <span style="color: #008000;">basestring</span><span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">NotImplemented</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span>other.<span style="color: #0000cd;">__add__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Override la division.</span>
    <span style="color: #808080; font-style: italic;"># path('truc') / 'machin' donne path('trucm/achin')</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># The / operator joins paths.</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__div__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, rel<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; fp.__div__(rel) == fp / rel == fp.joinpath(rel)
&nbsp;
        Join two path components, adding a separator character if
        needed.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">join</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, rel<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Petite astuce de compatibilité si le mec a fait</span>
    <span style="color: #808080; font-style: italic;"># from __future__ import division ou si on est en Python 3</span>
    <span style="color: #808080; font-style: italic;">#</span>
    <span style="color: #808080; font-style: italic;"># Remarque : on peut définir des attributs de classe n'importe où, et pas</span>
    <span style="color: #808080; font-style: italic;"># seulement en haut de la classe.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Make the / operator work even when true division is enabled.</span>
    __truediv__ = <span style="color: #0000cd;">__div__</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># path() est aussi un context manager qu'on peut utiliser avec with !</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># with path('truc'):</span>
    <span style="color: #808080; font-style: italic;">#     tout ce qui est ici ce fait dans le dossier truc</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># *_ n'est pas une notation qui a un effet spécial. '_' est un nom de</span>
    <span style="color: #808080; font-style: italic;"># variable valide, c'est une convention pour dire 'je ne vais pas me</span>
    <span style="color: #808080; font-style: italic;"># servir de cet argument, je le déclare juste pour respecter la signature'</span>
    <span style="color: #808080; font-style: italic;"># et '*' et l'opérateur de paramétrage dynamique. '*_' est donc l'auteur</span>
    <span style="color: #808080; font-style: italic;"># signalant qu'il accepte n'importe quels paramètres positionnels, mais</span>
    <span style="color: #808080; font-style: italic;"># qu'ils ne les utilisera pas.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> __enter__<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>._old_dir = <span style="color: #008000;">self</span>.<span style="color: black;">getcwd</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #dc143c;">os</span>.<span style="color: black;">chdir</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> __exit__<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #66cc66;">*</span>_<span style="color: black;">&#41;</span>:
        <span style="color: #dc143c;">os</span>.<span style="color: black;">chdir</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>._old_dir<span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Le résultat de os.getcwdu(), mais retourne un objet path().</span>
    <span style="color: #808080; font-style: italic;"># Une bonne part du travail de la lib consiste à wrapper les méthodes</span>
    <span style="color: #808080; font-style: italic;"># ordinaires des autres modules pour qu'elles retournent un type path()</span>
    <span style="color: #808080; font-style: italic;"># pour qu'après on puisse faire des '.parent' ou utiliser '/' dessus</span>
    <span style="color: #808080; font-style: italic;"># sans y penser.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    @<span style="color: #008000;">classmethod</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> getcwd<span style="color: black;">&#40;</span>cls<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Return the current working directory as a path object. &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> cls<span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span>.<span style="color: black;">getcwdu</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#</span>
    <span style="color: #808080; font-style: italic;"># --- Operations on path strings.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># On enchaine ici des wrappers sur des méthodes de os.path (ou son</span>
    <span style="color: #808080; font-style: italic;"># remplaçant dans self.module), que l'objet s'applique à lui-même (self).</span>
    <span style="color: #808080; font-style: italic;"># Comme la classe hérite de 'unicode', toutes ces méthodes marchent.</span>
    <span style="color: #808080; font-style: italic;"># Et comme self._next_class retourne la classe pour créer le prochain</span>
    <span style="color: #808080; font-style: italic;"># path, on retourne toujours un objet de type 'path'.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Si on fait fi des abstractions et qu'on lit les valeurs par défaut,</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#     self._next_class(self.module.abspath(self))</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># fait en fait:</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#     path(os.path.abspath('ton_chemin'))</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Ce qui donne l'API suivante quand on utilise la lib :</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#     &gt;&gt;&gt; path('/etc/nginx/..').abspath()</span>
    <span style="color: #808080; font-style: italic;">#     path(u'/etc')</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> abspath<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">abspath</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> normcase<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">normcase</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> normpath<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">normpath</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> realpath<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">realpath</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> expanduser<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">expanduser</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> expandvars<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">expandvars</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> dirname<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">dirname</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> basename<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">basename</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Là on rentre dans les méthodes utilitaires. L'auteur a constaté qu'on</span>
    <span style="color: #808080; font-style: italic;"># appelait très souvent ces trois méthodes sur les chemin des fichiers de</span>
    <span style="color: #808080; font-style: italic;"># config genre '~/toto' pour obtenir '/home/sam/toto' et propose donc</span>
    <span style="color: #808080; font-style: italic;"># un shortcut pour le faire car honnêtement, qui se souvient du nom</span>
    <span style="color: #808080; font-style: italic;"># de ces 3 méthodes à enchaîner pour obtenir un truc bullet proof ?</span>
    <span style="color: #808080; font-style: italic;"># Règle d'or d'une belle API : si il faut regarder dans la doc à chaque</span>
    <span style="color: #808080; font-style: italic;"># fois qu'on utilise quelque chose, il faut écrire un meilleur code.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> expand<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Clean up a filename by calling expandvars(),
        expanduser(), and normpath() on it.
&nbsp;
        This is commonly everything needed to clean up a filename
        read from a configuration file, for example.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">expandvars</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">expanduser</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">normpath</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Les méthodes suivantes sont préfixées d'un '_', donc elle n'apparaitront</span>
    <span style="color: #808080; font-style: italic;"># pas dans les résultats d'outils avec complétion du code. Cela nous</span>
    <span style="color: #808080; font-style: italic;"># indique qu'il s'agit d'un détail implémentation, et que l'on ne devrait</span>
    <span style="color: #808080; font-style: italic;"># pas l'utiliser en dehors de la classe. Rien n'empêche de le faire</span>
    <span style="color: #808080; font-style: italic;"># cependant si vous avez envie de faire un beau hack bien gras.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Ici l'auteur fait ce choix car il va enrober ces appels dans des</span>
    <span style="color: #808080; font-style: italic;"># propriétés pour les déguiser en attributs.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Ce 3 méthodes retournent respectivement l'extension de fichier, le nom</span>
    <span style="color: #808080; font-style: italic;"># de fichier sans extension, et la lettre de lecteur sur les chemins</span>
    <span style="color: #808080; font-style: italic;"># windows.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> _get_namebase<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        base, ext = <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">splitext</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">name</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> base
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> _get_ext<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        f, ext = <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">splitext</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> ext
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> _get_drive<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        drive, r = <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">splitdrive</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span>drive<span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Malgré l'indentation bizarre, il s'agit bien de :</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#     attribut_de_classe = function(arg1, arg2, arg3, arg4)</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;"># Dans les tutos précédents vous avez vu comment créer une propriété avec</span>
    <span style="color: #808080; font-style: italic;"># le décorateur @property.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Ici l'auteur utilise l'ancienne façon de faire, car il veut garder la</span>
    <span style="color: #808080; font-style: italic;"># compatibilité avec python 2.5.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># C'est globalement la même chose, par exemple ici l'attribut 'namebase'</span>
    <span style="color: #808080; font-style: italic;"># est défini comme une property et y accéder en lecture va appeler la</span>
    <span style="color: #808080; font-style: italic;"># méthode '_get_namebase'. Le second et le troisième argument de</span>
    <span style="color: #808080; font-style: italic;"># property() sont les setter et les deleter qui ne sont pas ici définis et</span>
    <span style="color: #808080; font-style: italic;"># mis à None (donc l'attribut est en lecture seule). Le dernier argument</span>
    <span style="color: #808080; font-style: italic;"># est la docstring.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    parent = <span style="color: #008000;">property</span><span style="color: black;">&#40;</span>
        dirname, <span style="color: #008000;">None</span>, <span style="color: #008000;">None</span>,
        <span style="color: #483d8b;">&quot;&quot;&quot; This path's parent directory, as a new path object.
&nbsp;
        For example, path('/usr/local/lib/libpython.so').parent == path('/usr/local/lib')
        &quot;&quot;&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    name = <span style="color: #008000;">property</span><span style="color: black;">&#40;</span>
        basename, <span style="color: #008000;">None</span>, <span style="color: #008000;">None</span>,
        <span style="color: #483d8b;">&quot;&quot;&quot; The name of this file or directory without the full path.
&nbsp;
        For example, path('/usr/local/lib/libpython.so').name == 'libpython.so'
        &quot;&quot;&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    namebase = <span style="color: #008000;">property</span><span style="color: black;">&#40;</span>
        _get_namebase, <span style="color: #008000;">None</span>, <span style="color: #008000;">None</span>,
        <span style="color: #483d8b;">&quot;&quot;&quot; The same as path.name, but with one file extension stripped off.
&nbsp;
        For example, path('/home/guido/python.tar.gz').name     == 'python.tar.gz',
        but          path('/home/guido/python.tar.gz').namebase == 'python.tar'
        &quot;&quot;&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    ext = <span style="color: #008000;">property</span><span style="color: black;">&#40;</span>
        _get_ext, <span style="color: #008000;">None</span>, <span style="color: #008000;">None</span>,
        <span style="color: #483d8b;">&quot;&quot;&quot; The file extension, for example '.py'. &quot;&quot;&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    drive = <span style="color: #008000;">property</span><span style="color: black;">&#40;</span>
        _get_drive, <span style="color: #008000;">None</span>, <span style="color: #008000;">None</span>,
        <span style="color: #483d8b;">&quot;&quot;&quot; The drive specifier, for example 'C:'.
        This is always empty on systems that don't use drive specifiers.
        &quot;&quot;&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Encore des wrappers pour retourner des objets path(). La structure</span>
    <span style="color: #808080; font-style: italic;"># est classique: définition de méthodes courtes avec docstring.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># L'auteur retourne un tuple comme les méthodes originales (autant</span>
    <span style="color: #808080; font-style: italic;"># changer le comportement attendu le moins possible), mais cast la</span>
    <span style="color: #808080; font-style: italic;"># première partie du tuple en objet path().</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> splitpath<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; p.splitpath() -&gt; Return (p.parent, p.name). &quot;&quot;&quot;</span>
        parent, child = <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">split</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span>parent<span style="color: black;">&#41;</span>, child
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> splitdrive<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; p.splitdrive() -&gt; Return (p.drive, &lt;the rest of p&gt;).
&nbsp;
        Split the drive specifier from this path.  If there is
        no drive specifier, p.drive is empty, so the return value
        is simply (path(''), p).  This is always the case on Unix.
        &quot;&quot;&quot;</span>
        drive, rel = <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">splitdrive</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span>drive<span style="color: black;">&#41;</span>, rel
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> splitext<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; p.splitext() -&gt; Return (p.stripext(), p.ext).
&nbsp;
        Split the filename extension from this path and return
        the two parts.  Either part may be empty.
&nbsp;
        The extension is everything from '.' to the end of the
        last path segment.  This has the property that if
        (a, b) == p.splitext(), then a + b == p.
        &quot;&quot;&quot;</span>
        filename, ext = <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">splitext</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span>filename<span style="color: black;">&#41;</span>, ext
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Ici on a des méthodes légèrement différentes de celles qu'elles wraps.</span>
    <span style="color: #808080; font-style: italic;"># C'est vraiment pour se faciliter la tâche sur les opérations courantes</span>
    <span style="color: #808080; font-style: italic;"># et sauver quelques caractères à la frappe.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> stripext<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; p.stripext() -&gt; Remove one file extension from the path.
&nbsp;
        For example, path('/home/guido/python.tar.gz').stripext()
        returns path('/home/guido/python.tar').
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">splitext</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#93;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> splitunc<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        unc, rest = <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">splitunc</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span>unc<span style="color: black;">&#41;</span>, rest
&nbsp;
    @<span style="color: #008000;">property</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> uncshare<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot;
        The UNC mount point for this path.
        This is empty for paths on local drives.
        &quot;&quot;&quot;</span>
        unc, r = <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">splitunc</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span>unc<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># joinpath cast le premier argument si il n'est pas du même type que la</span>
    <span style="color: #808080; font-style: italic;"># classe en cours. Il n'y a pas de raison apparente, donc je suppose que</span>
    <span style="color: #808080; font-style: italic;"># c'est pour éviter une bug qu'ils ont découvert dans une situation</span>
    <span style="color: #808080; font-style: italic;"># borderline</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    @multimethod
    <span style="color: #ff7700;font-weight:bold;">def</span> joinpath<span style="color: black;">&#40;</span>cls, first, <span style="color: #66cc66;">*</span>others<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot;
        Join first to zero or more path components, adding a separator
        character (first.module.sep) if needed.  Returns a new instance of
        first._next_class.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #008000;">isinstance</span><span style="color: black;">&#40;</span>first, cls<span style="color: black;">&#41;</span>:
            first = cls<span style="color: black;">&#40;</span>first<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> first._next_class<span style="color: black;">&#40;</span>first.<span style="color: black;">module</span>.<span style="color: black;">join</span><span style="color: black;">&#40;</span>first, <span style="color: #66cc66;">*</span>others<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Puis on arrive enfin dans les méthodes métiers qui ne sont pas dans les</span>
    <span style="color: #808080; font-style: italic;"># modules. Typiquement ce seront des méthodes plus longues et inconnues</span>
    <span style="color: #808080; font-style: italic;"># car n'existant pas dans les autres modules donc :</span>
    <span style="color: #808080; font-style: italic;"># - on les met à la fin</span>
    <span style="color: #808080; font-style: italic;"># - la docstring est plus explicite.</span>
    <span style="color: #808080; font-style: italic;"># Ici splitall permet de faire :</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># &gt;&gt;&gt; path('/usr/lib/python2.7/fnmatch.pyc').splitall()</span>
    <span style="color: #808080; font-style: italic;"># [path(u'/'), u'usr', u'lib', u'python2.7', u'fnmatch.pyc']</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Ce que os.path ne permet pas de faire directement.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> splitall<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        r<span style="color: #483d8b;">&quot;&quot;&quot; Return a list of the path components in this path.
&nbsp;
        The first item in the list will be a path.  Its value will be
        either os.curdir, os.pardir, empty, or the root directory of
        this path (for example, ``'/'`` or ``'C:<span style="color: #000099; font-weight: bold;">\\</span>'``).  The other items in
        the list will be strings.
&nbsp;
        ``path.path.joinpath(*result)`` will yield the original path.
        &quot;&quot;&quot;</span>
        parts = <span style="color: black;">&#91;</span><span style="color: black;">&#93;</span>
        loc = <span style="color: #008000;">self</span>
        <span style="color: #ff7700;font-weight:bold;">while</span> loc <span style="color: #66cc66;">!</span>= <span style="color: #dc143c;">os</span>.<span style="color: black;">curdir</span> <span style="color: #ff7700;font-weight:bold;">and</span> loc <span style="color: #66cc66;">!</span>= <span style="color: #dc143c;">os</span>.<span style="color: black;">pardir</span>:
            prev = loc
            loc, child = prev.<span style="color: black;">splitpath</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> loc == prev:
                <span style="color: #ff7700;font-weight:bold;">break</span>
            parts.<span style="color: black;">append</span><span style="color: black;">&#40;</span>child<span style="color: black;">&#41;</span>
        parts.<span style="color: black;">append</span><span style="color: black;">&#40;</span>loc<span style="color: black;">&#41;</span>
        parts.<span style="color: black;">reverse</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> parts
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Voici une bonne pratique, avoir une méthode complexe (ici relpathto(),</span>
    <span style="color: #808080; font-style: italic;"># qui créer un chemin relatif du path() courant vers un autre dossier), et</span>
    <span style="color: #808080; font-style: italic;"># son opposée plus simple (ici relpath(), qui créer un chemin relatif d'un</span>
    <span style="color: #808080; font-style: italic;"># dossier vers le path courant) qui utilise la méthode précédente en en</span>
    <span style="color: #808080; font-style: italic;"># inversant juste les paramètres.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># En effet ça ne sert à rien d'écrire deux fois la même méthode, on</span>
    <span style="color: #808080; font-style: italic;"># factorise ainsi du code et respecte le principe DRY (don't repeat</span>
    <span style="color: #808080; font-style: italic;"># yourself).</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># relpathto() est un bon exemple d'un code assez complexe pour une</span>
    <span style="color: #808080; font-style: italic;"># opération qui parait pourtant assez simple. C'est aussi un très bon</span>
    <span style="color: #808080; font-style: italic;"># exemple de comment écrire des commentaires : on ne décrit pas les</span>
    <span style="color: #808080; font-style: italic;"># opérations évidentes mais on explique les choses ambiguës et on met des</span>
    <span style="color: #808080; font-style: italic;"># avertissements</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> relpath<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, start=<span style="color: #483d8b;">'.'</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Return this path as a relative path,
        based from start, which defaults to the current working directory.
        &quot;&quot;&quot;</span>
        cwd = <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span>start<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> cwd.<span style="color: black;">relpathto</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> relpathto<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, dest<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Return a relative path from self to dest.
&nbsp;
        If there is no relative path from self to dest, for example if
        they reside on different drives in Windows, then this returns
        dest.abspath().
        &quot;&quot;&quot;</span>
        origin = <span style="color: #008000;">self</span>.<span style="color: black;">abspath</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        dest = <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span>dest<span style="color: black;">&#41;</span>.<span style="color: black;">abspath</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
        orig_list = origin.<span style="color: black;">normcase</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">splitall</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #808080; font-style: italic;"># Don't normcase dest!  We want to preserve the case.</span>
        dest_list = dest.<span style="color: black;">splitall</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> orig_list<span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#93;</span> <span style="color: #66cc66;">!</span>= <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">normcase</span><span style="color: black;">&#40;</span>dest_list<span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>:
            <span style="color: #808080; font-style: italic;"># Can't get here from there.</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> dest
&nbsp;
        <span style="color: #808080; font-style: italic;"># Find the location where the two paths start to differ.</span>
        i = <span style="color: #ff4500;">0</span>
        <span style="color: #ff7700;font-weight:bold;">for</span> start_seg, dest_seg <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">zip</span><span style="color: black;">&#40;</span>orig_list, dest_list<span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">if</span> start_seg <span style="color: #66cc66;">!</span>= <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">normcase</span><span style="color: black;">&#40;</span>dest_seg<span style="color: black;">&#41;</span>:
                <span style="color: #ff7700;font-weight:bold;">break</span>
            i += <span style="color: #ff4500;">1</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Now i is the point where the two paths diverge.</span>
        <span style="color: #808080; font-style: italic;"># Need a certain number of &quot;os.pardir&quot;s to work up</span>
        <span style="color: #808080; font-style: italic;"># from the origin to the point of divergence.</span>
        segments = <span style="color: black;">&#91;</span><span style="color: #dc143c;">os</span>.<span style="color: black;">pardir</span><span style="color: black;">&#93;</span> <span style="color: #66cc66;">*</span> <span style="color: black;">&#40;</span><span style="color: #008000;">len</span><span style="color: black;">&#40;</span>orig_list<span style="color: black;">&#41;</span> - i<span style="color: black;">&#41;</span>
        <span style="color: #808080; font-style: italic;"># Need to add the diverging part of dest_list.</span>
        segments += dest_list<span style="color: black;">&#91;</span>i:<span style="color: black;">&#93;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">len</span><span style="color: black;">&#40;</span>segments<span style="color: black;">&#41;</span> == <span style="color: #ff4500;">0</span>:
            <span style="color: #808080; font-style: italic;"># If they happen to be identical, use os.curdir.</span>
            relpath = <span style="color: #dc143c;">os</span>.<span style="color: black;">curdir</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            relpath = <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">join</span><span style="color: black;">&#40;</span><span style="color: #66cc66;">*</span>segments<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span>relpath<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># --- Listing, searching, walking, and matching</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># un simple wrapper mais qui rajoute un argument en plus : un pattern à la</span>
    <span style="color: #808080; font-style: italic;"># unix. C'est une extension naturelle, et c'est le genre de chose que vous</span>
    <span style="color: #808080; font-style: italic;"># voudrez faire quand vous vous êtes toujours demandé : &quot;mais pourquoi</span>
    <span style="color: #808080; font-style: italic;"># c'est pas par défaut ?&quot; ou &quot;comment on fait ça facilement ?&quot; Si vous</span>
    <span style="color: #808080; font-style: italic;"># vous posez ce genre de question, étendez un peu les comportements</span>
    <span style="color: #808080; font-style: italic;"># initiaux. Rajouter un argument ne rend pas le comportement différent du</span>
    <span style="color: #808080; font-style: italic;"># précédent grâce au paramètre par défaut mis à None, donc c'est tout</span>
    <span style="color: #808080; font-style: italic;"># bénef.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> listdir<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, pattern=<span style="color: #008000;">None</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; D.listdir() -&gt; List of items in this directory.
&nbsp;
        Use D.files() or D.dirs() instead if you want a listing
        of just files or just subdirectories.
&nbsp;
        The elements of the list are path objects.
&nbsp;
        With the optional 'pattern' argument, this only lists
        items whose names match the given pattern.
        &quot;&quot;&quot;</span>
        names = <span style="color: #dc143c;">os</span>.<span style="color: black;">listdir</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> pattern <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #008000;">None</span>:
            names = <span style="color: #dc143c;">fnmatch</span>.<span style="color: #008000;">filter</span><span style="color: black;">&#40;</span>names, pattern<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#91;</span><span style="color: #008000;">self</span> / child <span style="color: #ff7700;font-weight:bold;">for</span> child <span style="color: #ff7700;font-weight:bold;">in</span> names<span style="color: black;">&#93;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Dans la même lignée de ce qu'on a vu plus haut: utiliser une fonction</span>
    <span style="color: #808080; font-style: italic;"># plus complexe (qui déjà étend un comportement par défaut) pour en</span>
    <span style="color: #808080; font-style: italic;"># faire encore une méthode plus spécialisée.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># L'avantage de cette approche c'est que le code est plein de petites</span>
    <span style="color: #808080; font-style: italic;"># briques:</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># vous avez listdir(), qui est assez court (mais déjà plus puissant),</span>
    <span style="color: #808080; font-style: italic;"># puis dirs() et files(), qui font la même chose en plus spécialisés.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># L'alternative aurait été d'ajouter une param à listdir() et ne pas</span>
    <span style="color: #808080; font-style: italic;"># créer dirs() et files(), mais ça aurait rajouté un if dans le code et</span>
    <span style="color: #808080; font-style: italic;"># un paramètre qui fait rechercher dans la doc celui qui l'utilise et</span>
    <span style="color: #808080; font-style: italic;"># celui qui lit le code.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Avec l'approche actuelle, l'API est très claire :</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># for d in path('/etc').dirs()</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># On s'attend à lire tous les dossiers de /etc. Et les</span>
    <span style="color: #808080; font-style: italic;"># méthodes restent courtes.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> dirs<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, pattern=<span style="color: #008000;">None</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; D.dirs() -&gt; List of this directory's subdirectories.
&nbsp;
        The elements of the list are path objects.
        This does not walk recursively into subdirectories
        (but see path.walkdirs).
&nbsp;
        With the optional 'pattern' argument, this only lists
        directories whose names match the given pattern.  For
        example, ``d.dirs('build-*')``.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#91;</span>p <span style="color: #ff7700;font-weight:bold;">for</span> p <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">self</span>.<span style="color: black;">listdir</span><span style="color: black;">&#40;</span>pattern<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">if</span> p.<span style="color: black;">isdir</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> files<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, pattern=<span style="color: #008000;">None</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; D.files() -&gt; List of the files in this directory.
&nbsp;
        The elements of the list are path objects.
        This does not walk into subdirectories (see path.walkfiles).
&nbsp;
        With the optional 'pattern' argument, this only lists files
        whose names match the given pattern.  For example,
        ``d.files('*.pyc')``.
        &quot;&quot;&quot;</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#91;</span>p <span style="color: #ff7700;font-weight:bold;">for</span> p <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">self</span>.<span style="color: black;">listdir</span><span style="color: black;">&#40;</span>pattern<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">if</span> p.<span style="color: black;">isfile</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># walk() et ses pendants walkdirs() et walkfiles() sont des alternatives</span>
    <span style="color: #808080; font-style: italic;"># au très peu intuitif os.path.walk qui permet de traverser récursivement</span>
    <span style="color: #808080; font-style: italic;"># un répertoire.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># En effet, en Python les callbacks sont quelque chose qu'on utilise peu,</span>
    <span style="color: #808080; font-style: italic;"># et à l'inverse, on itère beaucoup.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Cela permet de faire:</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># for f in path('/etc').walk_files():</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Pour lister récursivements tous les fichiers de /etc et de ses sous</span>
    <span style="color: #808080; font-style: italic;"># (et sous, sous, sous) dossiers.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># C'est clair, c'est simple à comprendre et facile à utiliser.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># L'auteur utilise ici 'yield', et c'est l'outil parfait pour cela.</span>
    <span style="color: #808080; font-style: italic;"># Souvenez vous de 'yield' comme un très bon moyen de parcourir des choses</span>
    <span style="color: #808080; font-style: italic;"># imbriquées comme si c'était une structure plate à une dimension.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Yield permet de transformer n'importe quelle méthode d'un objet en</span>
    <span style="color: #808080; font-style: italic;"># un générateur sur un algorythme qui peut être très complexe, simplifiant</span>
    <span style="color: #808080; font-style: italic;"># son utilisation. Pensez-y !</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Sous le capot, c'est presque un appel récursif, si ce n'est qu'un nouvel</span>
    <span style="color: #808080; font-style: italic;"># objet path() est créé à chaque fois, depuis lequel on fait walk().</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Notez également que sur une méthode comme ça qui peut foirer facilement</span>
    <span style="color: #808080; font-style: italic;"># (une opération sur des centaines de fichiers...), un paramètre permet</span>
    <span style="color: #808080; font-style: italic;"># de choisir une gestion des erreurs parmis :</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># - lever une exception (qui est dans un code propre le choix par défaut)</span>
    <span style="color: #808080; font-style: italic;"># - ignorer (pour faire un code tolérant aux erreur)</span>
    <span style="color: #808080; font-style: italic;"># - ou faire un retour sans erreur, mais avec un warning technique (utile</span>
    <span style="color: #808080; font-style: italic;">#     pour le scripting)</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Encore une fois, faire une classe, c'est l'occasion de penser à</span>
    <span style="color: #808080; font-style: italic;"># l'utilisateur de la classe, ce qui a été ici bien fait.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Enfin, contrairement à ce qu'on pourrait attendre, walkdirs et walkfiles</span>
    <span style="color: #808080; font-style: italic;"># n'utilise pas walk(), ce qui est généralement fait pour des raisons de</span>
    <span style="color: #808080; font-style: italic;"># performances (on sacrifie le DRY pour éviter un appel de callback</span>
    <span style="color: #808080; font-style: italic;"># ou un test sur des grosses boucles), même si ici c'est une supposition.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> walk<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, pattern=<span style="color: #008000;">None</span>, errors=<span style="color: #483d8b;">'strict'</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; D.walk() -&gt; iterator over files and subdirs, recursively.
&nbsp;
        The iterator yields path objects naming each child item of
        this directory and its descendants.  This requires that
        D.isdir().
&nbsp;
        This performs a depth-first traversal of the directory tree.
        Each directory is returned just before all its children.
&nbsp;
        The errors= keyword argument controls behavior when an
        error occurs.  The default is 'strict', which causes an
        exception.  The other allowed values are 'warn', which
        reports the error via warnings.warn(), and 'ignore'.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> errors <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">'strict'</span>, <span style="color: #483d8b;">'warn'</span>, <span style="color: #483d8b;">'ignore'</span><span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">ValueError</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;invalid errors parameter&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            childList = <span style="color: #008000;">self</span>.<span style="color: black;">listdir</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">Exception</span>:
            <span style="color: #ff7700;font-weight:bold;">if</span> errors == <span style="color: #483d8b;">'ignore'</span>:
                <span style="color: #ff7700;font-weight:bold;">return</span>
            <span style="color: #ff7700;font-weight:bold;">elif</span> errors == <span style="color: #483d8b;">'warn'</span>:
                <span style="color: #dc143c;">warnings</span>.<span style="color: black;">warn</span><span style="color: black;">&#40;</span>
                    <span style="color: #483d8b;">&quot;Unable to list directory '%s': %s&quot;</span>
                    <span style="color: #66cc66;">%</span> <span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #dc143c;">sys</span>.<span style="color: black;">exc_info</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>,
                    TreeWalkWarning<span style="color: black;">&#41;</span>
                <span style="color: #ff7700;font-weight:bold;">return</span>
            <span style="color: #ff7700;font-weight:bold;">else</span>:
                <span style="color: #ff7700;font-weight:bold;">raise</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">for</span> child <span style="color: #ff7700;font-weight:bold;">in</span> childList:
            <span style="color: #ff7700;font-weight:bold;">if</span> pattern <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #008000;">None</span> <span style="color: #ff7700;font-weight:bold;">or</span> child.<span style="color: #dc143c;">fnmatch</span><span style="color: black;">&#40;</span>pattern<span style="color: black;">&#41;</span>:
                <span style="color: #ff7700;font-weight:bold;">yield</span> child
            <span style="color: #ff7700;font-weight:bold;">try</span>:
                isdir = child.<span style="color: black;">isdir</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">Exception</span>:
                <span style="color: #ff7700;font-weight:bold;">if</span> errors == <span style="color: #483d8b;">'ignore'</span>:
                    isdir = <span style="color: #008000;">False</span>
                <span style="color: #ff7700;font-weight:bold;">elif</span> errors == <span style="color: #483d8b;">'warn'</span>:
                    <span style="color: #dc143c;">warnings</span>.<span style="color: black;">warn</span><span style="color: black;">&#40;</span>
                        <span style="color: #483d8b;">&quot;Unable to access '%s': %s&quot;</span>
                        <span style="color: #66cc66;">%</span> <span style="color: black;">&#40;</span>child, <span style="color: #dc143c;">sys</span>.<span style="color: black;">exc_info</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>,
                        TreeWalkWarning<span style="color: black;">&#41;</span>
                    isdir = <span style="color: #008000;">False</span>
                <span style="color: #ff7700;font-weight:bold;">else</span>:
                    <span style="color: #ff7700;font-weight:bold;">raise</span>
&nbsp;
            <span style="color: #ff7700;font-weight:bold;">if</span> isdir:
                <span style="color: #ff7700;font-weight:bold;">for</span> item <span style="color: #ff7700;font-weight:bold;">in</span> child.<span style="color: black;">walk</span><span style="color: black;">&#40;</span>pattern, errors<span style="color: black;">&#41;</span>:
                    <span style="color: #ff7700;font-weight:bold;">yield</span> item
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> walkdirs<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, pattern=<span style="color: #008000;">None</span>, errors=<span style="color: #483d8b;">'strict'</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; D.walkdirs() -&gt; iterator over subdirs, recursively.
&nbsp;
        With the optional 'pattern' argument, this yields only
        directories whose names match the given pattern.  For
        example, ``mydir.walkdirs('*test')`` yields only directories
        with names ending in 'test'.
&nbsp;
        The errors= keyword argument controls behavior when an
        error occurs.  The default is 'strict', which causes an
        exception.  The other allowed values are 'warn', which
        reports the error via warnings.warn(), and 'ignore'.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> errors <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">'strict'</span>, <span style="color: #483d8b;">'warn'</span>, <span style="color: #483d8b;">'ignore'</span><span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">ValueError</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;invalid errors parameter&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            dirs = <span style="color: #008000;">self</span>.<span style="color: black;">dirs</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">Exception</span>:
            <span style="color: #ff7700;font-weight:bold;">if</span> errors == <span style="color: #483d8b;">'ignore'</span>:
                <span style="color: #ff7700;font-weight:bold;">return</span>
            <span style="color: #ff7700;font-weight:bold;">elif</span> errors == <span style="color: #483d8b;">'warn'</span>:
                <span style="color: #dc143c;">warnings</span>.<span style="color: black;">warn</span><span style="color: black;">&#40;</span>
                    <span style="color: #483d8b;">&quot;Unable to list directory '%s': %s&quot;</span>
                    <span style="color: #66cc66;">%</span> <span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #dc143c;">sys</span>.<span style="color: black;">exc_info</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>,
                    TreeWalkWarning<span style="color: black;">&#41;</span>
                <span style="color: #ff7700;font-weight:bold;">return</span>
            <span style="color: #ff7700;font-weight:bold;">else</span>:
                <span style="color: #ff7700;font-weight:bold;">raise</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">for</span> child <span style="color: #ff7700;font-weight:bold;">in</span> dirs:
            <span style="color: #ff7700;font-weight:bold;">if</span> pattern <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #008000;">None</span> <span style="color: #ff7700;font-weight:bold;">or</span> child.<span style="color: #dc143c;">fnmatch</span><span style="color: black;">&#40;</span>pattern<span style="color: black;">&#41;</span>:
                <span style="color: #ff7700;font-weight:bold;">yield</span> child
            <span style="color: #ff7700;font-weight:bold;">for</span> subsubdir <span style="color: #ff7700;font-weight:bold;">in</span> child.<span style="color: black;">walkdirs</span><span style="color: black;">&#40;</span>pattern, errors<span style="color: black;">&#41;</span>:
                <span style="color: #ff7700;font-weight:bold;">yield</span> subsubdir
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> walkfiles<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, pattern=<span style="color: #008000;">None</span>, errors=<span style="color: #483d8b;">'strict'</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; D.walkfiles() -&gt; iterator over files in D, recursively.
&nbsp;
        The optional argument, pattern, limits the results to files
        with names that match the pattern.  For example,
        ``mydir.walkfiles('*.tmp')`` yields only files with the .tmp
        extension.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> errors <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">'strict'</span>, <span style="color: #483d8b;">'warn'</span>, <span style="color: #483d8b;">'ignore'</span><span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">ValueError</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;invalid errors parameter&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            childList = <span style="color: #008000;">self</span>.<span style="color: black;">listdir</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">Exception</span>:
            <span style="color: #ff7700;font-weight:bold;">if</span> errors == <span style="color: #483d8b;">'ignore'</span>:
                <span style="color: #ff7700;font-weight:bold;">return</span>
            <span style="color: #ff7700;font-weight:bold;">elif</span> errors == <span style="color: #483d8b;">'warn'</span>:
                <span style="color: #dc143c;">warnings</span>.<span style="color: black;">warn</span><span style="color: black;">&#40;</span>
                    <span style="color: #483d8b;">&quot;Unable to list directory '%s': %s&quot;</span>
                    <span style="color: #66cc66;">%</span> <span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #dc143c;">sys</span>.<span style="color: black;">exc_info</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>,
                    TreeWalkWarning<span style="color: black;">&#41;</span>
                <span style="color: #ff7700;font-weight:bold;">return</span>
            <span style="color: #ff7700;font-weight:bold;">else</span>:
                <span style="color: #ff7700;font-weight:bold;">raise</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">for</span> child <span style="color: #ff7700;font-weight:bold;">in</span> childList:
            <span style="color: #ff7700;font-weight:bold;">try</span>:
                isfile = child.<span style="color: black;">isfile</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
                isdir = <span style="color: #ff7700;font-weight:bold;">not</span> isfile <span style="color: #ff7700;font-weight:bold;">and</span> child.<span style="color: black;">isdir</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">except</span>:
                <span style="color: #ff7700;font-weight:bold;">if</span> errors == <span style="color: #483d8b;">'ignore'</span>:
                    <span style="color: #ff7700;font-weight:bold;">continue</span>
                <span style="color: #ff7700;font-weight:bold;">elif</span> errors == <span style="color: #483d8b;">'warn'</span>:
                    <span style="color: #dc143c;">warnings</span>.<span style="color: black;">warn</span><span style="color: black;">&#40;</span>
                        <span style="color: #483d8b;">&quot;Unable to access '%s': %s&quot;</span>
                        <span style="color: #66cc66;">%</span> <span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #dc143c;">sys</span>.<span style="color: black;">exc_info</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>,
                        TreeWalkWarning<span style="color: black;">&#41;</span>
                    <span style="color: #ff7700;font-weight:bold;">continue</span>
                <span style="color: #ff7700;font-weight:bold;">else</span>:
                    <span style="color: #ff7700;font-weight:bold;">raise</span>
&nbsp;
            <span style="color: #ff7700;font-weight:bold;">if</span> isfile:
                <span style="color: #ff7700;font-weight:bold;">if</span> pattern <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #008000;">None</span> <span style="color: #ff7700;font-weight:bold;">or</span> child.<span style="color: #dc143c;">fnmatch</span><span style="color: black;">&#40;</span>pattern<span style="color: black;">&#41;</span>:
                    <span style="color: #ff7700;font-weight:bold;">yield</span> child
            <span style="color: #ff7700;font-weight:bold;">elif</span> isdir:
                <span style="color: #ff7700;font-weight:bold;">for</span> f <span style="color: #ff7700;font-weight:bold;">in</span> child.<span style="color: black;">walkfiles</span><span style="color: black;">&#40;</span>pattern, errors<span style="color: black;">&#41;</span>:
                    <span style="color: #ff7700;font-weight:bold;">yield</span> f
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #dc143c;">fnmatch</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, pattern<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Return True if self.name matches the given pattern.
&nbsp;
        pattern - A filename pattern with wildcards,
            for example ``'*.py'``.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #dc143c;">fnmatch</span>.<span style="color: #dc143c;">fnmatch</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">name</span>, pattern<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #dc143c;">glob</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, pattern<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Return a list of path objects that match the pattern.
&nbsp;
        pattern - a path relative to this directory, with wildcards.
&nbsp;
        For example, path('/users').glob('*/bin/*') returns a list
        of all the files users have in their bin directories.
        &quot;&quot;&quot;</span>
        cls = <span style="color: #008000;">self</span>._next_class
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#91;</span>cls<span style="color: black;">&#40;</span>s<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">for</span> s <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #dc143c;">glob</span>.<span style="color: #dc143c;">glob</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span> / pattern<span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#</span>
    <span style="color: #808080; font-style: italic;"># --- Reading or writing an entire file at once.</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, mode=<span style="color: #483d8b;">'r'</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Open this file.  Return a file object. &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, mode<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># L'avantage d'avoir une classe comme point de départ de tout c'est que</span>
    <span style="color: #808080; font-style: italic;"># c'est facile à manipuler dans le shell, surtout en autocompletion.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Donc il est bon de mettre quelques outils qui sont pratiques dans les</span>
    <span style="color: #808080; font-style: italic;"># usages type shell.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Ici c'est exactement le cas : on fait des méthodes un peu bourrines (</span>
    <span style="color: #808080; font-style: italic;"># globalement ça dump en mémoire ou ça écrit tout le fichier d'un coup),</span>
    <span style="color: #808080; font-style: italic;"># mais très pratiques pour manipuler les objets dans un terminal.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Notez aussi le nettoyage opéré:</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#             return (t.replace(u'\r\n', u'\n')</span>
    <span style="color: #808080; font-style: italic;">#                  .replace(u'\r\x85', u'\n')</span>
    <span style="color: #808080; font-style: italic;">#                  .replace(u'\r', u'\n')</span>
    <span style="color: #808080; font-style: italic;">#                  .replace(u'\x85', u'\n')</span>
    <span style="color: #808080; font-style: italic;">#                  .replace(u'\u2028', u'\n'))</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Ce n'est pas particulièrement lié à la POO, mais l'encapsulation de</span>
    <span style="color: #808080; font-style: italic;"># ce genre de process est toujours le bienvenu. L'idée est que l'objet</span>
    <span style="color: #808080; font-style: italic;"># puisse être utilisé comme une boîte noire en laquelle on a totalement</span>
    <span style="color: #808080; font-style: italic;"># confiance.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #dc143c;">bytes</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Open this file, read all bytes, return them as a string. &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">with</span> <span style="color: #008000;">self</span>.<span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'rb'</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> f:
            <span style="color: #ff7700;font-weight:bold;">return</span> f.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> write_bytes<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #dc143c;">bytes</span>, append=<span style="color: #008000;">False</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Open this file and write the given bytes to it.
&nbsp;
        Default behavior is to overwrite any existing file.
        Call p.write_bytes(bytes, append=True) to append instead.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> append:
            mode = <span style="color: #483d8b;">'ab'</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            mode = <span style="color: #483d8b;">'wb'</span>
        <span style="color: #ff7700;font-weight:bold;">with</span> <span style="color: #008000;">self</span>.<span style="color: #008000;">open</span><span style="color: black;">&#40;</span>mode<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> f:
            f.<span style="color: black;">write</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">bytes</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> text<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, encoding=<span style="color: #008000;">None</span>, errors=<span style="color: #483d8b;">'strict'</span><span style="color: black;">&#41;</span>:
        r<span style="color: #483d8b;">&quot;&quot;&quot; Open this file, read it in, return the content as a string.
&nbsp;
        This method uses 'U' mode, so '<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>' and '<span style="color: #000099; font-weight: bold;">\r</span>' are automatically
        translated to '<span style="color: #000099; font-weight: bold;">\n</span>'.
&nbsp;
        Optional arguments:
&nbsp;
        encoding - The Unicode encoding (or character set) of
            the file.  If present, the content of the file is
            decoded and returned as a unicode object; otherwise
            it is returned as an 8-bit str.
        errors - How to handle Unicode errors; see help(str.decode)
            for the options.  Default is 'strict'.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> encoding <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #008000;">None</span>:
            <span style="color: #808080; font-style: italic;"># 8-bit</span>
            <span style="color: #ff7700;font-weight:bold;">with</span> <span style="color: #008000;">self</span>.<span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'U'</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> f:
                <span style="color: #ff7700;font-weight:bold;">return</span> f.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            <span style="color: #808080; font-style: italic;"># Unicode</span>
            <span style="color: #ff7700;font-weight:bold;">with</span> <span style="color: #dc143c;">codecs</span>.<span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #483d8b;">'r'</span>, encoding, errors<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> f:
                <span style="color: #808080; font-style: italic;"># (Note - Can't use 'U' mode here, since codecs.open</span>
                <span style="color: #808080; font-style: italic;"># doesn't support 'U' mode.)</span>
                t = f.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#40;</span>t.<span style="color: black;">replace</span><span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>'</span>, u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span>
                     .<span style="color: black;">replace</span><span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\x</span>85'</span>, u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span>
                     .<span style="color: black;">replace</span><span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\r</span>'</span>, u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span>
                     .<span style="color: black;">replace</span><span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\x</span>85'</span>, u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span>
                     .<span style="color: black;">replace</span><span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\u</span>2028'</span>, u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Sur des methodes avec de nombreux paramètres, ne pas hésiter</span>
    <span style="color: #808080; font-style: italic;"># à mettre un maximum de valeurs par défaut &quot;saines&quot; (c'est à dire la</span>
    <span style="color: #808080; font-style: italic;"># valeur du cas le plus courant ou pragmatique).</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Comme c'est une grosse fonction très configurable, la docstring</span>
    <span style="color: #808080; font-style: italic;"># est écrite en conséquence. Ne soyez pas timide avec la dosctring,</span>
    <span style="color: #808080; font-style: italic;"># on peut la faire très très très longue, ce n'est pas une mauvaise</span>
    <span style="color: #808080; font-style: italic;"># chose.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Notez que la docstring est préfixée d'un &quot;r&quot; ici, pour que Python</span>
    <span style="color: #808080; font-style: italic;"># n'interprète pas les \n et \r.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> write_text<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, text, encoding=<span style="color: #008000;">None</span>, errors=<span style="color: #483d8b;">'strict'</span>, linesep=<span style="color: #dc143c;">os</span>.<span style="color: black;">linesep</span>, append=<span style="color: #008000;">False</span><span style="color: black;">&#41;</span>:
        r<span style="color: #483d8b;">&quot;&quot;&quot; Write the given text to this file.
&nbsp;
        The default behavior is to overwrite any existing file;
        to append instead, use the 'append=True' keyword argument.
&nbsp;
        There are two differences between path.write_text() and
        path.write_bytes(): newline handling and Unicode handling.
        See below.
&nbsp;
        Parameters:
&nbsp;
          - text - str/unicode - The text to be written.
&nbsp;
          - encoding - str - The Unicode encoding that will be used.
            This is ignored if 'text' isn't a Unicode string.
&nbsp;
          - errors - str - How to handle Unicode encoding errors.
            Default is 'strict'.  See help(unicode.encode) for the
            options.  This is ignored if 'text' isn't a Unicode
            string.
&nbsp;
          - linesep - keyword argument - str/unicode - The sequence of
            characters to be used to mark end-of-line.  The default is
            os.linesep.  You can also specify None; this means to
            leave all newlines as they are in 'text'.
&nbsp;
          - append - keyword argument - bool - Specifies what to do if
            the file already exists (True: append to the end of it;
            False: overwrite it.)  The default is False.
&nbsp;
&nbsp;
        --- Newline handling.
&nbsp;
        write_text() converts all standard end-of-line sequences
        ('<span style="color: #000099; font-weight: bold;">\n</span>', '<span style="color: #000099; font-weight: bold;">\r</span>', and '<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>') to your platform's default end-of-line
        sequence (see os.linesep; on Windows, for example, the
        end-of-line marker is '<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>').
&nbsp;
        If you don't like your platform's default, you can override it
        using the 'linesep=' keyword argument.  If you specifically want
        write_text() to preserve the newlines as-is, use 'linesep=None'.
&nbsp;
        This applies to Unicode text the same as to 8-bit text, except
        there are three additional standard Unicode end-of-line sequences:
        u'<span style="color: #000099; font-weight: bold;">\x</span>85', u'<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\x</span>85', and u'<span style="color: #000099; font-weight: bold;">\u</span>2028'.
&nbsp;
        (This is slightly different from when you open a file for
        writing with fopen(filename, &quot;w&quot;) in C or open(filename, 'w')
        in Python.)
&nbsp;
&nbsp;
        --- Unicode
&nbsp;
        If 'text' isn't Unicode, then apart from newline handling, the
        bytes are written verbatim to the file.  The 'encoding' and
        'errors' arguments are not used and must be omitted.
&nbsp;
        If 'text' is Unicode, it is first converted to bytes using the
        specified 'encoding' (or the default encoding if 'encoding'
        isn't specified).  The 'errors' argument applies only to this
        conversion.
&nbsp;
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">isinstance</span><span style="color: black;">&#40;</span>text, <span style="color: #008000;">unicode</span><span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">if</span> linesep <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #008000;">None</span>:
                <span style="color: #808080; font-style: italic;"># Convert all standard end-of-line sequences to</span>
                <span style="color: #808080; font-style: italic;"># ordinary newline characters.</span>
                text = <span style="color: black;">&#40;</span>text.<span style="color: black;">replace</span><span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>'</span>, u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span>
                            .<span style="color: black;">replace</span><span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\x</span>85'</span>, u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span>
                            .<span style="color: black;">replace</span><span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\r</span>'</span>, u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span>
                            .<span style="color: black;">replace</span><span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\x</span>85'</span>, u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span>
                            .<span style="color: black;">replace</span><span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\u</span>2028'</span>, u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
                text = text.<span style="color: black;">replace</span><span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span>, linesep<span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> encoding <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #008000;">None</span>:
                encoding = <span style="color: #dc143c;">sys</span>.<span style="color: black;">getdefaultencoding</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
            <span style="color: #dc143c;">bytes</span> = text.<span style="color: black;">encode</span><span style="color: black;">&#40;</span>encoding, errors<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            <span style="color: #808080; font-style: italic;"># It is an error to specify an encoding if 'text' is</span>
            <span style="color: #808080; font-style: italic;"># an 8-bit string.</span>
            <span style="color: #ff7700;font-weight:bold;">assert</span> encoding <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #008000;">None</span>
&nbsp;
            <span style="color: #ff7700;font-weight:bold;">if</span> linesep <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #008000;">None</span>:
                text = <span style="color: black;">&#40;</span>text.<span style="color: black;">replace</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>'</span>, <span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span>
                            .<span style="color: black;">replace</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\r</span>'</span>, <span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
                <span style="color: #dc143c;">bytes</span> = text.<span style="color: black;">replace</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span>, linesep<span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">write_bytes</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">bytes</span>, append<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> lines<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, encoding=<span style="color: #008000;">None</span>, errors=<span style="color: #483d8b;">'strict'</span>, retain=<span style="color: #008000;">True</span><span style="color: black;">&#41;</span>:
        r<span style="color: #483d8b;">&quot;&quot;&quot; Open this file, read all lines, return them in a list.
&nbsp;
        Optional arguments:
            encoding - The Unicode encoding (or character set) of
                the file.  The default is None, meaning the content
                of the file is read as 8-bit characters and returned
                as a list of (non-Unicode) str objects.
            errors - How to handle Unicode errors; see help(str.decode)
                for the options.  Default is 'strict'
            retain - If true, retain newline characters; but all newline
                character combinations ('<span style="color: #000099; font-weight: bold;">\r</span>', '<span style="color: #000099; font-weight: bold;">\n</span>', '<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>') are
                translated to '<span style="color: #000099; font-weight: bold;">\n</span>'.  If false, newline characters are
                stripped off.  Default is True.
&nbsp;
        This uses 'U' mode.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> encoding <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #008000;">None</span> <span style="color: #ff7700;font-weight:bold;">and</span> retain:
            <span style="color: #ff7700;font-weight:bold;">with</span> <span style="color: #008000;">self</span>.<span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'U'</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> f:
                <span style="color: #ff7700;font-weight:bold;">return</span> f.<span style="color: black;">readlines</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">text</span><span style="color: black;">&#40;</span>encoding, errors<span style="color: black;">&#41;</span>.<span style="color: black;">splitlines</span><span style="color: black;">&#40;</span>retain<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> write_lines<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, lines, encoding=<span style="color: #008000;">None</span>, errors=<span style="color: #483d8b;">'strict'</span>,
                    linesep=<span style="color: #dc143c;">os</span>.<span style="color: black;">linesep</span>, append=<span style="color: #008000;">False</span><span style="color: black;">&#41;</span>:
        r<span style="color: #483d8b;">&quot;&quot;&quot; Write the given lines of text to this file.
&nbsp;
        By default this overwrites any existing file at this path.
&nbsp;
        This puts a platform-specific newline sequence on every line.
        See 'linesep' below.
&nbsp;
        lines - A list of strings.
&nbsp;
        encoding - A Unicode encoding to use.  This applies only if
            'lines' contains any Unicode strings.
&nbsp;
        errors - How to handle errors in Unicode encoding.  This
            also applies only to Unicode strings.
&nbsp;
        linesep - The desired line-ending.  This line-ending is
            applied to every line.  If a line already has any
            standard line ending ('<span style="color: #000099; font-weight: bold;">\r</span>', '<span style="color: #000099; font-weight: bold;">\n</span>', '<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>', u'<span style="color: #000099; font-weight: bold;">\x</span>85',
            u'<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\x</span>85', u'<span style="color: #000099; font-weight: bold;">\u</span>2028'), that will be stripped off and
            this will be used instead.  The default is os.linesep,
            which is platform-dependent ('<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>' on Windows, '<span style="color: #000099; font-weight: bold;">\n</span>' on
            Unix, etc.)  Specify None to write the lines as-is,
            like file.writelines().
&nbsp;
        Use the keyword argument append=True to append lines to the
        file.  The default is to overwrite the file.  Warning:
        When you use this with Unicode data, if the encoding of the
        existing data in the file is different from the encoding
        you specify with the encoding= parameter, the result is
        mixed-encoding data, which can really confuse someone trying
        to read the file later.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> append:
            mode = <span style="color: #483d8b;">'ab'</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            mode = <span style="color: #483d8b;">'wb'</span>
        <span style="color: #ff7700;font-weight:bold;">with</span> <span style="color: #008000;">self</span>.<span style="color: #008000;">open</span><span style="color: black;">&#40;</span>mode<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> f:
            <span style="color: #ff7700;font-weight:bold;">for</span> line <span style="color: #ff7700;font-weight:bold;">in</span> lines:
                isUnicode = <span style="color: #008000;">isinstance</span><span style="color: black;">&#40;</span>line, <span style="color: #008000;">unicode</span><span style="color: black;">&#41;</span>
                <span style="color: #ff7700;font-weight:bold;">if</span> linesep <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #008000;">None</span>:
                    <span style="color: #808080; font-style: italic;"># Strip off any existing line-end and add the</span>
                    <span style="color: #808080; font-style: italic;"># specified linesep string.</span>
                    <span style="color: #ff7700;font-weight:bold;">if</span> isUnicode:
                        <span style="color: #ff7700;font-weight:bold;">if</span> line<span style="color: black;">&#91;</span>-<span style="color: #ff4500;">2</span>:<span style="color: black;">&#93;</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>'</span>, u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\x</span>0d<span style="color: #000099; font-weight: bold;">\x</span>85'</span><span style="color: black;">&#41;</span>:
                            line = line<span style="color: black;">&#91;</span>:-<span style="color: #ff4500;">2</span><span style="color: black;">&#93;</span>
                        <span style="color: #ff7700;font-weight:bold;">elif</span> line<span style="color: black;">&#91;</span>-<span style="color: #ff4500;">1</span>:<span style="color: black;">&#93;</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: black;">&#40;</span>u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\r</span>'</span>, u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span>,
                                           u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\x</span>85'</span>, u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\u</span>2028'</span><span style="color: black;">&#41;</span>:
                            line = line<span style="color: black;">&#91;</span>:-<span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span>
                    <span style="color: #ff7700;font-weight:bold;">else</span>:
                        <span style="color: #ff7700;font-weight:bold;">if</span> line<span style="color: black;">&#91;</span>-<span style="color: #ff4500;">2</span>:<span style="color: black;">&#93;</span> == <span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>'</span>:
                            line = line<span style="color: black;">&#91;</span>:-<span style="color: #ff4500;">2</span><span style="color: black;">&#93;</span>
                        <span style="color: #ff7700;font-weight:bold;">elif</span> line<span style="color: black;">&#91;</span>-<span style="color: #ff4500;">1</span>:<span style="color: black;">&#93;</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\r</span>'</span>, <span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">&#41;</span>:
                            line = line<span style="color: black;">&#91;</span>:-<span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span>
                    line += linesep
                <span style="color: #ff7700;font-weight:bold;">if</span> isUnicode:
                    <span style="color: #ff7700;font-weight:bold;">if</span> encoding <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #008000;">None</span>:
                        encoding = <span style="color: #dc143c;">sys</span>.<span style="color: black;">getdefaultencoding</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
                    line = line.<span style="color: black;">encode</span><span style="color: black;">&#40;</span>encoding, errors<span style="color: black;">&#41;</span>
                f.<span style="color: black;">write</span><span style="color: black;">&#40;</span>line<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> read_md5<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Calculate the md5 hash for this file.
&nbsp;
        This reads through the entire file.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">read_hash</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'md5'</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> _hash<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, hash_name<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">with</span> <span style="color: #008000;">self</span>.<span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'rb'</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> f:
            m = hashlib.<span style="color: #dc143c;">new</span><span style="color: black;">&#40;</span>hash_name<span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">while</span> <span style="color: #008000;">True</span>:
                d = f.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">8192</span><span style="color: black;">&#41;</span>
                <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> d:
                    <span style="color: #ff7700;font-weight:bold;">break</span>
                m.<span style="color: black;">update</span><span style="color: black;">&#40;</span>d<span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> m
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> read_hash<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, hash_name<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Calculate given hash for this file.
&nbsp;
        List of supported hashes can be obtained from hashlib package. This
        reads the entire file.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._hash<span style="color: black;">&#40;</span>hash_name<span style="color: black;">&#41;</span>.<span style="color: black;">digest</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> read_hexhash<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, hash_name<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Calculate given hash for this file, returning hexdigest.
&nbsp;
        List of supported hashes can be obtained from hashlib package. This
        reads the entire file.
        &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._hash<span style="color: black;">&#40;</span>hash_name<span style="color: black;">&#41;</span>.<span style="color: black;">hexdigest</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Comme les fonctions, les méthodes peuvent être définies sur une ligne si</span>
    <span style="color: #808080; font-style: italic;"># le bloc ne fait qu'une ligne de taille. On utilise ça quand la fonction</span>
    <span style="color: #808080; font-style: italic;"># est juste un alias un peu avancé comme ici pour garder un style quasi</span>
    <span style="color: #808080; font-style: italic;"># déclaratif.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># --- Methods for querying the filesystem.</span>
    <span style="color: #808080; font-style: italic;"># N.B. On some platforms, the os.path functions may be implemented in C</span>
    <span style="color: #808080; font-style: italic;"># (e.g. isdir on Windows, Python 3.2.2), and compiled functions don't get</span>
    <span style="color: #808080; font-style: italic;"># bound. Playing it safe and wrapping them all in method calls.</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> isabs<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">isabs</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> exists<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">exists</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> isdir<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">isdir</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> isfile<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">isfile</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> islink<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">islink</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> ismount<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">ismount</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> samefile<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">samefile</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> getatime<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">getatime</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
    atime = <span style="color: #008000;">property</span><span style="color: black;">&#40;</span>
        getatime, <span style="color: #008000;">None</span>, <span style="color: #008000;">None</span>,
        <span style="color: #483d8b;">&quot;&quot;&quot; Last access time of the file. &quot;&quot;&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> getmtime<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">getmtime</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
    mtime = <span style="color: #008000;">property</span><span style="color: black;">&#40;</span>
        getmtime, <span style="color: #008000;">None</span>, <span style="color: #008000;">None</span>,
        <span style="color: #483d8b;">&quot;&quot;&quot; Last-modified time of the file. &quot;&quot;&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> getctime<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">getctime</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
    ctime = <span style="color: #008000;">property</span><span style="color: black;">&#40;</span>
        getctime, <span style="color: #008000;">None</span>, <span style="color: #008000;">None</span>,
        <span style="color: #483d8b;">&quot;&quot;&quot; Creation time of the file. &quot;&quot;&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> getsize<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>: <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">module</span>.<span style="color: black;">getsize</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
    size = <span style="color: #008000;">property</span><span style="color: black;">&#40;</span>
        getsize, <span style="color: #008000;">None</span>, <span style="color: #008000;">None</span>,
        <span style="color: #483d8b;">&quot;&quot;&quot; Size of the file, in bytes. &quot;&quot;&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Technique intéressante : on peut générer dynamiquement le corps de</span>
    <span style="color: #808080; font-style: italic;"># la classe. En effet, il peut contenir des if, des try, des for, etc.</span>
    <span style="color: #808080; font-style: italic;"># Ici par exemple, on ne définit la méthode access() que si le module</span>
    <span style="color: #808080; font-style: italic;"># 'os' possède l'attribut 'access'.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Si ce n'est pas la cas, la classe n'aura pas cette méthode.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span>, <span style="color: #483d8b;">'access'</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">def</span> access<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, mode<span style="color: black;">&#41;</span>:
            <span style="color: #483d8b;">&quot;&quot;&quot; Return true if current user has access to this path.
&nbsp;
            mode - One of the constants os.F_OK, os.R_OK, os.W_OK, os.X_OK
            &quot;&quot;&quot;</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #dc143c;">os</span>.<span style="color: black;">access</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, mode<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #dc143c;">stat</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Perform a stat() system call on this path. &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #dc143c;">os</span>.<span style="color: #dc143c;">stat</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> lstat<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Like path.stat(), but do not follow symbolic links. &quot;&quot;&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #dc143c;">os</span>.<span style="color: black;">lstat</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Une autre technique intéressante : une des rares utilisation du double</span>
    <span style="color: #808080; font-style: italic;"># '_' en tant que préfixe qui ait du sens. '__method' interdit d'accéder</span>
    <span style="color: #808080; font-style: italic;"># directement à la méthode depuis l'extérieur. C'est ce qu'on a de plus</span>
    <span style="color: #808080; font-style: italic;"># proche de &quot;private&quot; en Python.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Ce n'est pas sécurisé du tout (on peut le contourner) et cela empêche le</span>
    <span style="color: #808080; font-style: italic;"># monkey patching et autres mesures de contournement en cas de besoin,</span>
    <span style="color: #808080; font-style: italic;"># donc je ne vous  recommande pas de le faire.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Mais dans ce cas, ces méthodes sont volontairement définies ainsi pour</span>
    <span style="color: #808080; font-style: italic;"># être invisibles puis un peu plus pas, si win32security ou pwd existent</span>
    <span style="color: #808080; font-style: italic;"># (rappelez-vous, ce sont des dépendances optionnelles), alors elles sont</span>
    <span style="color: #808080; font-style: italic;"># aliasées pour être rendues disponibles.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Il y a 3 implémentations (3 méthodes: un pour windows, une pour unix et</span>
    <span style="color: #808080; font-style: italic;"># une pour le cas où aucun module n'est présent) pour la même</span>
    <span style="color: #808080; font-style: italic;"># fonctionnalitéé, et l'une des 3 méthodes est utilisée comme</span>
    <span style="color: #808080; font-style: italic;"># implémentation de get_owner().</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># On aurait pu tout mettre dans des if directement, mais ça ferait des</span>
    <span style="color: #808080; font-style: italic;"># gros blocs moins lisibles. Ici il est facile de comprendre le code</span>
    <span style="color: #808080; font-style: italic;"># source.</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> __get_owner_windows<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        r<span style="color: #483d8b;">&quot;&quot;&quot;
        Return the name of the owner of this file or directory. Follow
        symbolic links.
&nbsp;
        Return a name of the form ur'DOMAIN<span style="color: #000099; font-weight: bold;">\U</span>ser Name'; may be a group.
        &quot;&quot;&quot;</span>
        desc = win32security.<span style="color: black;">GetFileSecurity</span><span style="color: black;">&#40;</span>
            <span style="color: #008000;">self</span>, win32security.<span style="color: black;">OWNER_SECURITY_INFORMATION</span><span style="color: black;">&#41;</span>
        sid = desc.<span style="color: black;">GetSecurityDescriptorOwner</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        account, domain, typecode = win32security.<span style="color: black;">LookupAccountSid</span><span style="color: black;">&#40;</span><span style="color: #008000;">None</span>, sid<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> domain + u<span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\\</span>'</span> + account
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> __get_owner_unix<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot;
        Return the name of the owner of this file or directory. Follow
        symbolic links.
        &quot;&quot;&quot;</span>
        st = <span style="color: #008000;">self</span>.<span style="color: #dc143c;">stat</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #dc143c;">pwd</span>.<span style="color: black;">getpwuid</span><span style="color: black;">&#40;</span>st.<span style="color: black;">st_uid</span><span style="color: black;">&#41;</span>.<span style="color: black;">pw_name</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> __get_owner_not_implemented<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">NotImplementedError</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Ownership not available on this platform.&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #483d8b;">'win32security'</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">globals</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
        get_owner = __get_owner_windows
    <span style="color: #ff7700;font-weight:bold;">elif</span> <span style="color: #483d8b;">'pwd'</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">globals</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
        get_owner = __get_owner_unix
    <span style="color: #ff7700;font-weight:bold;">else</span>:
        get_owner = __get_owner_not_implemented
&nbsp;
    owner = <span style="color: #008000;">property</span><span style="color: black;">&#40;</span>
        get_owner, <span style="color: #008000;">None</span>, <span style="color: #008000;">None</span>,
        <span style="color: #483d8b;">&quot;&quot;&quot; Name of the owner of this file or directory. &quot;&quot;&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span>, <span style="color: #483d8b;">'statvfs'</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #dc143c;">statvfs</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
            <span style="color: #483d8b;">&quot;&quot;&quot; Perform a statvfs() system call on this path. &quot;&quot;&quot;</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #dc143c;">os</span>.<span style="color: #dc143c;">statvfs</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span>, <span style="color: #483d8b;">'pathconf'</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">def</span> pathconf<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, name<span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #dc143c;">os</span>.<span style="color: black;">pathconf</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, name<span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
    <span style="color: #808080; font-style: italic;"># Pas d'autres commentaires après celui-là. jusqu'à la classe de fin.</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Les méthodes suivantes retournent 'self' bien que ce ne soit</span>
    <span style="color: #808080; font-style: italic;"># pas nécessaire.</span>
    <span style="color: #808080; font-style: italic;"># Par exemple path('/tmp/test').chmod(777) va retourner path('/tmp/test')</span>
    <span style="color: #808080; font-style: italic;"># alors que tout ce qu'on lui demande, c'est de changer la permission</span>
    <span style="color: #808080; font-style: italic;"># du dossier. On le fait pour permettre le chaîning, c'est à dire</span>
    <span style="color: #808080; font-style: italic;"># d'autoriser les appels enchainés comme :</span>
    <span style="color: #808080; font-style: italic;"># path('/tmp/test').chmod(777).rename('/tmp/essai').mkdir('ping')</span>
    <span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#</span>
    <span style="color: #808080; font-style: italic;"># --- Modifying operations on files and directories</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> utime<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, times<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Set the access and modified times of this file. &quot;&quot;&quot;</span>
        <span style="color: #dc143c;">os</span>.<span style="color: black;">utime</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, times<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> chmod<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, mode<span style="color: black;">&#41;</span>:
        <span style="color: #dc143c;">os</span>.<span style="color: black;">chmod</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, mode<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span>, <span style="color: #483d8b;">'chown'</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">def</span> chown<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, uid, gid<span style="color: black;">&#41;</span>:
            <span style="color: #dc143c;">os</span>.<span style="color: black;">chown</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, uid, gid<span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> rename<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #dc143c;">new</span><span style="color: black;">&#41;</span>:
        <span style="color: #dc143c;">os</span>.<span style="color: black;">rename</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #dc143c;">new</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #dc143c;">new</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> renames<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #dc143c;">new</span><span style="color: black;">&#41;</span>:
        <span style="color: #dc143c;">os</span>.<span style="color: black;">renames</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #dc143c;">new</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #dc143c;">new</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#</span>
    <span style="color: #808080; font-style: italic;"># --- Create/delete operations on directories</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> mkdir<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, mode=0777<span style="color: black;">&#41;</span>:
        <span style="color: #dc143c;">os</span>.<span style="color: black;">mkdir</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, mode<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> mkdir_p<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, mode=0777<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            <span style="color: #008000;">self</span>.<span style="color: black;">mkdir</span><span style="color: black;">&#40;</span>mode<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">OSError</span>, e:
            <span style="color: #ff7700;font-weight:bold;">if</span> e.<span style="color: #dc143c;">errno</span> <span style="color: #66cc66;">!</span>= <span style="color: #dc143c;">errno</span>.<span style="color: black;">EEXIST</span>:
                <span style="color: #ff7700;font-weight:bold;">raise</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> makedirs<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, mode=0777<span style="color: black;">&#41;</span>:
        <span style="color: #dc143c;">os</span>.<span style="color: black;">makedirs</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, mode<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> makedirs_p<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, mode=0777<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            <span style="color: #008000;">self</span>.<span style="color: black;">makedirs</span><span style="color: black;">&#40;</span>mode<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">OSError</span>, e:
            <span style="color: #ff7700;font-weight:bold;">if</span> e.<span style="color: #dc143c;">errno</span> <span style="color: #66cc66;">!</span>= <span style="color: #dc143c;">errno</span>.<span style="color: black;">EEXIST</span>:
                <span style="color: #ff7700;font-weight:bold;">raise</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> rmdir<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #dc143c;">os</span>.<span style="color: black;">rmdir</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> rmdir_p<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            <span style="color: #008000;">self</span>.<span style="color: black;">rmdir</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">OSError</span>, e:
            <span style="color: #ff7700;font-weight:bold;">if</span> e.<span style="color: #dc143c;">errno</span> <span style="color: #66cc66;">!</span>= <span style="color: #dc143c;">errno</span>.<span style="color: black;">ENOTEMPTY</span> <span style="color: #ff7700;font-weight:bold;">and</span> e.<span style="color: #dc143c;">errno</span> <span style="color: #66cc66;">!</span>= <span style="color: #dc143c;">errno</span>.<span style="color: black;">EEXIST</span>:
                <span style="color: #ff7700;font-weight:bold;">raise</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> removedirs<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #dc143c;">os</span>.<span style="color: black;">removedirs</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> removedirs_p<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            <span style="color: #008000;">self</span>.<span style="color: black;">removedirs</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">OSError</span>, e:
            <span style="color: #ff7700;font-weight:bold;">if</span> e.<span style="color: #dc143c;">errno</span> <span style="color: #66cc66;">!</span>= <span style="color: #dc143c;">errno</span>.<span style="color: black;">ENOTEMPTY</span> <span style="color: #ff7700;font-weight:bold;">and</span> e.<span style="color: #dc143c;">errno</span> <span style="color: #66cc66;">!</span>= <span style="color: #dc143c;">errno</span>.<span style="color: black;">EEXIST</span>:
                <span style="color: #ff7700;font-weight:bold;">raise</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># --- Modifying operations on files</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> touch<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">&quot;&quot;&quot; Set the access/modified times of this file to the current time.
        Create the file if it does not exist.
        &quot;&quot;&quot;</span>
        fd = <span style="color: #dc143c;">os</span>.<span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #dc143c;">os</span>.<span style="color: black;">O_WRONLY</span> | <span style="color: #dc143c;">os</span>.<span style="color: black;">O_CREAT</span>, 0666<span style="color: black;">&#41;</span>
        <span style="color: #dc143c;">os</span>.<span style="color: black;">close</span><span style="color: black;">&#40;</span>fd<span style="color: black;">&#41;</span>
        <span style="color: #dc143c;">os</span>.<span style="color: black;">utime</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #008000;">None</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> remove<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #dc143c;">os</span>.<span style="color: black;">remove</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> remove_p<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            <span style="color: #008000;">self</span>.<span style="color: black;">unlink</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">OSError</span>, e:
            <span style="color: #ff7700;font-weight:bold;">if</span> e.<span style="color: #dc143c;">errno</span> <span style="color: #66cc66;">!</span>= <span style="color: #dc143c;">errno</span>.<span style="color: black;">ENOENT</span>:
                <span style="color: #ff7700;font-weight:bold;">raise</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> unlink<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #dc143c;">os</span>.<span style="color: black;">unlink</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> unlink_p<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">remove_p</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># --- Links</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span>, <span style="color: #483d8b;">'link'</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">def</span> link<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, newpath<span style="color: black;">&#41;</span>:
            <span style="color: #483d8b;">&quot;&quot;&quot; Create a hard link at 'newpath', pointing to this file. &quot;&quot;&quot;</span>
            <span style="color: #dc143c;">os</span>.<span style="color: black;">link</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, newpath<span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span>newpath<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span>, <span style="color: #483d8b;">'symlink'</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">def</span> symlink<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, newlink<span style="color: black;">&#41;</span>:
            <span style="color: #483d8b;">&quot;&quot;&quot; Create a symbolic link at 'newlink', pointing here. &quot;&quot;&quot;</span>
            <span style="color: #dc143c;">os</span>.<span style="color: black;">symlink</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, newlink<span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span>newlink<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span>, <span style="color: #483d8b;">'readlink'</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">def</span> readlink<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
            <span style="color: #483d8b;">&quot;&quot;&quot; Return the path to which this symbolic link points.
&nbsp;
            The result may be an absolute or a relative path.
            &quot;&quot;&quot;</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._next_class<span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span>.<span style="color: black;">readlink</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">def</span> readlinkabs<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
            <span style="color: #483d8b;">&quot;&quot;&quot; Return the path to which this symbolic link points.
&nbsp;
            The result is always an absolute path.
            &quot;&quot;&quot;</span>
            p = <span style="color: #008000;">self</span>.<span style="color: black;">readlink</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> p.<span style="color: black;">isabs</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
                <span style="color: #ff7700;font-weight:bold;">return</span> p
            <span style="color: #ff7700;font-weight:bold;">else</span>:
                <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">parent</span> / p<span style="color: black;">&#41;</span>.<span style="color: black;">abspath</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#</span>
    <span style="color: #808080; font-style: italic;"># --- High-level functions from shutil</span>
&nbsp;
    copyfile = <span style="color: #dc143c;">shutil</span>.<span style="color: black;">copyfile</span>
    copymode = <span style="color: #dc143c;">shutil</span>.<span style="color: black;">copymode</span>
    copystat = <span style="color: #dc143c;">shutil</span>.<span style="color: black;">copystat</span>
    <span style="color: #dc143c;">copy</span> = <span style="color: #dc143c;">shutil</span>.<span style="color: #dc143c;">copy</span>
    copy2 = <span style="color: #dc143c;">shutil</span>.<span style="color: black;">copy2</span>
    copytree = <span style="color: #dc143c;">shutil</span>.<span style="color: black;">copytree</span>
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">shutil</span>, <span style="color: #483d8b;">'move'</span><span style="color: black;">&#41;</span>:
        move = <span style="color: #dc143c;">shutil</span>.<span style="color: black;">move</span>
    rmtree = <span style="color: #dc143c;">shutil</span>.<span style="color: black;">rmtree</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> rmtree_p<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            <span style="color: #008000;">self</span>.<span style="color: black;">rmtree</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">OSError</span>, e:
            <span style="color: #ff7700;font-weight:bold;">if</span> e.<span style="color: #dc143c;">errno</span> <span style="color: #66cc66;">!</span>= <span style="color: #dc143c;">errno</span>.<span style="color: black;">ENOENT</span>:
                <span style="color: #ff7700;font-weight:bold;">raise</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #808080; font-style: italic;">#</span>
    <span style="color: #808080; font-style: italic;"># --- Special stuff from os</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span>, <span style="color: #483d8b;">'chroot'</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">def</span> chroot<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
            <span style="color: #dc143c;">os</span>.<span style="color: black;">chroot</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span>, <span style="color: #483d8b;">'startfile'</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">def</span> startfile<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
            <span style="color: #dc143c;">os</span>.<span style="color: black;">startfile</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;">#&lt;sm&gt;</span>
<span style="color: #808080; font-style: italic;"># La seule spécificité de cette classe est d'overrider la méthode __new__ qui</span>
<span style="color: #808080; font-style: italic;"># est le véritable constructeur en Python (__init__ n'est pas un constructeur)</span>
<span style="color: #808080; font-style: italic;"># L'auteur le fait car tempdir hérite de path qui hérite d'unicode. Or, tous</span>
<span style="color: #808080; font-style: italic;"># les types non-mutables (int, tuple, str, etc, et donc unicode), n'étant pas</span>
<span style="color: #808080; font-style: italic;"># modifiables, ne peuvent être changés dans __init__. Ici __new__ est</span>
<span style="color: #808080; font-style: italic;"># utilisé pour retourner un path tout en créant un dossier temporaire, ce</span>
<span style="color: #808080; font-style: italic;"># qui ne marcherait pas dans __init__. Il est très rare d'avoir besoin de</span>
<span style="color: #808080; font-style: italic;"># s'occuper de __new__.</span>
<span style="color: #808080; font-style: italic;">#&lt;/sm&gt;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> tempdir<span style="color: black;">&#40;</span>path<span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot;
    A temporary directory via tempfile.mkdtemp, and constructed with the
    same parameters that you can use as a context manager.
&nbsp;
    Example:
&nbsp;
        with tempdir() as d:
            # do stuff with the path object &quot;d&quot;
&nbsp;
        # here the directory is deleted automatically
    &quot;&quot;&quot;</span>
&nbsp;
    @ClassProperty
    @<span style="color: #008000;">classmethod</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> _next_class<span style="color: black;">&#40;</span>cls<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> path
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__new__</span><span style="color: black;">&#40;</span>cls, <span style="color: #66cc66;">*</span>args, <span style="color: #66cc66;">**</span>kwargs<span style="color: black;">&#41;</span>:
        dirname = <span style="color: #dc143c;">tempfile</span>.<span style="color: black;">mkdtemp</span><span style="color: black;">&#40;</span><span style="color: #66cc66;">*</span>args, <span style="color: #66cc66;">**</span>kwargs<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">super</span><span style="color: black;">&#40;</span>tempdir, cls<span style="color: black;">&#41;</span>.<span style="color: #0000cd;">__new__</span><span style="color: black;">&#40;</span>cls, dirname<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #66cc66;">*</span>args, <span style="color: #66cc66;">**</span>kwargs<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">pass</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> __enter__<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> __exit__<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, exc_type, exc_value, <span style="color: #dc143c;">traceback</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> exc_value:
            <span style="color: #008000;">self</span>.<span style="color: black;">rmtree</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>C&#8217;est une bibliothèque très complète et propre, et bien qu&#8217;il y ait quelques astuces ici et là, vous avez pu constater que l&#8217;usage de la POO reste tout à fait accessible : héritage simple, déclaration de méthode, properties, etc. On ne fait pas beaucoup de folies.</p>
<p>Il n&#8217;y a pas besoin de faire les choses compliquées avec la POO, on peut faire des choses tout à fait ordinaires et utiles.</p>
<p>Pour le dernier tuto de la série, on tapera dans la magie noire, à savoir <a href="http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-8/">les métaclasses</a>. Tintintin.</p>
<p>P.S: cet article a été sponsorisé par le plugin Sublime Text <a href="https://github.com/ehuss/Sublime-Wrap-Plus">Wraps Plus</a>. Avec Wraps Plus, plus de caractères en sus !</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=5912&amp;md5=5ee04086e4fda5af17ffc872144fb631" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-7/feed/</wfw:commentRss>
		<slash:comments>22</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fle-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-7%2F&amp;language=en_GB&amp;category=text&amp;title=Le+guide+ultime+et+d%C3%A9finitif+sur+la+programmation+orient%C3%A9e+objet+en+Python+%C3%A0+l%E2%80%99usage+des+d%C3%A9butants+qui+sont+rassur%C3%A9s+par+les+textes+d%C3%A9taill%C3%A9s+qui+prennent+le+temps+de+tout+expliquer.+Partie+7.&amp;description=Un+peu+de+rock+%C3%A0+l%26%238217%3Banglaise+pour+faire+passer+la+pilule+%3A+Apr%C3%A8s+avoir+lu+la+partie+pr%C3%A9c%C3%A9dente%2C+vous+avez+d%C3%BB+vous+demander+comment+mettre+tout+%C3%A7a+en+application.+Comme...&amp;tags=classe%2Cclasses%2Cheritage%2Cpath.py%2Cpoo%2Cpython%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/04/PzXJlX6.jpg" length="217148" type="image/jpg" />	</item>
		<item>
		<title>Le guide ultime et définitif sur la programmation orientée objet en Python à l’usage des débutants qui sont rassurés par les textes détaillés qui prennent le temps de tout expliquer. Partie 5.</title>
		<link>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-5/</link>
		<comments>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-5/#comments</comments>
		<pubDate>Mon, 11 Feb 2013 17:38:28 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[composition]]></category>
		<category><![CDATA[heritage]]></category>
		<category><![CDATA[poo]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=4495</guid>
		<description><![CDATA[La POO, c'est comme les poupées russes. Une fois qu'on a maîtrisé un concept, paf, y en a un autre qui se ramène derrière.
]]></description>
			<content:encoded><![CDATA[<p>Maestro, musique !</p>

<!-- iframe plugin v:2.3 - wordpress.org/extend/plugins/iframe/ -->
<iframe width="420" height="315" src="http://www.youtube.com/embed/XWE_VC9DpK0" frameborder="0" scrolling="no" class="iframe-class"></iframe>
<p>Prérequis :</p>
<ul>
<li>Avoir lu la <a href="http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-4/">partie 4</a>.</li>
<li>Etre bien au point sur la notion de <a href="http://sametmax.com/valeurs-et-references-en-python/">références</a>.</li>
</ul>
<p>La POO, c&#8217;est comme les poupées russes. Une fois qu&#8217;on a maîtrisé un concept, paf, y en a un autre qui se ramène derrière.</p>
<h2>J&#8217;ai plusieurs mamans</h2>
<p>En ces temps de polémique sur l&#8217;autorisation du mariage entre êtres amoureux et consentants (par opposition à celui qu&#8217;on fait par convention sociale depuis des siècles), je vous propose de vous rappeler qu&#8217;une fois de plus les informaticiens sont en avance sur les mœurs.</p>
<p>D&#8217;abord parce qu&#8217;une communauté qui fait autant de links vers <a href="http://www.yougotrickrolled.com/">Never Gona Give You Up</a> est forcément pro gay par essence. Ensuite parce qu&#8217;une classe fille peut avoir plusieurs classes mères sans que ça choque personne.</p>
<p>Prenez ces deux classes qui passaient par là sans rien demander :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> MouMoutte<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #008000;">type</span> = <span style="color: #483d8b;">'top'</span> <span style="color: #808080; font-style: italic;"># c'est tip top moumoutte</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Raoul<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    trop = <span style="color: #483d8b;">'cool'</span></pre></div></div>

<p>Hé merde, j&#8217;ai écris ça, et maintenant j&#8217;ai aucune idée de comment faire un code cohérent à partir de cet exemple à la con.</p>
<p>On annule tout.</p>
<p>On recommence.</p>
<p>Vous faites un jeu vidéo. Ça, ça parle bien. Et dedans vous avez des protections et des armes.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Arme<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, nom, degat<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">nom</span> = nom
        <span style="color: #008000;">self</span>.<span style="color: black;">degat</span> = degat
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> attaque<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, cible<span style="color: black;">&#41;</span>: <span style="color: #808080; font-style: italic;"># on retire les degâts de l'épee des points de vie</span>
        cible.<span style="color: black;">vie</span> -= <span style="color: #008000;">self</span>.<span style="color: black;">degat</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Protection<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, nom, armure<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">nom</span> = nom
        <span style="color: #008000;">self</span>.<span style="color: black;">armure</span> = armure
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> defend<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, degat<span style="color: black;">&#41;</span>: <span style="color: #808080; font-style: italic;"># on diminue les degâts, voire on les annule</span>
&nbsp;
        degat = degat - <span style="color: #008000;">self</span>.<span style="color: black;">armure</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> degat <span style="color: #66cc66;">&lt;</span> <span style="color: #ff4500;">0</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #ff4500;">0</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> degat
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> epee = Arme<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Epée Mana'</span>, degat=<span style="color: #ff4500;">999</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> casque = Protection<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Casque de Balduran'</span>, armure=<span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span></pre></div></div>

<p>C&#8217;est simpliste, mais vous voyez le tableau. Maintenant un connard de client arrive et vous sort une idée trop cool : il faudrait ajouter un barbare dans le jeu. Qui tape aussi avec son bouclier, parce que la concurrence le fait et qu&#8217;ils veulent pas se faire mettre un vent par Blizzard.</p>
<p>Enfer et Rutabaga ! Comment allons nous nous sortir de cette situation ?</p>
<p>Il y a moult manières de faire, mais l&#8217;une d&#8217;elle est d&#8217;utiliser l&#8217;<strong>héritage multiple</strong>, c&#8217;est-à-dire de créer une classe qui hérite des deux classes en même temps.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> ProtectionOffensive<span style="color: black;">&#40;</span>Arme, Protection<span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, nom, degat, armure<span style="color: black;">&#41;</span>:
&nbsp;
        Arme.<span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, nom, degat<span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># appelle le __init__ de arme</span>
        Protection.<span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, nom, armure<span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># appelle le __init de protection</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># comme on a appelé les deux __init__, on va avoir les attributs</span>
        <span style="color: #808080; font-style: italic;"># settés dans les deux __init__ attachés à cette classe</span></pre></div></div>

<p>Nous avons alors une classe qui possède les méthodes des deux classes parentes :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> bouclier = ProtectionOffensive<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Bouclier du dragon'</span>, degat=<span style="color: #ff4500;">10</span>, armure=<span style="color: #ff4500;">100</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> bouclier.<span style="color: black;">degat</span>
<span style="color: #ff4500;">10</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> bouclier.<span style="color: black;">armure</span>
<span style="color: #ff4500;">100</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> bouclier.<span style="color: black;">defend</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">10</span><span style="color: black;">&#41;</span>
<span style="color: #ff4500;">0</span></pre></div></div>

<p>Ne cherchez pas compliqué, ça fait exactement ce que ça à l&#8217;air de faire : &#8220;copier&#8221; (oui bon, entre guillemets) le code de chaque parent dans l&#8217;enfant.</p>
<p>Néanmoins vous avez vu qu&#8217;il y a quelques subtilités, notamment la partie <code>__init__</code>.</p>
<p>Posez-vous deux minutes. Respirez. Concentrez-vous. Prêt ?</p>
<p>Les deux classes parentes ont une méthode <code>__init__</code>, mais <strong>Python ne peut en &#8220;copier&#8221; qu&#8217;une seule </strong>dans l&#8217;enfant. Il copie donc la première qu&#8217;il trouve. Il va prendre la liste des parents (ici: <code>Arme, Protection</code>), et la lire de gauche à droite. Il va regarder chaque parent, et si la méthode existe, il va la &#8220;copier&#8221; dans l&#8217;enfant.</p>
<p>Si il retrouve une méthode de même nom dans un des parents suivants, il l&#8217;ignore. (Je dis un DES parents suivants car vous pouvez avoir 10 parents si vous voulez).</p>
<p>Donc dans notre exemple, si je fais :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> ProtectionOffensive<span style="color: black;">&#40;</span>Arme, Protection<span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">pass</span></pre></div></div>

<p><code>ProtectionOffensive</code> n&#8217;aura que la méthode <code>__init__</code> de <code>Arme</code>. Or ce n&#8217;est pas ce qu&#8217;on veut. On va donc overrider la méthode <code>__init__</code>, et dedans appeler la méthode <code>__init__</code> de <code>Arme</code> ET celle de <code>Protection</code>.</p>
<p>Cette syntaxe : <code>Classe.methode(self, args...)</code> que l&#8217;on retrouve dans <code>Arme.__init__(self, nom, degat)</code> est juste un moyen d&#8217;appeler spécifiquement la méthode du parent.</p>
<p>Dans la partie précédente, je vous ai montré qu&#8217;on pouvait faire cela avec <code>super()</code>. Or <code>super()</code> vous retournera la première méthode du premier parent qu&#8217;elle trouve : c&#8217;est le but de <code>super()</code>, de faire ça automatiquement sans se soucier de savoir qui est le premier parent à avoir une méthode du bon nom.</p>
<p>C&#8217;est utile car parfois c&#8217;est le parent du parent du parent qui a la méthode qu&#8217;on veut appeler. On ne connaît pas forcément son nom, ou alors on ne veut pas l&#8217;écrire en dur. Mais dans notre cas, on veut spécifiquement une méthode d&#8217;un parent en particulier, il faut donc l&#8217;écrire à la main.</p>
<p>D&#8217;une manière générale :</p>
<ul>
<li>Utilisez<code> super()</code> quand vous faites de l&#8217;héritage simple où que vous voulez juste appeler la méthode du premier parent venu sans vous soucier de son nom (car il peut être très haut dans la chaîne d&#8217;héritage).</li>
<li>Utilisez <code>Classe.methode(self, args...)</code> quand vous voulez spécifiquement appeler la méthode d&#8217;un parent en particulier.</li>
</ul>
<p>Faites attention !</p>
<p>Le <code>self</code> n&#8217;est pas au même endroit dans <code>super(ClassCourante, self).methode(args...)</code> et <code>ClasseParente.methode(self, args...)</code>. Et dans le premier cas, on passe la classe courante (que <code>super()</code> va l&#8217;analyser pour trouver les parents automatiquement), dans le cas suivant, on écrit le nom de la classe parente en dur.</p>
<p>Faites quelques tests avec des scripts bidons pour bien comprendre comment ça marche. Faites ça avec des classes toutes simples. Sinon le jour où vous aurez une classe compliquée, vous allez vous embrouiller.</p>
<h2>La composition (POO pour les vrais mecs)</h2>
<p>Jusqu&#8217;ici c&#8217;était un tuto avec des notions de base pour des petits geeks imberbes qui jouent avec des actions figures fabriquées en Chine et achetées sur ebay. Mais maintenant nous allons voir la POO pour les vrais hommes, les barbus, ceux qui jouent avec des <a href="https://www.realdoll.com/">reals dolls</a> et qui n&#8217;ont pas peur de mettre des chaussettes dépareillées.</p>
<p>Voyez-vous, un objet, tout seul, il sert à rien. Il s&#8217;emmerde déjà, rien à foutre le samedi, nul part où sortir, tout ça. Mais surtout, il a personne pour prendre l&#8217;apéro. Non, dans un programme digne d&#8217;un vrai pastis, il faut plusieurs objets qui interagissent entre eux. En fait, plusieurs objets qui s&#8217;utilisent les uns les autres.</p>
<p>Retournez à notre exemple de jeu video :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> HeroViril<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #808080; font-style: italic;"># def __init__(self, nom, prenom, groupe_sanguin, signe_astrologique,</span>
    <span style="color: #808080; font-style: italic;">#              couleur_preferee, tendance_sexuelle, culte,</span>
    <span style="color: #808080; font-style: italic;">#              taille_de_la_troisieme_phallange_de_l_index_gauche)</span>
    <span style="color: #808080; font-style: italic;"># TODO : voir le CDC avec le client pour confirmer les attributs du personnage</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, nom, vie, arme=<span style="color: #008000;">None</span>, protection=<span style="color: #008000;">None</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">nom</span> = nom
        <span style="color: #008000;">self</span>.<span style="color: black;">vie</span> = vie
        <span style="color: #008000;">self</span>.<span style="color: black;">arme</span> = arme
        <span style="color: #008000;">self</span>.<span style="color: black;">protection</span> = protection
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> combattre<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, ennemi<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;{} attaque {}&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">nom</span>, ennemi.<span style="color: black;">nom</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">while</span> <span style="color: #008000;">True</span>:
&nbsp;
            <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">arme</span>:
                <span style="color: #008000;">self</span>.<span style="color: black;">arme</span>.<span style="color: black;">attaque</span><span style="color: black;">&#40;</span>ennemi<span style="color: black;">&#41;</span>
&nbsp;
            <span style="color: #ff7700;font-weight:bold;">if</span> ennemi.<span style="color: black;">vie</span> <span style="color: #66cc66;">&lt;</span>= <span style="color: #ff4500;">0</span>:
                <span style="color: #ff7700;font-weight:bold;">break</span>
&nbsp;
            <span style="color: #ff7700;font-weight:bold;">if</span> ennemi.<span style="color: black;">arme</span>:
                ennemi.<span style="color: black;">arme</span>.<span style="color: black;">attaque</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
&nbsp;
            <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">vie</span> <span style="color: #66cc66;">&lt;</span>= <span style="color: #ff4500;">0</span>:
                <span style="color: #ff7700;font-weight:bold;">break</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">vie</span> <span style="color: #66cc66;">&gt;</span> <span style="color: #ff4500;">0</span>:
            <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;Victoire de {}&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">nom</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;{} est mort comme une pov' merde&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">nom</span><span style="color: black;">&#41;</span></pre></div></div>

<p>Et là vous notez un truc, c&#8217;est que nous n&#8217;avons pas de méthode <code>attaque()</code> sur notre héros. Nous utilisons la méthode attaque d&#8217;un objet arme. Que l&#8217;on a en attribut.</p>
<p>C&#8217;est cela la composition : un objet, qui en fait est composé de plusieurs sous-objets. Dans notre cas, notre objet héros est aussi composé d&#8217;une arme et d&#8217;une protection, qui sont ses attributs. Il peut ainsi utiliser le comportement de ses objets pour faire le boulot à sa place : c&#8217;est ce qu&#8217;on appelle la délégation.</p>
<p>Reprenons notre code des armes, un peu adapté :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># le code de l'armure ne change pas</span>
<span style="color: #ff7700;font-weight:bold;">class</span> Protection<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, nom, armure<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">nom</span> = nom
        <span style="color: #008000;">self</span>.<span style="color: black;">armure</span> = armure
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> defend<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, degat<span style="color: black;">&#41;</span>:
&nbsp;
        degat = degat - <span style="color: #008000;">self</span>.<span style="color: black;">armure</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> degat <span style="color: #66cc66;">&lt;</span> <span style="color: #ff4500;">0</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #ff4500;">0</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> degat
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;"># on change le code de l'arme, si la cible a une protection</span>
<span style="color: #808080; font-style: italic;"># cela diminue les degâts pris</span>
<span style="color: #ff7700;font-weight:bold;">class</span> Arme<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, nom, degat<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">nom</span> = nom
        <span style="color: #008000;">self</span>.<span style="color: black;">degat</span> = degat
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> attaque<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, cible<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #808080; font-style: italic;"># je mets aussi quelques prints pour le lulz</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> cible.<span style="color: black;">protection</span>:
            degat = cible.<span style="color: black;">protection</span>.<span style="color: black;">defend</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">degat</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;{} - {} = {}&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span>cible.<span style="color: black;">vie</span>, degat, cible.<span style="color: black;">vie</span> - degat<span style="color: black;">&#41;</span>
            cible.<span style="color: black;">vie</span> -= degat
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;{} - {} = {}&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span>cible.<span style="color: black;">vie</span>, <span style="color: #008000;">self</span>.<span style="color: black;">degat</span>, cible.<span style="color: black;">vie</span> - <span style="color: #008000;">self</span>.<span style="color: black;">degat</span><span style="color: black;">&#41;</span>
            cible.<span style="color: black;">vie</span> -= <span style="color: #008000;">self</span>.<span style="color: black;">degat</span></pre></div></div>

<p>Maintenant créons deux héros, armons-les, et faisons-les combattre :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> gosu = HeroViril<span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Drizzt Do'Urden&quot;</span>, <span style="color: #ff4500;">2000</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> gosu.<span style="color: black;">arme</span> = Arme<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Lame Vorpale'</span>, <span style="color: #ff4500;">10</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> gosu.<span style="color: black;">protection</span> = Protection<span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Maille en Kevlar de mithril doré a l'adamantium&quot;</span>, <span style="color: #ff4500;">10</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> noob_qui_repop = HeroViril<span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Bob&quot;</span>, <span style="color: #ff4500;">200</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> noob_qui_repop.<span style="color: black;">arme</span> = Arme<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Cure-dent'</span>, <span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> noob_qui_repop.<span style="color: black;">protection</span> = Protection<span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Slip&quot;</span>, <span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> noob_qui_repop.<span style="color: black;">combattre</span><span style="color: black;">&#40;</span>gosu<span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># yaaaaaaaaaaaaaaaaaaaaaaa !</span>
&nbsp;
Bob attaque Drizzt Do<span style="color: #483d8b;">'Urden
2000 - 0 = 2000
200 - 9 = 191
2000 - 0 = 2000
191 - 9 = 182
2000 - 0 = 2000
182 - 9 = 173
2000 - 0 = 2000
173 - 9 = 164
2000 - 0 = 2000
164 - 9 = 155
2000 - 0 = 2000
155 - 9 = 146
2000 - 0 = 2000
146 - 9 = 137
2000 - 0 = 2000
137 - 9 = 128
2000 - 0 = 2000
128 - 9 = 119
2000 - 0 = 2000
119 - 9 = 110
2000 - 0 = 2000
110 - 9 = 101
2000 - 0 = 2000
101 - 9 = 92
2000 - 0 = 2000
92 - 9 = 83
2000 - 0 = 2000
83 - 9 = 74
2000 - 0 = 2000
74 - 9 = 65
2000 - 0 = 2000
65 - 9 = 56
2000 - 0 = 2000
56 - 9 = 47
2000 - 0 = 2000
47 - 9 = 38
2000 - 0 = 2000
38 - 9 = 29
2000 - 0 = 2000
29 - 9 = 20
2000 - 0 = 2000
20 - 9 = 11
2000 - 0 = 2000
11 - 9 = 2
2000 - 0 = 2000
2 - 9 = -7
Bob est mort comme une pov'</span> merde</pre></div></div>

<h2>Ok, j&#8217;ai pigé le principe, mais comment ça marche dans le détail ?</h2>
<p>Regardons la méthode combattre de plus près :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">    <span style="color: #808080; font-style: italic;"># elle attend un ennemi en paramètre, donc UN OBJET HeroViril</span>
    <span style="color: #808080; font-style: italic;"># self est l'objet en cours, donc aussi un objet HeroViril</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> combattre<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, ennemi<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;{} attaque {}&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">nom</span>, ennemi.<span style="color: black;">nom</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># une petite boucle infinie. Warning, c'est un tuto. Ne faites pas</span>
        <span style="color: #808080; font-style: italic;"># ça chez vous les enfants.</span>
        <span style="color: #808080; font-style: italic;"># cette boucle loop pour toujours si il n'y a pas d'attribut arme donc</span>
        <span style="color: #808080; font-style: italic;"># ceci n'est qu'un exemple. Hein ? Noté ? Les deux du fond là ?</span>
        <span style="color: #ff7700;font-weight:bold;">while</span> <span style="color: #008000;">True</span>:
&nbsp;
            <span style="color: #808080; font-style: italic;"># on donne le premier coup à la personne qui attaque (l'objet en</span>
            <span style="color: #808080; font-style: italic;"># cours). On vérifie qu'il a une arme. Si c'est le cas,</span>
            <span style="color: #808080; font-style: italic;"># on appelle la méthode de l'arme &quot;attaque()&quot;, et on lui passe</span>
            <span style="color: #808080; font-style: italic;"># en paramètre l'ennemi.</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">arme</span>:
                <span style="color: #008000;">self</span>.<span style="color: black;">arme</span>.<span style="color: black;">attaque</span><span style="color: black;">&#40;</span>ennemi<span style="color: black;">&#41;</span>
&nbsp;
            <span style="color: #808080; font-style: italic;"># condition de sortie de la boucle sur la vie du héros qui a pris</span>
            <span style="color: #808080; font-style: italic;"># le coup</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> ennemi.<span style="color: black;">vie</span> <span style="color: #66cc66;">&lt;</span>= <span style="color: #ff4500;">0</span>:
                <span style="color: #ff7700;font-weight:bold;">break</span>
&nbsp;
            <span style="color: #808080; font-style: italic;"># ensuite on fait pareil à l'envers pour donner une chance à l'autre</span>
            <span style="color: #808080; font-style: italic;"># de répliquer : on vérifie que l'ennemi a une arme, et si c'est</span>
            <span style="color: #808080; font-style: italic;"># le cas, on applique la méthode &quot;attaque&quot; de l'arme à l'objet</span>
            <span style="color: #808080; font-style: italic;"># en cours</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> ennemi.<span style="color: black;">arme</span>:
                ennemi.<span style="color: black;">arme</span>.<span style="color: black;">attaque</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>
&nbsp;
            <span style="color: #808080; font-style: italic;"># condition de sortie de la boucle sur la vie du héros qui a pris</span>
            <span style="color: #808080; font-style: italic;"># le coup</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">vie</span> <span style="color: #66cc66;">&lt;</span>= <span style="color: #ff4500;">0</span>:
                <span style="color: #ff7700;font-weight:bold;">break</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># une fois sorti de la boucle, on vérifie le niveau de vie pour</span>
        <span style="color: #808080; font-style: italic;"># désigner le vainqueur</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">vie</span> <span style="color: #66cc66;">&gt;</span> <span style="color: #ff4500;">0</span>:
            <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;Victoire de {}&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">nom</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;{} est mort comme une pov' merde&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">nom</span><span style="color: black;">&#41;</span></pre></div></div>

<p>Donc combattre utilise un objet arme, et appelle sa méthode <code>attaque()</code> sur un héros (j&#8217;ai viré les prints pour rendre le truc plus clair) :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">    <span style="color: #808080; font-style: italic;"># self est l'objet en cours, donc l'arme</span>
    <span style="color: #808080; font-style: italic;"># cible est un héros, puisqu'on l'a passé en paramètre</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> attaque<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, cible<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #808080; font-style: italic;"># si la cible (l'objet héros) a un attribut protection,</span>
        <span style="color: #808080; font-style: italic;"># les dégâts retirés sont diminués (ce calcul est fait par la protection)</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> cible.<span style="color: black;">protection</span>:
            cible.<span style="color: black;">vie</span> -= cible.<span style="color: black;">protection</span>.<span style="color: black;">defend</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">degat</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># sinon, on retire les dégâts à la vie de la cible (le héros)</span>
        <span style="color: #808080; font-style: italic;"># directement</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            cible.<span style="color: black;">vie</span> -= <span style="color: #008000;">self</span>.<span style="color: black;">degat</span></pre></div></div>

<p>Diantre ! La méthode attaque utilise elle-même la méthode <code>defend(</code>) de la protection :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">    <span style="color: #808080; font-style: italic;"># self est l'objet en cours, donc la protection</span>
    <span style="color: #808080; font-style: italic;"># degat est un simple int</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> defend<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, degat<span style="color: black;">&#41;</span>:
        <span style="color: #808080; font-style: italic;"># on retourne les degâts infligés, moins la protection</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> degat - <span style="color: #008000;">self</span>.<span style="color: black;">armure</span></pre></div></div>

<p>Pour comprendre tous ces codes, il faut bien piger deux trucs :</p>
<ul>
<li>Il y a 6 objets. Deux héros, deux armes, et deux protections. Les héros ont les armes / protections comme attributs.</li>
<li>On se sert des méthodes des armes pour attaquer. On passe les héros en paramètres à ces méthodes. Les armes se servent des protections des héros pour calculer les dégats.</li>
</ul>
<p>Ce dernier point est le plus important. Si vous comprenez ça, vous avez maîtrisé le plus important de la POO. Relisez le plusieurs fois :</p>
<p>Les héros ont une référence aux armes. Et ensuite, on passe une référence des héros aux armes. Les armes retirent de la vie à ces héros, non sans calculer les dégâts en fonction de la protection qu&#8217;ils portent.</p>
<p>Les objets ont tous des références les uns vers les autres. <strong>Ils se manipulent tous les uns les autres.</strong></p>
<p>Cela fait bizarre car dans la vie une épée ne manipule pas un héros (bon, je connais peu d&#8217;elfes noirs IRL aussi). On comprend facilement qu&#8217;un héros ait un attribut &#8216;épée&#8217;, mais il est difficile de comprendre qu&#8217;une épée ait une méthode, et que le paramètre de cette méthode soit un héros.</p>
<p>C&#8217;est un concept purement informatique : la logique des dégâts est codée dans l&#8217;arme, pas dans le héros. L&#8217;avantage de cette architecture, c&#8217;est que si vous changez l&#8217;arme, vous changez toute la logique des dégâts. Par exemple, vous rajoutez une arme empoisonnée :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> ArmeMegaEmpoisonnee<span style="color: black;">&#40;</span>Arme<span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, nom, degat, poison=<span style="color: #ff4500;">100000</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">super</span><span style="color: black;">&#40;</span>ArmeMegaEmpoisonnee, <span style="color: #008000;">self</span><span style="color: black;">&#41;</span>.<span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span>nom, degat<span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">poison</span> = poison
&nbsp;
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> attaque<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, cible<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #808080; font-style: italic;"># on prend les degâts une premiere fois</span>
        <span style="color: #008000;">super</span><span style="color: black;">&#40;</span>ArmeMegaEmpoisonnee, <span style="color: #008000;">self</span><span style="color: black;">&#41;</span>.<span style="color: black;">attaque</span><span style="color: black;">&#40;</span>cible<span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># puis on prend les dégâts du poison</span>
        cible.<span style="color: black;">vie</span> -= <span style="color: #008000;">self</span>.<span style="color: black;">poison</span></pre></div></div>

<p>Cette arme fait plus de dégâts. Son mécanisme pour faire des dégâts est différent. Il suffit d&#8217;équiper un héros avec l&#8217;arme (en changeant l&#8217;attribut) pour que ce nouveau calcul de dégâts soit pris en compte.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> noob_qui_repop.<span style="color: black;">vie</span> = <span style="color: #ff4500;">200</span> <span style="color: #808080; font-style: italic;"># rePOP !</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> noob_qui_repop.<span style="color: black;">arme</span> = ArmeMegaEmpoisonnee<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Cheat Code'</span>, <span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> noob_qui_repop.<span style="color: black;">combattre</span><span style="color: black;">&#40;</span>gosu<span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># Vengeance !</span>
Bob attaque Drizzt Do<span style="color: #483d8b;">'Urden
2000 - 0 = 2000
Victoire de Bob</span></pre></div></div>

<p>Ce qu&#8217;il faut retenir : on peut mettre des objets en tant qu&#8217;attributs d&#8217;objets. Il n&#8217;y a pas de limite dans les nombres d&#8217;objets à mettre, leur mélange, les niveaux d&#8217;imbrications, etc. On peut mettre des objets, dans des objets, dans des objets&#8230; C&#8217;est la composition.</p>
<p>Et les objets peuvent utiliser les méthodes des autres objets. Et on peut passer des objets comme paramètres à des méthodes. C&#8217;est la délégation.</p>
<p>C&#8217;est la partouze des objets, quoi.</p>
<p>On peut mettre des objets dans des sets, des dicos, des listes&#8230; Par juste des attributs. Il y en a des choses à faire !</p>
<h2>Choisir entre l&#8217;héritage et la composition</h2>
<p>Les deux techniques permettent de réutiliser du code, mais pas de la même façon. Aucune règle générale ne tient la route dans tous les cas, mais un bon point de départ est de se dire que :</p>
<ul>
<li>Si vous avez deux objets de même nature et que l&#8217;un est une spécialisation de l&#8217;autre (Garçon est une spécialisation de Personne, Voiture est une spécialisation de véhicule, Clio est une spécialisation de voiture, Reptincel est une spécialisation de pokemon, foxmask est une spécialisation du correcteur orthographique de Word, etc), alors utilisez l&#8217;héritage.</li>
<li>Si vous avez deux objets qui échangent des données, qui sont associés ou qui dans la vie réelle sont des &#8216;part de&#8217; (un article est une partie d&#8217;un blog, Raymond Barre est membre d&#8217;un parti, Raymond fait parti d&#8217;un bar, le bar et la raie font parti des poissons, etc), utilisez la composition.</li>
</ul>
<p>Il y a aussi, quelque part, dans le lointain pays des enculeurs de mouche, une différence entre l’agrégation (qu&#8217;on a pas vu) et la composition. Vous vivrez très bien en considérant que c&#8217;est la même chose.</p>
<h2>Le design pattern &#8220;stratégie&#8221;</h2>
<p>Vous entendrez parfois parler du motif de conception &#8220;stratégie&#8221;. C&#8217;est en fait une mise en application abstraite de la composition.</p>
<p>Normalement la composition s&#8217;utilise avec des &#8220;part de&#8221; concrètes. Vous avez une voiture : elle est composée d&#8217;objets pneus, d&#8217;un objet moteur, etc.</p>
<p>Le design pattern stratégie est l&#8217;extraction d&#8217;une part du comportement d&#8217;un objet pour le mettre dans un autre objet, mais la nature de l&#8217;objet importe peu. Ceci est fait purement pour découpler le comportement de l&#8217;objet. </p>
<p>On a vu plus haut que changer l&#8217;arme permet de changer le calcul des dégâts. C&#8217;est ce type de résultat qu&#8217;on vise avec le design pattern strategy.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">os</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> ParseurXml<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    ...
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> ParseurJson<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    ...
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> ParseurDeFichier<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    _strategy = <span style="color: black;">&#123;</span> <span style="color: #808080; font-style: italic;"># les stratégie par défaut</span>
        <span style="color: #483d8b;">'json'</span>: ParseurXml,
        <span style="color: #483d8b;">'xml'</span>: ParseurJson
    <span style="color: black;">&#125;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, fichier, strategy=<span style="color: #008000;">None</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">fichier</span> = fichier
        <span style="color: #808080; font-style: italic;"># on récupère l'extension du fichier</span>
        path, ext = <span style="color: #dc143c;">os</span>.<span style="color: black;">path</span>.<span style="color: black;">splitext</span><span style="color: black;">&#40;</span>fichier<span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Strategy est une classe de parseur</span>
        <span style="color: #808080; font-style: italic;"># on la récupère depuis les paramètres ou selon</span>
        <span style="color: #808080; font-style: italic;"># l'extension</span>
        Strategy = strategy <span style="color: #ff7700;font-weight:bold;">or</span> <span style="color: #008000;">self</span>._strategy<span style="color: black;">&#91;</span>ext.<span style="color: black;">lstrip</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'.'</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>
        <span style="color: #808080; font-style: italic;"># on instancie notre classe de strategie</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">strategy</span> = Strategy<span style="color: black;">&#40;</span>fichier<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> parse<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #808080; font-style: italic;"># on délègue le boulot à la stratégie</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">strategy</span>.<span style="color: black;">parse</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>La ligne la plus importante est :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">Strategy = strategy <span style="color: #ff7700;font-weight:bold;">or</span> <span style="color: #008000;">self</span>._strategy<span style="color: black;">&#91;</span>ext<span style="color: black;">&#93;</span></pre></div></div>

<p>Ici on dit récupérer la stratégie de parsing en paramètre, ou sinon, la bonne en fonction de l&#8217;extension de fichier. On charge donc une classe dynamiquement, on va créer un objet à partir de cette classe. Et c&#8217;est cet objet à qui on va déléguer le comportement du parseur :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">    <span style="color: #ff7700;font-weight:bold;">def</span> parse<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">strategy</span>.<span style="color: black;">parse</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>On utilise l&#8217;objet dynamiquement pour gérer tout le parsing. On peut ainsi choisir un parseur à la volée.</p>
<p>La pattern strategy mélange donc composition (l&#8217;objet strategy est une part de l&#8217;objet général), délégation (l&#8217;objet général utilise le comportement de l&#8217;objet strategy) et d&#8217;injection de dépendance (on peut changer l&#8217;algo à la volée, il suffit de changer de stratégie).</p>
<p>Bon, ça c&#8217;était le mode hard. C&#8217;est pas grave si vous finissez pas le niveau toute de suite. Mettez pause. Allez pisser un coup et revenez- plus tard, les continues sont infinis sur le blog.</p>
<p>C&#8217;est bon, vous êtes chaud ? Prochaine stations, <a href="http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-6/">le monde merveilleux des méthodes magiques</a>.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=4495&amp;md5=6dac65ec8e007344d1cfac6f8b8c5402" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-5/feed/</wfw:commentRss>
		<slash:comments>49</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fle-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-5%2F&amp;language=en_GB&amp;category=text&amp;title=Le+guide+ultime+et+d%C3%A9finitif+sur+la+programmation+orient%C3%A9e+objet+en+Python+%C3%A0+l%E2%80%99usage+des+d%C3%A9butants+qui+sont+rassur%C3%A9s+par+les+textes+d%C3%A9taill%C3%A9s+qui+prennent+le+temps+de+tout+expliquer.+Partie+5.&amp;description=Maestro%2C+musique+%21+Pr%C3%A9requis+%3A+Avoir+lu+la+partie+4.+Etre+bien+au+point+sur+la+notion+de+r%C3%A9f%C3%A9rences.+La+POO%2C+c%26%238217%3Best+comme+les+poup%C3%A9es+russes.+Une+fois+qu%26%238217%3Bon+a...&amp;tags=composition%2Cheritage%2Cpoo%2Cpython%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/02/magic_warmhanz.jpg" length="172488" type="image/jpg" />	</item>
		<item>
		<title>Le guide ultime et définitif sur la programmation orientée objet en Python à l’usage des débutants qui sont rassurés par les textes détaillés qui prennent le temps de tout expliquer. Partie 4.</title>
		<link>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-4/</link>
		<comments>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-4/#comments</comments>
		<pubDate>Sun, 03 Feb 2013 11:04:56 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[heritage]]></category>
		<category><![CDATA[poo]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=4395</guid>
		<description><![CDATA[Aujourd'hui nous allons voir ce qui fait toute la puissance de la programmation orientée objet : l'héritage.]]></description>
			<content:encoded><![CDATA[<p>Un peu de zik, puisque c&#8217;est ce qu&#8217;on fait maintenant :</p>

<!-- iframe plugin v:2.3 - wordpress.org/extend/plugins/iframe/ -->
<iframe width="420" height="315" src="http://www.youtube.com/embed/5DeOSLNbhfg" frameborder="0" scrolling="no" class="iframe-class"></iframe>
<p>Prérequis :</p>
<ul>
<li>Avoir lu (et compris) la <a href="http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-3/">partie 3</a></li>
</ul>
<p>Aujourd&#8217;hui nous allons voir ce qui fait toute la puissance de la programmation orientée objet : l&#8217;héritage.</p>
<h2>Héritage simple</h2>
<p>L&#8217;héritage est un moyen de factoriser du code, c&#8217;est à dire que si on a le même code à deux endroits, l&#8217;héritage permet de centraliser ce code à un seul endroit. Ce n&#8217;est pas le seul moyen de faire ça. On peut très bien factoriser du code uniquement avec des fonctions. Néanmoins l&#8217;héritage a des caractéristiques qui rendent la factorisation très efficace.</p>
<p>Supposons que vous fassiez un jeu vidéo pour apprendre les prières chrétiennes, et que vous ayez une classe par prière :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> AveMaria:
&nbsp;
&nbsp;
    texte = <span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Je vous salue, Marie pleine de grâce ;&quot;</span>,
            <span style="color: #483d8b;">&quot;Le Seigneur est avec vous.&quot;</span>,
            <span style="color: #483d8b;">&quot;Vous êtes bénie entre toutes les femmes&quot;</span>,
            <span style="color: #483d8b;">&quot;Et Jésus, le fruit de vos entrailles, est béni.&quot;</span>,
            <span style="color: #483d8b;">&quot;Sainte Marie, Mère de Dieu,&quot;</span>,
            <span style="color: #483d8b;">&quot;Priez pour nous, pauvres pécheurs,&quot;</span>,
            <span style="color: #483d8b;">&quot;Maintenant, et à l'heure de notre mort.&quot;</span>,
            <span style="color: #483d8b;">&quot;Amen.&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> prier<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, nombre_de_fois=<span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">xrange</span><span style="color: black;">&#40;</span>nombre_de_fois<span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">for</span> ligne <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">self</span>.<span style="color: black;">texte</span>:
                <span style="color: #ff7700;font-weight:bold;">print</span> ligne
&nbsp;
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> PaterNoster:
&nbsp;
&nbsp;
    texte = <span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Notre Père qui es aux cieux&quot;</span>,
            <span style="color: #483d8b;">&quot;que ton nom soit sanctifié&quot;</span>,
            <span style="color: #483d8b;">&quot;que ton règne vienne,&quot;</span>,
            <span style="color: #483d8b;">&quot;que ta volonté soit faite&quot;</span>,
            <span style="color: #483d8b;">&quot;sur la terre comme au ciel.&quot;</span>,
            <span style="color: #483d8b;">&quot;Donne-nous aujourd’hui&quot;</span>,
            <span style="color: #483d8b;">&quot;notre pain de ce jour,&quot;</span>,
            <span style="color: #483d8b;">&quot;pardonne-nous nos offenses&quot;</span>,
            <span style="color: #483d8b;">&quot;comme nous pardonnons aussi&quot;</span>,
            <span style="color: #483d8b;">&quot;à ceux qui nous ont offensés&quot;</span>,
            <span style="color: #483d8b;">&quot;et ne nous soumets pas à la tentation&quot;</span>,
            <span style="color: #483d8b;">&quot;mais délivre-nous du mal.&quot;</span>,
            <span style="color: #483d8b;">&quot;Amen&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> prier<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, nombre_de_fois=<span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">xrange</span><span style="color: black;">&#40;</span>nombre_de_fois<span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">for</span> ligne <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">self</span>.<span style="color: black;">texte</span>:
                <span style="color: #ff7700;font-weight:bold;">print</span> ligne
&nbsp;
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> piere = AveMaria<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> piere.<span style="color: black;">prier</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
Je vous salue, Marie pleine de grâce <span style="color: #66cc66;">;</span>
Le Seigneur est avec vous.
<span style="color: black;">Vous</span> êtes bénie entre toutes les femmes
Et Jésus, le fruit de vos entrailles, est béni.
<span style="color: black;">Sainte</span> Marie, Mè<span style="color: #dc143c;">re</span> de Dieu,
Priez pour nous, pauvres pécheurs,
Maintenant, et à l<span style="color: #483d8b;">'heure de notre mort.
Amen.</span></pre></div></div>

<p>Ici la méthode <code>prier()</code> est dupliquée. Or, c&#8217;est exactement la même. Il n&#8217;y a pas de raison de l&#8217;écrire deux fois. Nous allons utiliser l&#8217;héritage pour centraliser ce code en créant une classe <code>Priere</code> qui contiendra le code commun à toutes les prières :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Priere:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> prier<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, nombre_de_fois=<span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">xrange</span><span style="color: black;">&#40;</span>nombre_de_fois<span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">for</span> ligne <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">self</span>.<span style="color: black;">texte</span>:
                <span style="color: #ff7700;font-weight:bold;">print</span> ligne</pre></div></div>

<p>Ensuite, nous allons demander à toutes les classes prières d&#8217;hériter de cette classe commune :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> AveMaria<span style="color: black;">&#40;</span>Priere<span style="color: black;">&#41;</span>: <span style="color: #808080; font-style: italic;"># &lt;---- cette syntaxe veut dire 'hérite de Priere'</span>
&nbsp;
    texte = <span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Je vous salue, Marie pleine de grâce ;&quot;</span>,
            <span style="color: #483d8b;">&quot;Le Seigneur est avec vous.&quot;</span>,
            <span style="color: #483d8b;">&quot;Vous êtes bénie entre toutes les femmes&quot;</span>,
            <span style="color: #483d8b;">&quot;Et Jésus, le fruit de vos entrailles, est béni.&quot;</span>,
            <span style="color: #483d8b;">&quot;Sainte Marie, Mère de Dieu,&quot;</span>,
            <span style="color: #483d8b;">&quot;Priez pour nous, pauvres pécheurs,&quot;</span>,
            <span style="color: #483d8b;">&quot;Maintenant, et à l'heure de notre mort.&quot;</span>,
            <span style="color: #483d8b;">&quot;Amen.&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> PaterNoster<span style="color: black;">&#40;</span>Priere<span style="color: black;">&#41;</span>:
&nbsp;
    texte = <span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Notre Père qui es aux cieux&quot;</span>,
            <span style="color: #483d8b;">&quot;que ton nom soit sanctifié&quot;</span>,
            <span style="color: #483d8b;">&quot;que ton règne vienne,&quot;</span>,
            <span style="color: #483d8b;">&quot;que ta volonté soit faite&quot;</span>,
            <span style="color: #483d8b;">&quot;sur la terre comme au ciel.&quot;</span>,
            <span style="color: #483d8b;">&quot;Donne-nous aujourd’hui&quot;</span>,
            <span style="color: #483d8b;">&quot;notre pain de ce jour,&quot;</span>,
            <span style="color: #483d8b;">&quot;pardonne-nous nos offenses&quot;</span>,
            <span style="color: #483d8b;">&quot;comme nous pardonnons aussi&quot;</span>,
            <span style="color: #483d8b;">&quot;à ceux qui nous ont offensés&quot;</span>,
            <span style="color: #483d8b;">&quot;et ne nous soumets pas à la tentation&quot;</span>,
            <span style="color: #483d8b;">&quot;mais délivre-nous du mal.&quot;</span>,
            <span style="color: #483d8b;">&quot;Amen&quot;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>Ici, les classes <code>AveMaria</code> et <code>PaterNoster</code> héritent de la classe <code>Priere</code>. On dit qu&#8217;elles sont les enfants (ou filles) de <code>Priere</code>. Ou que <code>Priere</code> est la classe parente de <code>AveMaria</code> et <code>PaterNoster</code></p>
<p>Notez qu&#8217;on a retiré la méthode <code>prier()</code> de <code>PaterNoster</code> et <code>AveMaria</code>. Malgré cela, ça marche :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> PaterNoster<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">prier</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
Notre Pè<span style="color: #dc143c;">re</span> qui es aux cieux
que ton nom soit sanctifié
que ton règne vienne,
que ta volonté soit faite
sur la terre comme au ciel.
<span style="color: black;">Donne</span>-nous aujourd<span style="color: #483d8b;">'hui
notre pain de ce jour,
pardonne-nous nos offenses
comme nous pardonnons aussi
à ceux qui nous ont offensés
et ne nous soumets pas à la tentation
mais délivre-nous du mal.
Amen</span></pre></div></div>

<p>Cela marche car quand on hérite d&#8217;une classe, le code de cette classe est copié de la classe parente vers la classe enfant. Ainsi, <code>prier()</code> est automatiquement copiée de <code>Priere</code> vers <code>AveMaria</code> et <code>PaterNostre</code>.</p>
<p>Cela marche pour toutes les méthodes, même celles appelées automatiquement. C&#8217;est particulièrement utile avec la méthode <code>__init__</code>:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Priere:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, expiation=<span style="color: #008000;">False</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">expiation</span> = expiation
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> prier<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, nombre_de_fois=<span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">xrange</span><span style="color: black;">&#40;</span>nombre_de_fois<span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">for</span> ligne <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">self</span>.<span style="color: black;">texte</span>:
                <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">expiation</span>:
                    <span style="color: #ff7700;font-weight:bold;">print</span> ligne.<span style="color: black;">upper</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
                <span style="color: #ff7700;font-weight:bold;">else</span>:
                    <span style="color: #ff7700;font-weight:bold;">print</span> ligne</pre></div></div>

<p>On rajoute ici un attribut, et il se retrouve dans la classe enfant (si vous êtes dans un shell, n&#8217;oubliez pas de réécrire aussi la classe <code>AveMaria</code> à chaque fois, même si elle ne change pas):</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> priere = AveMaria<span style="color: black;">&#40;</span>expiation=<span style="color: #008000;">True</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> priere.<span style="color: black;">expiation</span>
<span style="color: #008000;">True</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> priere.<span style="color: black;">prier</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
JE VOUS SALUE, MARIE PLEINE DE GRâCE <span style="color: #66cc66;">;</span>
LE SEIGNEUR EST AVEC VOUS.
<span style="color: black;">VOUS</span> êTES BéNIE ENTRE TOUTES LES FEMMES
ET JéSUS, LE FRUIT DE VOS ENTRAILLES, EST BéNI.
<span style="color: black;">SAINTE</span> MARIE, MèRE DE DIEU,
PRIEZ POUR NOUS, PAUVRES PéCHEURS,
MAINTENANT, ET à L<span style="color: #483d8b;">'HEURE DE NOTRE MORT.
AMEN.</span></pre></div></div>

<p>L&#8217;héritage, c&#8217;est juste cela. Pas la peine de chercher une truc compliqué : le code du parent se retrouve dans celui de l&#8217;enfant. Cela marche pour les méthodes et les attributs.</p>
<h2>Petite appartée sur <code>object</code></h2>
<p>Dans la partie précédente et dans de nombreux codes, vous avez dû voir des classes comme cela :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> MaClass<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>: <span style="color: #808080; font-style: italic;"># wtf is this object stuff ?</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># code</span></pre></div></div>

<p>Il s&#8217;agit bel et bien d&#8217;héritage, <code>object</code> étant un type buil-in en Python au même titre que les string ou les int :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">object</span>
<span style="color: #66cc66;">&lt;</span>type <span style="color: #483d8b;">'object'</span><span style="color: #66cc66;">&gt;</span></pre></div></div>

<p>La raison de cet héritage bizarre est qu&#8217;à partir de Python 2.2, une nouvelle architecture des classes a été introduite qui corrige les problèmes de l&#8217;ancienne. Mais pour garder le code compatible, ces nouvelles classes n&#8217;ont pas été activées par défaut.</p>
<p>Ainsi, même si vous êtes en Python 2.7, quand vous faites :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> MaClass:
&nbsp;
    <span style="color: #808080; font-style: italic;"># code</span></pre></div></div>

<p>Vous utilisez l&#8217;ancien type de classe (old-style class). Pour dire à Python que vous voulez utiliser le nouveau type de classe (new-style class), il faut hériter d&#8217;<code>object</code> :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> MaClass<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #808080; font-style: italic;"># code</span></pre></div></div>

<p><strong>Il n&#8217;y a AUCUN intérêt à utiliser les old-style classes.</strong> Je l&#8217;ai fais en ce début de cours pour éviter d&#8217;introduire la notion d&#8217;héritage trop tôt.</p>
<p>A partir de maintenant, quand vous créez une nouvelle classe qui n&#8217;a pas de parent, faites la TOUJOURS hériter de <code>object</code>.</p>
<p>Des tas de fonctions (par exemple les properties) fonctionnent beaucoup mieux avec les new-style classes. (D&#8217;ailleurs à partir de Python 3, elles sont activées par défaut)</p>
<p>Ainsi, notre classe Priere doit ressembler à ça maintenant :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Priere<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, expiation=<span style="color: #008000;">False</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">expiation</span> = expiation
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> prier<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, nombre_de_fois=<span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">xrange</span><span style="color: black;">&#40;</span>nombre_de_fois<span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">for</span> ligne <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">self</span>.<span style="color: black;">texte</span>:
                <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">expiation</span>:
                    <span style="color: #ff7700;font-weight:bold;">print</span> ligne.<span style="color: black;">upper</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
                <span style="color: #ff7700;font-weight:bold;">else</span>:
                    <span style="color: #ff7700;font-weight:bold;">print</span> ligne</pre></div></div>

<h2>Overriding</h2>
<p>Parfois on veut tout le code du parent dans l&#8217;enfant. Parfois juste une partie. L&#8217;héritage vous permet de réécrire certaines méthodes du parent dans l&#8217;enfant, c&#8217;est ce qu&#8217;on appelle l&#8217;overriding.</p>
<p>Quand vous faites :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Parent<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> truc<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'foo'</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Enfant<span style="color: black;">&#40;</span>Parent<span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">pass</span></pre></div></div>

<p>En fait vous faites en quelque sorte :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Enfant<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> truc<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'foo'</span></pre></div></div>

<p>Si vous faites :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Enfant<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> truc<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'foo'</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> truc<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'bar'</span></pre></div></div>

<p>Vous allez écraser la première méthode avec la deuxième, car elles portent toutes les deux le même nom :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> Enfant<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">truc</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
bar</pre></div></div>

<p>&#8220;Ecraser&#8221; en anglais, se dit &#8220;to override&#8221;. Félicitation, vous venez d&#8217;apprendre l&#8217;overriding ! Ce qu&#8217;on vient de voir plus haut s&#8217;écrit comme ça dans le cadre de l&#8217;héritage :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Parent<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> truc<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'foo'</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Enfant1<span style="color: black;">&#40;</span>Parent<span style="color: black;">&#41;</span>: 
    <span style="color: #ff7700;font-weight:bold;">pass</span> <span style="color: #808080; font-style: italic;"># pas d'overriding</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Enfant2<span style="color: black;">&#40;</span>Parent<span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> truc<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'bar'</span> <span style="color: #808080; font-style: italic;"># overriding !</span>
&nbsp;
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> Enfant1<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">truc</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
foo
<span style="color: #66cc66;">&gt;&gt;&gt;</span> Enfant2<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">truc</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
bar</pre></div></div>

<p><code>Enfant1</code> a tout le code du parent qui est copié. <code>Enfant2</code> aussi, mais il réécrit la méthode, donc sa version de la méthode écrase celle du parent.</p>
<p>Voyons ce que ça donne sur un cas plus concret dans la vie de tous les jours comme les prières chrétiennes (promis je fais les sourates du Coran si je fais un tuto Haskell) :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Priere<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, expiation=<span style="color: #008000;">False</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">expiation</span> = expiation
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> prier<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, nombre_de_fois=<span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">xrange</span><span style="color: black;">&#40;</span>nombre_de_fois<span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">for</span> ligne <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">self</span>.<span style="color: black;">texte</span>:
                <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">expiation</span>:
                    <span style="color: #ff7700;font-weight:bold;">print</span> ligne.<span style="color: black;">upper</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
                <span style="color: #ff7700;font-weight:bold;">else</span>:
                    <span style="color: #ff7700;font-weight:bold;">print</span> ligne
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> PaterNoster<span style="color: black;">&#40;</span>Priere<span style="color: black;">&#41;</span>:
&nbsp;
    texte = <span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Notre Père qui es aux cieux&quot;</span>,
            <span style="color: #483d8b;">&quot;que ton nom soit sanctifié&quot;</span>,
            <span style="color: #483d8b;">&quot;que ton règne vienne,&quot;</span>,
            <span style="color: #483d8b;">&quot;que ta volonté soit faite&quot;</span>,
            <span style="color: #483d8b;">&quot;sur la terre comme au ciel.&quot;</span>,
            <span style="color: #483d8b;">&quot;Donne-nous aujourd’hui&quot;</span>,
            <span style="color: #483d8b;">&quot;notre pain de ce jour,&quot;</span>,
            <span style="color: #483d8b;">&quot;pardonne-nous nos offenses&quot;</span>,
            <span style="color: #483d8b;">&quot;comme nous pardonnons aussi&quot;</span>,
            <span style="color: #483d8b;">&quot;à ceux qui nous ont offensés&quot;</span>,
            <span style="color: #483d8b;">&quot;et ne nous soumets pas à la tentation&quot;</span>,
            <span style="color: #483d8b;">&quot;mais délivre-nous du mal.&quot;</span>,
            <span style="color: #483d8b;">&quot;Amen&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;"># sur avemaria, on veut mettre en avant la version en araméen</span>
<span style="color: #808080; font-style: italic;"># par l'araméen c'est trop cool (ça ressemble au langage des furlings</span>
<span style="color: #808080; font-style: italic;"># dans stargate)</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> AveMaria<span style="color: black;">&#40;</span>Priere<span style="color: black;">&#41;</span>: 
&nbsp;
    vf = <span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Je vous salue, Marie pleine de grâce ;&quot;</span>,
            <span style="color: #483d8b;">&quot;Le Seigneur est avec vous.&quot;</span>,
            <span style="color: #483d8b;">&quot;Vous êtes bénie entre toutes les femmes&quot;</span>,
            <span style="color: #483d8b;">&quot;Et Jésus, le fruit de vos entrailles, est béni.&quot;</span>,
            <span style="color: #483d8b;">&quot;Sainte Marie, Mère de Dieu,&quot;</span>,
            <span style="color: #483d8b;">&quot;Priez pour nous, pauvres pécheurs,&quot;</span>,
            <span style="color: #483d8b;">&quot;Maintenant, et à l'heure de notre mort.&quot;</span>,
            <span style="color: #483d8b;">&quot;Amen.&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
    vo = <span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;ܡܠܝܬ ܛܝܒܘܬܐ&quot;</span>,
          <span style="color: #483d8b;">&quot;ܡܪܢ ܥܡܟܝ&quot;</span>,
          <span style="color: #483d8b;">&quot;ܡܒܪܟܬܐ ܐܢܬܝ ܒܢܫ̈ܐ&quot;</span>,
          <span style="color: #483d8b;">&quot;ܘܡܒܪܟ ܗܘ ܦܐܪܐ ܕܒܟܪܣܟܝ ܡܪܢ ܝܫܘܥ&quot;</span>,
          <span style="color: #483d8b;">&quot;ܐܘ ܩܕܝܫܬܐ ܡܪܝܡ ܝܠܕܬ ܐܠܗܐ&quot;</span>,
          <span style="color: #483d8b;">&quot;ܨܠܝ ܚܠܦܝܢ ܚܛܝ̈ܐ&quot;</span>,
          <span style="color: #483d8b;">&quot;ܗܫܐ ܘܒܫܥܬ ܘܡܘܬܢ&quot;</span>,
          <span style="color: #483d8b;">&quot;ܐܡܝܢ܀&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> prier<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, nombre_de_fois=<span style="color: #ff4500;">1</span>, version=<span style="color: #483d8b;">'vo'</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">xrange</span><span style="color: black;">&#40;</span>nombre_de_fois<span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">for</span> ligne <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">getattr</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, version, <span style="color: #483d8b;">'vo'</span><span style="color: black;">&#41;</span>:
                <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">expiation</span>:
                    <span style="color: #ff7700;font-weight:bold;">print</span> ligne.<span style="color: black;">upper</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
                <span style="color: #ff7700;font-weight:bold;">else</span>:
                    <span style="color: #ff7700;font-weight:bold;">print</span> ligne
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> AveMaria<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">prier</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
ܡܠܝܬ ܛܝܒܘܬܐ
ܡܪܢ ܥܡܟܝ
ܡܒܪܟܬܐ ܐܢܬܝ ܒܢܫ̈ܐ
ܘܡܒܪܟ ܗܘ ܦܐܪܐ ܕܒܟܪܣܟܝ ܡܪܢ ܝܫܘܥ
ܐܘ ܩܕܝܫܬܐ ܡܪܝܡ ܝܠܕܬ ܐܠܗܐ
ܨܠܝ ܚܠܦܝܢ ܚܛܝ̈ܐ
ܗܫܐ ܘܒܫܥܬ ܘܡܘܬܢ
ܐܡܝܢ܀
<span style="color: #66cc66;">&gt;&gt;&gt;</span> AveMaria<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">prier</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">2</span>, <span style="color: #483d8b;">'vf'</span><span style="color: black;">&#41;</span>
Je vous salue, Marie pleine de grâce <span style="color: #66cc66;">;</span>
Le Seigneur est avec vous.
<span style="color: black;">Vous</span> êtes bénie entre toutes les femmes
Et Jésus, le fruit de vos entrailles, est béni.
<span style="color: black;">Sainte</span> Marie, Mè<span style="color: #dc143c;">re</span> de Dieu,
Priez pour nous, pauvres pécheurs,
Maintenant, et à l<span style="color: #483d8b;">'heure de notre mort.
Amen.
Je vous salue, Marie pleine de grâce ;
Le Seigneur est avec vous.
Vous êtes bénie entre toutes les femmes
Et Jésus, le fruit de vos entrailles, est béni.
Sainte Marie, Mère de Dieu,
Priez pour nous, pauvres pécheurs,
Maintenant, et à l'</span>heure de notre mort.
<span style="color: black;">Amen</span>.</pre></div></div>

<p>Ici la classe <code>AveMaria</code> hérite de la classe <code>Priere</code>. Deux méthodes sont copiées de <code>Priere</code> vers <code>AveMaria</code> : <code>__init__</code> et <code>prier()</code>.</p>
<p><code>__init__</code> ne change pas. Donc <code>AveMaria</code> a toujours le <code>__init__</code> de <code>Priere</code>. Par contre, on a overridé <code>prier()</code> dans <code>AveMaria</code>, qui est maintenant un code personnalisé<code>.<br />
</code><br />
Ceci nous permet donc de bénéficier d&#8217;une partie du code en commun (<code>__init__</code>), et de choisir un comportement différent pour d&#8217;autres bout du code (<code>prier()</code>).</p>
<p>La classe <code>PaterNoster</code>, elle, n&#8217;est pas affectée. Elle n&#8217;override rien, et sa méthode <code>prier()</code> est la même que celle de <code>Priere</code>.</p>
<p>Peut-être voulez-vous une exemple plus terre à terre (et moins dans les cieux) :</p>
<p>Prenez la bibliothèque <a href="http://sametmax.com/path-py-plus-en-detail/">path.py</a>, par exemple. Normalement quand on additionne deux strings, ça les concatène. Mais quand on les divise, le comportement par défaut est de lever une erreur.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #483d8b;">'/home/sam'</span> + <span style="color: #483d8b;">'/blog'</span>
<span style="color: #483d8b;">'/home/sam/blog'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #483d8b;">'/home/sam'</span> / <span style="color: #483d8b;">'/blog'</span>
Traceback <span style="color: black;">&#40;</span>most recent call last<span style="color: black;">&#41;</span>:
  File <span style="color: #483d8b;">&quot;&lt;ipython-input-58-8701a4e82b4b&gt;&quot;</span>, line <span style="color: #ff4500;">1</span>, <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #66cc66;">&lt;</span>module<span style="color: #66cc66;">&gt;</span>
    <span style="color: #483d8b;">'/home/sam'</span> / <span style="color: #483d8b;">'/blog'</span>
<span style="color: #008000;">TypeError</span>: unsupported operand <span style="color: #008000;">type</span><span style="color: black;">&#40;</span>s<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">for</span> /: <span style="color: #483d8b;">'str'</span> <span style="color: #ff7700;font-weight:bold;">and</span> <span style="color: #483d8b;">'str'</span></pre></div></div>

<p>Path.py override ce comportement :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">os</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> path<span style="color: black;">&#40;</span><span style="color: #008000;">str</span><span style="color: black;">&#41;</span>: <span style="color: #808080; font-style: italic;"># hé oui, on peut hériter des types de base</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__div__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, other<span style="color: black;">&#41;</span>: <span style="color: #808080; font-style: italic;"># override le comportement face à l'opérateur '/'</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> path<span style="color: black;">&#40;</span><span style="color: #dc143c;">os</span>.<span style="color: black;">path</span>.<span style="color: black;">join</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, other<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
... <span style="color: black;">p</span> = path<span style="color: black;">&#40;</span><span style="color: #483d8b;">'/home/sam'</span><span style="color: black;">&#41;</span>
... <span style="color: #ff7700;font-weight:bold;">print</span> p / <span style="color: #483d8b;">'blog'</span>
/home/sam/blog</pre></div></div>

<p>Ca nous donne une très jolie interface pour la manipulation des chemins d&#8217;accès.</p>
<h2>Polymorphisme et autres diableries</h2>
<p>Comme d&#8217;hab en prog, on adore les mots qui font super hype de la vibes du flex.</p>
<p>Le polymorphisme fait partie de ces termes compliqués qui cachent une notion simple : avoir une API commune qui fait des choses différentes.</p>
<p>Voyez-vous, nos deux classes <code>AveMaria</code> et <code>PaterNoster</code>, sont toutes les deux filles de la même classe parente. Elles se ressemblent donc beaucoup : elles ont des attributs et des méthodes en commun :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> p1 = AveMaria<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> p2 = PaterNoster<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> p1.<span style="color: black;">expiation</span>
<span style="color: #008000;">False</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> p2.<span style="color: black;">expiation</span>
<span style="color: #008000;">False</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> p1.<span style="color: black;">prier</span>
<span style="color: #66cc66;">&lt;</span>bound method AveMaria.<span style="color: black;">prier</span> of <span style="color: #66cc66;">&lt;</span>__main__.<span style="color: black;">AveMaria</span> <span style="color: #008000;">object</span> at 0x20618d0<span style="color: #66cc66;">&gt;&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> p2.<span style="color: black;">prier</span>
<span style="color: #66cc66;">&lt;</span>bound method PaterNoster.<span style="color: black;">prier</span> of <span style="color: #66cc66;">&lt;</span>__main__.<span style="color: black;">PaterNoster</span> <span style="color: #008000;">object</span> at 0x2061c90<span style="color: #66cc66;">&gt;&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> p1.<span style="color: #0000cd;">__init__</span>
<span style="color: #66cc66;">&lt;</span>bound method AveMaria.<span style="color: #0000cd;">__init__</span> of <span style="color: #66cc66;">&lt;</span>__main__.<span style="color: black;">AveMaria</span> <span style="color: #008000;">object</span> at 0x20618d0<span style="color: #66cc66;">&gt;&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> p2.<span style="color: #0000cd;">__init__</span>
<span style="color: #66cc66;">&lt;</span>bound method PaterNoster.<span style="color: #0000cd;">__init__</span> of <span style="color: #66cc66;">&lt;</span>__main__.<span style="color: black;">PaterNoster</span> <span style="color: #008000;">object</span> at 0x2061c90<span style="color: #66cc66;">&gt;&gt;</span></pre></div></div>

<p>Ce sont pourtant des classes différentes (et <code>prier()</code> ne fait pas du tout le même chose), mais elles partagent ce qu&#8217;on appelle une API (une interface), c&#8217;est à dire une manière de les utiliser.</p>
<p>Cette capacité à être utilisé pareil, mais produire un résultat diffférent est ce qu&#8217;on appelle le polymorphisme (et c&#8217;est la base du <a href="https://fr.wikipedia.org/wiki/Duck_typing">duck typing</a>). Concrètement ça veut dire que vous pouvez utiliser les deux classes dans le même contexte, sans vous soucier de si c&#8217;est l&#8217;une ou l&#8217;autre :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> prieres = <span style="color: black;">&#91;</span>AveMaria<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>, AveMaria<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>, PaterNoster<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>, AveMaria<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>, PaterNoster<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> prieres
<span style="color: black;">&#91;</span><span style="color: #66cc66;">&lt;</span>__main__.<span style="color: black;">AveMaria</span> <span style="color: #008000;">object</span> at 0x2061d50<span style="color: #66cc66;">&gt;</span>, <span style="color: #66cc66;">&lt;</span>__main__.<span style="color: black;">AveMaria</span> <span style="color: #008000;">object</span> at 0x2061d90<span style="color: #66cc66;">&gt;</span>, <span style="color: #66cc66;">&lt;</span>__main__.<span style="color: black;">PaterNoster</span> <span style="color: #008000;">object</span> at 0x2061f50<span style="color: #66cc66;">&gt;</span>, <span style="color: #66cc66;">&lt;</span>__main__.<span style="color: black;">AveMaria</span> <span style="color: #008000;">object</span> at 0x2061f90<span style="color: #66cc66;">&gt;</span>, <span style="color: #66cc66;">&lt;</span>__main__.<span style="color: black;">PaterNoster</span> <span style="color: #008000;">object</span> at 0x2061fd0<span style="color: #66cc66;">&gt;</span><span style="color: black;">&#93;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">for</span> priere <span style="color: #ff7700;font-weight:bold;">in</span> prieres: 
...     <span style="color: black;">priere</span>.<span style="color: black;">prier</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># prier une prière, ça se fait pareil</span>
&nbsp;
ܡܠܝܬ ܛܝܒܘܬܐ
ܡܪܢ ܥܡܟܝ
ܡܒܪܟܬܐ ܐܢܬܝ ܒܢܫ̈ܐ
ܘܡܒܪܟ ܗܘ ܦܐܪܐ ܕܒܟܪܣܟܝ ܡܪܢ ܝܫܘܥ
ܐܘ ܩܕܝܫܬܐ ܡܪܝܡ ܝܠܕܬ ܐܠܗܐ
ܨܠܝ ܚܠܦܝܢ ܚܛܝ̈ܐ
ܗܫܐ ܘܒܫܥܬ ܘܡܘܬܢ
ܐܡܝܢ܀
ܡܠܝܬ ܛܝܒܘܬܐ
ܡܪܢ ܥܡܟܝ
ܡܒܪܟܬܐ ܐܢܬܝ ܒܢܫ̈ܐ
ܘܡܒܪܟ ܗܘ ܦܐܪܐ ܕܒܟܪܣܟܝ ܡܪܢ ܝܫܘܥ
ܐܘ ܩܕܝܫܬܐ ܡܪܝܡ ܝܠܕܬ ܐܠܗܐ
ܨܠܝ ܚܠܦܝܢ ܚܛܝ̈ܐ
ܗܫܐ ܘܒܫܥܬ ܘܡܘܬܢ
ܐܡܝܢ܀
Notre Pè<span style="color: #dc143c;">re</span> qui es aux cieux
que ton nom soit sanctifié
que ton règne vienne,
que ta volonté soit faite
sur la terre comme au ciel.
<span style="color: black;">Donne</span>-nous aujourd’hui
notre pain de ce jour,
pardonne-nous nos offenses
comme nous pardonnons aussi
à ceux qui nous ont offensés
et ne nous soumets pas à la tentation
mais délivre-nous du mal.
<span style="color: black;">Amen</span>
ܡܠܝܬ ܛܝܒܘܬܐ
ܡܪܢ ܥܡܟܝ
ܡܒܪܟܬܐ ܐܢܬܝ ܒܢܫ̈ܐ
ܘܡܒܪܟ ܗܘ ܦܐܪܐ ܕܒܟܪܣܟܝ ܡܪܢ ܝܫܘܥ
ܐܘ ܩܕܝܫܬܐ ܡܪܝܡ ܝܠܕܬ ܐܠܗܐ
ܨܠܝ ܚܠܦܝܢ ܚܛܝ̈ܐ
��ܫܐ ܘܒܫܥܬ ܘܡܘܬܢ
ܐܡܝܢ܀
Notre Pè<span style="color: #dc143c;">re</span> qui es aux cieux
que ton nom soit sanctifié
que ton règne vienne,
que ta volonté soit faite
sur la terre comme au ciel.
<span style="color: black;">Donne</span>-nous aujourd’hui
notre pain de ce jour,
pardonne-nous nos offenses
comme nous pardonnons aussi
à ceux qui nous ont offensés
et ne nous soumets pas à la tentation
mais délivre-nous du mal.
<span style="color: black;">Amen</span></pre></div></div>

<p>Le polymorphisme, c&#8217;est donc l&#8217;utilisation de l&#8217;héritage pour faire des choses différentes, mais en proposant la même interface (ensemble de méthodes et d&#8217;attributs) pour le faire. Le polymorphisme s&#8217;étend aussi à la réaction aux opérateurs (+, -, /, or, and, etc), d&#8217;autant qu&#8217;en Python, c&#8217;est implémenté avec les méthodes nommées avec <code>__</code>.</p>
<p>Un dernier point pour les gens qui se demandent ce que veut dire <em>overloader</em>. L&#8217;overload est lié à l&#8217;override et au polymorphisme, mais ce n&#8217;est pas la même chose : elle consiste à overrider plusieurs fois une même méthode avec une signature différente. Il n&#8217;y a pas d&#8217;overload en Python, la notion ne nous concerne donc pas. Si vous voulez en apprendre plus, chopez un tuto Java ou C++.</p>
<h2>Qui est qui</h2>
<p>Avec l&#8217;héritage vient la notion de type. Quand vous créez une classe, vous créez un nouveau type. Quand vous sous-classez, vous créez un sous-type.</p>
<p>C&#8217;est intéressant, car une classe fille, est de son propre type ET du type de son parent (mais l&#8217;inverse n&#8217;est pas vrai).</p>
<p>Avec Python, on vérifie cela avec <code>isinstance()</code> :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">isinstance</span><span style="color: black;">&#40;</span>Priere<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>, Priere<span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># instance de sa propre classe</span>
<span style="color: #008000;">True</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">isinstance</span><span style="color: black;">&#40;</span>Priere<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>, <span style="color: #008000;">str</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># pas l'instance d'une classe quelconque</span>
<span style="color: #008000;">False</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">isinstance</span><span style="color: black;">&#40;</span>Priere<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>, AveMaria<span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># pas l'instance d'un enfant</span>
<span style="color: #008000;">False</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">isinstance</span><span style="color: black;">&#40;</span>AveMaria<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>, AveMaria<span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># instance de sa propre classe</span>
<span style="color: #008000;">True</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">isinstance</span><span style="color: black;">&#40;</span>AveMaria<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>, Priere<span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># instance de sa classe parente</span>
<span style="color: #008000;">True</span></pre></div></div>

<p>C&#8217;est utile, car certains comportements sont basés sur le type. Le plus important étant le mécanisme des exceptions. Un <code>try</code> / <code>except</code> arrêtera l&#8217;exception demandée, <strong>ou du même type</strong>.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> MonExceptionPerso<span style="color: black;">&#40;</span><span style="color: #008000;">Exception</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">pass</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> FillesDeMonExceptionPerso<span style="color: black;">&#40;</span>MonExceptionPerso<span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">pass</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">try</span>:
    <span style="color: #ff7700;font-weight:bold;">raise</span> MonExceptionPerso<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Alerte ! Alerte !'</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">except</span> MonExceptionPerso:
    <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'Exception arrêtée'</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">try</span>:
    <span style="color: #ff7700;font-weight:bold;">raise</span> FillesDeMonExceptionPerso<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Alerte ! Alerte !'</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">except</span> FillesDeMonExceptionPerso:
    <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'Exception arrêtée'</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">try</span>:
    <span style="color: #ff7700;font-weight:bold;">raise</span> FillesDeMonExceptionPerso<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Alerte ! Alerte !'</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">except</span> MonExceptionPerso:
    <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'Exception arrêtée'</span>    
&nbsp;
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">try</span>:
    <span style="color: #ff7700;font-weight:bold;">raise</span> MonExceptionPerso<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Alerte ! Alerte !'</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">except</span> FillesDeMonExceptionPerso:
    <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'Exception arrêtée'</span>    
&nbsp;
&nbsp;
<span style="color: #008000;">Exception</span> arrêtée
<span style="color: #008000;">Exception</span> arrêtée
<span style="color: #008000;">Exception</span> arrêtée
Traceback <span style="color: black;">&#40;</span>most recent call last<span style="color: black;">&#41;</span>:
  File <span style="color: #483d8b;">&quot;&lt;ipython-input-67-7e7aec1e78c9&gt;&quot;</span>, line <span style="color: #ff4500;">21</span>, <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #66cc66;">&lt;</span>module<span style="color: #66cc66;">&gt;</span>
    <span style="color: #ff7700;font-weight:bold;">raise</span> MonExceptionPerso<span style="color: black;">&#40;</span><span style="color: #483d8b;">'Alerte ! Alerte !'</span><span style="color: black;">&#41;</span>
MonExceptionPerso: Alerte <span style="color: #66cc66;">!</span> Alerte <span style="color: #66cc66;">!</span></pre></div></div>

<p><code>MonExceptionPerso</code> est de type <code>MonExceptionPerso</code>, donc l&#8217;exception est arrêtée. <code>FillesDeMonExceptionPerso</code> est de type <code>FillesDeMonExceptionPerso</code>, donc l&#8217;exception est arrêtée. <code>FillesDeMonExceptionPerso</code>, qui hérite de <code>MonExceptionPerso</code>, et donc de type <code>MonExceptionPerso</code> est arrêtée.</p>
<p>En revanche, <code>MonExceptionPerso</code> n&#8217;est PAS de type <code>FillesDeMonExceptionPerso</code>. Donc elle n&#8217;est pas arrêtée.</p>
<p>Je le signale car il est très courant de faire des enfants de <code>ValueError</code>, <code>IOError</code>, <code>IndexError</code>, <code>KeyError</code>, etc. et de le lever dans son propre programme. Cela permet à l&#8217;utilisateur de son code de pouvoir attraper soit toutes les erreurs de son code en faisant un <code>except</code> sur l&#8217;enfant, soit attraper toutes les erreurs de type <code>ValueError</code>, <code>IOError</code>, <code>IndexError</code>, <code>KeyError</code> en faisant le <code>except</code> sur le parent. On laisse ainsi une marge de manoeuvre dans la gestion des erreurs.</p>
<h2>Appeler la méthode de la classe parent</h2>
<p>Bon, vous avez overridé une méthode du parent. Mais c&#8217;est une groooooooooooooossse méthode. Vous allez pas la réécrire en entier, si ?</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Escorte<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> calculer_prix<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, heures, tarif<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> heures <span style="color: #66cc66;">*</span> tarif
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> EscorteDeLuxe<span style="color: black;">&#40;</span>Escorte<span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> calculer_prix<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, heures, tarif, supplement<span style="color: black;">&#41;</span>:
&nbsp;
        tarif =  heures <span style="color: #66cc66;">*</span> tarif
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> tarif + <span style="color: black;">&#40;</span>tarif <span style="color: #66cc66;">*</span> supplement / <span style="color: #ff4500;">100</span><span style="color: black;">&#41;</span></pre></div></div>

<p>Sur cet exemple éminement intellectuel, <code>calculer_prix()</code> est simple, donc tout réécrire dans <code>EscorteDeLuxe</code> n&#8217;est pas grave. Mais si c&#8217;était une <code>Geisha</code>, hein ? Avec un manuel en Japonais ? </p>
<p>Pour éviter ces problèmes de complexité liés à la globalisation, le perméabilisation des frontières et les sites de streaming, on peut appeler la méthode du parent, dans l&#8217;enfant, en utilisant <code>super()</code>:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> EscorteDeLuxe<span style="color: black;">&#40;</span>Escorte<span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> calculer_prix<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, heures, tarif, supplement<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #808080; font-style: italic;"># ceci est une manière compliquée de faire Escorte.calculer_prix</span>
        <span style="color: #808080; font-style: italic;"># et de récupérer le résultat</span>
        tarif =  <span style="color: #008000;">super</span><span style="color: black;">&#40;</span>EscorteDeLuxe, <span style="color: #008000;">self</span><span style="color: black;">&#41;</span>.<span style="color: black;">calculer_prix</span><span style="color: black;">&#40;</span>heures, tarif<span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> tarif + <span style="color: black;">&#40;</span>tarif <span style="color: #66cc66;">*</span> supplement / <span style="color: #ff4500;">100</span><span style="color: black;">&#41;</span></pre></div></div>

<p>C&#8217;est exactement la même chose que plus haut. Sauf qu&#8217;au lieu de copier / coller le code du parent, on l&#8217;appelle directement.</p>
<p>Je résume :</p>
<ul>
<li>on hérite du parent, et de son code</li>
<li>on override son code, car on veut un comportement différent</li>
<li>mais on veut quand même une partie du comportement du parent</li>
<li>donc dans la méthode de l&#8217;enfant, on appelle la méthode du parent</li>
</ul>
<p>Je réformule : quand vous overridez la méthode du parent dans l&#8217;enfant, celle du parent ne disparait pas. Elle est remplacée uniquement dans l&#8217;enfant. Et vous pouvez toujours vous servir de la version du parent en utilisant <code>super(ClassEncours, self).nom_de_method(arguments)</code> si vous en avez besoin.</p>
<p>Bon, c&#8217;était un gros morceau, et je suis pas sûr de pas être allé trop fort. Donc laissez en comment les remarques sur ce qui pourrait être mieux expliqué. <a href="http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-5/">La prochaine fois</a>, on verra des usages poussés comme la composition, la délégation et tous ces trucs d&#8217;un vrai code de production.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=4395&amp;md5=33e7f91a7702e831e3c29bbb80c7f910" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-4/feed/</wfw:commentRss>
		<slash:comments>17</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fle-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-4%2F&amp;language=en_GB&amp;category=text&amp;title=Le+guide+ultime+et+d%C3%A9finitif+sur+la+programmation+orient%C3%A9e+objet+en+Python+%C3%A0+l%E2%80%99usage+des+d%C3%A9butants+qui+sont+rassur%C3%A9s+par+les+textes+d%C3%A9taill%C3%A9s+qui+prennent+le+temps+de+tout+expliquer.+Partie+4.&amp;description=Un+peu+de+zik%2C+puisque+c%26%238217%3Best+ce+qu%26%238217%3Bon+fait+maintenant+%3A+Pr%C3%A9requis+%3A+Avoir+lu+%28et+compris%29+la+partie+3+Aujourd%26%238217%3Bhui+nous+allons+voir+ce+qui+fait+toute+la+puissance...&amp;tags=heritage%2Cpoo%2Cpython%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/02/image01.jpg" length="43410" type="image/jpg" />	</item>
		<item>
		<title>Modèles Django et classes abstraites</title>
		<link>http://sametmax.com/modeles-django-et-classes-abstraites/</link>
		<comments>http://sametmax.com/modeles-django-et-classes-abstraites/#comments</comments>
		<pubDate>Fri, 01 Feb 2013 12:40:23 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[abstract class]]></category>
		<category><![CDATA[django]]></category>
		<category><![CDATA[model]]></category>
		<category><![CDATA[orm]]></category>
		<category><![CDATA[poo]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=4361</guid>
		<description><![CDATA[<strong>Je suis le génie de la l'ANPE. Enigma, tu m'as trouvé, et tu as le droit à 3 voeux.</strong>]]></description>
			<content:encoded><![CDATA[<blockquote><p>    Bonjour Sam &#038; Max,</p></blockquote>
<p><strong>Je suis le génie de la l&#8217;ANPE. Enigma, tu m&#8217;as trouvé, et tu as le droit à 3 voeux.</strong></p>
<blockquote><p>    J&#8217;ai bien aimé votre blog consacré a dynamiser la communauté francophone python et je voudrais vous poser une petite question.<br />
    En fait, Quand il s&#8217;agit d&#8217;écrire un modèle, ce dernier doit hériter de la classe models.Model</p>
<p>    par exemple:<br />
    class Entry(models.Model):</p>
<p>    je me demande pourquoi exactement models.Model ?<br />
    et pourquoi ne pas faire l&#8217;héritage directement comme ça:<br />
    class Entry(Model)</p></blockquote>
<p><strong><br />
Une explication de la syntaxe d&#8217;héritage des modèles Django ? Qu&#8217;il en soit ainsi.</strong></p>
<p>On peut faire les deux. C&#8217;est une question d&#8217;import.</p>
<p>Si tu fais:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">from</span> django <span style="color: #ff7700;font-weight:bold;">import</span> models</pre></div></div>

<p>Tu importes le module <code>models</code>.</p>
<p>Alors si tu veux hériter de la classe <code>Model</code> du module <code>models</code>, tu dois préfixer la classe du module (c&#8217;est ce qu&#8217;on appelle un namespace) : <code>class Entry(models.Model)</code>.</p>
<p>Si par contre tu fais :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">from</span> django.<span style="color: black;">models</span> <span style="color: #ff7700;font-weight:bold;">import</span> Model</pre></div></div>

<p>Tu importes la classe <code>Model</code>. Tu peux donc l&#8217;utiliser directement : <code>class Entry(Model)</code></p>
<p>Le choix entre l&#8217;un et l&#8217;autre est essentiellement une question de style. En Django, pour les modèles on utilise <code>from django import models</code> car on va généralement également utiliser beaucoup de champs (<code>models.IntegerField</code>, <code>models.BooleanField</code>, etc) et que ça évite de tous les importer.</p>
<blockquote><p>Aussi, je voudrais savoir qu&#8217;est ce qu&#8217;une Abstract base class ? ( car je sais que c&#8217;est un peu ça mais j&#8217;arrive pas à faire le lien )</p></blockquote>
<p><strong><br />
Je ne peux pas faire tomber amoureux, ressusciter les morts ni faire des classes abstraites en Python. Mais je peux t&#8217;expliquer pourquoi. Accordé !</strong></p>
<p>Une Abstract Base Class n&#8217;existe pas vraiment en Python. Il y a bien un module <a href="http://docs.python.org/2/library/abc.html?highlight=abc#abc">abc</a> pour les simuler en utilisant des metaclasses, mais il est peu probable que tu en aies jamais besoin.</p>
<p>Dans d&#8217;autres langages, les classes abstraites sont des classes &#8220;à trou&#8221;. C&#8217;est à dire qu&#8217;elles ne sont pas complètes. On en hérite pour récupérer une partie de leur comportement, et on écrit le reste. </p>
<p>Imagine une classe <code>Vehicule</code>, qui sert de classe de base à une classe <code>Voiture</code> et une classe <code>Moto</code> :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Vehicule<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span>carburant<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">carburant</span> = carburant</pre></div></div>

<p>Ceci est une classe abstraite. Elle possède des éléments communs à tous les véhicules, mais ne sait pas rouler. Chaque enfant doit implémenter la méthode <code>rouler()</code> :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Moto<span style="color: black;">&#40;</span>Vehicule<span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> rouler<span style="color: black;">&#40;</span>km<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">carburant</span> -= km <span style="color: #66cc66;">*</span> <span style="color: #ff4500;">3</span>
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'Brrrrrrrrrrrrrrrrrr'</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Voiture<span style="color: black;">&#40;</span>Vehicule<span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> rouler<span style="color: black;">&#40;</span>km<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">carburant</span> -= km <span style="color: #66cc66;">*</span> <span style="color: #ff4500;">7</span>
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'Vrouuuuuuum'</span></pre></div></div>

<p>Une classe abstraite est donc une classe incomplète, utile pour rassembler du code commun aux autres classes, <strong>mais qui ne marche pas d&#8217;elle même.</strong></p>
<p>Dans d&#8217;autres langages, ce concept est formalisé par des mots clés, et des vérifications. Pas en Python : toutes les classes sont égales.</p>
<p>Maintenant le concept des classes abstraites dans Django est une application particulière. Je pense que tu poses la question parce que tu as vu ça :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Vehicule<span style="color: black;">&#40;</span>models.<span style="color: black;">Model</span><span style="color: black;">&#41;</span>:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">class</span> Meta:
&nbsp;
        abstract = <span style="color: #008000;">True</span></pre></div></div>

<p>Dans ce cas particulier, le principe est le même que plus haut, mais appliqué aux models.</p>
<p>L&#8217;ORM de django crée en base de donnée une table par classe qui hérite de <code>models.Model</code>. Ce n&#8217;est pas ce que tu veux pour <code>Vehicule</code> : <code>Vehicule</code> ne marche pas par elle même, aucun intérêt de créer une table pour elle.</p>
<p>Ainsi Django le formalise l&#8217;aspect &#8220;abstrait&#8221; avec un attribut. Si l&#8217;attribut <code>abstract</code> est sur <code>True</code>, Django ne créera pas de table en base de donnée pour ce modèle, car il sait que c&#8217;est une classe abstraite, et qui donc n&#8217;est pas destinée à être utilisée directement. Tous les attributs  du modèle <code>Vehicule</code> qui correspondent à des champs seront copiés dans les enfants, et seront des champs de leurs tables respectives.</p>
<blockquote><p>Je vous remercie d&#8217;avance, et j&#8217;aimerais bien si c&#8217;est possible que la réponse soit comme le prochain sujet comme ça tout le monde en profite. </p></blockquote>
<p><strong><br />
Tes désirs sont des ordres, maître.<br />
</strong><br />
(Comme d&#8217;hab, personne ne fait le v&oelig;u de libérer le génie, hein, bande de connards !)</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=4361&amp;md5=f4d60eab3da6f62f6b65c43480e36fa5" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/modeles-django-et-classes-abstraites/feed/</wfw:commentRss>
		<slash:comments>16</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fmodeles-django-et-classes-abstraites%2F&amp;language=en_GB&amp;category=text&amp;title=Mod%C3%A8les+Django+et+classes+abstraites&amp;description=Bonjour+Sam+%26%23038%3B+Max%2C+Je+suis+le+g%C3%A9nie+de+la+l%26%238217%3BANPE.+Enigma%2C+tu+m%26%238217%3Bas+trouv%C3%A9%2C+et+tu+as+le+droit+%C3%A0+3+voeux.+J%26%238217%3Bai+bien+aim%C3%A9+votre+blog+consacr%C3%A9+a...&amp;tags=abstract+class%2Cdjango%2Cmodel%2Corm%2Cpoo%2Cpython%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/02/genie.jpg" length="28719" type="image/jpg" />	</item>
		<item>
		<title>Le guide ultime et définitif sur la programmation orientée objet en Python à l’usage des débutants qui sont rassurés par les textes détaillés qui prennent le temps de tout expliquer. Partie 3.</title>
		<link>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-3/</link>
		<comments>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-3/#comments</comments>
		<pubDate>Sun, 27 Jan 2013 06:59:49 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[attributs]]></category>
		<category><![CDATA[classes]]></category>
		<category><![CDATA[poo]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=4292</guid>
		<description><![CDATA[Nous avons vu les attributs de classe et les propriétés, mais de manière très rudimentaire. Il y a beaucoup de choses à savoir sur la question.]]></description>
			<content:encoded><![CDATA[<p>Prérequis :</p>
<ul>
<li>Avoir lu la <a href="http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-2/">partie 2</a></li>
<li>Comprendre la notion de <a href="http://sametmax.com/valeurs-et-references-en-python/">référence</a>.</li>
</ul>
<p>Nous avons vu les attributs de classe et les propriétés, mais de manière très rudimentaire. Il y a beaucoup de choses à savoir sur la question.</p>
<h2>Attribut de classe, la totale</h2>
<p>Nous avons vu qu&#8217;un attribut de classe était accessible par la classe, sans instance :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">class</span> TrueLies:
...
...         <span style="color: black;">attribut_de_classe</span> = <span style="color: #483d8b;">'valeur'</span>
...
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span> TrueLies.<span style="color: black;">attribut_de_classe</span>
valeur</pre></div></div>

<p>Mais également par une instance :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span> TrueLies<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">attribut_de_classe</span>
valeur</pre></div></div>

<p>C&#8217;est simple et direct. Il n&#8217;y a pas de <code>public static virtuel neconceptuel</code> à mettre devant comme dans certains langages trop cafféinés.</p>
<p>Ce qu&#8217;on a pas vu par contre, c&#8217;est ce qui arrive si on modifie la valeur de ces attributs.</p>
<p>Pour faire simple :</p>
<ul>
<li>Si je modifie l&#8217;attribut au niveau de l&#8217;instance, seule l&#8217;instance voit les modifications.</li>
<li>Si je modifie l&#8217;attribut au niveau de la classe, la classe et toutes les instances crées après ont la nouvelle valeur.</li>
</ul>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> instance = TrueLies<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> instance.<span style="color: black;">attribut_de_classe</span> = <span style="color: #483d8b;">'nouvelle valeur'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span> instance.<span style="color: black;">attribut_de_classe</span>
nouvelle valeur
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span> TrueLies.<span style="color: black;">attribut_de_classe</span> <span style="color: #808080; font-style: italic;"># ça ne change rien pour la classe</span>
valeur
<span style="color: #66cc66;">&gt;&gt;&gt;</span> TrueLies.<span style="color: black;">attribut_de_classe</span> = <span style="color: #483d8b;">'encore une nouvelle valeur'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span> TrueLies.<span style="color: black;">attribut_de_classe</span>
encore une nouvelle valeur
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span> instance.<span style="color: black;">attribut_de_classe</span> <span style="color: #808080; font-style: italic;"># ça ne change rien pour cette instance</span>
nouvelle valeur
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span> TrueLies<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">attribut_de_classe</span> <span style="color: #808080; font-style: italic;"># mais pour une nouvelle oui</span>
encore une nouvelle valeur</pre></div></div>

<p>Comme <code>self</code> est l&#8217;instance en cours, vous pouvez remplacer <code>instance</code> par <code>self</code> dans l&#8217;exemple ci-dessus (dans une méthode bien sûr, pas dans le shell), ça marche pareil.</p>
<p>Vu comme ça, ça à l&#8217;air d&#8217;être super pour donner une valeur par défaut à des attributs.</p>
<p>C&#8217;est une mauvaise idée.</p>
<p>En effet, les attributs de classes sont initialisés une seule fois, à la première lecture du code par Python. Pour les objets immutables comme les strings ou les int, on s&#8217;en branle. Mais pour les objets mutables comme les dicos ou les listes, c&#8217;est la merde.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">class</span> TrueLies:
...
...         <span style="color: black;">attribut_de_classe</span> = <span style="color: black;">&#91;</span><span style="color: black;">&#93;</span> <span style="color: #808080; font-style: italic;"># mettons une liste ici</span>
...
...
<span style="color: #66cc66;">&gt;&gt;&gt;</span> flim_qui_vole_le_travail_des_francais = TrueLies<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> etranger_qui_vole_le_travail_des_francais = TrueLies<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>On a donc deux instances de <code>TrueLies</code>. A priori, on a aussi deux valeurs de <code>attribut_de_classe</code>, une pour chaque instance ?</p>
<div id="attachment_4294" class="wp-caption aligncenter" style="width: 360px"><a href="http://sametmax.com/wp-content/uploads/2013/01/Norman350.jpg"><img src="http://sametmax.com/wp-content/uploads/2013/01/Norman350.jpg" alt="Des faux seins sur un FAUX de norman fait des vidéos" title="Norman va bientôt faire un film avec les robins des bois au fait" width="350" height="248" class="size-full wp-image-4294" /></a><p class="wp-caption-text">Norman va bientôt faire un film avec les robins des bois au fait</p></div>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">id</span><span style="color: black;">&#40;</span>flim_qui_vole_le_travail_des_francais.<span style="color: black;">attribut_de_classe</span><span style="color: black;">&#41;</span>
<span style="color: #ff4500;">28992072</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">id</span><span style="color: black;">&#40;</span>flim_pas_sur_le_cyclimse.<span style="color: black;">attribut_de_classe</span><span style="color: black;">&#41;</span>
<span style="color: #ff4500;">28992072</span></pre></div></div>

<p>Comme vous pouvez le voir c&#8217;est le même id. <code>attribut_de_classe</code> est la même chose, car Python initialise <code>attribut_de_classe</code> une seule fois pour toute la session. Les deux instances ont donc un attribut qui contient une référence (puisque TOUT est référence en Python) qui pointe sur la même liste.</p>
<p>Dans les fait, ça veut dire que si on modifie l&#8217;un, ben forcément la modification est visible de l&#8217;autre côté aussi :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> flim_qui_vole_le_travail_des_francais.<span style="color: black;">attribut_de_classe</span>.<span style="color: black;">append</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> flim_pas_sur_le_cyclimse.<span style="color: black;">attribut_de_classe</span>
<span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span></pre></div></div>

<p>C&#8217;est rarement ce qu&#8217;on veut.</p>
<p>Donc ne donnez pas de valeur par défaut dans les attributs de classe. Faites ça avec <code>__init__</code>:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">class</span> TrueLies:
...
...         <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
...
...                 <span style="color: #008000;">self</span>.<span style="color: black;">attribut_tres_classe</span> = <span style="color: black;">&#91;</span><span style="color: black;">&#93;</span>
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> flim_qui_vole_le_travail_des_francais = TrueLies<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> etranger_qui_vole_le_travail_des_francais = TrueLies<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> flim_pas_sur_le_cyclimse.<span style="color: black;">attribut_tres_classe</span>.<span style="color: black;">append</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> flim_pas_sur_le_cyclimse.<span style="color: black;">attribut_tres_classe</span>
<span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> flim_qui_vole_le_travail_des_francais.<span style="color: black;">attribut_tres_classe</span>
<span style="color: black;">&#91;</span><span style="color: black;">&#93;</span></pre></div></div>

<p>Le comportement attendu est le bon ici.</p>
<h2>Ok, mais alors ils servent à quoi ces attributs à deux cents, là, cousin ?</h2>
<p>- Et ben wesh, tu vois, ils servent à stocker les constantes et le cache.</p>
<p>- Ouais quand j&#8217;ai constamment du stock j&#8217;ai du cash, man.</p>
<p>- héééééééééééé&#8230; xactement.</p>
<p>Donc, d&#8217;abord, on met les pseudo constantes en attributs de classe. Je dis pseudo car il n&#8217;existe pas de constantes en Python. On parle de constante quand une variable est écrite toute en majuscule, une convention pour dire &#8220;le programme ne change jamais la valeur de cette variable (et t&#8217;as pas intérêt à la changer, pigé ?)&#8221;.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> TrueLies:
&nbsp;
    NOMBRE_DE_BALLES_DANS_LE_CHARGEUR = <span style="color: #ff4500;">10000</span></pre></div></div>

<p>On peut être certain que Schwarzy ne recharge jamais (y a que Thierry Lhermitte qui ferait un truc aussi ringard). Donc le nombre de balles dans le chargeur ne varie pas. On le met comme attribut de classe. C&#8217;est essentiellement à titre informatif. Pour nous ça change rien, mais pour quelqu&#8217;un qui va utiliser le code, il sait qu&#8217;il peut chercher toutes les constantes liées à <code>TrueLies</code> en faisant <code>TrueLies.LES_TRUCS_EN_MAJUSCULES</code>.</p>
<p>C&#8217;est l&#8217;usage le plus courant.</p>
<p>On peut aussi utiliser les attributs de classes pour créer une API déclarative, comme le fait <a href="https://docs.djangoproject.com/en/dev/topics/db/models/">l&#8217;ORM de Django</a>. Mais bon, c&#8217;est mega advanced, donc je mets de côté le how to. Le jour où vous coderez un truc comme ça, vous lirez pas un article pour débutant.</p>
<p>Enfin on peut utiliser les attributs de classe pour partager des données entre les instances. Par exemple du cache.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> TrueFalseSomeWhatLiesMaybeWhoKnows :
&nbsp;
    _cache = <span style="color: black;">&#123;</span><span style="color: black;">&#125;</span>
&nbsp;
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> calculer_le_nombre_de_balles_a_la_seconde<span style="color: black;">&#40;</span>scene<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #808080; font-style: italic;"># si y a rien dans le cache, on fait le calcul et on le met dans le cache</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> scene <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">self</span>._cache :
&nbsp;
            <span style="color: #008000;">self</span>._cache<span style="color: black;">&#91;</span>scene<span style="color: black;">&#93;</span> = <span style="color: #808080; font-style: italic;"># mettre un calcul bien compliqué ici</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># on retourne le contenu du cache</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._cache<span style="color: black;">&#91;</span>scene<span style="color: black;">&#93;</span>
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> TrueFalseSomeWhatLiesMaybeWhoKnows<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">calculer_le_nombre_de_balles_a_la_seconde</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>
<span style="color: #ff4500;">56586586</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> TrueFalseSomeWhatLiesMaybeWhoKnows<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">calculer_le_nombre_de_balles_a_la_seconde</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>
<span style="color: #ff4500;">56586586</span></pre></div></div>

<p>Le premier appel va faire le calcul. Mais pas le second, car le résultat a été stocké dans le dictionnaire qui est au niveau de la classe (et donc chaque nouvelle instance a une référence vers ce dictionnaire) et peut donc être réutilisé.</p>
<p>Vous noterez qu&#8217;on a appelé la variable <code>_cache</code> et pas <code>cache</code>. C&#8217;est encore une convention. Ça signifie, &#8220;cette variable est utilisée en interne, t&#8217;as pas à savoir ce qu&#8217;elle fait, imagine que c&#8217;est privé. Circulez, y a rien à voir.&#8221; Les outils de complétion de code masquent ces variables par défaut.</p>
<p>Pour la culture, sachez que nommer ses variables <code>__nom</code> les rend &#8220;privées&#8221; en Python. Néanmoins cette fonctionnalité est facilement contournable, et très peu appréciée dans la communauté, donc évitez-la.</p>
<h2>Et puis il y a les méthodes statiques aussi</h2>
<p>On a vu les méthodes de classe, qui sont, comme les attributs de classe, des méthodes qui n&#8217;ont pas besoin d&#8217;instance pour être appelées :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> ArmeeDesDouzeSinges:
    <span style="color: #483d8b;">&quot;&quot;&quot;
        Ouais c'est un remake d'un film français aussi.
        Ça vous la coupe hein ?
    &quot;&quot;&quot;</span>
&nbsp;
    SINGES = <span style="color: #ff4500;">12</span>
&nbsp;
    @<span style="color: #008000;">classmethod</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> nombre_de_singes_au_carre<span style="color: black;">&#40;</span>cls<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> cls.<span style="color: black;">SINGES</span> <span style="color: #66cc66;">*</span> cls.<span style="color: black;">SINGES</span>
&nbsp;
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> ArmeeDesDouzeSinges.<span style="color: black;">nombre_de_singes_au_carre</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #ff4500;">144</span></pre></div></div>

<p>Le premier paramètre n&#8217;est pas l&#8217;objet en cours mais la classe en cours, et c&#8217;est tout ce dont nous avons besoin ici pour accéder à <code>SINGES</code> puisque c&#8217;est un attribut de classe.</p>
<p>Cet exemple est issu d&#8217;un de mes codes réels de productions, vous pouvez en constater l’intérêt évident dans la vie de tous les jours.</p>
<p>Nan je déconne, moi j&#8217;utilise plutôt des dromadaires au quotidien.</p>
<p>Bon, mais sachez plus sérieusement qu&#8217;il y a en prime des méthodes de classe, des méthodes statiques. C&#8217;est la même chose, mais aucun paramètre n&#8217;est passé automatiquement.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> LHommeALaChaussureRouge:
    <span style="color: #483d8b;">&quot;&quot;&quot;
        Oui c'est exactement ce que vous pensez. C'est affligeant.
    &quot;&quot;&quot;</span>
&nbsp;
    @<span style="color: #008000;">staticmethod</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> crie_son_desespoir<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>: <span style="color: #808080; font-style: italic;"># pas de cls</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;Nooooooooooooooooooooooooooooooooon&quot;</span>
&nbsp;
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> LHommeALaChaussureRouge.<span style="color: black;">crie_son_desespoir</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
Nooooooooooooooooooooooooooooooooon</pre></div></div>

<p>Alors là on arrive dans la feature anecdotique hein, du genre qu&#8217;on sort qu&#8217;au repas de Noël. Je la mets au menu juste pour que vous sachiez que ça existe, mais franchement je ne m&#8217;en sers presque jamais.</p>
<p>L&#8217;usage est le même qu&#8217;une méthode de classe, mais pour les trucs qui n&#8217;ont pas besoin d&#8217;avoir accès à la classe en cours.</p>
<p>Bon.</p>
<p>Bref, c&#8217;est juste une fonction préfixée. Avantage : elle est un poil plus rapide que la méthode de classe, et elle est mieux rangée qu&#8217;une simple fonction. Mais c&#8217;est vraiment tout.</p>
<h2>Retour sur les properties</h2>
<p>Si vous avez bonne mémoire, vous vous souviendrez qu&#8217;une propriété est juste un déguisement qu&#8217;on met sur une méthode pour qu&#8217;elle ressemble à un attribut :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> LesVisiteursEnAmerique:
    <span style="color: #483d8b;">&quot;&quot;&quot;
        Mais si, mais si...
    &quot;&quot;&quot;</span>
&nbsp;
    @<span style="color: #008000;">property</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> replique<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #483d8b;">'okay'</span>
&nbsp;
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> film_pourri = LesVisiteursEnAmerique<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> film_pourri.<span style="color: black;">replique</span>
<span style="color: #483d8b;">'okay'</span></pre></div></div>

<p>Mais on peut aller plus loin que la lecture. On peut aussi décorer l&#8217;écriture et la suppression !</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> LesVisiteursEnAmerique<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>: <span style="color: #808080; font-style: italic;"># on rajoute (object) truc ici</span>
&nbsp;
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>._replique = <span style="color: #483d8b;">'okay'</span> <span style="color: #808080; font-style: italic;"># c'est privé, pas touche, y a un underscore</span>
&nbsp;
&nbsp;
    @<span style="color: #008000;">property</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> replique<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'get'</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._replique
&nbsp;
&nbsp;
    @replique.<span style="color: black;">setter</span> <span style="color: #808080; font-style: italic;"># le décorateur a le même nom que la méthode</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> replique<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, value<span style="color: black;">&#41;</span>: <span style="color: #808080; font-style: italic;"># value est la valeur à droite du '=' quand on set</span>
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'set to {}'</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span>value<span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>._replique = value
&nbsp;
&nbsp;
    @replique.<span style="color: black;">deleter</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> replique<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'delete'</span>
        <span style="color: #008000;">self</span>._replique = <span style="color: #008000;">None</span>
&nbsp;
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> film_pourri = LesVisiteursEnAmerique<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> film_pourri.<span style="color: black;">replique</span>
get
<span style="color: #483d8b;">'okay'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> film_pourri.<span style="color: black;">replique</span> = <span style="color: #483d8b;">'zarma'</span>
<span style="color: #008000;">set</span> to zarma
<span style="color: #66cc66;">&gt;&gt;&gt;</span> film_pourri.<span style="color: black;">replique</span>
get
<span style="color: #483d8b;">'zarma'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> film_pourri._replique
<span style="color: #483d8b;">'zarma'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">del</span> film_pourri.<span style="color: black;">replique</span>
delete
<span style="color: #66cc66;">&gt;&gt;&gt;</span> film_pourri.<span style="color: black;">replique</span>
get</pre></div></div>

<p>Et là vous allez me dire :</p>
<p>- c&#8217;est quoi ce (object) là haut là qui est apparu magiquement ?<br />
- et à quoi ça sert ? Nom d&#8217;un remake hollywodien !</p>
<p>À la première question je dirai, réponse dans la prochaine partie. Sachez juste que s&#8217;il y a pas ce <code>(object)</code>, le setter et le deleter ne marchent pas.</p>
<p>Pour la seconde, imaginez un truc un peu plus choupi, comme une réplique garantie d&#8217;être toujours en majuscule :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> LesVisiteursEnAmerique<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
&nbsp;
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>._replique = <span style="color: #483d8b;">'OKAY'</span>
&nbsp;
&nbsp;
    @<span style="color: #008000;">property</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> replique<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._replique
&nbsp;
&nbsp;
    @replique.<span style="color: black;">setter</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> replique<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, value<span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>._replique = value.<span style="color: black;">upper</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># PAF ! on majusculise</span>
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> film_TRES_pourri = LesVisiteursEnAmerique<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> film_TRES_pourri.<span style="color: black;">replique</span>
<span style="color: #483d8b;">'OKAY'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> film_TRES_pourri.<span style="color: black;">replique</span> = <span style="color: #483d8b;">&quot;D'ac&quot;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> film_TRES_pourri.<span style="color: black;">replique</span>
<span style="color: #483d8b;">&quot;D'AC&quot;</span></pre></div></div>

<p>Et voilà le travail.</p>
<p>On peut donc &#8220;intercepter&#8221; la récupération, la suppression et la modification d&#8217;un attribut facilement. Cela permet d&#8217;exposer une belle API à base d&#8217;attribut, mais derrière faire des traitements complexes.</p>
<p>Il suffit de transformer un attribut normal en méthode, et de lui coller @<code>property</code> au cul.</p>
<p>C&#8217;est pour cette raison qu&#8217;on n&#8217;a jamais de getter et de setter en Python : on utilise les attributs tels quel, et si le besoin se présente, on en fait des propriétés.</p>
<p><a href="http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-4/">Next stop</a>, héritage, overriding, polymorphisme et autres gros mots que vous pourrez ressortir aux soirées mousses dans les hackerspaces.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=4292&amp;md5=a1b6d7097ea55753d6cf64a79d13c71f" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-3/feed/</wfw:commentRss>
		<slash:comments>17</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fle-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-3%2F&amp;language=en_GB&amp;category=text&amp;title=Le+guide+ultime+et+d%C3%A9finitif+sur+la+programmation+orient%C3%A9e+objet+en+Python+%C3%A0+l%E2%80%99usage+des+d%C3%A9butants+qui+sont+rassur%C3%A9s+par+les+textes+d%C3%A9taill%C3%A9s+qui+prennent+le+temps+de+tout+expliquer.+Partie+3.&amp;description=Pr%C3%A9requis+%3A+Avoir+lu+la+partie+2+Comprendre+la+notion+de+r%C3%A9f%C3%A9rence.+Nous+avons+vu+les+attributs+de+classe+et+les+propri%C3%A9t%C3%A9s%2C+mais+de+mani%C3%A8re+tr%C3%A8s+rudimentaire.+Il+y+a...&amp;tags=attributs%2Cclasses%2Cpoo%2Cpython%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/01/JoxeA.jpg" length="61374" type="image/jpg" />	</item>
		<item>
		<title>Le guide ultime et définitif sur la programmation orientée objet en Python à l&#8217;usage des débutants qui sont rassurés par les textes détaillés qui prennent le temps de tout expliquer. Partie 1.</title>
		<link>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-1/</link>
		<comments>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-1/#comments</comments>
		<pubDate>Tue, 15 Jan 2013 07:30:56 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[class]]></category>
		<category><![CDATA[object]]></category>
		<category><![CDATA[poo]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=4134</guid>
		<description><![CDATA[Je viens de dire que c'était le guide ultime et définitif sur la programmation orientée objet en Python à l'usage des débutants qui sont rassurés par les textes détaillés qui prennent le temps de tout expliquer. Partie 1. Je peux pas faire titre plus explicite, si ?]]></description>
			<content:encoded><![CDATA[<p>Prérequis à ce tuto bien chargé :</p>
<ul>
<li>comprendre parfaitement les mots clés les plus courants (conditions, tests, pass, etc);</li>
<li>comprendre parfaitement les fonctions (et donc les <a href="http://sametmax.com/operateur-splat-ou-etoile-en-python/">paramètres avancées</a> en Python);</li>
<li>comprendre la notion de <a href="http://sametmax.com/valeurs-et-references-en-python/">référence</a>;</li>
<li>connaitre les <a href="http://sametmax.com/quest-ce-quune-structure-de-donnees/">structures de données</a> de base (string, int, list, dict, etc).</li>
</ul>
<h2>Intro</h2>
<p>Il y a des tas de manières de programmer. Des styles. Des formes que l&#8217;on donne au code. On leur donne des noms: programmation procédurale, fonctionnelle, orientée flux, par contrat, etc. C&#8217;est ce qu&#8217;on appelle des paradigmes, des points de vue sur comment on doit faire le boulot.</p>
<p>En vérité, le point de vue n&#8217;est pas déterminant. Vous pouvez faire le même boulot en utilisant n&#8217;importe lequel. L&#8217;important c&#8217;est de coder.</p>
<p>Mais chaque point de vue possède des caractéristiques et des outils différents. </p>
<p>Ce que vous allez voir est ce qu&#8217;on appelle la programmation orientée objet, ou POO. C&#8217;est un simple point de vue, un outil, mais il est très utilisé en Python, Ruby ou Java.</p>
<p>Quand vous avez appris la programmation, on vous a montré comment stocker des données dans des structures de données:</p>
<ul>
<li>les listes</li>
<li>les chaînes</li>
<li>les entiers</li>
<li>les dictionnaires</li>
<li>etc</li>
</ul>
<p>Et on vous a montré comment créer un comportement pour votre programme en utilisant des mots clés, puis plus tard en utilisant des fonctions pour regrouper ces mots clés. </p>
<p>En Python, à ce stade, vous utilisez des fonctions pour agir sur des structures de données.</p>
<p><strong>La programmation orienté objet, c&#8217;est un style de programmation qui permet de regrouper au même endroit le comportement (les fonctions) et les données (les structures) qui sont faites pour aller ensemble.</strong></p>
<p>C&#8217;est tout. C&#8217;est une simple question d&#8217;organisation du programme.</p>
<h2>Qu&#8217;est-ce qu&#8217;un objet</h2>
<p>Un objet est un&#8230; truc. Un machin. Un bidule.</p>
<p>Ça peut vous paraître une définition floue, mais c&#8217;est parce que c&#8217;est exactement ce que peut être un objet: n&#8217;importe quoi que vous décidiez de coder. L&#8217;objet est un moyen de dire à la machine, ce < entrez_ici_un_nom_de_truc > possède telle donnée, et fait telle chose avec.</p>
<p>En Python, absolument tout est un objet : une chaîne, un entier, un dictionnaire, une liste, une fonction&#8230; Vous avez donc manipulé des objets sans le savoir. Maintenant vous allez créer les vôtres.</p>
<p>Créer des objets se fait en deux étapes: décrire à quoi ressemble votre objet, et demander à l&#8217;ordinateur d&#8217;utiliser cette description pour le fabriquer.</p>
<p>En Python 2.x, cela donne ceci:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> DescriptionDeLObject:
    <span style="color: #ff7700;font-weight:bold;">pass</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> object_tout_neuf = DescriptionDeLObject<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span> object_tout_neuf
<span style="color: #66cc66;">&lt;</span>__main__.<span style="color: black;">DescriptionDeLObject</span> instance at 0x3112440<span style="color: #66cc66;">&gt;</span></pre></div></div>

<p>La description de l&#8217;objet (le plan de construction) est :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> DescriptionDeLObject:
    <span style="color: #ff7700;font-weight:bold;">pass</span></pre></div></div>

<p>C&#8217;est ce qu&#8217;on appelle une classe. La classe est le moyen, en Python, de décrire à quoi va ressembler un objet.</p>
<p>On dit ici:</p>
<p>&#8220;Cet objet s&#8217;appelle DescriptionDeLObject.&#8221;</p>
<p>C&#8217;est tout.</p>
<p>Ensuite, on crée l&#8217;objet:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> object_tout_neuf = DescriptionDeLObject<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></div></div>

<p><code>DescriptionDeLObject()</code> (notez les parenthèses), est la syntaxe Python pour dire &#8220;fabrique un objet à partir de ce plan&#8221;. Le nouvel objet va être retourné, et mis dans la variable <code>object_tout_neuf</code>.</p>
<p>La variable <code>object_tout_neuf</code> contient un objet issue de la classe <code>DescriptionDeLObject</code>, on dit qu&#8217;il contient une instance de <code>DescriptionDeLObject</code>. C&#8217;est pour cela que l&#8217;action de créer un objet à partir d&#8217;une classe est appelée <em>instanciation</em>.</p>
<p>Python ne sait pas grand chose sur cet objet si ce n&#8217;est son nom et son adresse en mémoire. Si on fait <code>print</code> dessus, c&#8217;est donc ce qu&#8217;il vous donne:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span> object_tout_neuf
<span style="color: #66cc66;">&lt;</span>__main__.<span style="color: black;">DescriptionDeLObject</span> instance at 0x3112440<span style="color: #66cc66;">&gt;</span></pre></div></div>

<p>On peut créer autant d&#8217;objets que l&#8217;on veut à partir d&#8217;une classe :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> DescriptionDeLObject<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&lt;</span>__main__.<span style="color: black;">DescriptionDeLObject</span> instance at 0x31c1d40<span style="color: #66cc66;">&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> DescriptionDeLObject<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&lt;</span>__main__.<span style="color: black;">DescriptionDeLObject</span> instance at 0x31d6cf8<span style="color: #66cc66;">&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> DescriptionDeLObject<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&lt;</span>__main__.<span style="color: black;">DescriptionDeLObject</span> instance at 0x31d6bd8<span style="color: #66cc66;">&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> DescriptionDeLObject<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&lt;</span>__main__.<span style="color: black;">DescriptionDeLObject</span> instance at 0x31d6c68<span style="color: #66cc66;">&gt;</span></pre></div></div>

<h2>Méthodes</h2>
<p>Les méthodes sont des fonctions déclarées à l&#8217;intérieur de la classe. <em>Methode</em> est juste un nom pour dire &#8220;cette fonction est dans une classe&#8221;.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> DescriptionDeLObject:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> la_methode<span style="color: black;">&#40;</span>objet_en_cours<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">'Edgar Morin'</span></pre></div></div>

<p>Nous avons créé une &#8220;fonction&#8221; nommée <code>une_methode</code> dans le bloc de la classe. Puisqu&#8217;elle est dans ce bloc, cette fonction est ce qu&#8217;on appelle une méthode.</p>
<p>Elle n&#8217;existe pas en dehors de la classe.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> la_methode<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
Traceback <span style="color: black;">&#40;</span>most recent call last<span style="color: black;">&#41;</span>:
  File <span style="color: #483d8b;">&quot;&lt;ipython-input-12-c02691e8aa46&gt;&quot;</span>, line <span style="color: #ff4500;">1</span>, <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #66cc66;">&lt;</span>module<span style="color: #66cc66;">&gt;</span>
    la_methode<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #008000;">NameError</span>: name <span style="color: #483d8b;">'la_methode'</span> <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #ff7700;font-weight:bold;">not</span> defined</pre></div></div>

<p>Mais, elle est attachée à chaque objet. On peut l&#8217;utiliser en faisant < variable_contenant_objet >.< nom_de_méthode >. Ainsi, pour appeler la méthode une méthode, il nous faut forcément une instance :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> objet_tout_neuf = DescriptionDeLObject<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> objet_tout_neuf.<span style="color: black;">la_methode</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
Edgar Morin</pre></div></div>

<p>Arrivé à ce stade, vous devez vous demander &#8220;quel est ce <code>objet_en_cours</code>&#8221; qui est défini comme paramètre de la méthode ?</p>
<p>C&#8217;est une spécificité de Python : quand vous appelez une méthode depuis un objet, l&#8217;objet est automatiquement passé en premier paramètre par Python. C&#8217;est automatique, et invisible.</p>
<p>C&#8217;est très facile à comprendre en faisant une méthode qui retourne <code>objet_en_cours</code> pour voir ce qu&#8217;il y a dedans :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">class</span> DescriptionDeLObject:
...         
...         <span style="color: #ff7700;font-weight:bold;">def</span> une_methode<span style="color: black;">&#40;</span>objet_en_cours<span style="color: black;">&#41;</span>:
...         
...                 <span style="color: #ff7700;font-weight:bold;">return</span> objet_en_cours
...     
<span style="color: #66cc66;">&gt;&gt;&gt;</span> ze_object = DescriptionDeLObject<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span> ze_object 
<span style="color: #66cc66;">&lt;</span>__main__.<span style="color: black;">DescriptionDeLObject</span> instance at 0x3429170<span style="color: #66cc66;">&gt;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span> ze_object.<span style="color: black;">une_methode</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&lt;</span>__main__.<span style="color: black;">DescriptionDeLObject</span> instance at 0x3429170<span style="color: #66cc66;">&gt;</span></pre></div></div>

<p>Python fait comme si on avait fait :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">ze_object.<span style="color: black;">une_methode</span><span style="color: black;">&#40;</span>ze_object<span style="color: black;">&#41;</span></pre></div></div>

<p><code>objet_en_cours</code> et <code>ze_object</code> contiennent la même chose : l&#8217;objet en cours. <code>objet_en_cours</code> est juste le nom que nous avons donné à notre premier argument, mais Python passe toujours automatiquement en premier argument l&#8217;objet en cours afin que vous puissiez modifier cet objet à l&#8217;intérieur d&#8217;une méthode.</p>
<p>On dit donc que <code>objet_en_cours</code> est l&#8217;instance courante.</p>
<p>Une méthode doit donc toujours déclarer au moins un paramètre pour accueillir la référence à l&#8217;objet en cours, sinon ça plante. Voyez plutôt :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> DescriptionDeLObject:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> methode_sans_objet_en_cours<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;test&quot;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> methode_avec_objet_en_cours<span style="color: black;">&#40;</span>objet_en_cours<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;test&quot;</span>
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> ze_object = DescriptionDeLObject<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> ze_object.<span style="color: black;">methode_avec_objet_en_cours</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> 
<span style="color: #dc143c;">test</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> ze_object.<span style="color: black;">methode_sans_objet_en_cours</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
Traceback <span style="color: black;">&#40;</span>most recent call last<span style="color: black;">&#41;</span>:
  File <span style="color: #483d8b;">&quot;&lt;ipython-input-19-90434b7e7bfa&gt;&quot;</span>, line <span style="color: #ff4500;">1</span>, <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #66cc66;">&lt;</span>module<span style="color: #66cc66;">&gt;</span>
    ze_object.<span style="color: black;">methode_sans_objet_en_cours</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #008000;">TypeError</span>: methode_sans_objet_en_cours<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> takes no arguments <span style="color: black;">&#40;</span><span style="color: #ff4500;">1</span> given<span style="color: black;">&#41;</span></pre></div></div>

<p>Python dit que <code>methode_sans_objet_en_cours</code> est déclarée sans argument mais on lui en a passé un tout de même. Et en effet, Python lui a passé de manière invisible l&#8217;objet en cours en tant que premier argument. </p>
<p>En résumé, on déclare une classe avec une méthode ainsi:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> DescriptionDeLObject:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> nom_de_methode<span style="color: black;">&#40;</span>objet_en_cours<span style="color: black;">&#41;</span>:
&nbsp;
        faire quelque chose ici</pre></div></div>

<p>Et on l&#8217;utilise ainsi:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">variable = DescriptionDeLObject<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
variable.<span style="color: black;">nom_de_methode</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></div></div>

<h2>Conventions</h2>
<p>En Python, peu de choses sont forcées. La plupart de choses sont des conventions. Mais ce sont des conventions fortes, les gens y tiennent.</p>
<p>Parmi ces conventions, il y a les conventions de nommage, à savoir:</p>
<ul>
<li>
on nomme les classes sans espace, avec des majuscules : NomDUneClasse</li>
<li>
on nomme le reste en minuscule avec des underscores : nom_de_methode, nom_d_attribut, etc</li>
</ul>
<p>La convention la plus surprenant est celle du premier paramètre des méthodes qui contient l&#8217;objet en cours. Son nom n&#8217;est pas forcé, contrairement aux autres langages (comme <code>this</code> en Java par exemple), en fait c&#8217;est un paramètre tout à faire ordinaire. Néanmoins, la (très très forte) convention est de l&#8217;appeler <code>self</code> :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> DescriptionDeLObject:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> nom_de_methode<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
&nbsp;
        faire quelque chose ici</pre></div></div>

<p>Appelez-donc TOUJOURS le premier paramètre de chaque méthode <code>self</code>, et rappelez-vous qu&#8217;il contiendra toujours l&#8217;instance courante.</p>
<p>Enfin, les concepteurs de Python ont ajouté une convention supplémentaire : les méthodes appelées automatiquement sont appelées <code>__nom_de_methode__</code> (avec deux underscores de chaque côté).</p>
<p>En effet, il existe un certains nombre de méthodes que vous pouvez écrire, et si vous les nommez d&#8217;une certaine façon, elle seront appelées automatiquement quand une condition spéciale (liée au nom), se présente.</p>
<p>Nous verrons cela avec la méthode <code>__init__</code>.</p>
<h2>Attributs</h2>
<p>Vous avez vu que les méthodes étaient juste des fonctions attachées à un objet. Hé bien les attributs sont juste des variables attachées à un objet.</p>
<p>En fait, techniquement, les méthodes sont aussi des attributs, mais faisons comme si ce n&#8217;était pas le cas et séparons :</p>
<ul>
<li>méthodes : fonctions pour objets</li>
<li>attributs : variables pour objets</li>
</ul>
<p>Comme Python est un langage dynamique, on peut ajouter n&#8217;importe quel attribut à n&#8217;importe quel objet en utilisant la syntaxe < objet >.< nom_attribut > :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span> ze_object.<span style="color: black;">un_attribut</span> <span style="color: #808080; font-style: italic;"># l'attribut n'existe pas</span>
Traceback <span style="color: black;">&#40;</span>most recent call last<span style="color: black;">&#41;</span>:
  File <span style="color: #483d8b;">&quot;&lt;ipython-input-30-b52a599929f9&gt;&quot;</span>, line <span style="color: #ff4500;">1</span>, <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #66cc66;">&lt;</span>module<span style="color: #66cc66;">&gt;</span>
    ze_object.<span style="color: black;">un_attribut</span>
<span style="color: #008000;">AttributeError</span>: DescriptionDeLObject instance has no attribute <span style="color: #483d8b;">'un_attribut'</span>
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> ze_object.<span style="color: black;">un_attribut</span> = <span style="color: #483d8b;">&quot;valeur de l'attribut&quot;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span> ze_object.<span style="color: black;">un_attribut</span>
valeur de l<span style="color: #483d8b;">'attribut</span></pre></div></div>

<p>Et c&#8217;est là que vous allez voir l&#8217;interêt de <code>self</code> :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> DescriptionDeLObject:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> afficher<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #808080; font-style: italic;"># self est l'objet en cours, donc on à accès à ses attributs !</span>
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #008000;">self</span>.<span style="color: black;">un_attribut</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> modifier<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #808080; font-style: italic;"># on peut modifier les attributs depuis l'intérieur</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">un_attribut</span> = <span style="color: #483d8b;">&quot;autre valeur&quot;</span></pre></div></div>

<p>On peut accéder aux attributs depuis l&#8217;intérieur et l&#8217;extérieur d&#8217;un objet :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> ze_object = DescriptionDeLObject<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> 
<span style="color: #66cc66;">&gt;&gt;&gt;</span> ze_object.<span style="color: black;">afficher</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># l'attribut n'existe pas encore</span>
Traceback <span style="color: black;">&#40;</span>most recent call last<span style="color: black;">&#41;</span>:
  File <span style="color: #483d8b;">&quot;&lt;ipython-input-35-c10abd45fc98&gt;&quot;</span>, line <span style="color: #ff4500;">1</span>, <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #66cc66;">&lt;</span>module<span style="color: #66cc66;">&gt;</span>
    ze_object.<span style="color: black;">afficher</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># l'attribut n'exite pas</span>
  File <span style="color: #483d8b;">&quot;&lt;ipython-input-33-3e1eb4d8e5f6&gt;&quot;</span>, line <span style="color: #ff4500;">5</span>, <span style="color: #ff7700;font-weight:bold;">in</span> afficher
    <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #008000;">self</span>.<span style="color: black;">un_attribut</span>
<span style="color: #008000;">AttributeError</span>: DescriptionDeLObject instance has no attribute <span style="color: #483d8b;">'un_attribut'</span>
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> ze_object.<span style="color: black;">un_attribut</span> = <span style="color: #483d8b;">&quot;maintenant il existe !&quot;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> ze_object.<span style="color: black;">afficher</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> 
maintenant il existe <span style="color: #66cc66;">!</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> ze_object.<span style="color: black;">modifier</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># l'attribut est modifié par la méthode</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> ze_object.<span style="color: black;">un_attribut</span> 
<span style="color: #483d8b;">'autre valeur'</span></pre></div></div>

<p>Comme une méthode est juste une fonction attachée à un objet, on peut lui passer des paramètres. Et une méthode a accès à l&#8217;objet en cours, elle peut modifier l&#8217;objet en cours. </p>
<p>Donc, une méthode peut modifier l&#8217;objet en cours en fonction des paramètres passés :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> DescriptionDeLObject:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> afficher<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;La valeur actuelle est %s&quot;</span> <span style="color: #66cc66;">%</span> <span style="color: #008000;">self</span>.<span style="color: black;">un_attribut</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> modifier<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, valeur<span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">un_attribut</span> = valeur <span style="color: #66cc66;">*</span> <span style="color: #ff4500;">2</span>
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> ze_object = DescriptionDeLObject<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> ze_object.<span style="color: black;">un_attribut</span> = <span style="color: #ff4500;">1</span> <span style="color: #808080; font-style: italic;"># on met un entier en valeur cette fois</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> ze_object.<span style="color: black;">afficher</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
La valeur actuelle est <span style="color: #ff4500;">1</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> ze_object.<span style="color: black;">modifier</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">2</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># on passe un paramètre </span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> ze_object.<span style="color: black;">afficher</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
La valeur actuelle est <span style="color: #ff4500;">4</span></pre></div></div>

<p>Les méthodes servent exactement à cela : retourner les valeurs à l&#8217;intérieur de l&#8217;objet, ou à les modifier.</p>
<h2>Initialisation d&#8217;un objet</h2>
<p>On souhaite généralement donner une état de départ à tout nouvel objet créé. Par exemple, si vous travaillez sur un jeu vidéo de course de voitures, vous voudrez peut-être créer un objet voiture avec du carburant et une couleur de peinture. </p>
<p>Il serait contre productif de devoir les spécifier à chaque fois. Pour automatiser le travail, Python met à disposition des méthodes appelées automatiquement quand une condition est remplie. Ce sont les méthodes nommées <code>__methode__</code>.</p>
<p>Dans notre cas, on veut que notre objet ait un état de départ, donc on va utiliser la méthode qui est appelée automatiquement après la création de l&#8217;objet. C&#8217;est la méthode <code>__init__</code>.</p>
<p>Si vous appelez une méthode avec le nom <code>__init__</code>, Python va automatiquement, et de manière invisible, appeler la méthode après avoir créé l&#8217;objet :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> DescriptionDeLObject:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;L'objet a été créé !&quot;</span>
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;La méthode est appelée automatiquement&quot;</span>
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> ze_object = DescriptionDeLObject<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
L<span style="color: #483d8b;">'objet a été créé !
La méthode est appelée automatiquement</span></pre></div></div>

<p><code>__init__</code> est une méthode tout à fait ordinaire. Seul le nom est important: comme elle est appelée ainsi, Python la détecte automatiquement et l&#8217;appelle au bon moment.</p>
<p>C&#8217;est très utile pour fournir un état de départ:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Voiture:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">carburant</span> = <span style="color: #ff4500;">100</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">couleur</span> = <span style="color: #483d8b;">&quot;noire&quot;</span>
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> v = Voiture<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> v.<span style="color: black;">couleur</span>
<span style="color: #483d8b;">'noire'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> v.<span style="color: black;">carburant</span>
<span style="color: #ff4500;">100</span></pre></div></div>

<p>Bien entendu, on veut généralement pouvoir changer l&#8217;état de départ. Ici encore, Python nous aide:<strong> si vous passez des paramètres à l&#8217;instanciation, ils sont passés automatiquement à <code>__init__</code></strong>.</p>
<p>Comme <code>__init__</code> est une méthode ordinaire (et donc une fonction), on peut lui donner des paramètres avec des valeurs par défaut mais accepter une nouvelle valeur si elle est passée :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Voiture:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, combien_de_carburant=<span style="color: #ff4500;">100</span>, quelle_couleur=<span style="color: #483d8b;">&quot;noire&quot;</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">carburant</span> = combien_de_carburant
        <span style="color: #008000;">self</span>.<span style="color: black;">couleur</span> = quelle_couleur
&nbsp;
&nbsp;
<span style="color: #66cc66;">&gt;&gt;&gt;</span> v1 = Voiture<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># sans paramètres, les valeurs par défaut sont utilisées</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> v1.<span style="color: black;">couleur</span>
<span style="color: #483d8b;">'noire'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> v1.<span style="color: black;">carburant</span>
<span style="color: #ff4500;">100</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> v2 = Voiture<span style="color: black;">&#40;</span><span style="color: #ff4500;">50</span>, <span style="color: #483d8b;">'rouge et jaune à petit pois'</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># on change les valeurs</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> v2.<span style="color: black;">couleur</span> 
<span style="color: #483d8b;">'rouge et jaune <span style="color: #000099; font-weight: bold;">\x</span>c3<span style="color: #000099; font-weight: bold;">\x</span>a0 petit pois'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> v1.<span style="color: black;">couleur</span>
<span style="color: #483d8b;">'noire'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> v3 = Voiture<span style="color: black;">&#40;</span>quelle_couleur=<span style="color: #483d8b;">&quot;fushia virant sur l'aigue marine&quot;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> v3.<span style="color: black;">couleur</span>
<span style="color: #483d8b;">&quot;fushia virant sur l'aigue marine&quot;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> v3.<span style="color: black;">carburant</span>
<span style="color: #ff4500;">100</span></pre></div></div>

<p>Les valeurs passées dans <code>Voiture(valeurs, passées)</code>, sont automatiquement repassées à <code>__init__</code>(self, valeurs, passées). </p>
<p>En résumé : <code>__init__</code> est appelée automatiquement après que l&#8217;objet soit créé, et on lui passe les paramètres passés à l&#8217;instanciation. Comme <code>__init__</code> est une méthode et a accès à l&#8217;instance courante, elle peut ajouter des attributs à l&#8217;objet en cours en fonction de ces paramètres. On utilise ça pour créer des objets avec un état de départ par défaut, et permettre une personnalisation de cet état de départ.</p>
<p>J&#8217;ai mis des noms différents pour les paramètres d&#8217;<code>__init__</code> et les attributs de l&#8217;objet, mais en réalité on leur met souvent le même nom par convention. Donc l&#8217;exemple ci-dessus s&#8217;écrirait plutôt :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> Voiture:
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, carburant=<span style="color: #ff4500;">100</span>, couleur=<span style="color: #483d8b;">&quot;noire&quot;</span><span style="color: black;">&#41;</span>:
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">carburant</span> = carburant
        <span style="color: #008000;">self</span>.<span style="color: black;">couleur</span> = couleur</pre></div></div>

<p><code>carburant</code> et <code>couleur</code> ne sont pas la même chose que <code>self.carburant</code> et <code>self.couleur</code> : les premiers n&#8217;existent que dans <code>__init__</code>. Une fois qu&#8217;<code>__init__</code> a fini de s’exécuter, ils disparaissent. Les seconds sont des attributs de l&#8217;objet en cours, et sont donc toujours disponibles tant que l&#8217;objet existe. Le fait qu&#8217;ils portent le même nom ne pose aucun problème car la syntaxe <code>self.<attribut></code> les différencies.</p>
<h2>Résumé final</h2>
<p>La classe, c&#8217;est un plan. </p>
<p>L&#8217;objet, c&#8217;est ce qu&#8217;on créé avec le plan. </p>
<p>Une méthode, c&#8217;est une fonction déclarée dans une classe (qui est attachée à chaque objet produit, et on lui passe en premier paramètre l&#8217;objet en cours). </p>
<p>Un attribut, c&#8217;est une variable attachée à un objet. </p>
<p>Une instance d&#8217;une classe, c&#8217;est l&#8217;objet issu d&#8217;une classe.</p>
<p><a href="https://fr.wikipedia.org/wiki/Spermophile">Un spermophile</a>, c&#8217;est un animal dont la queue est assez courte et plus ou moins fournie. Il aime être à 4 pattes et mange parfois des glands. Ça n&#8217;a rien à voir, mais je me suis dit qu&#8217;il fallait faire passer l&#8217;info. Ah oui, et la cuniculture, <a href="https://fr.wikipedia.org/wiki/Cunniculture">c&#8217;est prendre soin d&#8217;un lapinou</a>. La levrette, par contre, n&#8217;est pas la femelle du lièvre. </p>
<p>Le vocabulaire en informatique, <a href="http://danstonchat.com/14113.html">c&#8217;est primordial</a>.<br />
<a href="http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-2/"><br />
La partie 2</a>, c&#8217;est par ici.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=4134&amp;md5=60ef728a93229d276247b57a1ddab158" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-1/feed/</wfw:commentRss>
		<slash:comments>34</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fle-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-1%2F&amp;language=en_GB&amp;category=text&amp;title=Le+guide+ultime+et+d%C3%A9finitif+sur+la+programmation+orient%C3%A9e+objet+en+Python+%C3%A0+l%26%238217%3Busage+des+d%C3%A9butants+qui+sont+rassur%C3%A9s+par+les+textes+d%C3%A9taill%C3%A9s+qui+prennent+le+temps+de+tout+expliquer.+Partie+1.&amp;description=Pr%C3%A9requis+%C3%A0+ce+tuto+bien+charg%C3%A9+%3A+comprendre+parfaitement+les+mots+cl%C3%A9s+les+plus+courants+%28conditions%2C+tests%2C+pass%2C+etc%29%3B+comprendre+parfaitement+les+fonctions+%28et+donc+les+param%C3%A8tres+avanc%C3%A9es+en+Python%29%3B...&amp;tags=class%2Cobject%2Cpoo%2Cpython%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/01/michel-ange.jpg" length="19849" type="image/jpg" />	</item>
	</channel>
</rss>
