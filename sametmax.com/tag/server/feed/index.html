<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Sam &#38; Max: Python, Django, Git et du cul &#187; server</title>
	<atom:link href="http://sametmax.com/tag/server/feed/" rel="self" type="application/rss+xml" />
	<link>http://sametmax.com</link>
	<description>Deux développeurs en vadrouille qui se sortent les doigts du code</description>
	<lastBuildDate>Wed, 05 Feb 2014 14:20:37 +0000</lastBuildDate>
	<language>en</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.3.1</generator>
	<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2F&amp;language=en_US&amp;category=text&amp;title=Sam+%26amp%3B+Max%3A+Python%2C+Django%2C+Git+et+du+cul&amp;description=Deux+d%C3%A9veloppeurs+en+vadrouille+qui+se+sortent+les+doigts+du+code&amp;tags=blog" type="text/html" />
		<item>
		<title>Qu&#8217;est-ce que WSGI et à quoi ça sert ?</title>
		<link>http://sametmax.com/quest-ce-que-wsgi-et-a-quoi-ca-sert/</link>
		<comments>http://sametmax.com/quest-ce-que-wsgi-et-a-quoi-ca-sert/#comments</comments>
		<pubDate>Wed, 03 Jul 2013 10:36:16 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[bottle]]></category>
		<category><![CDATA[cherrypy]]></category>
		<category><![CDATA[django]]></category>
		<category><![CDATA[nginx]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[server]]></category>
		<category><![CDATA[wsgi]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=6544</guid>
		<description><![CDATA[On va dire que je me répète, mais <a href="https://en.wikipedia.org/wiki/Wsgi">WSGI</a> est typiquement le cas d'une notion simple et super mal expliquée sur le Web.]]></description>
			<content:encoded><![CDATA[<p>On va dire que je me répète, mais <a href="https://en.wikipedia.org/wiki/Wsgi">WSGI</a> est typiquement le cas d&#8217;une notion simple et super mal expliquée sur le Web.</p>
<p>C&#8217;est terrible ça, une vrai maladie. Ça me donne envie de faire des vidéos comme le joueur du Grenier pour râler à voix haute.</p>
<p>Bref.</p>
<p>Donc WSGI a le même but que FastCGI, SCGI, or AJP : c&#8217;est une norme qui sert à définir comment un serveur Python et son application peuvent discuter. Ça été pondu pour que tous les serveurs et toutes les applications Python qui respectent la norme soient garantis de pouvoir s&#8217;interfacer.</p>
<p>Ça, c&#8217;est la définition que vous voyez partout. Super, mais concrètement ça veut dire quoi ?</p>
<h2>WSGI, c&#8217;est juste une convention de discussion</h2>
<p>Un bon dessin vaut mieux&#8230;</p>
<div id="attachment_6545" class="wp-caption aligncenter" style="width: 465px"><a href="http://sametmax.com/wp-content/uploads/2013/07/wsgi.png"><img class=" wp-image-6545  " title="C'est compliqué de faire un schéma comme ça sérieux ? Ah ça pond une norme de 30 pages mais ça peut pas faire 3 ronds dans paint." src="http://sametmax.com/wp-content/uploads/2013/07/wsgi.png" alt="Schéma du fonctionnement de WSGI" width="455" height="644" /></a><p class="wp-caption-text">C&#39;est compliqué de faire un schéma comme ça sérieux ? Ah ça pond une norme de 30 pages mais ça peut pas faire 3 ronds dans paint.</p></div>
<p>D&#8217;un côté vous avez des serveurs comme ceux de cherrypy, de paste, de werkzeug ou comme la commande runserver de Django, ou tels que les serveurs gunicorn, Apache (avec mod_wsgi). Ces logiciels ont pour boulot d’accueillir une requête HTTP et de renvoyer la réponse. Ils ont des problématiques comme : gérer les sockets, gérer plusieurs processus en parallèle, éviter qu&#8217;un pirate se balade sur votre serveur, etc.</p>
<p>De l&#8217;autre côté vous avez votre application. 9 fois sur 10, votre site Web, donc votre code. Sa problématique c&#8217;est de recevoir une requête, la comprendre, et générer une réponse en tapant dans la base de données, et en faisant sa popotte HTML.</p>
<p>Il faut donc que votre serveur dialogue avec votre app, qu&#8217;il lui passe la requête, que votre app la gère, retourne la réponse, et file la réponse au serveur. Alors le serveur envoie la réponse au navigateur.</p>
<p>C&#8217;est la chose la plus mal expliquée : il y a deux parties à WSGI. Une pour le serveur, et une pour l&#8217;application.</p>
<p>Un serveur est dit &#8220;compatible WSGI&#8221; quand il est capable de transmettre une requête HTTP normale à votre application via le protocole WSGI, et qu&#8217;il est capable de récupérer une réponse HTTP depuis votre application via le protocole WSGI pour en faire une requête HTTP normale.</p>
<p>Une application est dite &#8220;compatible WSGI&#8221; quand elle est capable de recevoir une requête HTTP <strong>transformée en un objet Python</strong> selon la norme WSGI, et qu&#8217;elle retourne une réponse HTTP <strong>sous la forme d&#8217;un objet Python</strong> selon la norme WSGI.</p>
<h2>J&#8217;avais demandé concrètement, show me the fucking code !</h2>
<p>Côté serveur WSGI, on doit lui passer le point d&#8217;entrée de votre app.</p>
<p>Le point d&#8217;entrée est un module Python qui contient une variable nommé <code>application</code>.</p>
<p>C&#8217;est tout.</p>
<p>La variable application doit contenir votre application compatible WSGI.</p>
<p>Une application compatible WSGI a un certain nombre de méthodes pour accepter en paramètres un objet requête HTTP, et retourner un objet réponse HTTP, mais la bonne nouvelle, c&#8217;est que <strong>vous n&#8217;avez absolument pas besoin de savoir comment ça marche</strong>.</p>
<p>En effet, tous les frameworks compatibles WSGI (bottle, django, cherrypy, etc) ont une fonction qui retourne cette application toute faite.</p>
<p>Par exemple, avec bottle, mon fichier wsgi va contenir :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">site</span> <span style="color: #ff7700;font-weight:bold;">import</span> app
&nbsp;
application = app</pre></div></div>

<p>C&#8217;est tout. <code>app</code>, le décorateur qui permet de faire <code>@app.route('/')</code> dans le code du site bottle, est déjà une application WSGI.</p>
<p>Pour Django, ça va donner un truc comme :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">os</span>
<span style="color: #808080; font-style: italic;"># ont dit quel est le module de settings Django</span>
<span style="color: #dc143c;">os</span>.<span style="color: black;">environ</span><span style="color: black;">&#91;</span><span style="color: #483d8b;">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span style="color: black;">&#93;</span> = <span style="color: #483d8b;">&quot;project.settings&quot;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># et on fabrique l'application WSGI avec une fonction</span>
<span style="color: #808080; font-style: italic;"># que Django nous donne</span>
<span style="color: #ff7700;font-weight:bold;">from</span> django.<span style="color: black;">core</span>.<span style="color: black;">wsgi</span> <span style="color: #ff7700;font-weight:bold;">import</span> get_wsgi_application
&nbsp;
application = get_wsgi_application<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>Le simple fait qu&#8217;il y ait une variable nommée <code>application</code> fait que le serveur va se débrouiller. Tout ce qu&#8217;il y a à faire, c&#8217;est passer en paramètre ce module au serveur, et comment le faire dépend du serveur.</p>
<p>Par exemple pour gunicorn, c&#8217;est le premier paramètre de la commande qu&#8217;on utilise pour lancer le serveur :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">gunicorn nom_du_module</pre></div></div>

<p>Il faut que le module soit importable (on peut passer l&#8217;option <code>--pythonpath</code> pour s&#8217;en assurer.)</p>
<p>Pour Apache et mod_wsgi, ça se fait dans le fichier de config <em>apache.conf</em>:</p>

<div class="wp_syntax"><div class="code"><pre class="xml" style="font-family:monospace;">WSGIScriptAlias / /chemin/version/module.wsgi</pre></div></div>

<p>Bref, faire dialoguer un serveur et une application WSGI, c&#8217;est con comme la lune :</p>
<ol>
<li>Faire un module qui contient une variable nommée <code>application</code> contenant l&#8217;app WSGI.</li>
<li>Dire au serveur où se trouve le fichier</li>
</ol>
<h2>Avantages et inconvénients de WSGI</h2>
<p>Parmi les avantages, on retrouve :</p>
<ul>
<li>Pas de parsing de la requête au niveau de l&#8217;application.</li>
<li>Entrée de toutes les apps WSGI normalisées.</li>
<li>Tous les logiciels WSGI sont compatibles entre eux.</li>
<li>Le module WSGI reste chargé en mémoire une bonne fois pour toute, pas besoin de le recréer à chaque requête.</li>
<li>WSGI se suffit à lui même pour écrire une application. Dans la théorie, on n&#8217;a même pas besoin de framework.</li>
</ul>
<p>Quant aux inconvénients :</p>
<ul>
<li>En pratique il y a très peu de code partagé entre les applications WSGI. La communication sur WSGI s&#8217;est très mal passée et cela reste quelque chose de mystérieux pour la plupart des développeurs.</li>
<li>WSGI ne gère pas les websockets, et la norme est en train d&#8217;être mise à jour pour cela. Mais cela prend du temps et les websockets sont déjà là, du coup les gens se tournent vers des solutions non WSGI (tornado, twisted, etc).</li>
<li>Certains serveurs ne gèrent pas WSGI (comme nginx ou lighttpd), du coup on ne peut pas communiquer directement entre l&#8217;app et eux. Il faut un intermédiaire. C&#8217;est pour cela qu&#8217;on voit très souvent des setups comme nginx <=> gunicorn <=> django, avec un serveur WSGI qui sert d&#8217;intermédiaire. Il y a tout de même le bénéfice de pouvoir gérer parfaitement indépendamment le processus WSGI du serveur HTTP, ce qui est très pratique pour le debug, l&#8217;administration système, le déploiement, etc.</li>
<li>WSGI, c&#8217;est du Python. Qui dit Python, dit import, qui dit import, dit PYTHON PATH. 90% des erreurs de mise en prod sont des erreurs d&#8217;import, et pour cette raison <code>sys.path</code> est presque toujours manipulé dans un fichier qui contient une application WSGI.</li>
</ul>
<h2>Pour la culture</h2>
<p>Voici à quoi ressemble un hello world en WSGI :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">def</span> application<span style="color: black;">&#40;</span>environ, start_response<span style="color: black;">&#41;</span>:
    start_response<span style="color: black;">&#40;</span><span style="color: #483d8b;">'200 OK'</span>, <span style="color: black;">&#91;</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'Content-Type'</span>, <span style="color: #483d8b;">'text/plain'</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">yield</span> <span style="color: #483d8b;">'Hello World<span style="color: #000099; font-weight: bold;">\n</span>'</span></pre></div></div>

<p>Et oui, c&#8217;est très simple, et il n&#8217;y a rien à importer. La norme WSGI est une convention : il doit y avoir une variable nommée <code>application</code> (ici la variable c&#8217;est le nom de la fonction), et cette variable doit contenir une application WSGI.</p>
<p>Mais une application WSGI, c&#8217;est juste un callable (ici une fonction) qui accepte en paramètres <code>environ</code> (la requête), <code>start_response</code> (une fonction qui écrit l&#8217;en-tête de la réponse) et qui retourne un générateur de string. C&#8217;est tout.</p>
<p>Il n&#8217;y a rien de magique. C&#8217;est une simple interface sur laquelle tout le monde s&#8217;est mis d&#8217;accord.</p>
<p>Quand on fait en Django:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">application = get_wsgi_application<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>En fait Django ne fait que fabriquer une fonction comme on vient de voir, qui derrière appelle votre application Django.</p>
<p>En revanche, comme on utilise souvent Django derrière nginx, le setup ressemble très souvent à ça :</p>
<div id="attachment_6546" class="wp-caption aligncenter" style="width: 465px"><a href="http://sametmax.com/wp-content/uploads/2013/07/wsgi_with_nginx.png"><img class="size-full wp-image-6546" title="Quand on voit &quot;socket&quot;, ça fait peur, mais c'est juste une ligne de config qui point généralement vers localhost:8000." src="http://sametmax.com/wp-content/uploads/2013/07/wsgi_with_nginx.png" alt="Schém d'utilistation de WSGI avec Nginx" width="455" height="644" /></a><p class="wp-caption-text">Quand on voit &quot;socket&quot;, ça fait peur, mais c&#39;est juste une ligne de config qui point généralement vers localhost:8000.</p></div>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=6544&amp;md5=7b0bfe72a1ba28286d021e7e0529f0f3" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/quest-ce-que-wsgi-et-a-quoi-ca-sert/feed/</wfw:commentRss>
		<slash:comments>23</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fquest-ce-que-wsgi-et-a-quoi-ca-sert%2F&amp;language=en_GB&amp;category=text&amp;title=Qu%26%238217%3Best-ce+que+WSGI+et+%C3%A0+quoi+%C3%A7a+sert+%3F&amp;description=On+va+dire+que+je+me+r%C3%A9p%C3%A8te%2C+mais+WSGI+est+typiquement+le+cas+d%26%238217%3Bune+notion+simple+et+super+mal+expliqu%C3%A9e+sur+le+Web.+C%26%238217%3Best+terrible+%C3%A7a%2C+une+vrai+maladie.+%C3%87a...&amp;tags=bottle%2Ccherrypy%2Cdjango%2Cnginx%2Cpython%2Cserver%2Cwsgi%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/07/v2TyF.jpg" length="31544" type="image/jpg" />	</item>
		<item>
		<title>Installer un nœud Bitcoin sur un serveur Ubuntu</title>
		<link>http://sametmax.com/installer-un-noeud-bitcoin-sur-un-serveur-ubuntu/</link>
		<comments>http://sametmax.com/installer-un-noeud-bitcoin-sur-un-serveur-ubuntu/#comments</comments>
		<pubDate>Sat, 29 Jun 2013 08:54:59 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Administration System]]></category>
		<category><![CDATA[bitcoin]]></category>
		<category><![CDATA[node]]></category>
		<category><![CDATA[server]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=6496</guid>
		<description><![CDATA[Hier on a fait Tor, pourquoi ne pas faire Bitcoin aujourd'hui ?]]></description>
			<content:encoded><![CDATA[<p>Hier on a fait Tor, pourquoi ne pas faire Bitcoin aujourd&#8217;hui ? (j&#8217;ai essayé freenet, mais je me suis gaufré sur une erreur Java, c&#8217;est con).</p>
<p>Faire tourner <a href="http://bitcoin.org/en/download">bitcoinqt</a> sur son ordinateur personnel a plusieurs défauts :</p>
<ul>
<li>Il télécharge toute la blockchain, ce qui est long et prend des Go de place sur le disque.</li>
<li>Ca bouffe de la ressource pour rien.</li>
<li>On aide pas tellement le réseau car on ferme le client dès que l&#8217;opération financière est terminée.</li>
</ul>
<p>Bref, le client officiel Bitcoin n&#8217;est pas le plus ergonomique, et on lui préférera des alternatives légères comme <a href="http://electrum.org/">Electrum</a>.</p>
<p>Seulement puisque ces wallets &#8220;allégés&#8221; ne télécharge pas la blockchain, vous n&#8217;aidez pas le réseau. Or, personnellement, <a href="http://sametmax.com/quest-ce-que-bitcoin/">je participe à Bitcoin pour aider le mouvement</a>.</p>
<p>J&#8217;ai donc décidé d&#8217;installer un nœud Bitcoin sur un de mes serveur, comme ça j&#8217;ai le meilleur des deux mondes. Évidement je ne recommande pas à Mme Michu de faire ça, mais en même temps je ne recommande pas à la vieille d&#8217;utiliser Bitcoin non plus.</p>
<p>Sur Ubuntu Server, ce n&#8217;est pas une opération complexe.</p>
<h2>Créer un utilisateur nommé &#8220;bitcoin&#8221;</h2>
<p>Ca permet d&#8217;isoler les fichiers de config (le wallet sera vide de toute façon, je suis pas fou).</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">sudo</span> adduser bitcoin</pre></div></div>

<h2>Installer le daemon bitcoin</h2>
<p>Cool, c&#8217;est dans les dépôts !</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #c20cb9; font-weight: bold;">apt-get</span> <span style="color: #c20cb9; font-weight: bold;">install</span> bitcoind</pre></div></div>

<h2>Faire un script de démarrage</h2>
<p>Alors là, je m&#8217;attendais à une galère sans nom, mais c&#8217;est sans compter qu&#8217;Ubuntu utilise maintenant <a href="http://newcome.wordpress.com/2012/02/26/running-programs-as-linux-daemons-using-upstart/">upstarts</a>, qui rend la création de scripts de démarrage super simple.</p>
<p>Créer un fichier <em>/etc/init/bitcoin.conf</em> et mettre dedans:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #666666; font-style: italic;"># bitcoind upstart script for Ubuntu</span>
&nbsp;
description <span style="color: #ff0000;">&quot;Bitcoin daemon&quot;</span>
&nbsp;
start on runlevel <span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2345</span><span style="color: #7a0874; font-weight: bold;">&#93;</span>
stop on runlevel <span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000; font-weight: bold;">!</span><span style="color: #000000;">2345</span><span style="color: #7a0874; font-weight: bold;">&#93;</span>
&nbsp;
respawn
<span style="color: #7a0874; font-weight: bold;">exec</span> <span style="color: #c20cb9; font-weight: bold;">su</span> <span style="color: #660033;">-c</span> <span style="color: #ff0000;">&quot;bitcoind&quot;</span> - bitcoin</pre></div></div>

<p>Pouf pouf, on démarre le service :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">service bitcoin start</pre></div></div>

<p>Et voilà, bitcoind est maintenant un service de votre serveur, tournant vaillamment en tâche de fond, lancé à chaque reboot.</p>
<h2>Ouvrir le port 8333</h2>
<p>Sinon vous aurez un super service qui tourne pour lui tout seul.</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">sudo</span> iptables <span style="color: #660033;">-I</span> OUTPUT <span style="color: #660033;">-p</span> tcp <span style="color: #660033;">-m</span> tcp <span style="color: #660033;">--dport</span> <span style="color: #000000;">8333</span> <span style="color: #660033;">-j</span> ACCEPT
<span style="color: #c20cb9; font-weight: bold;">sudo</span> iptables <span style="color: #660033;">-I</span> INPUT <span style="color: #660033;">-p</span> tcp <span style="color: #660033;">-m</span> tcp <span style="color: #660033;">--dport</span> <span style="color: #000000;">8333</span> <span style="color: #660033;">-j</span> ACCEPT</pre></div></div>

<p>Vérifier si ça marche :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">du</span> <span style="color: #660033;">-sH</span> <span style="color: #000000; font-weight: bold;">/</span>home<span style="color: #000000; font-weight: bold;">/</span>bitcoin<span style="color: #000000; font-weight: bold;">/</span>.bitcoin</pre></div></div>

<p>La taille devrait grossir avec le temps</p>
<p>Prochaine étape, faire son propre serveur de blockchain, histoire de ne pas dépendre de ceux d&#8217;electrum.</p>
<p>PS: passer l&#8217;option &#8220;-gen&#8221; à <code>bitcoind</code> si vous voulez miner. Ça vous servira à rien, mais c&#8217;est psychologique ^^</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=6496&amp;md5=b09c9635c9633211a2f20d747b6d2dee" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/installer-un-noeud-bitcoin-sur-un-serveur-ubuntu/feed/</wfw:commentRss>
		<slash:comments>10</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Finstaller-un-noeud-bitcoin-sur-un-serveur-ubuntu%2F&amp;language=en_GB&amp;category=text&amp;title=Installer+un+n%C5%93ud+Bitcoin+sur+un+serveur+Ubuntu&amp;description=Hier+on+a+fait+Tor%2C+pourquoi+ne+pas+faire+Bitcoin+aujourd%26%238217%3Bhui+%3F+%28j%26%238217%3Bai+essay%C3%A9+freenet%2C+mais+je+me+suis+gaufr%C3%A9+sur+une+erreur+Java%2C+c%26%238217%3Best+con%29.+Faire+tourner+bitcoinqt+sur...&amp;tags=bitcoin%2Cnode%2Cserver%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/06/2dA7ozT.jpg" length="71779" type="image/jpg" />	</item>
		<item>
		<title>Ajouter un nœud de sortie Tor sur son serveur Ubuntu</title>
		<link>http://sametmax.com/ajouter-un-noeud-de-sortie-tor-sur-son-serveur-ubuntu/</link>
		<comments>http://sametmax.com/ajouter-un-noeud-de-sortie-tor-sur-son-serveur-ubuntu/#comments</comments>
		<pubDate>Fri, 28 Jun 2013 09:21:56 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Administration System]]></category>
		<category><![CDATA[server]]></category>
		<category><![CDATA[tor]]></category>
		<category><![CDATA[ubuntu]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=6489</guid>
		<description><![CDATA[La procédure pour l'installation sur Ubuntu est beaucoup plus simple qu'au début du projet.]]></description>
			<content:encoded><![CDATA[<p>Installer un nœud de sortie Tor est un moyen de contribuer à son niveau à l&#8217;émancipation du Web. L&#8217;installer sur sa machine de bureau n&#8217;est pas très intéressant, mais on trouve des <a href="https://www.leaseweb.nl">serveurs à 7 euros par mois</a> de nos jours qui suffisent largement à cette tâche. </p>
<p>La procédure pour l&#8217;installation sur Ubuntu est beaucoup plus simple qu&#8217;au début du projet.</p>
<p>D&#8217;abord, il faut récupérer le nom de sa distrib :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">lsb_release <span style="color: #660033;">-c</span>
Codename: precise</pre></div></div>

<p>Ici pour pour moi &#8220;precise&#8221;.</p>
<p>Ensuite on rajoute <em>/etc/apt/sources.list</em> une ligne contenant <code>deb http://deb.torproject.org/torproject.org nom_distrib main</code>, dans mon cas :</p>
<p><code>deb http://deb.torproject.org/torproject.org precise main</code></p>
<p>On rajoute les clés du dépôt officiel de tor et on install tor (ntp pour synchroniser l&#8217;heure) :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">gpg <span style="color: #660033;">--keyserver</span> keys.gnupg.net <span style="color: #660033;">--recv</span> 886DDD89
gpg <span style="color: #660033;">--export</span> A3C4F0F979CAA22CDBA8F512EE8CBC9E886DDD89 <span style="color: #000000; font-weight: bold;">|</span> <span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #c20cb9; font-weight: bold;">apt-key</span> add -
<span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #c20cb9; font-weight: bold;">apt-get</span> update
<span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #c20cb9; font-weight: bold;">apt-get</span> <span style="color: #c20cb9; font-weight: bold;">install</span> deb.torproject.org-keyring tor ntp</pre></div></div>

<p>A ce stade là vous avez un client Tor fonctionel, mais pas un nœd de sortie. Un petit <code>sudo vi /etc/tor/torrc</code> et on décommente la ligne :</p>
<p><code>#ORPort 9001</code></p>
<p>Il faut du coup ouvrir le port 9001 :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">iptables <span style="color: #660033;">-I</span> INPUT <span style="color: #660033;">-p</span> tcp <span style="color: #660033;">-m</span> tcp <span style="color: #660033;">--dport</span> <span style="color: #000000;">9001</span> <span style="color: #660033;">-j</span> ACCEPT
iptables <span style="color: #660033;">-I</span> OUTPUT <span style="color: #660033;">-p</span> tcp <span style="color: #660033;">-m</span> tcp <span style="color: #660033;">--dport</span> <span style="color: #000000;">9001</span> <span style="color: #660033;">-j</span> ACCEPT</pre></div></div>

<p>(Sauvegardez votre config iptables sinon au prochain reboot, votre port est à nouveau bloqué)</p>
<p>Et on relance le service.</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">sudo</span> service tor reload</pre></div></div>

<p>Pour voir si ça a bien fonctionné :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">cat</span> <span style="color: #000000; font-weight: bold;">/</span>var<span style="color: #000000; font-weight: bold;">/</span>log<span style="color: #000000; font-weight: bold;">/</span>tor<span style="color: #000000; font-weight: bold;">/</span>log <span style="color: #000000; font-weight: bold;">|</span> <span style="color: #c20cb9; font-weight: bold;">grep</span> <span style="color: #7a0874; font-weight: bold;">test</span>
Self-testing indicates your ORPort is reachable from the outside. Excellent.</pre></div></div>

<p>Quelques avertissements tout de même :</p>
<ul>
<li>Tor est un projet utilisé massivement par des activistes politiques et personnes à la connexion internet et aux libertés bridées (c&#8217;est ceux qu&#8217;on cherche à aider), mais également des gens aux activités illégales (ventes de produits interdits dans leurs pays, ce qui va de la weed au GHB) voir carrément immorales (pédopornographie, terrorisme). En ouvrant un nœud Tor, vous n&#8217;avez aucun contrôle sur QUI utilise votre équipement, ou pour faire quoi.</li>
<li>Certains hébergeurs interdisent Tor. C&#8217;est le cas de <a href="http://www.cinfu.com/">cinfu</a>, un hébergeur qui accepte pourtant les <a href="sametmax.com/quest-ce-que-bitcoin/">Bitcoins</a> mais aussi, je viens de l&#8217;apprendre à mes dépends, de online.net et ses fameuses dédibox. Il m&#8217;ont donné 24 H pour fermer mon nœd Tor, et je vais donc devoir le migrer sur leaseweb ou OVH.</li>
<li>Le cadre légal autour de Tor est encore fluctuant. Je suis incapable de vous dire si vous pouvez être tenu pour responsable des activités illégales qui seraient perpétrées à travers votre équipement.</li>
<li>Ça va bouffer de la bande passante.</li>
</ul>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=6489&amp;md5=cb9fce27070fb8c80062ea02c7f40bd4" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/ajouter-un-noeud-de-sortie-tor-sur-son-serveur-ubuntu/feed/</wfw:commentRss>
		<slash:comments>11</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fajouter-un-noeud-de-sortie-tor-sur-son-serveur-ubuntu%2F&amp;language=en_GB&amp;category=text&amp;title=Ajouter+un+n%C5%93ud+de+sortie+Tor+sur+son+serveur+Ubuntu&amp;description=Installer+un+n%C5%93ud+de+sortie+Tor+est+un+moyen+de+contribuer+%C3%A0+son+niveau+%C3%A0+l%26%238217%3B%C3%A9mancipation+du+Web.+L%26%238217%3Binstaller+sur+sa+machine+de+bureau+n%26%238217%3Best+pas+tr%C3%A8s+int%C3%A9ressant%2C+mais+on...&amp;tags=server%2Ctor%2Cubuntu%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/06/op52w9Q.jpg" length="88624" type="image/jpg" />	</item>
		<item>
		<title>Ça ferait de très bons noms de serveur&#8230;</title>
		<link>http://sametmax.com/ca-ferait-de-tres-bon-nom-de-serveur/</link>
		<comments>http://sametmax.com/ca-ferait-de-tres-bon-nom-de-serveur/#comments</comments>
		<pubDate>Wed, 22 May 2013 16:46:04 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Administration System]]></category>
		<category><![CDATA[Philo et culture]]></category>
		<category><![CDATA[meta]]></category>
		<category><![CDATA[server]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=6197</guid>
		<description><![CDATA[Non ?]]></description>
			<content:encoded><![CDATA[<ul>
<li>Hakuna matata</li>
<li>Yabadabadoo</li>
<li>Cowabunga</li>
<li>Scoobidoobidoo</li>
<li>Hey, Listen !</li>
<li>Fatality</li>
<li>GogoGadgeto</li>
<li>Doh</li>
<li>What&#8217;s up, doc</li>
<li>Beep-beep</li>
<li>Arriba</li>
<li>M&#8217;enfin</li>
<li>Par toutatis</li>
<li>Pas glop</li>
<li>Kamehameha</li>
<li>Yipikai</li>
<li>Fulguro point</li>
<li>Supercalifragilisticexpialidocious (ok, chiant à taper celui là)</li>
<li>Treguna, Mekoides, Trecorum, Satis, Dee (5 machines)</li>
</ul>
<p>Non ?</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=6197&amp;md5=3b636cd7749c8216f6112faad037e330" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/ca-ferait-de-tres-bon-nom-de-serveur/feed/</wfw:commentRss>
		<slash:comments>25</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fca-ferait-de-tres-bon-nom-de-serveur%2F&amp;language=en_GB&amp;category=text&amp;title=%C3%87a+ferait+de+tr%C3%A8s+bons+noms+de+serveur%26%238230%3B&amp;description=Hakuna+matata+Yabadabadoo+Cowabunga+Scoobidoobidoo+Hey%2C+Listen+%21+Fatality+GogoGadgeto+Doh+What%26%238217%3Bs+up%2C+doc+Beep-beep+Arriba+M%26%238217%3Benfin+Par+toutatis+Pas+glop+Kamehameha+Yipikai+Fulguro+point+Supercalifragilisticexpialidocious+%28ok%2C+chiant+%C3%A0+taper...&amp;tags=meta%2Cserver%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/05/oH2v3.jpg" length="249233" type="image/jpg" />	</item>
		<item>
		<title>Pourquoi ça a tranché, chérie</title>
		<link>http://sametmax.com/pourquoi-ca-a-tranche-cherie/</link>
		<comments>http://sametmax.com/pourquoi-ca-a-tranche-cherie/#comments</comments>
		<pubDate>Sat, 23 Feb 2013 07:02:27 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Administration System]]></category>
		<category><![CDATA[hosting]]></category>
		<category><![CDATA[meta]]></category>
		<category><![CDATA[server]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=4670</guid>
		<description><![CDATA[Juste un petit mot en passant pour expliquer le couac d'hier.]]></description>
			<content:encoded><![CDATA[<p>Juste un petit mot en passant pour expliquer le couac d&#8217;hier (et aussi parcequ&#8217;on se casse au ski donc les articles attendront) : notre hébergeur, leaseweb (et pas online.net qui était l&#8217;ancien hébergeur du blog), a eu quelques problèmes sur son réseau.</p>
<p>Comme ce sont des machines virtuelles, le problème s&#8217;est manifesté à notre niveau sous la forme d&#8217;un iowait de plus de 90% à la cause impossible à diagnostiquer et qui impliquait de fortes lenteurs sur le blog (et tous nos autres sites) jusqu&#8217;à ce qu&#8217;on force un reboot (juste sur le blog :-p).</p>
<p>C&#8217;était une mauvaise idée, puisque le serveur est devenu injoignable (alors que les autres tournaient mal, mais tournaient).</p>
<p>Au final, leaseweb à bien réagi en communiquant rapidement sur le problème et en remettant le truc d&#8217;équerre rapidement.</p>
<p>Ça nous a permis de réaliser que bien qu&#8217;on ait un backup du blog, on avait pas de backup de <a href="http://0bin.net">0bin</a>. C&#8217;est maintenant chose faite.</p>
<p>Comme on critique beaucoup Twitter en ce moment, au moins un point positif c&#8217;est que quand on se pête la gueule, on peut continuer à communiquer par ce genre de services tiers. Le could-social-over-hyper-3.0 n&#8217;a pas que du mauvais.</p>
<p>@+ dans le bus</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=4670&amp;md5=185ebdcd3bf5c9fab1d129d94d3b20f3" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/pourquoi-ca-a-tranche-cherie/feed/</wfw:commentRss>
		<slash:comments>9</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fpourquoi-ca-a-tranche-cherie%2F&amp;language=en_GB&amp;category=text&amp;title=Pourquoi+%C3%A7a+a+tranch%C3%A9%2C+ch%C3%A9rie&amp;description=Juste+un+petit+mot+en+passant+pour+expliquer+le+couac+d%26%238217%3Bhier+%28et+aussi+parcequ%26%238217%3Bon+se+casse+au+ski+donc+les+articles+attendront%29+%3A+notre+h%C3%A9bergeur%2C+leaseweb+%28et+pas+online.net+qui...&amp;tags=hosting%2Cmeta%2Cserver%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/02/traffic-jam.jpg" length="145160" type="image/jpg" />	</item>
		<item>
		<title>Redirection de &#8220;www&#8221; pour Apache, Nginx et Lighttpd</title>
		<link>http://sametmax.com/redirection-de-www-pour-apache-nginx-et-lighttpd/</link>
		<comments>http://sametmax.com/redirection-de-www-pour-apache-nginx-et-lighttpd/#comments</comments>
		<pubDate>Wed, 06 Jun 2012 01:44:39 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Administration System]]></category>
		<category><![CDATA[apache]]></category>
		<category><![CDATA[lighttp]]></category>
		<category><![CDATA[nginx]]></category>
		<category><![CDATA[server]]></category>
		<category><![CDATA[serveur]]></category>
		<category><![CDATA[www]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=870</guid>
		<description><![CDATA[Une fois que vous avez décidé si votre nom de domaine allait être précédé ou non de "www", il va falloir vous y tenir. Il va aussi falloir créer une redirection de l'un vers l'autre.]]></description>
			<content:encoded><![CDATA[<p>Une fois que vous avez décidé si votre nom de domaine allait être précédé ou non de &#8220;www&#8221;, il va falloir vous y tenir. Il va aussi falloir créer une redirection de l&#8217;un vers l&#8217;autre. Cela est en effet nécessaire  pour éviter que les moteurs de recherche ne considèrent qu&#8217;il y a du contenu dupliqué, mais aussi parceque certains outils (je ne vise personne en particulier, et sûrement pas l&#8217;admin WordPress) utilisent parfois les mauvaises URLs.</p>
<h2>Rediriger &#8220;www&#8221; avec Apache</h2>
<p>On peut mettre la redirection dans les fichiers de configuration Apache, mais le plus simple est de créer un fichier <em>.htaccess</em> dans le dossier qui contient tout le code de votre site Web, et d&#8217;y mettre le code qui gère la redirection.</p>
<h3>Pour rediriger de &#8220;www&#8221; vers l&#8217;adresse sans &#8220;www&#8221;</h3>
<p><code><br />
RewriteEngine On<br />
RewriteCond %{HTTP_HOST} ^www\.(.*) [NC]<br />
RewriteRule ^(.*) http://%1/$1 [R=301,L]</code></p>
<h3>Pour rediriger l&#8217;adresse sans &#8220;www&#8221; vers &#8220;www&#8221;</h3>
<p><code>RewriteEngine On<br />
RewriteCond %{HTTP_HOST} ^votresupersiteweb\.com$ [NC]<br />
RewriteRule ^(.*)$ http://www.votresupersiteweb.com/$1 [R=301,L]</code></p>
<p>Pour que la redirection marche, il faut vous assurer que le module <code>mod_rewrite</code> d&#8217;Apache est installé et activé, ce qui est la cas dans la plupart des installations et hébergeurs par défaut.</p>
<h2>Rediriger &#8220;www&#8221; avec Nginx</h2>
<p>Il faut mettre la redirection dans le fichier de configuration de votre site, généralement situé dans <em>/etc/nginx/conf.d/</em>. Vous avez besoin que nginx soit compilé avec le module rewrite, ce qui est le cas par défaut.</p>
<h3>Pour rediriger de &#8220;www&#8221; vers l&#8217;adresse sans &#8220;www&#8221;</h3>
<p><code>server {<br />
  listen 80;<br />
  server_name www.votresupersiteweb.com;<br />
  rewrite ^/(.*) http://votresupersiteweb.com/$1 permanent;<br />
}</code></p>
<h3>Pour rediriger l&#8217;adresse sans &#8220;www&#8221; vers &#8220;www&#8221;</h3>
<p><code>server {<br />
  listen 80;<br />
  server_name votresupersiteweb.com;<br />
  rewrite ^/(.*) http://www.votresupersiteweb.com/$1 permanent;<br />
}</code></p>
<p>Si vous avez déjà un bloc &#8220;server&#8221;, mettez celui-ci au dessus du précédent. Redémarrez Nginx pour que les changements soient pris en compte.</p>
<h2>Rediriger &#8220;www&#8221; avec Lighttpd</h2>
<p>Assurez vous que le module &#8220;mod_redirect&#8221; est activé dans le fichier de configuration de Lighttpd.<br />
This trick requires mod_redirect module. You should put it close to the top of the configuration file before other redirect or rewrite rules.</p>
<h3>Pour rediriger de &#8220;www&#8221; vers l&#8217;adresse sans &#8220;www&#8221;</h3>
<p><code>$HTTP["host"] =~ "^www\.(.*)$" {<br />
  url.redirect = ( "^/(.*)" => "http://%1/$1" )<br />
}<br />
</code></p>
<h3>Pour rediriger l&#8217;adresse sans &#8220;www&#8221; vers &#8220;www&#8221;</h3>
<p><code>$HTTP["host"] =~ "^votresupersiteweb\.com$" {<br />
  url.redirect = ( "^/(.*)" => "http://www.votresupersiteweb.com/$1" )<br />
}</code></p>
<p>Redémarrez Lighttpd pour que les changements soient pris en compte.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=870&amp;md5=cad65229b8573505ebee8bf7a0a562bc" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/redirection-de-www-pour-apache-nginx-et-lighttpd/feed/</wfw:commentRss>
		<slash:comments>7</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fredirection-de-www-pour-apache-nginx-et-lighttpd%2F&amp;language=en_GB&amp;category=text&amp;title=Redirection+de+%26%238220%3Bwww%26%238221%3B+pour+Apache%2C+Nginx+et+Lighttpd&amp;description=Une+fois+que+vous+avez+d%C3%A9cid%C3%A9+si+votre+nom+de+domaine+allait+%C3%AAtre+pr%C3%A9c%C3%A9d%C3%A9+ou+non+de+%26%238220%3Bwww%26%238221%3B%2C+il+va+falloir+vous+y+tenir.+Il+va+aussi+falloir+cr%C3%A9er+une...&amp;tags=apache%2Clighttp%2Cnginx%2Cserver%2Cserveur%2Cwww%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2012/06/images1.jpeg" length="12270" type="image/jpg" />	</item>
	</channel>
</rss>
