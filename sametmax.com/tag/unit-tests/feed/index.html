<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Sam &#38; Max: Python, Django, Git et du cul &#187; unit tests</title>
	<atom:link href="http://sametmax.com/tag/unit-tests/feed/" rel="self" type="application/rss+xml" />
	<link>http://sametmax.com</link>
	<description>Deux développeurs en vadrouille qui se sortent les doigts du code</description>
	<lastBuildDate>Wed, 05 Feb 2014 14:20:37 +0000</lastBuildDate>
	<language>en</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.3.1</generator>
	<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2F&amp;language=en_US&amp;category=text&amp;title=Sam+%26amp%3B+Max%3A+Python%2C+Django%2C+Git+et+du+cul&amp;description=Deux+d%C3%A9veloppeurs+en+vadrouille+qui+se+sortent+les+doigts+du+code&amp;tags=blog" type="text/html" />
		<item>
		<title>Un gros guide bien gras sur les tests unitaires en Python, partie 1</title>
		<link>http://sametmax.com/un-gros-guide-bien-gras-sur-les-tests-unitaires-en-python-partie-1/</link>
		<comments>http://sametmax.com/un-gros-guide-bien-gras-sur-les-tests-unitaires-en-python-partie-1/#comments</comments>
		<pubDate>Wed, 15 Jan 2014 15:26:00 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[assert]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[unit tests]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=8764</guid>
		<description><![CDATA[Les tests unitaires font partie de ces "bonnes pratiques" que tout le monde semble appliquer sur le net. Tous les devs hypes parlent de tests unitaires : les conférences, les blogs, les tutos, les livres, whooooo !

Dans la vraie vie vivante, on croise pourtant peu de gens qui les utilisent vraiment. On les retrouvent surtout dans les gros projets et les grosses boîtes, et encore.]]></description>
			<content:encoded><![CDATA[<p>La zik maintenant traditionelle :</p>

<!-- iframe plugin v:2.3 - wordpress.org/extend/plugins/iframe/ -->
<iframe width="560" height="315" src="//www.youtube.com/embed/1pm4fQRl72k" frameborder="0" scrolling="no" class="iframe-class"></iframe>
<p>Les tests unitaires font partie de ces &#8220;bonnes pratiques&#8221; que tout le monde semble appliquer sur le net. Tous les devs hypes parlent de tests unitaires : les conférences, les blogs, les tutos, les livres, whooooo !</p>
<p>Dans la vraie vie vivante, on croise pourtant peu de gens qui les utilisent vraiment. On les retrouvent surtout dans les gros projets et les grosses boîtes, et encore.</p>
<p>Il y a plusieurs raisons à cela. D&#8217;une part, beaucoup, beaucoup, beaucoup de développeurs n&#8217;ont aucune idée de ce qu&#8217;est un test unitaire. Ceux qui savent, ne voient pas forcément l’intérêt, et ceux qui en voient l’intérêt n&#8217;ont pas forcément l&#8217;expérience nécessaire à leur mise en œuvre.</p>
<p>Je connais des tas de dev qui codent des tas d&#8217;excellents projets sans le moindre test unitaires.</p>
<p>L&#8217;adage selon lequel un code sans test unitaire est un code buggé est parfaitement faux puisque existe bien d&#8217;autres manières de tester son code. De plus, même un code bien testé est un code buggé. Je le sais, je l&#8217;ai codé.</p>
<p>Malgré cela, vous devriez maitriser l&#8217;usage des tests unitaires, car quand vous arrivez à vous sortir les extrémités digitales de la terminaison dorsale afin de les mettre en place, le bénéfice est très important. Mais aussi parce que certains projets ne peuvent pas s&#8217;en passer, et donc que vous ne pourrez pas travailler dessus sans savoir en faire. Certains projets sur Github n&#8217;acceptent pas de pull request sans couverture de tests, et certaines personnes n&#8217;utiliseront pas votre lib si elle n&#8217;est pas testée. C&#8217;est un gage de qualité.</p>
<p>Je n&#8217;en ferai pas une question morale ou de principe, les projets que l&#8217;on publie sur Sam et Max sont parfaitement exempt de tests unitaires, et d&#8217;ailleurs, la plupart des projets pros avec Max n&#8217;ont aucun tests non plus.</p>
<p>En revanche, en tant que freelance, je prends généralement le temps d&#8217;en faire.</p>
<p>Pas de dogmatisme du test donc, mais passé le goût de crabe dans la bouche, ça vaut le coup, alors lisez ce guide.</p>
<h2>Qu&#8217;est-ce qu&#8217;un test unitaire</h2>
<p>Le test unitaire est un bout de code qui fait exactement ce que son nom dit : il teste une unité de code.</p>
<p>Le problème c&#8217;est quoi tester, qu&#8217;est-ce qu&#8217;une &#8220;unité de code&#8221;, ce n&#8217;est pas quelque chose d&#8217;évident à définir, et vient avec la pratique. En théorie c&#8217;est un bout de code minimaliste, que l&#8217;on ne peut pas réduire plus. En pratique, on choisit avec pragmatisme un truc assez petit, mais pas trop, parce que merde, hein.</p>
<p>Mais alors que veut-on dire par &#8220;tester&#8221; ?</p>
<p>Et bien c&#8217;est d&#8217;une banalité affligeante : on donne des entrées au code, et on vérifie que ses sorties sont celles attendues pour ces entrées.</p>
<p>Bref, généralement (mais pas toujours) on teste une fonction. Souvent avec une autre fonction. Et c&#8217;est d&#8217;un manque d&#8217;originalité terrible.</p>
<p>Le test unitaire le plus bête qu&#8217;on puisse avoir en Python :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># Fichier de code</span>
<span style="color: #ff7700;font-weight:bold;">def</span> fonction_a_tester<span style="color: black;">&#40;</span>param1, param2<span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">return</span> param1 + param2</pre></div></div>


<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># Fichier de test</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> fichier_de_code <span style="color: #ff7700;font-weight:bold;">import</span> fonction_a_test
&nbsp;
<span style="color: #ff7700;font-weight:bold;">assert</span> fonction_a_tester<span style="color: black;">&#40;</span><span style="color: #ff4500;">1</span>, <span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span> == <span style="color: #ff4500;">2</span>  <span style="color: #808080; font-style: italic;"># test de l'addition</span>
<span style="color: #ff7700;font-weight:bold;">assert</span> fonction_a_tester<span style="color: black;">&#40;</span><span style="color: #ff4500;">1</span>, -<span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span> == <span style="color: #ff4500;">0</span> <span style="color: #808080; font-style: italic;"># test avec chiffre négatif</span>
<span style="color: #ff7700;font-weight:bold;">assert</span> fonction_a_tester<span style="color: black;">&#40;</span><span style="color: #ff4500;">4</span>, <span style="color: #ff4500;">2</span><span style="color: black;">&#41;</span> == <span style="color: #ff4500;">6</span> <span style="color: #808080; font-style: italic;"># test avec autre chose que des 1</span>
<span style="color: #ff7700;font-weight:bold;">assert</span> fonction_a_tester<span style="color: black;">&#40;</span><span style="color: #ff4500;">4</span>., <span style="color: #ff4500;">2</span><span style="color: black;">&#41;</span> == <span style="color: #ff4500;">6</span>. <span style="color: #808080; font-style: italic;"># test avec des floats</span></pre></div></div>

<p>Deux constats :</p>
<ul>
<li>C&#8217;est parfaitement chiant. Les tests unitaires sont dans 99% des cas des tautologiques super ennuyeuses.</li>
<li>On teste le même code plusieurs fois, avec plusieurs cas de figure, pour être certain que ça se comporte comme prévu.</li>
</ul>
<p><code>assert</code> est un mot clé qui lève l&#8217;exception <code>AssertionError</code> quand l&#8217;expression évaluée ne retourne pas <code>True</code>. L&#8217;utilisation d&#8217;<code>assert</code> n&#8217;est pas le sujet de l&#8217;article, ici on s&#8217;en sert pour faire un test unitaire tout simplement parce que la première ligne qui ne renverra pas <code>True</code> fera  planter le programme. C&#8217;est le test unitaire du pauvre.</p>
<p>Un test unitaire, ce n&#8217;est que ça. Un répétition bête et emmerdante de vérifications généralement très connes.</p>
<h2>C&#8217;est minable ! A quoi ça sert ?</h2>
<p>Là normalement vous vous dites &#8220;je sais ce que fait mon code, surtout une unité minimaliste, je n&#8217;ai pas besoin d&#8217;écrire des évidences pour le tester&#8221;. Et c&#8217;est pour cela que je ne suis pas dogmatique sur les tests unitaires, car c&#8217;est en partie vrai. Beaucoup de codes sont suffisamment simples ou peu critiques pour ne pas avoir besoin d&#8217;être renforcés par des tests unitaires. Et même si il faut des tests, tout le code n&#8217;a pas nécessairement besoin d&#8217;être testé.</p>
<p>Lancer un blog pour sa cousine n&#8217;est pas la même chose qu&#8217;une site de rencontre pour un grand compte.</p>
<p>Mais le test unitaire a plusieurs bénéfices. Le premier c&#8217;est qu&#8217;il vous oblige à réfléchir aux entrées et sorties de vos fonctions, et à l&#8217;API de votre code en général. Vous vous apercevrez à l&#8217;usage qu&#8217;un code est plus ou moins facile à tester selon la manière dont vous l&#8217;avez organisé, et ce faisant, vous serez forcé d&#8217;écrire un code plus souple, propre, extensible.</p>
<p>Écrire des tests fait de vous un meilleur développeur.</p>
<p>Cependant ce n&#8217;est pas le principal intérêt. Le véritable gain tient dans ce que vous gagnez dans le futur : quand vous allez modifier votre code, vous pourrez rapidement voir si il n&#8217;est pas cassé. En effet, votre code va grossir, et vous ne vous souviendrez pas de toutes les dépendances, de tous les effets de bords, de toutes les interactions. Certains dev sont meilleurs que d&#8217;autres à tout garder dans la tête, mais même Cortex a ses limites. Au bout d&#8217;un moment, le code est plus fort que vous.</p>
<p>À partir de là, vous allez tout de même avoir besoin de factoriser le code, bouger des choses, en ajouter d&#8217;autres, corriger un bug, faire un petit ajustement. À chaque fois que vous le faites, vous prenez le risque de casser un truc. Au début du projet, le risque est faible, et même si ça arrive, ça se répare vite. Après 2 mois de dev, les tests seront votre filet de sécurité. Vous pouvez les lancer après chaque modif, et voir que vous n&#8217;avez rien pété. Vous pouvez les lancer après une contribution d&#8217;un autre dev, et voir que ça tourne toujours. Vous pouvez les lancer après un changement d’environnement (OS, base de données, système de fichier, format, etc) et vous assurer que ça n&#8217;a pas d’impacts.</p>
<p>Particulièrement, des tests unitaires ont beaucoup de valeur sur un projet avec beaucoup de participants, tels que des logiciels libres populaires ou des systèmes de grandes sociétés.</p>
<p>Par exemple, sur notre dernière fonction bidon, on décide de faire une petite modification :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># Fichier de code</span>
<span style="color: #ff7700;font-weight:bold;">def</span> fonction_a_tester<span style="color: black;">&#40;</span>param1, param2<span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>param1<span style="color: black;">&#41;</span> + <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>param2<span style="color: black;">&#41;</span></pre></div></div>

<p>On peut maintenant passer une string, et elle sera convertie en entier.</p>
<p>On lance notre batterie de tests, et là, au milieu de centaines d&#8217;autres tests, celui là foire :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">assert</span> fonction_a_tester<span style="color: black;">&#40;</span><span style="color: #ff4500;">4</span>., <span style="color: #ff4500;">2</span><span style="color: black;">&#41;</span> == <span style="color: #ff4500;">6</span>. <span style="color: #808080; font-style: italic;"># test avec des floats</span></pre></div></div>

<p>On voit très vite que notre idée était pourrie, car on a un use case qui ne sera plus compatible. Si quelqu&#8217;un a utilisé des floats avec notre fonction, on va casser son code.</p>
<p>En l&#8217;essence, c&#8217;est ça l’intérêt des tests unitaires : vous faire sauter au yeux quand quelque chose casse. On appelle ça des &#8220;tests de régression&#8221;, et c&#8217;est l&#8217;usage le plus courant.</p>
<p>Plus tard vous verrez qu&#8217;on utilise aussi les tests pour développer son code (TDD), pour définir un comportement du produit avec le client (BDD) ou tout simplement pour servir de documentation.</p>
<p>Mais l&#8217;usage de base, c&#8217;est ça. S&#8217;assurer qu&#8217;on est pas en train de merder.</p>
<h2>Résumé</h2>
<ol>
<li>N&#8217;écoutez pas les Papes du test vous disant que si vous n&#8217;avez pas des tests unitaires à 50 ans, vous avez raté votre vie. Les tests, c&#8217;est bien. Un projet livré, c&#8217;est mieux. Une documentation est plus importante que des tests. Les 3, évidement, c&#8217;est l&#8217;idéal.</li>
<li>Un test, c&#8217;est une suite parfaitement chiante d&#8217;énonciations d&#8217;évidences. Il n&#8217;y a généralement rien de compliqué dans les tests. Vous vous sentirez parfois insulté en les écrivant tellement c&#8217;est con.</li>
<li>L’intérêt majeur des tests est d&#8217;avoir une alerte rouge qui se lance quand vous avez pété un truc. Ça arrive bien plus souvent que vous ne le croyez sans que vous ne vous en aperceviez car vous n&#8217;avez pas de tests.</li>
</ol>
<p>Ces bases posées, la prochaine partie fera la démonstration du module <a href="http://docs.python.org/2/library/unittest.html">unittest</a> afin de créer vos premiers tests unitaires en Python, puis on enchaînera, partie par partie, sur les applications pratiques, les variantes, les girafes lesbiennes et tout ce qui fait un bon article de s&#038;m.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=8764&amp;md5=ca05e3d293406df04c3c71bb017b88a4" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/un-gros-guide-bien-gras-sur-les-tests-unitaires-en-python-partie-1/feed/</wfw:commentRss>
		<slash:comments>16</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fun-gros-guide-bien-gras-sur-les-tests-unitaires-en-python-partie-1%2F&amp;language=en_GB&amp;category=text&amp;title=Un+gros+guide+bien+gras+sur+les+tests+unitaires+en+Python%2C+partie+1&amp;description=La+zik+maintenant+traditionelle+%3A+Les+tests+unitaires+font+partie+de+ces+%26%238220%3Bbonnes+pratiques%26%238221%3B+que+tout+le+monde+semble+appliquer+sur+le+net.+Tous+les+devs+hypes+parlent+de+tests...&amp;tags=assert%2Cpython%2Cunit+tests%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2014/01/sm4y87Q.jpg" length="31863" type="image/jpg" />	</item>
		<item>
		<title>Ajouter une route au urls.py de Django durant les tests</title>
		<link>http://sametmax.com/ajouter-une-route-au-urls-py-de-django-durant-les-tests/</link>
		<comments>http://sametmax.com/ajouter-une-route-au-urls-py-de-django-durant-les-tests/#comments</comments>
		<pubDate>Thu, 09 May 2013 08:55:37 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[django]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[routes]]></category>
		<category><![CDATA[unit tests]]></category>
		<category><![CDATA[urls.py]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=5965</guid>
		<description><![CDATA[Créer des routes dans l'urlconf juste pour les tests unitaires n'est pas très propre, heureusement on peut utiliser des urls de test complètement séparées.]]></description>
			<content:encoded><![CDATA[<p>Créer des routes dans l&#8217;urlconf juste pour les tests unitaires n&#8217;est pas très propre, heureusement on peut utiliser des urls de test complètement séparées.</p>
<p>D&#8217;abord, il faut mettre un fichier <em>urls.py</em> dans votre dossier <em>tests</em> qui contient vos routes de tests. Ensuite&#8230;</p>
<p>Si vous utilisez le mécanisme de Django pour les tests, il suffit de déclarer le chemin de ce module comme attribut <code>urls</code> de votre classe de test, et Django se charge du reste :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">class</span> VotreTestCase<span style="color: black;">&#40;</span>TestCase<span style="color: black;">&#41;</span>:
    urls = <span style="color: #483d8b;">'votreapp.tests.urls'</span></pre></div></div>

<p>Dans le cas où, comme moi, vous préférez utiliser <a href="http://sametmax.com/se-simplifier-les-tests-python-avec-pytest/">une autre lib</a> pour écrire vos tests, vous pouvez quand choisir votre module d&#8217;urls en faisant :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">from</span> django.<span style="color: black;">conf</span> <span style="color: #ff7700;font-weight:bold;">import</span> settings
<span style="color: #ff7700;font-weight:bold;">from</span> django.<span style="color: black;">core</span>.<span style="color: black;">urlresolvers</span> <span style="color: #ff7700;font-weight:bold;">import</span> clear_url_caches
&nbsp;
<span style="color: #ff7700;font-weight:bold;">import</span> urls
&nbsp;
settings.<span style="color: black;">ROOT_URLCONF</span> = urls
<span style="color: #808080; font-style: italic;"># n'oubliez pas cette ligne, sinon vous autre des comportements aberrant</span>
<span style="color: #808080; font-style: italic;"># car django met les urls en cache</span>
clear_url_caches<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></div></div>

 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=5965&amp;md5=a99445b6954686cc63707726dba48ea9" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/ajouter-une-route-au-urls-py-de-django-durant-les-tests/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fajouter-une-route-au-urls-py-de-django-durant-les-tests%2F&amp;language=en_GB&amp;category=text&amp;title=Ajouter+une+route+au+urls.py+de+Django+durant+les+tests&amp;description=Cr%C3%A9er+des+routes+dans+l%26%238217%3Burlconf+juste+pour+les+tests+unitaires+n%26%238217%3Best+pas+tr%C3%A8s+propre%2C+heureusement+on+peut+utiliser+des+urls+de+test+compl%C3%A8tement+s%C3%A9par%C3%A9es.+D%26%238217%3Babord%2C+il+faut+mettre+un+fichier...&amp;tags=django%2Cpython%2Croutes%2Cunit+tests%2Curls.py%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/05/RixqOqk.jpg" length="75780" type="image/jpg" />	</item>
		<item>
		<title>Paramètres par défaut pour la commande py.test</title>
		<link>http://sametmax.com/parametres-par-defaut-pour-la-commande-py-test/</link>
		<comments>http://sametmax.com/parametres-par-defaut-pour-la-commande-py-test/#comments</comments>
		<pubDate>Fri, 03 May 2013 08:23:51 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[pytest]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[tox]]></category>
		<category><![CDATA[unit tests]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=5969</guid>
		<description><![CDATA[Je ne fais plus de tests unittaires sans <a href="http://sametmax.com/se-simplifier-les-tests-python-avec-pytest/">pytest</a>, et je me retrouve souvent à rentrer les mêmes paramètres de la commande encore et encore. Parfois, quand j'autilise des wrappers tels que django-pytest et pytest-django (ça s'invente pas), je ne peux même pas passer d'arguments directement à <code>py.test</code>.

On peut y remedier en créer un fichier de config à la racine du projet.]]></description>
			<content:encoded><![CDATA[<p>Je ne fais plus de tests unittaires sans <a href="http://sametmax.com/se-simplifier-les-tests-python-avec-pytest/">pytest</a>, et je me retrouve souvent à rentrer les mêmes paramètres de la commande encore et encore. Parfois, quand j&#8217;utilise des wrappers tels que django-pytest et pytest-django (ça s&#8217;invente pas), je ne peux même pas passer d&#8217;arguments directement à <code>py.test</code>.</p>
<p>On peut y remédier en créant un fichier de config à la racine du projet. Nommez le fichier <em>tox.ini</em>, car c&#8217;est aussi le nom du fichier de configuration de l&#8217;outil de tests <a href="http://testrun.org/tox/latest//">tox</a>, et il est compatible, donc autant avoir un seul format. Dedans, créez une section pytest, et vous pouvez configurer la lib la dedans.</p>
<p>En l’occurrence, le settings &#8220;addopts&#8221;, pour &#8220;add options&#8221; (ajouter options), permet de spécifier les options de la ligne de commande à toujours ajouter à <code>py.test</code>.</p>
<p>Mon fichier contient toujours au moins ceci :</p>

<div class="wp_syntax"><div class="code"><pre class="json" style="font-family:monospace;">[pytest]
addopts = --ignore=&quot;virtualenv&quot; --capture=no</pre></div></div>

<p>Ainsi <code>py.test</code> ignore toujours le dossier <em>virtualenv</em> (qui est un lien vers l&#8217;env virtuel de mon projet) car je ne veux pas qu&#8217;il lance les tests de ce dossier. Et il ne capture pas stdout, ce qui me permet d&#8217;utiliser <a href="http://sametmax.com/debugger-en-python-les-bases-de-pdb/">ipdb</a> pendant les tests unittaires. Parfois j&#8217;utilise aussi <code>--maxfail=1</code> quand je veux qu&#8217;il s&#8217;arrête dès la première erreur rencontrée.</p>
<p>Pour ne pas aller dans ce dossier et ne pas capturer stdout.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=5969&amp;md5=a6fe4d17d33ee89c21be724c6325f4d8" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/parametres-par-defaut-pour-la-commande-py-test/feed/</wfw:commentRss>
		<slash:comments>3</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fparametres-par-defaut-pour-la-commande-py-test%2F&amp;language=en_GB&amp;category=text&amp;title=Param%C3%A8tres+par+d%C3%A9faut+pour+la+commande+py.test&amp;description=Je+ne+fais+plus+de+tests+unittaires+sans+pytest%2C+et+je+me+retrouve+souvent+%C3%A0+rentrer+les+m%C3%AAmes+param%C3%A8tres+de+la+commande+encore+et+encore.+Parfois%2C+quand+j%26%238217%3Butilise+des+wrappers...&amp;tags=pytest%2Cpython%2Ctox%2Cunit+tests%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/05/OaEu6Os.jpg" length="78922" type="image/jpg" />	</item>
		<item>
		<title>Se simplifier les tests Python avec Pytest</title>
		<link>http://sametmax.com/se-simplifier-les-tests-python-avec-pytest/</link>
		<comments>http://sametmax.com/se-simplifier-les-tests-python-avec-pytest/#comments</comments>
		<pubDate>Wed, 07 Nov 2012 12:04:50 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[unit tests]]></category>
		<category><![CDATA[unittest]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=2884</guid>
		<description><![CDATA[Et si on pouvait rendre les tests plus simples à écrire et à lire, aussi simple qu'un <code>assert</code>, mais un résultat plus clair que <code>unittest</code> en sortie ?]]></description>
			<content:encoded><![CDATA[<p>Personne n&#8217;aime faire des tests unitaires. C&#8217;est un peu comme les impôts: on sait que c&#8217;est utile, mais on est jamais content de s&#8217;en occuper.</p>
<p>Réchèr m&#8217;a dernièrement <a href="http://sametmax.com/quelques-innovation-de-python-3-backportees-en-python-2-7/#comment-2870">posé la question</a> de l&#8217;abondance des méthodes <code>assertTruc()</code> et leur utilité, et je lui ai répondu que chaque méthode donnait des infos adaptées au test effectué.</p>
<p>Max m&#8217;a dernièrement fait la remarque que les tests &#8220;c&#8217;est bien mais c&#8217;est compliqué&#8221;. J&#8217;avoue être à court de contre argument.</p>
<p>Et si on pouvait rendre les tests plus simples à écrire et à lire, aussi simple qu&#8217;un <code>assert</code>, mais avec un résultat plus clair que <code>unittest</code> en sortie ?</p>
<p><code><a href="http://sametmax.com/votre-python-aime-les-pip/">pip install</a> pytest </code></p>
<p><a href="http://pytest.org/latest/index.html">Pytest</a> est une lib de test à utiliser à la place de <a href="http://docs.python.org/2/library/unittest.html">unittest</a>. Ses créateurs utilisent l&#8217;introspections et l&#8217;injection de dépendance pour créer des tests magiquement.</p>
<p>D&#8217;ordinnaire, la magie, on aime pas trop ça en Python, et on laisse ça aux rubistes. Mais dans le domaine du test, qui n&#8217;est pas un code de production avec les mêmes contraintes de lecture, de recherche de bugs architecturaux et d&#8217;interactions entre dev, mais qui a par contre une forte contrainte &#8220;j&#8217;ai pas envie d&#8217;écrire un caractère de plus&#8221;, ça a du sens.</p>
<p>Voilà comment ça se passe: on vire toute ce qui est classe et setup verbeux. On laisse juste les imports de vos libs, et les tests. Avec des <code>assert</code>. Pytest va alors analyser tout ça, et faire tout le boulot autour pour vous.</p>
<p>Exemple:</p>
<p>Dans votre lib:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">def</span> ma_fonction_a_tester<span style="color: black;">&#40;</span>a, b<span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">return</span> a + b</pre></div></div>

<p>Dans votre fichier test.py:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">from</span> malib <span style="color: #ff7700;font-weight:bold;">import</span> ma_fonction_a_tester
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> test_function<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">assert</span> ma_fonction_a_tester<span style="color: black;">&#40;</span><span style="color: #ff4500;">1</span>, <span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span> == <span style="color: #ff4500;">2</span></pre></div></div>

<p>Et on lance :</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">py.test test.py</pre></div></div>

<p>Pour obtenir:</p>
<pre>====== test session starts ======
platform linux2 -- Python 2.7.3 -- pytest-2.3.2
collected 1 items

Bureau/test.py .

====== 1 passed in 0.02 seconds ======
</pre>
<p>Et voilà, les tests redeviennent bêtes et simples. Mais ils ne perdent pas en puissance. Car Pytest analyse le <code>assert</code>, et le transforme à la volée. Du coup, pour les <a href="http://sametmax.com/quest-ce-quune-structure-de-donnees/">structures de données</a> complexes, Pytest va vous sortir les infos de debug utile que <code>assertTruc()</code> de unittest vous aurait sorti.</p>
<p>Exemple avec des tuples:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">def</span> ma_fonction_a_tester<span style="color: black;">&#40;</span>a, b<span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: black;">&#40;</span>a <span style="color: #66cc66;">*</span> <span style="color: #ff4500;">2</span>, b <span style="color: #66cc66;">*</span> <span style="color: #ff4500;">2</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> test_function<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">assert</span> ma_fonction_a_tester<span style="color: black;">&#40;</span><span style="color: #ff4500;">1</span>, <span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span> == <span style="color: black;">&#40;</span><span style="color: #ff4500;">2</span>, <span style="color: #ff4500;">2</span>, <span style="color: #ff4500;">3</span><span style="color: black;">&#41;</span></pre></div></div>

<p>Va donner:</p>
<pre>
====== test session starts ======
platform linux2 -- Python 2.7.3 -- pytest-2.3.2
collected 1 items

Bureau/test.py F

====== FAILURES ======
______ test_function ______

    def test_function():
>       assert ma_fonction_a_tester(1, 1) == (2, 2, 3)
E       assert (2, 2) == (2, 2, 3)
E         Right contains more items, first extra item: 3

Bureau/test.py:7: AssertionError
====== 1 failed in 0.02 seconds ======</pre>
<p>On nous indique clairement qu&#8217;il y a un item de trop dans mon résultat, et lequel.</p>
<p>En prime, Pytest nous affranchie des fonctions <code>setUp()</code> et <code>tearDown()</code> génériques. Le problème de ces méthodes dans unittest, c&#8217;est qu&#8217;elles sont éxécutées à chaque début de test. On en a pas forcément besoin, et on a pas les mêmes besoins pour chaque test.</p>
<p>Pytest ajoute encore un peu de magie pour régler le probleme</p>
<p>Dans votre lib, vous avez ça:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">re</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> extraire_title<span style="color: black;">&#40;</span>html<span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot;
        Extrait le title d'une page HTML a base de regex. C'est mal.
    &quot;&quot;&quot;</span>
    <span style="color: #ff7700;font-weight:bold;">try</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #dc143c;">re</span>.<span style="color: black;">search</span><span style="color: black;">&#40;</span>r<span style="color: #483d8b;">'&lt;title[^&gt;]*&gt;(.*)&lt;/title&gt;'</span>, html<span style="color: black;">&#41;</span>.<span style="color: black;">groups</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#93;</span>
    <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">IndexError</span>, <span style="color: #008000;">AttributeError</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">None</span></pre></div></div>

<p>Dans votre fichier de tests, vous aurez:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">urllib2</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">import</span> pytest
&nbsp;
@pytest.<span style="color: black;">fixture</span>
<span style="color: #ff7700;font-weight:bold;">def</span> exemple_html<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #dc143c;">urllib2</span>.<span style="color: black;">urlopen</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'http://www.google.com'</span><span style="color: black;">&#41;</span>.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> test_extraire_title<span style="color: black;">&#40;</span>exemple_html<span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">assert</span> extraire_title<span style="color: black;">&#40;</span>exemple_html<span style="color: black;">&#41;</span> == <span style="color: #483d8b;">'Google'</span></pre></div></div>

<p>Qu&#8217;est-ce qui va se passer ?</p>
<p><code>exemple_html()</code> va être déclarée comme une &#8220;fixture&#8221;, c&#8217;est à dire quelque chose qui contient ou génère des données de tests.</p>
<p>Quand Pytest va lancer les tests, il va voir qu&#8217;un argument de <code>test_extraire_title()</code> porte le même nom que la fonction <code>exemple_html</code>. Alors, il va automatiquement appeler <code>exemple_html()</code>, et passer le résultat à <code>test_extraire_title()</code> pour lancer le test.</p>
<p>On peut donc avoir des tas de fonctions de setup, partagées entre plein de fonctons de tests.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=2884&amp;md5=12bb42833a5c3fde7be9055ac639d7ba" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/se-simplifier-les-tests-python-avec-pytest/feed/</wfw:commentRss>
		<slash:comments>9</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fse-simplifier-les-tests-python-avec-pytest%2F&amp;language=en_GB&amp;category=text&amp;title=Se+simplifier+les+tests+Python+avec+Pytest&amp;description=Personne+n%26%238217%3Baime+faire+des+tests+unitaires.+C%26%238217%3Best+un+peu+comme+les+imp%C3%B4ts%3A+on+sait+que+c%26%238217%3Best+utile%2C+mais+on+est+jamais+content+de+s%26%238217%3Ben+occuper.+R%C3%A9ch%C3%A8r+m%26%238217%3Ba+derni%C3%A8rement+pos%C3%A9+la...&amp;tags=python%2Cunit+tests%2Cunittest%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2012/11/fat-free-product-4001.jpg" length="186363" type="image/jpg" />	</item>
		<item>
		<title>Quelques innovation de Python 3 backportées en Python 2.7</title>
		<link>http://sametmax.com/quelques-innovation-de-python-3-backportees-en-python-2-7/</link>
		<comments>http://sametmax.com/quelques-innovation-de-python-3-backportees-en-python-2-7/#comments</comments>
		<pubDate>Mon, 05 Nov 2012 11:36:42 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[context manager]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[sets]]></category>
		<category><![CDATA[strings]]></category>
		<category><![CDATA[unit tests]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=2863</guid>
		<description><![CDATA[Comme nous l'avons vu avec les vues ou les collections, Python 2.7 vient avec pas mal de bonus issus directement de la branche 3. En voici quelques autres. Tout ceci n'est bien sûr ni nouveau ni exhaustif, mais je m’aperçois que peu de personnes le savent.]]></description>
			<content:encoded><![CDATA[<p>Comme nous l&#8217;avons vu avec les <a href="http://sametmax.com/les-vues-sur-des-collections-en-python/">vues</a> ou les <a href="http://sametmax.com/ce-que-vous-ne-saviez-pas-sur-les-collections-en-python/">collections</a>, Python 2.7 vient avec pas mal de bonus issus directement de la branche 3. En voici quelques autres. Tout ceci n&#8217;est bien sûr ni nouveau ni exhaustif, mais je m’aperçois que peu de personnes le savent.</p>
<p>Une notation littérale pour les sets:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: black;">&#123;</span><span style="color: #ff4500;">1</span>, <span style="color: #ff4500;">2</span><span style="color: black;">&#125;</span> == <span style="color: #008000;">set</span><span style="color: black;">&#40;</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">1</span>, <span style="color: #ff4500;">2</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: #008000;">True</span></pre></div></div>

<p>Une syntaxe pour les dictionnaires en intention:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> d = <span style="color: black;">&#123;</span><span style="color: #008000;">chr</span><span style="color: black;">&#40;</span>x<span style="color: black;">&#41;</span>: x <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">65</span>, <span style="color: #ff4500;">91</span><span style="color: black;">&#41;</span><span style="color: black;">&#125;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> d
<span style="color: black;">&#123;</span><span style="color: #483d8b;">'A'</span>: <span style="color: #ff4500;">65</span>, <span style="color: #483d8b;">'C'</span>: <span style="color: #ff4500;">67</span>, <span style="color: #483d8b;">'B'</span>: <span style="color: #ff4500;">66</span>, <span style="color: #483d8b;">'E'</span>: <span style="color: #ff4500;">69</span>, <span style="color: #483d8b;">'D'</span>: <span style="color: #ff4500;">68</span>, <span style="color: #483d8b;">'G'</span>: <span style="color: #ff4500;">71</span>, <span style="color: #483d8b;">'F'</span>: <span style="color: #ff4500;">70</span>, <span style="color: #483d8b;">'I'</span>: <span style="color: #ff4500;">73</span>, <span style="color: #483d8b;">'H'</span>: <span style="color: #ff4500;">72</span>, <span style="color: #483d8b;">'K'</span>: <span style="color: #ff4500;">75</span>, <span style="color: #483d8b;">'J'</span>: <span style="color: #ff4500;">74</span>, <span style="color: #483d8b;">'M'</span>: <span style="color: #ff4500;">77</span>, <span style="color: #483d8b;">'L'</span>: <span style="color: #ff4500;">76</span>, <span style="color: #483d8b;">'O'</span>: <span style="color: #ff4500;">79</span>, <span style="color: #483d8b;">'N'</span>: <span style="color: #ff4500;">78</span>, <span style="color: #483d8b;">'Q'</span>: <span style="color: #ff4500;">81</span>, <span style="color: #483d8b;">'P'</span>: <span style="color: #ff4500;">80</span>, <span style="color: #483d8b;">'S'</span>: <span style="color: #ff4500;">83</span>, <span style="color: #483d8b;">'R'</span>: <span style="color: #ff4500;">82</span>, <span style="color: #483d8b;">'U'</span>: <span style="color: #ff4500;">85</span>, <span style="color: #483d8b;">'T'</span>: <span style="color: #ff4500;">84</span>, <span style="color: #483d8b;">'W'</span>: <span style="color: #ff4500;">87</span>, <span style="color: #483d8b;">'V'</span>: <span style="color: #ff4500;">86</span>, <span style="color: #483d8b;">'Y'</span>: <span style="color: #ff4500;">89</span>, <span style="color: #483d8b;">'X'</span>: <span style="color: #ff4500;">88</span>, <span style="color: #483d8b;">'Z'</span>: <span style="color: #ff4500;">90</span><span style="color: black;">&#125;</span></pre></div></div>

<p>Imbriquer <code>with</code>:</p>
<p>Avant il fallait utiliser <a href="http://docs.python.org/2/library/contextlib.html#contextlib.nested">nested()</a> ou imbriquer à la main</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">with</span> <span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'fichiera'</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> a:
    <span style="color: #ff7700;font-weight:bold;">with</span> <span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'fichiera'</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> b:
        <span style="color: #808080; font-style: italic;"># faire un truc</span></pre></div></div>

<p>Maintenant on peut faire:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">with</span> <span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'fichiera'</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> a, <span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'fichiera'</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> b:
    <span style="color: #808080; font-style: italic;"># faire un truc</span></pre></div></div>

<p>Rien à voir, mais toujours sympa. <code>timedelta</code> a maintenant une méthode <code>total_seconds()</code> qui retourne la valeur de la durée en seconde. En effet, l&#8217;attribut <code>seconds</code> ne retourne que ce qui reste en seconde une fois qu&#8217;on a retiré les jours:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">datetime</span> <span style="color: #ff7700;font-weight:bold;">import</span> timedelta
<span style="color: #66cc66;">&gt;&gt;&gt;</span> delta = timedelta<span style="color: black;">&#40;</span>days=<span style="color: #ff4500;">1</span>, seconds=<span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> delta.<span style="color: black;">seconds</span>
<span style="color: #ff4500;">1</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> delta.<span style="color: black;">total_seconds</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #ff4500;">86401.0</span></pre></div></div>

<p>Notez qu&#8217;il n&#8217;y a toujours ni attribut minutes, ni heures.</p>
<p>Le module <code>unittest</code> gagne une pléthore d&#8217;améliorations, et notamment:</p>
<p>L&#8217;utilisation de <code>assertRaises</code> comme context manager:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">with</span> <span style="color: #008000;">self</span>.<span style="color: black;">assertRaises</span><span style="color: black;">&#40;</span><span style="color: #008000;">KeyError</span><span style="color: black;">&#41;</span>:
    <span style="color: black;">&#123;</span><span style="color: black;">&#125;</span><span style="color: black;">&#91;</span><span style="color: #483d8b;">'foo'</span><span style="color: black;">&#93;</span></pre></div></div>

<p>Et un bon gros nombres de méthodes:</p>
<p><code>assertIsNone()</code> / <code>assertIsNotNone()</code>, <code>assertIs()</code> / <code>assertIsNot()</code>, <code>assertIsInstance()</code> / <code>assertNotIsInstance()</code>, <code>assertGreater()</code> / <code>assertGreaterEqual()</code> / <code>assertLess()</code> / <code>assertLessEqual()</code>, <code>assertRegexpMatches()</code> / <code>assertNotRegexpMatches()</code>, <code>assertRaisesRegexp()</code>,<br />
<code>assertIn()</code> / <code>assertNotIn()</code>, <code>assertDictContainsSubset()</code>, <code>assertAlmostEqual()</code> / <code>assertNotAlmostEqual()</code>.</p>
<p>Enfin <code>format()</code> commence à devenir une alternative valable à <code>%</code> car il propose maintenant des marqueurs sans noter d’index:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #483d8b;">&quot;{}, puis {} et finalement {}&quot;</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: #66cc66;">*</span><span style="color: #008000;">range</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">3</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: #483d8b;">'0, puis 1 et finalement 2'</span></pre></div></div>

<p>Et il ajoute le séparateur des milliers au mini-langage de formatage, mais pour la virgule uniquement. Par exemple, si avoir un nombre de 15 caractères minimum formater en tant que float, avec deux chiffres après la virgules, et donc les milliers sont groupés à l&#8217;américaine:</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #483d8b;">'{:15,.2f}'</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">54321</span><span style="color: black;">&#41;</span>
<span style="color: #483d8b;">'      54,321.00'</span></pre></div></div>

 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=2863&amp;md5=b9a5b349b7a2b23d40ef8cb66307cc73" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/quelques-innovation-de-python-3-backportees-en-python-2-7/feed/</wfw:commentRss>
		<slash:comments>4</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fquelques-innovation-de-python-3-backportees-en-python-2-7%2F&amp;language=en_GB&amp;category=text&amp;title=Quelques+innovation+de+Python+3+backport%C3%A9es+en+Python+2.7&amp;description=Comme+nous+l%26%238217%3Bavons+vu+avec+les+vues+ou+les+collections%2C+Python+2.7+vient+avec+pas+mal+de+bonus+issus+directement+de+la+branche+3.+En+voici+quelques+autres.+Tout+ceci...&amp;tags=context+manager%2Cpython%2Csets%2Cstrings%2Cunit+tests%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2012/11/Pimp-My-Ride-43797.jpg" length="291183" type="image/jpg" />	</item>
		<item>
		<title>Répéter une commande bash jusqu&#8217;à ça marche ou que ça plante</title>
		<link>http://sametmax.com/repeter-une-commande-bash-jusqua-ca-marche-ou-que-ca-plante/</link>
		<comments>http://sametmax.com/repeter-une-commande-bash-jusqua-ca-marche-ou-que-ca-plante/#comments</comments>
		<pubDate>Wed, 08 Aug 2012 14:37:01 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[bash]]></category>
		<category><![CDATA[unit tests]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=1594</guid>
		<description><![CDATA[Parfois il est utile de spammer son terminal jusqu'à ce que mort s'en suive.]]></description>
			<content:encoded><![CDATA[<p>Parfois il est utile de spammer son terminal jusqu&#8217;à ce que mort s&#8217;en suive.</p>
<p>Par exemple, hier nous avions un bug aléatoire qui apparaissait dans une batterie de tests qui prenait quelques minutes à exécuter. Confirmer qu&#8217;on avait bien éliminé le problème était délicat.</p>
<p>On est donc allé faire les courses (c&#8217;est y pas mignon, le petit couple sam et max au super marché, so kawaï) et j&#8217;ai lancé ceci avant de partir faire la queue pendant une heure:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;">nosetests tests <span style="color: #660033;">-x</span>; <span style="color: #000000; font-weight: bold;">while</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #007800;">$?</span> <span style="color: #660033;">-eq</span> <span style="color: #ff0000;">&quot;0&quot;</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #7a0874; font-weight: bold;">&#93;</span>; <span style="color: #000000; font-weight: bold;">do</span> nosetests tests <span style="color: #660033;">-x</span>; <span style="color: #000000; font-weight: bold;">done</span></pre></div></div>

<p><code>nosetests tests -x</code> lance tous les tests et plante dès le premier qui foire.</p>
<p><code>$? -eq "0"</code> vérifie le dernier code de retour, et continue si il est égal à 0 (ce qui veut dire &#8220;tout s&#8217;est bien passé&#8221; en langue Unix).</p>
<p>Ainsi les tests ont tourné pendant toute notre session de chasse au rayon fruits et légumes, et à au retour on a pu constaté qu&#8217;ils tournaient toujours. Il y a donc de forte chance que le bug ai été éradiqué, puisqu&#8217;avant il se montrait dans les 5 premiers lancements.</p>
<p>On peut aussi faire l&#8217;inverse: lancer une commande tant qu&#8217;elle foire:</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #7a0874; font-weight: bold;">command</span>; <span style="color: #000000; font-weight: bold;">while</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #007800;">$?</span> <span style="color: #660033;">-gt</span> <span style="color: #ff0000;">&quot;0&quot;</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #7a0874; font-weight: bold;">&#93;</span>; <span style="color: #000000; font-weight: bold;">do</span> <span style="color: #7a0874; font-weight: bold;">command</span>; <span style="color: #000000; font-weight: bold;">done</span></pre></div></div>

 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=1594&amp;md5=109a6523547b0996de0192ca35bbf5f3" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/repeter-une-commande-bash-jusqua-ca-marche-ou-que-ca-plante/feed/</wfw:commentRss>
		<slash:comments>5</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Frepeter-une-commande-bash-jusqua-ca-marche-ou-que-ca-plante%2F&amp;language=en_GB&amp;category=text&amp;title=R%C3%A9p%C3%A9ter+une+commande+bash+jusqu%26%238217%3B%C3%A0+%C3%A7a+marche+ou+que+%C3%A7a+plante&amp;description=Parfois+il+est+utile+de+spammer+son+terminal+jusqu%26%238217%3B%C3%A0+ce+que+mort+s%26%238217%3Ben+suive.+Par+exemple%2C+hier+nous+avions+un+bug+al%C3%A9atoire+qui+apparaissait+dans+une+batterie+de+tests+qui...&amp;tags=bash%2Cunit+tests%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2012/08/Einstein.jpg" length="19483" type="image/jpg" />	</item>
	</channel>
</rss>
