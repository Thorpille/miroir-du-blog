<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Sam &#38; Max: Python, Django, Git et du cul &#187; javascript</title>
	<atom:link href="http://sametmax.com/tag/javascript/feed/" rel="self" type="application/rss+xml" />
	<link>http://sametmax.com</link>
	<description>Deux développeurs en vadrouille qui se sortent les doigts du code</description>
	<lastBuildDate>Mon, 02 Dec 2013 10:02:45 +0000</lastBuildDate>
	<language>en</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.3.1</generator>
	<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2F&amp;language=en_US&amp;category=text&amp;title=Sam+%26amp%3B+Max%3A+Python%2C+Django%2C+Git+et+du+cul&amp;description=Deux+d%C3%A9veloppeurs+en+vadrouille+qui+se+sortent+les+doigts+du+code&amp;tags=blog" type="text/html" />
		<item>
		<title>La différence entre la programmation asynchrone, parallèle et concurrente</title>
		<link>http://sametmax.com/la-difference-entre-la-programmation-asynchrone-parallele-et-concurrente/</link>
		<comments>http://sametmax.com/la-difference-entre-la-programmation-asynchrone-parallele-et-concurrente/#comments</comments>
		<pubDate>Wed, 09 Oct 2013 22:08:13 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[asynchrone]]></category>
		<category><![CDATA[conccurence]]></category>
		<category><![CDATA[erlang]]></category>
		<category><![CDATA[javascript]]></category>
		<category><![CDATA[multiprocessing]]></category>
		<category><![CDATA[parallèle]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[thread]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=7378</guid>
		<description><![CDATA[On parle un peu partout de programmation non blocante ces temps-ci. NoSQL a remis le map/reduce au goût du jour, et PAF, on vous sort le mot clé parallélisation pour vous en vendre une tetrachiée. Les partisants de NodeJS vont crier "asynchrone", parce que c'est ce que Javascript sait faire de mieux. Et on on murmure dans les coins que la rubustesse d'Erlang tient dans ses acteurs qui travaillent de manière concurrente dans la VM.

Ok, donc tout ça, ça à l'air de faire la même chose, c'est à dire de faire plusieurs choses en même temps, sans bloquer.

Donc c'est pareil ?]]></description>
			<content:encoded><![CDATA[<p>On parle un peu partout de programmation non bloquante ces temps-ci. NoSQL a remis le map/reduce au goût du jour, et PAF, on vous sort le mot clé parallélisation pour vous en vendre une tetrachiée. Les partisants de NodeJS vont crier &#8220;asynchrone&#8221;, parce que c&#8217;est ce que Javascript sait faire de mieux. Et on murmure dans les coins que la robustesse d&#8217;Erlang tient dans ses acteurs qui travaillent de manière concurrente dans la VM.</p>
<p>Ok, donc tout ça, ça à l&#8217;air de faire la même chose, c&#8217;est à dire de faire plusieurs choses en même temps, sans bloquer.</p>
<p>Donc c&#8217;est pareil ?</p>
<p>Non. En fait c&#8217;est une question de point de vue : non bloquant dans quel contexte ?</p>
<h2>Si c&#8217;est l&#8217;IO, c&#8217;est asynchrone</h2>
<p>Pour rappel, l&#8217;IO (Input/Ouput), c&#8217;est toute activité qui implique que des données entrent et sortent de votre programme : saisie utilisateur, print sur un terminal, lecture sur une socket, écriture sur le disque, etc. Une opération I/O a plusieurs caractéristiques :</p>
<ul>
<li>Le temps que prend l&#8217;opération n&#8217;est pas dépendant du CPU : la vitesse du disque, la latence du réseau, le nombre d&#8217;heures de sommeil du sysadmin sont les facteurs qui vont déterminer quand l&#8217;opération va prendre fin.</li>
<li>Le corollaire, c&#8217;est qu&#8217;on ne peut pas prédire quand l&#8217;opération va prendre fin depuis le programme.</li>
<li>Sur les services avec beaucoup d&#8217;I/O (serveurs Web, bases de données, crawlers, scripts de déploiement, etc), c&#8217;est l&#8217;I/O qui généralement prend le plus de temps dans l&#8217;exécution du programme. L&#8217;optimisation de ces opérations va donc l&#8217;accélérer bien plus que de changer votre algo.</li>
</ul>
<p>La plupart des programmes bloquent quand ils effectuent une opération I/O. Par exemple, si vous faites ceci en Python :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">urllib2</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># télécharge et affiche le contenu de la page d'acceuil de sam et max</span>
<span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">urllib2</span>.<span style="color: black;">urlopen</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'http://sametmax.com'</span><span style="color: black;">&#41;</span>.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Coucou&quot;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>La ligne <code>print("Coucou")</code> ne s&#8217;exécutera pas tant que la ligne précédente n&#8217;aura pas terminé de s&#8217;exécuter. Dans ce cas ce n&#8217;est pas très grâve, mais dans ce cas là :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">urllib2</span>
&nbsp;
&nbsp;
mille_urls = obtenir_liste_de_mille_urls<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
contenu = <span style="color: black;">&#91;</span><span style="color: black;">&#93;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># télécharge et sauvegarde dans une liste</span>
<span style="color: #808080; font-style: italic;"># le contenu de chacune des 1000 urls</span>
<span style="color: #ff7700;font-weight:bold;">for</span> url <span style="color: #ff7700;font-weight:bold;">in</span> mille_urls:
	contenu.<span style="color: black;">append</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">urllib2</span>.<span style="color: black;">urlopen</span><span style="color: black;">&#40;</span>url<span style="color: black;">&#41;</span>.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>Chaque url est téléchargée une par une, et comme Internet, c&#8217;est vachement lent (300 ms X 1000, ça fait 5 minutes, mine de rien), votre programme va prendre un temps fou. Et pour rien en plus, car votre programme va passer la majeure partie du temps à ne rien faire ! En effet, 99% du temps de votre programme est passé à attendre qu&#8217;Internet réponde, pendant que votre CPU se touche les noix.</p>
<p>La programmation asynchrone est une réponse à cela : au lieu d&#8217;attendre que se finissent les entrées et les sorties, le programme continue de fonctionner. </p>
<p>Une autre problématique se pose alors : comment obtenir le résultat de l&#8217;opération d&#8217;I/O, puisqu&#8217;on ne sait pas quand il va arriver et qu&#8217;on attend pas qu&#8217;il arrive ?</p>
<p>C&#8217;est là que les systèmes synchrones font un peu de magie. En vérité, une partie du programme attend, mais discrètement, en arrière plan, au niveau de ce qu&#8217;on appelle une boucle d&#8217;événements (&#8220;events loop&#8221;), c&#8217;est à dire une boucle infinie qui check régulièrement si une opération I/O ne s&#8217;est pas terminée. </p>
<p>Cette boucle est invisible pour vous, votre programme continue de tourner. Mais si une opération I/O envoie des données, alors l&#8217;events loop va réagir.</p>
<p>Ca a l&#8217;air compliqué, mais en fait, c&#8217;est, la plupart du temps, juste une histoire de callback (si la notion vous échappe, je vous renvois à <a href="http://sametmax.com/quest-ce-quun-callback/">l&#8217;article dédié</a>&#8230;). Par exemple en Javascript :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">var mille_urls = obtenir_liste_de_mille_urls<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">;</span>
var contenu = <span style="color: black;">&#91;</span><span style="color: black;">&#93;</span><span style="color: #66cc66;">;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># notre callback qui va permettre d'ajouter </span>
<span style="color: #808080; font-style: italic;"># le contenu téléchargé à notre liste</span>
var callback = function<span style="color: black;">&#40;</span>data<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> 
      contenu.<span style="color: black;">push</span><span style="color: black;">&#40;</span>data<span style="color: black;">&#41;</span><span style="color: #66cc66;">;</span>
<span style="color: black;">&#125;</span><span style="color: #66cc66;">;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Bon, j'utilise jquery pour simplifier le code...</span>
<span style="color: #808080; font-style: italic;"># On boucle sur les milles URL</span>
$.<span style="color: black;">each</span><span style="color: black;">&#40;</span>mille_urls, function<span style="color: black;">&#40;</span>index, url<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span>
  <span style="color: #808080; font-style: italic;"># On télécharge le contenu, MAIS comme</span>
  <span style="color: #808080; font-style: italic;"># $.get est naturellement non blocante,</span>
  <span style="color: #808080; font-style: italic;"># elle ne va pas attendre qu'internet </span>
  <span style="color: #808080; font-style: italic;"># réponde pour continuer la boucle, et</span>
  <span style="color: #808080; font-style: italic;"># donc on pourra attendre plusieurs réponses</span>
  <span style="color: #808080; font-style: italic;"># en même temps. Pour avoir le résultat de </span>
  <span style="color: #808080; font-style: italic;"># chaque réponse, on passe un callback qui </span>
  <span style="color: #808080; font-style: italic;"># va être appelé quand la réponse arrive.</span>
  $.<span style="color: black;">get</span><span style="color: black;">&#40;</span>url, callback<span style="color: black;">&#41;</span><span style="color: #66cc66;">;</span>
&nbsp;
<span style="color: black;">&#125;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">;</span></pre></div></div>

<p>Comprenez bien la subtilité : à tout moment, il n&#8217;y a qu&#8217;UN SEUL process javascript qui s&#8217;éxécute. Il n&#8217;y a pas deux traitements, pas de threads, pas de processus parallèles, rien de tout ça. Simplement, Javascript n&#8217;attend pas la réponse de sa requête pour faire la requête suivante, il continu sur sa lancée, et donc <strong>peut optimiser les temps d&#8217;attente en attendant plusieurs choses en même temps</strong>.</p>
<p>Javascript utilise massivement des API asynchrones, c&#8217;est au cœur du langage, il n&#8217;y a aucun effort à faire pour cela. A l&#8217;inverse, Python est synchrone par nature, et il faut vraiment se faire chier pour obtenir un algo asynchrone. Ceci changera avec Python 3.4 qui accueillera <a href="https://code.google.com/p/tulip/">tulip</a> dans la stdlib, afin de se moderniser sur ce point. En attendant, si vous voulez faire de l&#8217;asynchrone en Python, vous pouvez voir du côté de <a href="http://www.gevent.org/">gevent</a>, <a href="https://github.com/saucelabs/monocle">monocle</a> ou <a href="http://www.tornadoweb.org/en/stable/">Tornado</a>. L&#8217;alternative est d&#8217;utiliser des <a href="http://docs.python.org/2/library/thread.html">threads</a> ou des <a href="http://docs.python.org/2/library/multiprocessing.html?highlight=multiprocessing#multiprocessing">processus séparés</a>, ce qui ne demande rien à installer, mais est un peu verbeux, et est moins performant.</p>
<p>Souvenez-vous que l&#8217;I/O, c&#8217;est toute entrée et sortie du programme. Un clic sur un bouton, c&#8217;est une entrée, mettre à jour un élément du DOM dans le navigateur, c&#8217;est une sortie. La programmation asynchrone est donc importante pour la réactivité des programmes.</p>
<h2>Si un algorithme peut répartir son travail en plusieurs bouts, c&#8217;est parallèle</h2>
<p>Par exemple, vous avez 1000 images en haute définition à traiter : il faut les redimensionner, les mettre en noir et blanc et ajouter une ombre sur les bords. Là, la partie de votre programme qui prend le plus de temps, c&#8217;est le traitement des images, pas l&#8217;I/O, et donc c&#8217;est le CPU. Par exemple, en Python :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">for</span> image <span style="color: #ff7700;font-weight:bold;">in</span> obtenir_liste_images<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
	<span style="color: #808080; font-style: italic;"># I/O</span>
	data = lire_image<span style="color: black;">&#40;</span>image<span style="color: black;">&#41;</span> 
&nbsp;
	<span style="color: #808080; font-style: italic;"># gros du travail</span>
	redimensioner<span style="color: black;">&#40;</span>data<span style="color: black;">&#41;</span>
	mettre_en_noir_et_blanc<span style="color: black;">&#40;</span>data<span style="color: black;">&#41;</span>
	ajouter_ombre<span style="color: black;">&#40;</span>data<span style="color: black;">&#41;</span>
&nbsp;
	<span style="color: #808080; font-style: italic;"># I/O</span>
	ecrire_image<span style="color: black;">&#40;</span>data, image<span style="color: black;">&#41;</span></pre></div></div>

<p>Si vous avez plusieurs ordinateurs, une manière de paralléliser le travail est de mettre 500 images sur l&#8217;un, et 500 images sur l&#8217;autre, et de lancer le script sur chaque ordi.</p>
<p>Si vous avez plusieurs processeurs dans votre ordi (ce qui est le cas de tous les ordis modernes, et plus seulement les super-calculateurs comme il y a 10 ans), vous pouvez aussi paralléliser le travail sur une seule machine : chaque processeur va s&#8217;occuper d&#8217;une partie du taf.</p>
<p>Bien entendu, vous pouvez lancer le script 2 fois, mais cela ne marche que sur des travaux simples comme celui là. Et ça suppose que vous connaissez le nombre de CPU que vous voulez faire travailler à l&#8217;avance.</p>
<p> Une manière de faire plus propre est d&#8217;utiliser des threads ou des processus séparés. En Python, le thread ne servirait à rien, car on se heurterait au GIL, le fameux global interpréteur lock, qui fait qu&#8217;une VM n&#8217;utilise qu&#8217;un processeur, quoi qu&#8217;il arrive. Les threads ne sont donc utiles (en Python), que pour l&#8217;I/O. Par contre on peut utiliser <a href="http://sametmax.com/remplacer-les-threads-avec-le-module-multiprocessing-en-python/">plusieurs processus</a> :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">from</span> multiprocessing <span style="color: #ff7700;font-weight:bold;">import</span> Process
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> traiter_les_images<span style="color: black;">&#40;</span>debut, fin<span style="color: black;">&#41;</span>:
&nbsp;
 <span style="color: #ff7700;font-weight:bold;">for</span> image <span style="color: #ff7700;font-weight:bold;">in</span> obtenir_liste_images<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span>debut, fin<span style="color: black;">&#93;</span>:
	<span style="color: #808080; font-style: italic;"># I/O</span>
	data = lire_image<span style="color: black;">&#40;</span>image<span style="color: black;">&#41;</span> 
&nbsp;
	<span style="color: #808080; font-style: italic;"># gros du travail</span>
	redimensioner<span style="color: black;">&#40;</span>data<span style="color: black;">&#41;</span>
	mettre_en_noir_et_blanc<span style="color: black;">&#40;</span>data<span style="color: black;">&#41;</span>
	ajouter_ombre<span style="color: black;">&#40;</span>data<span style="color: black;">&#41;</span>
&nbsp;
	<span style="color: #808080; font-style: italic;"># I/O</span>
	ecrire_image<span style="color: black;">&#40;</span>data, image<span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># On crée deux processus, un pour traiter les 500 premières images,</span>
<span style="color: #808080; font-style: italic;"># un pour traiter les images de 500 à 1000</span>
p1 = Process<span style="color: black;">&#40;</span>target=traiter_les_images, args=<span style="color: black;">&#40;</span><span style="color: #ff4500;">0</span>, <span style="color: #ff4500;">500</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
p2 = Process<span style="color: black;">&#40;</span>target=traiter_les_images, args=<span style="color: black;">&#40;</span><span style="color: #ff4500;">500</span>, <span style="color: #ff4500;">1000</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: #808080; font-style: italic;"># On les démarre, ils se séparent alors du programme pour</span>
<span style="color: #808080; font-style: italic;"># devenir indépendant</span>
p1.<span style="color: black;">start</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
p2.<span style="color: black;">start</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #808080; font-style: italic;"># on dit au programme d'attendre la fin des deux processus</span>
<span style="color: #808080; font-style: italic;"># CE programme bloque ici, mais les deux processus, eux,</span>
<span style="color: #808080; font-style: italic;"># ne bloquent pas.</span>
p1.<span style="color: black;">join</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
p2.<span style="color: black;">join</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>Dans cet exemple, il y a TROIS processus : votre programme Python, et les deux processus qui vont traiter les photos, qui consistent ni plus ni moins en la fonction <code>traiter_les_images()</code> qui a maintenant un process pour elle toute seule.</p>
<p>La plupart des langages ont ce genre de mécanisme pour faire du travail en parallèle. Java utilise les threads par exemple. Javascript utilise les Web Workers.</p>
<p>Nous traitons des données de plus en plus massives (jeux vidéos, encoding divx, retouche d&#8217;images, montage de sons&#8230;), et maîtriser la parallélisation permet donc d&#8217;optimiser les ressources de nos machines modernes afin d&#8217;être toujours plus efficace.</p>
<h2>Si il y a plusieurs entités indépendantes, c&#8217;est concurrent</h2>
<p>Si vous avez un serveur et un client, c&#8217;est de la programmation concurrente. Si vous avez un module qui s&#8217;occupe des I/O utilisateurs, un qui s&#8217;occupe de la base de données et un qui surveille le comportement de l&#8217;OS, dans des processus séparés, et qui communiquent entre eux, c&#8217;est de la programmation concurrente.</p>
<p>La programmation concurrente suppose que chaque acteur de votre système est indépendant et possède son propre état. Idéalement, les acteurs sont capables de communiquer entre eux. Généralement, ils partagent une ressource à laquelle ils doivent accéder, par exemple un fichier de log. Et c&#8217;est là qu&#8217;il faut faire attention : certaines ressources ne sont pas faites pour êtres utilisées en même temps par plusieurs process. C&#8217;est pour ça qu&#8217;on parle d&#8217;accès concurrent comme d&#8217;un gros problème en informatique.</p>
<p>Un exemple de programmation concurrente en Python serait d&#8217;avoir un process qui regarde régulièrement si il y a des mails, et les sauvegarde. Si il reçoit un message suspect, il envoie le message à un autre process, un anti-virus, qui en plus de surveiller l&#8217;ordi, peut désinfecter le mail. Exemple :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">from</span> multiprocessing <span style="color: #ff7700;font-weight:bold;">import</span> Process, <span style="color: #dc143c;">Queue</span>
&nbsp;
entree_traiteur_de_mail = <span style="color: #dc143c;">Queue</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
entree_anti_virus = <span style="color: #dc143c;">Queue</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> traiter_les_mails<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
&nbsp;
	<span style="color: #808080; font-style: italic;"># Les processus qui tournent continuellement</span>
	<span style="color: #808080; font-style: italic;"># en arrière plan sont juste boucle infinie</span>
	<span style="color: #ff7700;font-weight:bold;">while</span> <span style="color: #008000;">True</span>:
		mail = obtenir_mail<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
		<span style="color: #808080; font-style: italic;"># Si un mail est suspect, on l'envoie</span>
		<span style="color: #808080; font-style: italic;"># au processus de l'anti-virus, </span>
		<span style="color: #808080; font-style: italic;"># et on attend qu'il nous le renvoie</span>
		<span style="color: #808080; font-style: italic;"># tout propres.</span>
		<span style="color: #808080; font-style: italic;"># Les deux processus sont indépendant,</span>
		<span style="color: #808080; font-style: italic;"># ils fonctionnent l'un sans l'autre et</span>
		<span style="color: #808080; font-style: italic;"># ne sont pas dans la même VM.</span>
		<span style="color: #ff7700;font-weight:bold;">if</span> mail_est_suspect<span style="color: black;">&#40;</span>mail<span style="color: black;">&#41;</span>:
			entree_anti_virus.<span style="color: black;">put</span><span style="color: black;">&#40;</span>mail<span style="color: black;">&#41;</span>
			mail = entree_traiteur_de_mail.<span style="color: black;">get</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
		sauvegarder_mail<span style="color: black;">&#40;</span>mail<span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> anti_virus<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
&nbsp;
	<span style="color: #ff7700;font-weight:bold;">while</span> <span style="color: #008000;">True</span>:
		<span style="color: #808080; font-style: italic;"># L'anti-virus vérifie périodiquement </span>
		<span style="color: #808080; font-style: italic;"># s'il n'a pas un mail à nettoyer,</span>
		<span style="color: #808080; font-style: italic;"># mais n'attend que 0.01 seconde, et si</span>
		<span style="color: #808080; font-style: italic;"># rien ne se présente, continue son </span>
		<span style="color: #808080; font-style: italic;"># travail.</span>
        <span style="color: #ff7700;font-weight:bold;">try</span>:
        	<span style="color: #808080; font-style: italic;"># Si il y a un mail à désinfecter,</span>
        	<span style="color: #808080; font-style: italic;"># il le nettoie, et le renvoie</span>
        	<span style="color: #808080; font-style: italic;"># au processus de traitement de mails.</span>
            mail = entree_anti_virus.<span style="color: black;">get</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">0.01</span><span style="color: black;">&#41;</span>
            desinfecter_mail<span style="color: black;">&#40;</span>mail<span style="color: black;">&#41;</span>
            entree_traiteur_de_mail.<span style="color: black;">put</span><span style="color: black;">&#40;</span>mail<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> TimeoutError:
            <span style="color: #ff7700;font-weight:bold;">pass</span>
        <span style="color: #808080; font-style: italic;"># L'anti-virus ne fait pas que desinfecter </span>
        <span style="color: #808080; font-style: italic;"># les mails, il a d'autres tâches à lui</span>
        verifier_virus_sur_system<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;"># On lance les process. La plupart du temps, il n'y a </span>
<span style="color: #808080; font-style: italic;"># pas de mail suspect, et donc les deux processus</span>
<span style="color: #808080; font-style: italic;"># n'en bloquent pas. En cas de mail suspect ils bloquent</span>
<span style="color: #808080; font-style: italic;"># le temps d'échanger le mail entre eux.</span>
process_anti_virus = Process<span style="color: black;">&#40;</span>target=traiter_les_mails<span style="color: black;">&#41;</span>
process_traitement_mail = Process<span style="color: black;">&#40;</span>target=anti_virus<span style="color: black;">&#41;</span>
process_anti_virus.<span style="color: black;">start</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
process_traitement_mail.<span style="color: black;">start</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
process_anti_virus.<span style="color: black;">join</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
process_traitement_mail.<span style="color: black;">join</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></div></div>

<p>La programmation concurrente est donc une question d&#8217;architecture : vous êtes en concurrence ou non si vous décidez de répartir votre code entre plusieurs acteurs indépendant ou non. Les acteurs peuvent avoir des tâches distinctes, et ne pas se bloquer, mais communiquer sur les tâches communes. L&#8217;avantage de la programmation concurrente, c&#8217;est sa robustesse : si un process plante, le reste de votre programme continue de fonctionner. C&#8217;est pour cette raison qu&#8217;Erlang, un langage connu pour créer des systèmes increvables, base toute sa philosophie là dessus : un programme Erlang est composé de milliers d&#8217;acteurs communiquant entre eux par messages.</p>
<h2>Hey, mais, attends là !</h2>
<blockquote><p>Ton exemple de programmation parallèle, c&#8217;est aussi une exécution concurrente. Et puis si on fait pleins de processus, pour faire la même tâche d&#8217;I/O, ils ne se bloquent pas entre eux, donc c&#8217;est non bloquant sur l&#8217;I/O, c&#8217;est asynchrone !</p></blockquote>
<p>Allez-vous me dire, fort intelligement. Car nous avons des lecteurs intelligents.</p>
<p>Hé oui, effectivement, ce sont des notions qui se chevauchent. Comme je vous l&#8217;ai dit, c&#8217;est une question de point de vue. Si on se place du point de vue de l&#8217;algo, on peut paralléliser le traitement, ou non. Et il y a plusieurs manières de paralléliser. Si on se place du point de vu de l&#8217;I/O, on peut bloquer ou non, et alors on est dans de l&#8217;asynchrone. Si on se place du point de vu des acteurs, on peut en avoir plusieurs indépendants ou non, alors on est en concurrence.</p>
<p>En fait, même plusieurs acteurs qui communiquent entre eux sont considérés comme étant chacun en train de faire de l&#8217;I/O, avec les autres&#8230;</p>
<p>Bref, ces 3 termes, c&#8217;est de la sémantiques. Au final, ce qui importe, c&#8217;est que vous compreniez les enjeux qu&#8217;il y a derrière pour écrire un programme qui fasse son boulot comme il faut, et finisse en temps et en heure.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=7378&amp;md5=2daff4535bf9cc204c43088e47e857b0" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/la-difference-entre-la-programmation-asynchrone-parallele-et-concurrente/feed/</wfw:commentRss>
		<slash:comments>23</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fla-difference-entre-la-programmation-asynchrone-parallele-et-concurrente%2F&amp;language=en_GB&amp;category=text&amp;title=La+diff%C3%A9rence+entre+la+programmation+asynchrone%2C+parall%C3%A8le+et+concurrente&amp;description=On+parle+un+peu+partout+de+programmation+non+bloquante+ces+temps-ci.+NoSQL+a+remis+le+map%2Freduce+au+go%C3%BBt+du+jour%2C+et+PAF%2C+on+vous+sort+le+mot+cl%C3%A9+parall%C3%A9lisation+pour...&amp;tags=asynchrone%2Cconccurence%2Cerlang%2Cjavascript%2Cmultiprocessing%2Cparall%C3%A8le%2Cpython%2Cthread%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/10/cock-block.jpg" length="9784" type="image/jpg" />	</item>
		<item>
		<title>Envie de meurtre</title>
		<link>http://sametmax.com/envie-de-meurtre/</link>
		<comments>http://sametmax.com/envie-de-meurtre/#comments</comments>
		<pubDate>Fri, 19 Jul 2013 09:55:57 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[javascript]]></category>
		<category><![CDATA[nodejs]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=6725</guid>
		<description><![CDATA[Oui, je tapes beaucoup sur nodejs et la communauté javascript en général. Mais ils le méritent, Putain !
]]></description>
			<content:encoded><![CDATA[<p>Oui, je tape beaucoup sur nodejs et la communauté javascript en général. Mais ils le méritent, bordel !</p>
<p>Je tombe sur un projet OpenSource qui est sorti en janvier dernier. Ils vendent leur popote &#8220;As A Service&#8221;, donc a priori, on pourrait se dire qu&#8217;ils voudraient qu&#8217;on les prennent au sérieux.</p>
<p>Ils fournissent un serveur pour se faire la main en local avant de taper dans leur API payante. Cool. Merci.</p>
<p>D&#8217;abord, il faut évidement passer par l&#8217;installation de node et tout le bordel. Bon, admettons. Même si Python est installé par défaut, il faut bien installer <a href="http://sametmax.com/votre-python-aime-les-pip/">pip</a>.</p>
<p>Mais ensuite, au lancement du serveur, rien. Il reste là, silencieusement. Pas de mode verbose, un mode debug qui ne fait absolument rien.</p>
<p>Mon code client se connecte, et puis nada. Silence radio sur leur lib client et serveur. Vide intersidéral.</p>
<p>La doc est succincte (3 pages) et rien qui ne parle du problème. Question sur la mailling list. Pas de réponse.</p>
<p>A ce stade j&#8217;en ai déjà ras le cul. Les libs node qui marchent pas et qui en plus veulent pas mettre un putain de message d&#8217;erreur, y en a déjà un paquet. C&#8217;est une épidémie dans cette communauté.</p>
<p>Mais je retrousse mes manches, et je vais voir dans le code source.</p>
<p>Et là, je tombe sur 400 lignes de ça :</p>

<div class="wp_syntax"><div class="code"><pre class="javascript" style="font-family:monospace;">    <span style="color: #003366; font-weight: bold;">var</span> client<span style="color: #339933;">;</span>
    <span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span>self._clients<span style="color: #009900;">&#91;</span>key<span style="color: #009900;">&#93;</span> <span style="color: #339933;">||</span> <span style="color: #339933;">!</span><span style="color: #009900;">&#40;</span>client <span style="color: #339933;">=</span> self._clients<span style="color: #009900;">&#91;</span>key<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span>id<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
      <span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>req.<span style="color: #660066;">params</span>.<span style="color: #660066;">retry</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        res.<span style="color: #660066;">send</span><span style="color: #009900;">&#40;</span><span style="color: #CC0000;">401</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      <span style="color: #009900;">&#125;</span> <span style="color: #000066; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #006600; font-style: italic;">// Retry this request</span>
        req.<span style="color: #660066;">params</span>.<span style="color: #660066;">retry</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">;</span>
        setTimeout<span style="color: #009900;">&#40;</span>handle<span style="color: #339933;">,</span> <span style="color: #CC0000;">25</span><span style="color: #339933;">,</span> req<span style="color: #339933;">,</span> res<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      <span style="color: #009900;">&#125;</span>
      <span style="color: #000066; font-weight: bold;">return</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span></pre></div></div>

<p>C&#8217;est un appel au génocide, un style de coding comme ça ! Sérieusement, déjà Javascript est un langage moche, avec un scoping de merde, du nesting en pagaille et tout un tas de pièges qui fait que le code est dur à lire et à comprendre.</p>
<p>Mais là, vous imaginez la concentration qu&#8217;il faut pour lire ces 10 putains de lignes ? Et les remettre dans le contexte du script complet (qui au passage est commenté comme un diabétique sucre son café).</p>
<p>C&#8217;est trop dur de ne pas pondre des trucs innommables comme <code>!(client = self._clients[key][id])</code> ? Un ligne de plus a taper. Trop difficile de mettre des noms de variables complets ? <code>id</code>, mais id de quoi connard ? Je remonte tout le script pour m&#8217;en souvenir ? Et pourquoi tu assignes <code>client = self._clients</code>  si c&#8217;est pour ne pas t&#8217;en servir ? Et puis un double if imbriqué suivi d&#8217;un appel récursif asynchrone, c&#8217;est tellement fun pour suivre le workflow ! </p>
<p>400 lignes comme ça, après le dîner, ça fout la chiasse. Alors oui, c&#8217;est de l&#8217;open source, faut pas faire le difficile, etc.</p>
<p>Mais bordel, qu&#8217;on ne vienne pas me dire que c&#8217;est l&#8217;avenir. Les ex-script kiddies d&#8217;hier, codeurs PHP et VB, commencent à peine à écrire du code propre. Et là grosso modo on va se taper la vague des intégrateurs Web qui se mettent à coder parce que c&#8217;est du JS comme dans le navigateur ?</p>
<p>GGGGGGGGGGGGRRRRRRRRRRRRRRRRRRRRRRRR !</p>
<p>Je devrais faire une émission style &#8220;joueur du grenier&#8221;, mais pour le code pourri.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=6725&amp;md5=d9304974a5ce847e095fa0f1fd3dd254" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/envie-de-meurtre/feed/</wfw:commentRss>
		<slash:comments>42</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fenvie-de-meurtre%2F&amp;language=en_GB&amp;category=text&amp;title=Envie+de+meurtre&amp;description=Oui%2C+je+tape+beaucoup+sur+nodejs+et+la+communaut%C3%A9+javascript+en+g%C3%A9n%C3%A9ral.+Mais+ils+le+m%C3%A9ritent%2C+bordel+%21+Je+tombe+sur+un+projet+OpenSource+qui+est+sorti+en+janvier+dernier....&amp;tags=javascript%2Cnodejs%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/07/be5gI.jpg" length="55910" type="image/jpg" />	</item>
		<item>
		<title>Créer un bookmarklet</title>
		<link>http://sametmax.com/creer-un-bookmarklet/</link>
		<comments>http://sametmax.com/creer-un-bookmarklet/#comments</comments>
		<pubDate>Fri, 31 May 2013 12:49:54 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[bookmarklet]]></category>
		<category><![CDATA[javascript]]></category>
		<category><![CDATA[meta]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=3972</guid>
		<description><![CDATA[Vous avez un super outil JS que vous voulez partager avec le monde entier ? Faites un bookmarklet ! Il s'agit de compresser tout votre code sur une ligne de telle sorte qu'il puisse être mis en bookmark dans le browser et utilisé en un click.
]]></description>
			<content:encoded><![CDATA[<p>Vous avez un super outil JS que vous voulez partager avec le monde entier ? Faites un bookmarklet ! Il s&#8217;agit de compresser tout votre code sur une ligne de telle sorte qu&#8217;il puisse être mis en bookmark dans le browser et utilisé en un clic.</p>
<p>Problème : débugger un pâté de JS d&#8217;une ligne, c&#8217;est relou. Et pour les gros outils, il n&#8217;y a pas la place de toute coder. L&#8217;idée est donc de packer juste l&#8217;import de votre outil.</p>
<p>D&#8217;abord, mettre le script de votre outil quelque part (par exemple votre serveur Web). Pour l&#8217;article, je vais mettre le script sur <a href="http://yourjavascript.com">yourjavascript.com</a>.</p>
<p>Il <a href="http://yourjavascript.com/11356413275/test.js">affiche une des tag lines du blog avec clippy</a> (on m&#8217;avait demandé une fois comment on faisait, ben voilà). Il ne marche que sur le blog et tout en haut à gauche d&#8217;une page non scrollée, mais OSEF, c&#8217;est un exemple.</p>
<p>Ensuite, on fait le code d&#8217;include, qui va juste créer une balise SCRIPT et ajoute votre outil une fois que la page est chargée :</p>

<div class="wp_syntax"><div class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #006600; font-style: italic;">// on frabrique le tag SCRIPT</span>
<span style="color: #003366; font-weight: bold;">var</span> url <span style="color: #339933;">=</span> <span style="color: #3366CC;">&quot;http://yourjavascript.com/11356413275/test.js&quot;</span><span style="color: #339933;">;</span>
<span style="color: #003366; font-weight: bold;">var</span> head <span style="color: #339933;">=</span> document.<span style="color: #660066;">getElementsByTagName</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'head'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #CC0000;">0</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<span style="color: #003366; font-weight: bold;">var</span> script <span style="color: #339933;">=</span> document.<span style="color: #660066;">createElement</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'script'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
script.<span style="color: #660066;">type</span> <span style="color: #339933;">=</span> <span style="color: #3366CC;">'text/javascript'</span><span style="color: #339933;">;</span>
<span style="color: #006600; font-style: italic;">// on met la date dans l'url pour éviter le cache</span>
script.<span style="color: #660066;">src</span> <span style="color: #339933;">=</span> url <span style="color: #339933;">+</span> <span style="color: #3366CC;">'?'</span> <span style="color: #339933;">+</span> <span style="color: #009900;">&#40;</span><span style="color: #003366; font-weight: bold;">new</span> Date<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">getTime</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #006600; font-style: italic;">// on ajoute le tag ce qui va charger votre outil</span>
head.<span style="color: #660066;">appendChild</span><span style="color: #009900;">&#40;</span>script<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></div>

<p>Puis il faut le mettre au format bookmarklet, c&#8217;est à dire :</p>
<ul>
<li>Faire tenir le code sur une ligne.</li>
<li>L&#8217;enfermer dans une <a href="http://sametmax.com/la-fonction-anonyme-appelee-immediatement-en-javascript-function/">fonction appelée immédiatement</a>.</li>
<li>Transformer tout ça en URL (urlencoder + ajouter le protocole &#8220;javascript:&#8221;)</li>
</ul>
<p>Faites le une fois pour vous entraîner à comprendre ce qui se passe (avec un code plus simple, genre un <code>alert()</code>) :</p>

<div class="wp_syntax"><div class="code"><pre class="javascript" style="font-family:monospace;">javascript<span style="color: #339933;">:</span><span style="color: #009900;">&#40;</span><span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span><span style="color: #000066;">alert</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;test&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></pre></div></div>

<p>Ensuite faites le avec votre vrai code, encore à la main. Une fois. Vous noterez qu&#8217;il faut un code super propre (pas de &#8220;;&#8221; manquant) pour que ça marche.</p>
<p>Quand vous en aurez marre de galérer, vous ferez comme moi, vous utiliserez un <a href="http://chriszarate.github.io/bookmarkleter/">outil en ligne</a> pour le faire automatiquement.</p>
<p>Le code résultant est celui-ci:</p>

<div class="wp_syntax"><div class="code"><pre class="javascript" style="font-family:monospace;">javascript<span style="color: #339933;">:</span><span style="color: #009900;">&#40;</span><span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>var<span style="color: #339933;">%</span>20url<span style="color: #339933;">=%</span>22http<span style="color: #339933;">:</span><span style="color: #006600; font-style: italic;">//yourjavascript.com/11356413275/test.js%22;var%20head=document.getElementsByTagName('head')[0];var%20script=document.createElement('script');script.type='text/javascript';script.src=url+'%3F'+(new%20Date().getTime());head.appendChild(script);})();</span></pre></div></div>

<p>On peut le mettre directement à la place de l&#8217;URL HTTP dans un bookmark. Si on clique sur le bookmark, il va lancer ce code, qui va ajouter la balise SCRIPT avec mon autre code, qui va se lancer et faire apparaitre clippy pour notre plus grand plaisir.</p>

<!-- iframe plugin v:2.3 - wordpress.org/extend/plugins/iframe/ -->
<iframe width="100%" height="300" src="http://jsfiddle.net/ngxuC/2/embedded/result,html/presentation/" allowfullscreen="allowfullscreen" frameborder="0" scrolling="no" class="iframe-class"></iframe>
<p>Comme je suis une feignasse, clippy apparait en haut de la page, donc il vous faudra scroller tout en haut pour voir le résultat. J&#8217;avais pas envie de me taper les calculs pour faire une posionnement relatif au viewport.</p>
<p>Personnellement je m&#8217;en sers pour faire des petits outils comme lire des sites plein d&#8217;images en mettant toutes les images à la suite des autres en auto loading, pour charger des outils d&#8217;admin sur la page principale d&#8217;un site (genre le casting des videos pornos) ou juste debugger.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=3972&amp;md5=b13c1289c759008fa99c902d3c28840d" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/creer-un-bookmarklet/feed/</wfw:commentRss>
		<slash:comments>4</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fcreer-un-bookmarklet%2F&amp;language=en_GB&amp;category=text&amp;title=Cr%C3%A9er+un+bookmarklet&amp;description=Vous+avez+un+super+outil+JS+que+vous+voulez+partager+avec+le+monde+entier+%3F+Faites+un+bookmarklet+%21+Il+s%26%238217%3Bagit+de+compresser+tout+votre+code+sur+une+ligne+de...&amp;tags=bookmarklet%2Cjavascript%2Cmeta%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/05/oljUbOw.jpg" length="420922" type="image/jpg" />	</item>
		<item>
		<title>Faire cohabiter plusieurs versions de jQuery</title>
		<link>http://sametmax.com/faire-cohabiter-plusieurs-versions-de-jquery/</link>
		<comments>http://sametmax.com/faire-cohabiter-plusieurs-versions-de-jquery/#comments</comments>
		<pubDate>Sun, 12 May 2013 13:08:25 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[javascript]]></category>
		<category><![CDATA[jquery]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=3946</guid>
		<description><![CDATA[jQuery est très bien foutu, non content de permettre d'utiliser des libs concurrentes utilisant la même API avec <code>noConflict()</code> (c'est beau l'open source quand même), elle permet également d'utiliser en même temps une version plus récente ou plus ancienne de son code, facilitant les migrations.]]></description>
			<content:encoded><![CDATA[<p>jQuery est très bien foutu, non content de permettre d&#8217;utiliser des libs concurrentes utilisant la même API avec <code>noConflict()</code> (c&#8217;est beau l&#8217;open source quand même), elle permet également d&#8217;utiliser en même temps une version plus récente ou plus ancienne de son code, facilitant les migrations.</p>
<p>Pour utiliser noConflict à bon escient, il faut simplement faire très attention à l&#8217;ordre d&#8217;inclusion de ses scripts&#8230;</p>
<p>D&#8217;abord, loader les deux versions de jQuery :</p>

<div class="wp_syntax"><div class="code"><pre class="html" style="font-family:monospace;">&lt;script type=&quot;text/javascript&quot; src=&quot;version1-de-jquery.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;plugin-qui-utilise-cette-version.js&quot;&gt;&lt;/script&gt;</pre></div></div>

<p>Ensuite utilise <code>noConflict()</code> pour sauvegarder une référence à cette version :</p>

<div class="wp_syntax"><div class="code"><pre class="html" style="font-family:monospace;">&lt;script type=&quot;text/javascript&quot;&gt;
var version1dejQuery = $.noConflict(true);
&lt;/script&gt;</pre></div></div>

<p>Et on charge la deuxième fournée :</p>

<div class="wp_syntax"><div class="code"><pre class="html" style="font-family:monospace;">&lt;script type=&quot;text/javascript&quot; src=&quot;autre-version-de-jquery.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;plugin-qui-utilise-cette-autre-version.js&quot;&gt;&lt;/script&gt;</pre></div></div>

<p>On sauvegarde aussi cette version dans une variable :</p>

<div class="wp_syntax"><div class="code"><pre class="html" style="font-family:monospace;">&lt;script type=&quot;text/javascript&quot;&gt;
var autreVersionDejQuery = $.noConflict(true);
&lt;/script&gt;</pre></div></div>

<p>Et du coup on peut utiliser les deux en parallèle. Au lieu d&#8217;appeler <code>$</code>, les appelle par leur p&#8217;tit nom :</p>

<div class="wp_syntax"><div class="code"><pre class="javascript" style="font-family:monospace;">autreVersionDejQuery<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'a'</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">click</span><span style="color: #009900;">&#40;</span>truc<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></div>

<p>Et comme d&#8217;hab, vous pouvez utiliser la technique de la <a href="http://sametmax.com/la-fonction-anonyme-appelee-immediatement-en-javascript-function/">fonction anonyme immédiatement appelée</a> pour créer un alias local et réutiliser <code>$</code>.</p>

<div class="wp_syntax"><div class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #009900;">&#40;</span><span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>$<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    $<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'img'</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">hover</span><span style="color: #009900;">&#40;</span>bidule<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#40;</span>version1dejQuery<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></div>

<p>D&#8217;ailleurs, je pense que ça ne marche que si les plugins inclus utilisent cette technique, ce qui est normalement une convention dans le monde de jQuery.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=3946&amp;md5=05ba624c6a709b40d2146b4427b1ce6c" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/faire-cohabiter-plusieurs-versions-de-jquery/feed/</wfw:commentRss>
		<slash:comments>3</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Ffaire-cohabiter-plusieurs-versions-de-jquery%2F&amp;language=en_GB&amp;category=text&amp;title=Faire+cohabiter+plusieurs+versions+de+jQuery&amp;description=jQuery+est+tr%C3%A8s+bien+foutu%2C+non+content+de+permettre+d%26%238217%3Butiliser+des+libs+concurrentes+utilisant+la+m%C3%AAme+API+avec+noConflict%28%29+%28c%26%238217%3Best+beau+l%26%238217%3Bopen+source+quand+m%C3%AAme%29%2C+elle+permet+%C3%A9galement+d%26%238217%3Butiliser+en...&amp;tags=javascript%2Cjquery%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/05/10hRh.jpg" length="71942" type="image/jpg" />	</item>
		<item>
		<title>Utilisez des variables globales avec JSLint</title>
		<link>http://sametmax.com/utilisez-des-variables-globales-avec-jslint/</link>
		<comments>http://sametmax.com/utilisez-des-variables-globales-avec-jslint/#comments</comments>
		<pubDate>Wed, 17 Apr 2013 16:13:05 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[javascript]]></category>
		<category><![CDATA[jquery]]></category>
		<category><![CDATA[jslint]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=5508</guid>
		<description><![CDATA[Petite astuce si vous utilisez JSlint (par exemple via le <a href="https://github.com/SublimeLinter/SublimeLinter">super plugin Sublime Text</a>).]]></description>
			<content:encoded><![CDATA[<p>Petite astuce si vous utilisez <a href="http://www.jslint.com/">JSlint </a>(par exemple via le <a href="https://github.com/SublimeLinter/SublimeLinter">super plugin Sublime Text</a>).</p>
<p>Il va vous mettre en avant toutes les variables globales ou non déclarées précédement. C&#8217;est génial la plupart du temps, mais c&#8217;est un peu chiant pour des variables qui sont volontairement globales et mises à dispo par d&#8217;autres scripts comme les frameworks et libs.</p>
<p>Par exemple, il va vous déclarer que jQuery est une variable globale ou non déclarée. Pour éviter ça, mettez ce commentaire tout en haut du fichier :</p>

<div class="wp_syntax"><div class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #006600; font-style: italic;">/*global jQuery:true, $:true */</span></pre></div></div>

<p>JSLint va le prendre en compte et ignorer ces variables.</p>
<p>On peut lister autant de variables qu&#8217;on le souhaite.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=5508&amp;md5=1be789a49c4be721cd7ce043a975c1b9" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/utilisez-des-variables-globales-avec-jslint/feed/</wfw:commentRss>
		<slash:comments>1</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Futilisez-des-variables-globales-avec-jslint%2F&amp;language=en_GB&amp;category=text&amp;title=Utilisez+des+variables+globales+avec+JSLint&amp;description=Petite+astuce+si+vous+utilisez+JSlint+%28par+exemple+via+le+super+plugin+Sublime+Text%29.+Il+va+vous+mettre+en+avant+toutes+les+variables+globales+ou+non+d%C3%A9clar%C3%A9es+pr%C3%A9c%C3%A9dement.+C%26%238217%3Best+g%C3%A9nial...&amp;tags=javascript%2Cjquery%2Cjslint%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/04/kBhkJhC.jpg" length="101439" type="image/jpg" />	</item>
		<item>
		<title>Qu&#8217;est-ce que Javascript et à quoi ça sert ?</title>
		<link>http://sametmax.com/quest-ce-que-javascript-et-a-quoi-ca-sert/</link>
		<comments>http://sametmax.com/quest-ce-que-javascript-et-a-quoi-ca-sert/#comments</comments>
		<pubDate>Sun, 07 Apr 2013 22:04:26 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[browser]]></category>
		<category><![CDATA[javascript]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=5619</guid>
		<description><![CDATA[La question parait bête, mais je me la suis posé il y a des années. Et personne n'avait écrit un article pour expliquer ça. Personne. C'était tellement <a href="http://sametmax.com/bien-expliquer-quelque-chose-les-regles-de-base/">évident</a>.]]></description>
			<content:encoded><![CDATA[<p>La question parait bête, mais je me la suis posé il y a des années. Et personne n&#8217;avait écrit un article pour expliquer ça. Personne. C&#8217;était tellement <a href="http://sametmax.com/bien-expliquer-quelque-chose-les-regles-de-base/">évident</a>.</p>
<p>Cet article est pour toi, étudiant en info, commercial dans une boîte IT ou juste curieux qui trouve que l&#8217;<a href="https://fr.wikipedia.org/wiki/Javascript">article Wikipedia</a> ne veut rien dire.</p>
<h2>Ce que c&#8217;est</h2>
<p>Javascript est un langage de programmation, c&#8217;est une forme de code qui permet, quand on sait l&#8217;écrire, de dicter à l’ordinateur quoi faire.</p>
<p>Le code Javascript ressemble à ça :</p>

<div class="wp_syntax"><div class="code"><pre class="javascript" style="font-family:monospace;">setTimeout<span style="color: #009900;">&#40;</span><span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    <span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>truc <span style="color: #339933;">==</span> machin<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #000066;">alert</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'Bidule !'</span><span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">100</span><span style="color: #009900;">&#41;</span></pre></div></div>

<p>C&#8217;est du texte. Juste du texte. Comme une autre langue.</p>
<p>On trouve la majorité du code Javascript dans des pages Web, même si vous ne le voyez pas s&#8217;afficher. En effet, c&#8217;est le seul langage qui permette de dicter à un navigateur Web (Internet Explorer, Firefox, Chrome&#8230;) ce qu&#8217;il doit faire sans rien installer. La grande majorité des navigateurs Web &#8220;parlent&#8221; le Javascript.</p>
<h2>Ce qu&#8217;on peut faire avec</h2>
<p>La plupart du code Javascript se trouve dans des pages Web, et sert donc à dire comme la page Web doit réagir. Cela marche ainsi :</p>
<ol>
<li>L&#8217;utilisateur clique sur un lien ou entre une adresse.</li>
<li>Son navigateur charge la page Web. Il voit le texte, les couleurs, les images.</li>
<li>Si la page Web contient du code Javascript, le navigateur lit le code Javascript et suit les instructions du code.</li>
</ol>
<p>Généralement le code Javascript dans une page Web sert à :</p>
<ul>
<li>Faire bouger, apparaitre ou disparaitre des éléments de la page (un titre, un menu, un paragraphe, une image&#8230;).</li>
<li>Mettre à jour des éléments de la page sans recharger la page (changer le texte, recalculer un nombre, etc).</li>
<li>Demander au serveur un nouveau bout de page et l&#8217;insérer dans la page en cours, sans la recharger.</li>
<li>Attendre que l&#8217;utilisateur face quelque chose (cliquer, taper au clavier, bouger la souris&#8230;) et réagir (faire une des opérations ci-dessus suite à cette action).</li>
</ul>
<p>Le code Javascript sert donc à donner du dynamisme à la page. Sans lui, la page ressemble à une page de livre, un peu animée (grâce à un autre langage appelé le CSS), mais qui ne change pas beaucoup.</p>
<p>Par exemple, voici quelques fonctionnalités que l&#8217;on peut voir dans une page Web qui impliquent Javascript :</p>
<ul>
<li><a href="http://jqueryui.com/accordion/">Un menu accordéon.</a></li>
<li><a href="http://jqueryui.com/datepicker/">Un sélecteur de date.</a></li>
<li><a href="http://jqueryui.com/progressbar/">Une barre de progression.</a></li>
</ul>
<p>Cela ne veut pas dire qu&#8217;on ne pourrait pas avoir ces fonctionnalités avec autre chose que Javascript, mais dans notre cas, elles ont été produites avec Javascript.</p>
<p>Certains sites Web ne pourrait tout simplement pas fonctionner sans Javascript. C&#8217;est le cas de Facebook, Youtube ou Twitter qui utilisent le langage pour presque tout leur affichage. La page de recherche de Google, en revanche, peut fonctionner sans Javascript.</p>
<p>Voilà par exemple deux pages similaires. L&#8217;une avec Javascript (cliquez sur le texte pour voir l&#8217;effet) :</p>

<!-- iframe plugin v:2.3 - wordpress.org/extend/plugins/iframe/ -->
<iframe width="100%" height="300" src="http://jsfiddle.net/GBJEx/embedded/result,js,html" allowfullscreen="allowfullscreen" frameborder="0" scrolling="no" class="iframe-class"></iframe>
<p>Et l&#8217;autre sans (cliquez, il ne se passe rien):</p>

<!-- iframe plugin v:2.3 - wordpress.org/extend/plugins/iframe/ -->
<iframe width="100%" height="300" src="http://jsfiddle.net/C4Z9A/embedded/result,js,html" allowfullscreen="allowfullscreen" frameborder="0" scrolling="no" class="iframe-class"></iframe>
<h2>Quelques subtilités</h2>
<p>Le code Javascript est lu et exécuté sur le navigateur Web, donc sur l&#8217;ordinateur de l&#8217;internaute. </p>
<p>C&#8217;est ce qu&#8217;on appelle du code &#8220;côté client&#8221;. Et il ne peut pas interagir directement avec le code &#8220;côté serveur&#8221; (celui qui a produit la page Web); et donc on ne peut pas communiquer directement entre le Javascript côté client et PHP côté serveur par exemple.</p>
<p><strong>Comme l&#8217;internaute a le contrôle de sa machine, il peut choisir de désactiver le support de Javascript sur son navigateur. Dans ce cas, ce dernier ignorera le code Javascript et fera comme si il n&#8217;était pas là. Il verra la page, mais tous les éléments qui fonctionnent avec Javascript ne marcheront pas.</strong></p>
<p>Les pages Web sont aussi parcourues par des navigateurs qui ne supportent pas Javascript, et par des robots qui ne sont pas des navigateurs Web. De nombreux moteur de recherche (comme Google, DuckDuckGo ou Bing) ont en effet de tels robots pour lister toutes les pages Web, et souvent leurs robots ignorent Javascript.</p>
<p>Javascript, quand il est dans le navigateur Web, a aussi cette particularité d&#8217;être un langage limité à ce que le navigateur lui laisse faire. C&#8217;est ce qui le rend assez sécurisé. Mais chaque navigateur a ses particularités et comprend parfois le Javascript différemment. De plus, l&#8217;exécution du code Javascript a pendant longtemps été quelque chose de lent.</p>
<p>Cela a rendu le langage impopulaire, il été évité pour sa difficulté d&#8217;utilisation, ses limites importantes et ses performances basses.</p>
<h2>Javascript moderne</h2>
<p>Aujourd&#8217;hui le langage Javascript est massivement utilisé sur tous les sites Web grand public. Des outils, tel que <a href="http://jquery.com/">jQuery</a>, on été développés pour faciliter son utilisation et les navigateurs sont devenus beaucoup plus efficaces dans son traitement.</p>
<p>La popularité grandissante dans les années 2000 d&#8217;un outil appelé AJAX, qui permet à Javascript de mettre à jour une page sans la recharger, a propulsé le langage sur le devant de la scène. L&#8217;utilisation d&#8217;AJAX rendant, si il elle est bien faite, la consultation du site plus rapide et fluide, on l&#8217;a rapidement retrouvé sur tous les sites les plus fréquentés.</p>
<p><strong>La conséquence est qu&#8217;il est aujourd&#8217;hui impossible de se dire sérieusement développeur Web si l&#8217;on n&#8217;est pas capable d&#8217;écrire un minimum de code Javascript. Si vous voulez développer des sites Web, vous devez apprendre au moins les bases de Javascript. Si vous recrutez un développeur Web, assurez vous qu&#8217;il les connaisse.</strong></p>
<p>Javascript permet aujourd&#8217;hui, avec le support d&#8217;autres technologies (Flash, HTML5, canvas, CSS3, WebGL&#8230;), de faire des choses très évoluées comme de <a href="http://mrdoob.github.io/three.js/">la 3D</a>, de la <a href="http://www.pixastic.com/lib/docs/">manipulation d&#8217;images</a>, <a href="http://buzz.jaysalvat.com/">de sons</a> et <a href="http://popcornjs.org/">de videos</a>. Bientôt, avec des innovations comme WebRTC, Javascript permettra de faire du Peer-to-peer et de la vision conférence à l&#8217;intérieur du navigateur Web :</p>

<!-- iframe plugin v:2.3 - wordpress.org/extend/plugins/iframe/ -->
<iframe width="420" height="315" src="http://www.youtube.com/embed/AThKt13H3Nk" frameborder="0" scrolling="no" class="iframe-class"></iframe>
<p>Si vous voyez un jeu vidéo ou un film dans une page Web, un code Javascript est impliqué quelque part. Le langage a quitté depuis longtemps son statut de technologie &#8220;jouet&#8221; et est actuellement l&#8217;un de ceux qui possèdent le plus de potentiel d&#8217;évolution.</p>
<p>Des innovations importantes sont à attendre du côté de Javascript avec la maturation d&#8217;outils tels que <a href="https://www.youtube.com/watch?v=vpp-8gkPWVE">MeteorJs</a> qui permettent de coder, en Javascript, la génération des pages côté serveur ET le code client des navigateurs, tout en les faisant interagir automatiquement. Si cette phrase ne veut rien dire pour vous, dites vous seulement que c&#8217;est le seul langage à tenir cette promesse actuellement.</p>
<h2>Javascript, en dehors d&#8217;un navigateur Web</h2>
<p>Avec l&#8217;amélioration des performances de Javascript, le langage a été de plus en plus utilisé en dehors du navigateur Web. On le retrouve aujourd&#8217;hui un peu partout :</p>
<ul>
<li>Sur les serveurs, l&#8217;exemple le plus célèbre étant <a href="http://nodejs.org/">NodeJS</a>, un outil qui permet de générer les pages Web avant de les envoyer au navigateur.</li>
<li>Sur les interfaces des ordinateurs, il permet d&#8217;afficher des fenêtres et des boutons (Scripting QT, <a href="https://live.gnome.org/GnomeShell">Gnome Shell</a>).</li>
<li>Sur les téléphones, pour le moment sur <a href="https://www.youtube.com/watch?v=0Uxhd6qk2W8">FirefoxOS</a> et <a href="http://phonegap.com/">PhoneGap</a>, il permet d&#8217;écrire des applications.</li>
</ul>
<h2>Frameworks Javascript</h2>
<p>Javascript est né en tant que technologie minimaliste. Le langage est puissant, mais ne fait pas grand chose de lui-même. Avec sa professionalisation sont apparus ce que l&#8217;on appelle des frameworks, c&#8217;est à dire des collections de code qui rendent le développement en Javascript plus rapide, plus facile et plus puissant.</p>
<p>Sur le navigateur, le plus connu et utilisé est sans aucun doute <a href="http://jquery.com">jQuery</a>. Il est aussi celui que nous préférons utiliser chez Sam et Max, et il n&#8217;existe presque plus de raison de ne pas l&#8217;utiliser aujourd&#8217;hui. Par défaut, si rien d&#8217;évident ne s&#8217;oppose fortement à inclure jQuery, nous recommandons toujours de l&#8217;ajouter d&#8217;office à la première lettre du code Javascript tapée sur un projet Web.</p>
<p>Si vous ne savez pas utiliser jQuery mais devez programmer du Javascript pour une page Web, commencez par apprendre à utiliser jQuery. Coder en Javascript à la main de nos jours, c&#8217;est comme moudre sa farine soi-même, c&#8217;est instructif, mais pas très productif.</p>
<p>Il existe tout de même d&#8217;autres frameworks : Mootools, Prototype.js, YahooUI&#8230; Ceux qui existent encore actuellement sont ceux qui ont survécu à l&#8217;effet mode, et ce sont tous des outils aujourd’hui solides.</p>
<p>Ensuite il y a des bibliothèque spécialisées dans des problématiques telles que le routing, la manipulation de modèles, le templating, etc. Encore une fois, si ces termes ne vous parlent pas, c&#8217;est que vous n&#8217;avez pas encore besoin de ces bibliothèques. On retrouve dans le lot <a href="http://backbonejs.org/">backbone.js</a>, <a href="https://github.com/jokry/spinejs">spine.js</a>, <a href="https://github.com/dschnare/mustachejs">mustache.js</a> et bien d&#8217;autres.</p>
<p>Des frameworks hybrides couvrant de nombreuses problématiques à la fois sont arrivés ces dernières années, notamment <a href="http://knockoutjs.com/">knockout.js</a> de Microsoft et <a href="http://angularjs.org/">AngularJS</a> de Google qui sont encore très jeunes mais qui méritent d&#8217;être suivis de prêt.</p>
<h2>Les mauvais côtés de Javascript</h2>
<p>Malgré ma lucidité concernant l&#8217;importance grandissante de Javascript, j&#8217;aimerais partager avec vous des choses que les enthousiastes ne vous disent pas.</p>
<p>D&#8217;abord, c&#8217;est un langage extrêmement laid. Ça va vous sembler futile, mais ça se traduit par un temps d&#8217;apprentissage du langage plus élevé. Un temps de relecture BEAUCOUP plus élevé (et on lit le code des centaines de fois par jour). Un temps de debuggage plus long également. Et des erreurs plus nombreuses car le JS est très permissif. Bref, c&#8217;est un langage très improductif si on le compare à Ruby, Python ou même à PHP.</p>
<p>Pour donner une idée de la chose, voici un code Javascript que peut produire un débutant pour écrire la fameuse chanson <a href="http://99-bottles-of-beer.net/">99 bottle of beers</a>:</p>

<div class="wp_syntax"><div class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #000066; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #003366; font-weight: bold;">var</span> i <span style="color: #339933;">=</span> <span style="color: #CC0000;">99</span> <span style="color: #339933;">;</span> i <span style="color: #339933;">&gt;</span> <span style="color: #CC0000;">0</span> <span style="color: #339933;">;</span> i<span style="color: #339933;">--</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
&nbsp;
  j <span style="color: #339933;">=</span> i <span style="color: #339933;">-</span> <span style="color: #CC0000;">1</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>i <span style="color: #339933;">!=</span> <span style="color: #CC0000;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 
    icase <span style="color: #339933;">=</span> <span style="color: #3366CC;">&quot;bottles&quot;</span><span style="color: #339933;">;</span> 
  <span style="color: #009900;">&#125;</span> <span style="color: #000066; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span> 
    icase <span style="color: #339933;">=</span> <span style="color: #3366CC;">&quot;bottle&quot;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span>
&nbsp;
  <span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>j <span style="color: #339933;">!=</span> <span style="color: #CC0000;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    jcase <span style="color: #339933;">=</span> <span style="color: #3366CC;">&quot;bottles&quot;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span> <span style="color: #000066; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
    jcase <span style="color: #339933;">=</span> <span style="color: #3366CC;">&quot;bottle&quot;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span>
&nbsp;
  console.<span style="color: #660066;">log</span><span style="color: #009900;">&#40;</span>i <span style="color: #339933;">+</span> <span style="color: #3366CC;">&quot; &quot;</span> <span style="color: #339933;">+</span> icase <span style="color: #339933;">+</span> <span style="color: #3366CC;">&quot; of beer on the wall,&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  console.<span style="color: #660066;">log</span><span style="color: #009900;">&#40;</span>i <span style="color: #339933;">+</span> <span style="color: #3366CC;">&quot; &quot;</span> <span style="color: #339933;">+</span> icase <span style="color: #339933;">+</span> <span style="color: #3366CC;">&quot; of beer,&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  console.<span style="color: #660066;">log</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;Take 1 down, pass it around,&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>j <span style="color: #339933;">!=</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    console.<span style="color: #660066;">log</span><span style="color: #009900;">&#40;</span>j <span style="color: #339933;">+</span> <span style="color: #3366CC;">&quot; &quot;</span> <span style="color: #339933;">+</span> jcase <span style="color: #339933;">+</span> <span style="color: #3366CC;">&quot; of beer on the wall.&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span> <span style="color: #000066; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
    console.<span style="color: #660066;">log</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;No more bottles of beer on the wall!&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span>
&nbsp;
  console.<span style="color: #660066;">log</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#125;</span></pre></div></div>

<p>Et voici l&#8217;équivalent (littéral) en Python :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">for</span> i <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">xrange</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">99</span>, <span style="color: #ff4500;">0</span>, -<span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>:
&nbsp;
    j = i - <span style="color: #ff4500;">1</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> i <span style="color: #66cc66;">!</span>= <span style="color: #ff4500;">1</span>:
        icase = <span style="color: #483d8b;">&quot;bottles&quot;</span>
    <span style="color: #ff7700;font-weight:bold;">else</span>:
        icase = <span style="color: #483d8b;">&quot;bottle&quot;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> j <span style="color: #66cc66;">!</span>= <span style="color: #ff4500;">1</span>:
        jcase = <span style="color: #483d8b;">&quot;bottles&quot;</span>
    <span style="color: #ff7700;font-weight:bold;">else</span>:
        jcase = <span style="color: #483d8b;">&quot;bottle&quot;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;%s %s of beer on the wall&quot;</span> <span style="color: #66cc66;">%</span> <span style="color: black;">&#40;</span>i, icase<span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;%s %s of beer,&quot;</span> <span style="color: #66cc66;">%</span> <span style="color: black;">&#40;</span>i, icase<span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;Take 1 down, pass it around,&quot;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> j:
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;%s %s of beer on the wall.&quot;</span> <span style="color: #66cc66;">%</span> <span style="color: black;">&#40;</span>j, jcase<span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">else</span>:
        <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;No more bottles of beer on the wall!&quot;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">print</span></pre></div></div>

<p>En plus d&#8217;être plus plus d&#8217;être plus long de 50 caractères, le code Javascript comporte deux bugs potentiels : les variables non déclarées fonctionnent, mais sont partagées avec tout le reste du code. Le <code>console.log</code> va lui aussi fonctionner sur un serveur et sur certains navigateurs, mais fera planter d&#8217;autres navigateurs qui n&#8217;ont pas accès à cet objet. On peut le remplacer par <code>document.writeln</code> mais alors le code ne marchera pas sur un serveur.</p>
<p>Les prérequis pour coder un simple bout de code Javascript sans erreur sont plus élevés, la vigilance demandée est plus grande.</p>
<p>Ensuite, il est difficile de trouver de bons développeurs Javascript. Les profils les plus courants sont des designers forcés à faire un peu de JS, ou des codeurs PHP qui de temps en temps insèrent du JS dans leurs pages. Les spécialistes Javascript sont rares, chers et pas faciles à embaucher.</p>
<p>D&#8217;ailleurs, pour former quelqu&#8217;un ou se former à Javascript, les ressources sont spartiates. Je ne parle pas des milliers de scripts tout fait prêts à être utilisés. Ça il y en a plein. Je parle de cours pour devenir un codeur sérieux, et sortir de la relation d&#8217;amateurisme que la majorité des développeurs Web ont avec Javascript.</p>
<p>Côté navigateur, le Javascript est mûr. En revanche, en dehors du navigateur, c&#8217;est une technologie qui est encore dans son enfance. Oui, je parierai cher qu&#8217;il va devenir très dominant dans les prochaines années. Mais en attendant, <a href="http://sametmax.com/non-nodejs-nest-pas-mature/">ceux qui s&#8217;y mettent maintenant vont payer les pots cassés</a> : libs pas testées, mal documentées, incompatibles, maintenues avec des baguettes&#8230; quand elles existent.</p>
<p>Rien qu&#8217;installer de quoi coder en Javascript sur sa machine est une plaie : sous Linux et Mac, Ruby et Python sont installés par défaut. Javascript demande des étapes en plus. Sous Windows, c&#8217;est le parcours du combattant.</p>
<p>En clair : mettre trop de billes dans Javascript coûte cher, et c&#8217;est pour cela que je m&#8217;en tiens à développer avec sur des pages Web qui est son habitat naturel puisqu&#8217;il n&#8217;y a besoin de rien installer. C&#8217;est la raison de sa popularité initiale, et on est en train de faire exactement l&#8217;inverse en forçant son portage partout ailleurs.</p>
<p>Javascript n&#8217;est pas adapté à tout, et en ce moment, on veut le mettre à toutes les sauces. C&#8217;est à mon sens préjudiciable, très fortement influencé par un effet de mode, et met de côté d&#8217;excellents autres langages qui seraient beaucoup plus adaptés. Aussi, si vous devez faire de la programmation serveur ou d&#8217;interface graphique, je vous recommande plutôt Ruby ou Python, avec une préférence pour ce dernier somme toute biaisée par l&#8217;usage intensif qu&#8217;on en fait. </p>
<p>En prime ils vous rendront service pour le scripting, les traitements et l&#8217;analyse de données, le prototypage, et plein d&#8217;autres situations auxquelles vous n&#8217;aviez pas pensé. Ce sont des langages créés à l&#8217;origine pour être généralistes, pas adaptés durant les dernières années parce qu&#8217;ils ont le vent en poupe (Python est plus vieux que Java&#8230;).</p>
<p>Cela ne vous dispense pas de capitaliser sur des talents en Javascript en plus de ceux existant. Cela risque d&#8217;être plus qu&#8217;utile pour le futur.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=5619&amp;md5=f169714f23643132c8507834ff6a0602" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/quest-ce-que-javascript-et-a-quoi-ca-sert/feed/</wfw:commentRss>
		<slash:comments>31</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fquest-ce-que-javascript-et-a-quoi-ca-sert%2F&amp;language=en_GB&amp;category=text&amp;title=Qu%26%238217%3Best-ce+que+Javascript+et+%C3%A0+quoi+%C3%A7a+sert+%3F&amp;description=La+question+parait+b%C3%AAte%2C+mais+je+me+la+suis+pos%C3%A9+il+y+a+des+ann%C3%A9es.+Et+personne+n%26%238217%3Bavait+%C3%A9crit+un+article+pour+expliquer+%C3%A7a.+Personne.+C%26%238217%3B%C3%A9tait+tellement+%C3%A9vident.+Cet+article...&amp;tags=browser%2Cjavascript%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/04/0T7Gn.jpg" length="73761" type="image/jpg" />	</item>
		<item>
		<title>Un code plus propre avec &#8220;use strict&#8221; en javascript</title>
		<link>http://sametmax.com/un-code-plus-propre-avec-use-strict-en-javascript/</link>
		<comments>http://sametmax.com/un-code-plus-propre-avec-use-strict-en-javascript/#comments</comments>
		<pubDate>Tue, 26 Mar 2013 10:30:20 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[emacscript]]></category>
		<category><![CDATA[javascript]]></category>
		<category><![CDATA[strict-mode]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=4002</guid>
		<description><![CDATA[Le JavaScript est très permissif. Mais vous avez reçu <a href="http://shop.oreilly.com/product/9780596517748.do">un message de Dieu</a> lui-même, et maintenant vous n'utilisez juste qu'un sous-ensemble du langage dans votre code. Mais cela demande de la vigilance.

Une astuce peut vous aider à rester dans le droit chemin : "use strict".]]></description>
			<content:encoded><![CDATA[<p>Le JavaScript est très permissif. Mais vous avez reçu <a href="http://shop.oreilly.com/product/9780596517748.do">un message de Dieu</a> lui-même, et maintenant vous n&#8217;utilisez juste qu&#8217;un sous-ensemble du langage dans votre code. Mais cela demande de la vigilance.</p>
<p>Une astuce peut vous aider à rester dans le droit chemin : <code>"use strict"</code>.</p>
<p>Bien entendu, vous écrivez votre code dans <a href="http://sametmax.com/la-fonction-anonyme-appelee-immediatement-en-javascript-function/">une fonction appelée immédiatement</a>. Ajoutez la chaîne de caractères <code>"use strict";</code> juste en dessous de cette fonction pour que les interpréteurs des navigateurs modernes deviennent plus exigeants avec celui-ci :</p>

<div class="wp_syntax"><div class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #009900;">&#40;</span><span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
<span style="color: #3366CC;">&quot;use strict&quot;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #006600; font-style: italic;">// votre code</span>
&nbsp;
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></pre></div></div>

<p>Pour les navigateurs qui ne connaissent pas cette instruction, c&#8217;est juste une string, et c&#8217;est ignoré. Pour ceux qui connaissent l&#8217;instruction, tout le bloc concerné (ici tout votre code, mais PAS le code en dehors de la fonction, donc pas de risque de planter le code des autres tels qu&#8217;un plugin jQuery) sera vérifié.</p>
<p>Parmi les vérifications :</p>
<ul>
<li>Définir deux fois le même attribut dans un objet avec la notation littérale.</li>
<li>Utilisation de <code>eval()</code>.</li>
<li>Utilisation de <code>with</code>.</li>
<li>Utilisation de <code>arguments</code> and <code>caller</code>.</li>
</ul>
<p>Si ces situations sont rencontrées, une exception est levée. Un bon article avec des exemples en anglais <a href="http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/">ici</a>.</p>
<p>Tous mes codes JS ont maintenant<code> "use strict"</code> par défaut, en plus du plugin <a href="https://github.com/SublimeLinter/SublimeLinter">SublimeLinter</a> qui me sert de garde-fou supplémentaire.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=4002&amp;md5=ebfb64d54bb2e59d524ab07054a61083" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/un-code-plus-propre-avec-use-strict-en-javascript/feed/</wfw:commentRss>
		<slash:comments>13</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fun-code-plus-propre-avec-use-strict-en-javascript%2F&amp;language=en_GB&amp;category=text&amp;title=Un+code+plus+propre+avec+%26%238220%3Buse+strict%26%238221%3B+en+javascript&amp;description=Le+JavaScript+est+tr%C3%A8s+permissif.+Mais+vous+avez+re%C3%A7u+un+message+de+Dieu+lui-m%C3%AAme%2C+et+maintenant+vous+n%26%238217%3Butilisez+juste+qu%26%238217%3Bun+sous-ensemble+du+langage+dans+votre+code.+Mais+cela+demande+de...&amp;tags=emacscript%2Cjavascript%2Cstrict-mode%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/03/DiHN3sZ.jpg" length="71971" type="image/jpg" />	</item>
		<item>
		<title>Detecter la version d&#8217;IE en Javascript</title>
		<link>http://sametmax.com/detecter-la-version-die-en-javascript/</link>
		<comments>http://sametmax.com/detecter-la-version-die-en-javascript/#comments</comments>
		<pubDate>Tue, 19 Mar 2013 09:19:00 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[browser sniffing]]></category>
		<category><![CDATA[ie]]></category>
		<category><![CDATA[javascript]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=5436</guid>
		<description><![CDATA[Sniffer le browser, c'est maaaaal. Mais comme toute technique diabolique, il existe quelques corner cases dans lesquels on peut le justifier. ]]></description>
			<content:encoded><![CDATA[<p>Sniffer le browser, c&#8217;est maaaaal. Mais comme toute technique diabolique, il existe quelques corner cases dans lesquels on peut la justifier. Par exemple, vous utilisez un plugin jQuery qui plante mystérieusement sous IE (toute ressemblance avec un événement réel n&#8217;est que purement accidentelle), et vous ne comprenez pas pourquoi. Vous ne pouvez donc pas détecter la fonctionnalité qu&#8217;il manque avec <a href="http://modernizr.com/">modernizr</a> ou autre, seulement que ça plante sous IE. En attendant que votre ticket de bug soit pris en compte, il faut bien que votre site en prod marche. Donc, détection du browser, et mise en place de mesures de contournement.</p>
<p>Il y a d&#8217;autres cas utiles :</p>
<ul>
<li>Faire des statistiques sur les versions d&#8217;IE sur votre site sans taper dans votre code backend.</li>
<li>Charger dynamiquement des feuilles de styles et scripts pour IE (en opposition aux commentaires conditionnels qui les chargent avec la page).</li>
<li>Afficher dynamiquement plus de pub aux utilisateurs d&#8217;IE car vous savez qu&#8217;ils sont moins tech saavy que les autres et cliquent plus facilement dessus.</li>
</ul>
<p>Bref, la méthode la plus propre (pour un truc sale :-)) est d&#8217;utiliser des commentaires conditionnels pour mettre une classe au tag <code><html></code>.</p>

<div class="wp_syntax"><div class="code"><pre class="html" style="font-family:monospace;">&lt;!doctype html&gt;
&lt;!--[if lt IE 7 ]&gt; &lt;html class=&quot;ie6&quot;&gt; &lt;![endif]--&gt;
&lt;!--[if IE 7 ]&gt;    &lt;html class=&quot;ie7&quot;&gt; &lt;![endif]--&gt;
&lt;!--[if IE 8 ]&gt;    &lt;html class=&quot;ie8&quot;&gt; &lt;![endif]--&gt;
&lt;!--[if IE 9 ]&gt;    &lt;html class=&quot;ie9&quot;&gt; &lt;![endif]--&gt;
&lt;!--[if (gt IE 9)|!(IE)]&gt;&lt;!--&gt; &lt;html class=&quot;&quot;&gt; &lt;!--&lt;![endif]--&gt;
&lt;head&gt;</pre></div></div>

<p>Ainsi votre page va commencer avec :</p>

<div class="wp_syntax"><div class="code"><pre class="html" style="font-family:monospace;">&lt;html&gt;</pre></div></div>

<p> si ce n&#8217;est pas IE ou si c&#8217;est IE10 (qui est presqu&#8217;un navigateur décent).</p>

<div class="wp_syntax"><div class="code"><pre class="html" style="font-family:monospace;">&lt;html class=&quot;ie6&quot;&gt;</pre></div></div>

<p> si c&#8217;est IE6 ou moins.</p>

<div class="wp_syntax"><div class="code"><pre class="html" style="font-family:monospace;">&lt;html class=&quot;ie7 ou ie8 ou ie9&quot;&gt;</pre></div></div>

<p> respectivement pour ie7, ie8 et ie 8</p>
<p>Et derrière, pour cibler une version d&#8217;IE dans le code JS, jQuery fait des merveilles avec la fonction <code>is()</code>:</p>

<div class="wp_syntax"><div class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #003366; font-weight: bold;">var</span> browserDeMerde <span style="color: #339933;">=</span> $<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'html'</span><span style="color: #009900;">&#41;</span>.<span style="color: #000066; font-weight: bold;">is</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'.ie6, .ie7, .ie8, .ie9'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></div>

<p>Rappelez-vous qu&#8217;avec de grands pouvoirs viennent de grandes responsabilités, alors n&#8217;abusez pas de cette techique, c&#8217;est aussi chiant que les mecs qui font des sites Webkit only.</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=5436&amp;md5=b4d7ab18197bf3a66e7ca17977d58a95" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/detecter-la-version-die-en-javascript/feed/</wfw:commentRss>
		<slash:comments>10</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fdetecter-la-version-die-en-javascript%2F&amp;language=en_GB&amp;category=text&amp;title=Detecter+la+version+d%26%238217%3BIE+en+Javascript&amp;description=Sniffer+le+browser%2C+c%26%238217%3Best+maaaaal.+Mais+comme+toute+technique+diabolique%2C+il+existe+quelques+corner+cases+dans+lesquels+on+peut+la+justifier.+Par+exemple%2C+vous+utilisez+un+plugin+jQuery+qui+plante...&amp;tags=browser+sniffing%2Cie%2Cjavascript%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/03/2juPVdw.png" length="415254" type="image/jpg" />	</item>
		<item>
		<title>Demander confirmation à la fermeture d&#8217;un onglet en javascript</title>
		<link>http://sametmax.com/demander-confirmation-a-la-fermeture-dun-onglet-en-javascript/</link>
		<comments>http://sametmax.com/demander-confirmation-a-la-fermeture-dun-onglet-en-javascript/#comments</comments>
		<pubDate>Mon, 18 Mar 2013 08:28:40 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[event]]></category>
		<category><![CDATA[javascript]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=5405</guid>
		<description><![CDATA[Votre utilisateur est en train d’écrire un commentaire, upload un ficher ou fait un truc quelconque qui n’est pas terminé. Puis il clique sur fermer l’onglet.

Dans certains cas, vous voulez lui demander confirmation pour éviter qu’il perdre tout son travail.]]></description>
			<content:encoded><![CDATA[<p>Votre utilisateur est en train d&#8217;écrire un commentaire, upload un ficher ou fait un truc quelconque qui n&#8217;est pas terminé. Puis il clique sur &#8220;fermer l&#8217;onglet&#8221;.</p>
<p>Dans certains cas, vous voulez lui demander confirmation pour éviter qu&#8217;il perde tout son travail.</p>

<div class="wp_syntax"><div class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #003366; font-weight: bold;">var</span> confirmOnLeave <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>msg<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
&nbsp;
    window.<span style="color: #660066;">onbeforeunload</span> <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">function</span> <span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        e <span style="color: #339933;">=</span> e <span style="color: #339933;">||</span> window.<span style="color: #660066;">event</span><span style="color: #339933;">;</span>
        msg <span style="color: #339933;">=</span> msg <span style="color: #339933;">||</span> <span style="color: #3366CC;">''</span><span style="color: #339933;">;</span>
&nbsp;
        <span style="color: #006600; font-style: italic;">// For IE and Firefox</span>
        <span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>e.<span style="color: #660066;">returnValue</span> <span style="color: #339933;">=</span> msg<span style="color: #339933;">;</span><span style="color: #009900;">&#125;</span>
&nbsp;
        <span style="color: #006600; font-style: italic;">// For Chrome and Safari</span>
        <span style="color: #000066; font-weight: bold;">return</span> msg<span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #006600; font-style: italic;">// message de confirmation générique du navigateur</span>
confirmOnLeave<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #006600; font-style: italic;">// message de confirmation personnalisé</span>
confirmOnLeave<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'Vous allez perdre votre travail, êtes vous sûr(e) de vouloir quitter la page ?'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></div>

<p>Quand vous appelez la fonction <code>confirmOnLeave()</code>, le <a href="http://sametmax.com/quest-ce-quun-callback/">callback</a> de l&#8217;événement &#8216;onbeforeunload&#8217; va être remplacé par une nouvelle fonction. Vous pouvez appeler cette fonction n&#8217;importe quand, l&#8217;événement ne se déclenche que quand l&#8217;utilisateur quitte la page de toute façon.</p>
<p>Cette fonction ne fait que retourner un message et assigner le message à l&#8217;attribut <code>returnValue</code>.</p>
<p>La navigateur va réagir ainsi:</p>
<ul>
<li>À la fermeture de la page, il va déclencher l&#8217;événement &#8216;onbeforeunload&#8217;.</li>
<li>Au déclenchement de l&#8217;événement, il va appeler le callback.</li>
<li>Le navigateur va ensuite regarder la valeur de <code>returnValue</code>. Si elle n&#8217;est pas <code>undefined</code>, il va demander confirmation à l&#8217;utilisateur avec une pop up.</li>
<li>Le contenu de la pop up dépend de <code>returnValue</code>. Si c&#8217;est une chaîne vide, c&#8217;est un message générique, sinon, c&#8217;est le contenu de la chaîne qui est affiché.</li>
</ul>
<p>Dans la plupart des cas, cette fonction suffit. Mais si vous utilisez d&#8217;autres codes JS qui ont besoin aussi de réagir à &#8216;onbeforeunload&#8217; (comme par exemple pour faire un autosave), dans ce cas il vaut mieux utiliser utiliser une gestion avancée d&#8217;attachement de callback a des événements (pour qu&#8217;ils ne s&#8217;écrasent pas les uns les autres). Vous pouvez coder ça à la main, ou juste utiliser celui de jQuery qui fait ça très bien:</p>

<div class="wp_syntax"><div class="code"><pre class="javascript" style="font-family:monospace;">$<span style="color: #009900;">&#40;</span>window<span style="color: #009900;">&#41;</span>.<span style="color: #660066;">bind</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'beforeunload'</span><span style="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    ...
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></div>

 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=5405&amp;md5=8e0c507c1326327abc680d6c57dc9d18" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/demander-confirmation-a-la-fermeture-dun-onglet-en-javascript/feed/</wfw:commentRss>
		<slash:comments>18</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fdemander-confirmation-a-la-fermeture-dun-onglet-en-javascript%2F&amp;language=en_GB&amp;category=text&amp;title=Demander+confirmation+%C3%A0+la+fermeture+d%26%238217%3Bun+onglet+en+javascript&amp;description=Votre+utilisateur+est+en+train+d%26%238217%3B%C3%A9crire+un+commentaire%2C+upload+un+ficher+ou+fait+un+truc+quelconque+qui+n%26%238217%3Best+pas+termin%C3%A9.+Puis+il+clique+sur+%26%238220%3Bfermer+l%26%238217%3Bonglet%26%238221%3B.+Dans+certains+cas%2C+vous...&amp;tags=event%2Cjavascript%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/03/y1b7j.jpg" length="191053" type="image/jpg" />	</item>
		<item>
		<title>Évolution de la courbe d&#8217;apprentissage d&#8217;un dev front end</title>
		<link>http://sametmax.com/evolution-de-la-courbe-dapprentissage-dun-dev-front-end/</link>
		<comments>http://sametmax.com/evolution-de-la-courbe-dapprentissage-dun-dev-front-end/#comments</comments>
		<pubDate>Mon, 07 Jan 2013 16:42:50 +0000</pubDate>
		<dc:creator>Sam</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[bootstrap]]></category>
		<category><![CDATA[coffescript]]></category>
		<category><![CDATA[css]]></category>
		<category><![CDATA[css3]]></category>
		<category><![CDATA[html]]></category>
		<category><![CDATA[html5]]></category>
		<category><![CDATA[javascript]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=4029</guid>
		<description><![CDATA[On est pas dans la spatio-merde]]></description>
			<content:encoded><![CDATA[
<!-- iframe plugin v:2.3 - wordpress.org/extend/plugins/iframe/ -->
<iframe src="http://fr.slideshare.net/slideshow/embed_code/15885873" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" 1="webkitallowfullscreen" 2="mozallowfullscreen" class="iframe-class"></iframe>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=4029&amp;md5=3616766b0b423ec3029813c7d36d05c6" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/evolution-de-la-courbe-dapprentissage-dun-dev-front-end/feed/</wfw:commentRss>
		<slash:comments>12</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fevolution-de-la-courbe-dapprentissage-dun-dev-front-end%2F&amp;language=en_GB&amp;category=text&amp;title=%C3%89volution+de+la+courbe+d%26%238217%3Bapprentissage+d%26%238217%3Bun+dev+front+end&amp;description=Deux+d%C3%A9veloppeurs+en+vadrouille+qui+se+sortent+les+doigts+du+code&amp;tags=bootstrap%2Ccoffescript%2Ccss%2Ccss3%2Chtml%2Chtml5%2Cjavascript%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/01/blue-growth-chart.jpg" length="36625" type="image/jpg" />	</item>
	</channel>
</rss>
