<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Sam &#38; Max: Python, Django, Git et du cul &#187; UrlLib</title>
	<atom:link href="http://sametmax.com/tag/urllib/feed/" rel="self" type="application/rss+xml" />
	<link>http://sametmax.com</link>
	<description>Deux développeurs en vadrouille qui se sortent les doigts du code</description>
	<lastBuildDate>Wed, 05 Feb 2014 14:20:37 +0000</lastBuildDate>
	<language>en</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.3.1</generator>
	<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2F&amp;language=en_US&amp;category=text&amp;title=Sam+%26amp%3B+Max%3A+Python%2C+Django%2C+Git+et+du+cul&amp;description=Deux+d%C3%A9veloppeurs+en+vadrouille+qui+se+sortent+les+doigts+du+code&amp;tags=blog" type="text/html" />
		<item>
		<title>Ouverture du coffre : la méthode simple, bourine, mais efficace</title>
		<link>http://sametmax.com/ouverture-du-coffre-la-methode-simple-bourine-mais-efficace/</link>
		<comments>http://sametmax.com/ouverture-du-coffre-la-methode-simple-bourine-mais-efficace/#comments</comments>
		<pubDate>Fri, 26 Jul 2013 10:16:07 +0000</pubDate>
		<dc:creator>mraaaah</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[base64]]></category>
		<category><![CDATA[meta]]></category>
		<category><![CDATA[pickle]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[UrlLib]]></category>
		<category><![CDATA[zip]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=6789</guid>
		<description><![CDATA[Ceci est un post invité de MrAaaah posté sous licence creative common 3.0 unported. Salut à toutes et à tous c&#8217;est MrAaaah, je suis celui qui réussi à résoudre le plus rapidement les énigmes du coffre secret de Sam et Max, on ma demandé de vous faire un &#34;petit&#34; article expliquant un peu ma démarche [...]]]></description>
			<content:encoded><![CDATA[<p style="text-align: center;"><em><small>Ceci est un post invité de <a href="http://sametmax.com/author/MrAaaah/">MrAaaah</a> posté sous licence <a href="http://creativecommons.org/licenses/by/3.0/">creative common 3.0 unported</a>.</small></em></p>
<p>Salut à toutes et à tous c&#8217;est MrAaaah, je suis celui qui réussi à résoudre le plus rapidement les énigmes du <a href="http://sametmax.com/fetons-le-depart-de-max/">coffre secret de Sam et Max</a>, on ma demandé de vous faire un &quot;petit&quot; article expliquant un peu ma démarche et mes méthodes.</p>
<h2 id="avant-propos">Avant-propos</h2>
<p>Avant de me lancer dans la résolution des énigmes je tiens à signaler que je n&#8217;ai qu&#8217;un an de python dans les pattes, de ce fait le code peut paraitre cradoc et peut-être un poil bourrin vu que je ne connais pas encore très bien python, ses librairies et ses subtilités (ça a également été codé très vite). Je n’ai pas retouché le fonctionnement de mes scripts, j&#8217;ai juste renommé quelques variables et mis des commentaires, donc c&#8217;est du brut, y&#8217;a pas de vérif, ça plante à la fin, etc.</p>
<h2 id="yunoopen">Y U NO OPEN?</h2>
<p><a href="http://sametmax.com/ouverture-du-coffre-la-methode-simple-bourine-mais-efficace/attachment/36924691/" rel="attachment wp-att-6790"><img src="http://sametmax.com/wp-content/uploads/2013/07/36924691.jpg" alt="Un petit meme : &quot;Code Y U NO WORK?&quot;" title="Code Y U NO WORK?" width="400" height="300" class="aligncenter size-full wp-image-6790" /></a></p>
<p>Première énigme <a href="http://game.sametmax.com/">http://game.sametmax.com/</a> : un message, un champ d&#8217;entrée et une image. Comme beaucoup je suppose, je commence par rentrer diverses conneries dans le formulaire, toujours le même résultat : le message &#8220;<strong>I don&#8217;t GET it.</strong>&#8221;.</p>
<p>Je parcours le code source de la page à la recherche d&#8217;un éventuel script où autre indice dans le code, nada.</p>
<p>Si on regarde l&#8217;url on peut voir que le code est envoyé via la méthode <em>GET</em> : http://game.sametmax.com/<strong>?code=monnezsurtescouilles</strong>. En relisant le message de ci-dessus on peut deviner qu&#8217;il faut balancer une requête de type <em>POST</em>. Pour faire ça rien de plus simple, on sort <em>Firebug</em> (ou équivalent), on édite le code source en changeant l&#8217;attribut <strong>method</strong> du formulaire et on renvoi avec un code bidon.</p>
<p><a href="http://sametmax.com/ouverture-du-coffre-la-methode-simple-bourine-mais-efficace/fb/" rel="attachment wp-att-6796"><img src="http://sametmax.com/wp-content/uploads/2013/07/fb.png" alt="Modification de la methode d&#039;envoi d&#039;un formulaire avec Firebug." title="Firebug" width="679" height="439" class="aligncenter size-full wp-image-6796" /></a></p>
<p>Là on obtient un nouveau message : &#8220;Error log : areyouhuman&#8221;. Bon je retente des codes bidon (genre &#8220;yes&#8221;, etc.). Je cherche sur le net &#8220;areyouhuman&#8221;, mais rien de concluant.</p>
<p>Au final rien de bien complexe, mais y’a moyen de tourner un peu en rond, il suffit «juste» d&#8217;allez sur l&#8217;URL <a href="http://game.sametmax.com/areyouhuman">http://game.sametmax.com/areyouhuman</a></p>
<h2 id="areyouhuman">areyouhuman</h2>
<p>À partir de là des connaissances en Python (basiques) vont être nécessaires. (j&#8217;utilise ici Python 2.7)</p>
<p>La page nous renvoie ce qui ressemble à une définition de classe <em>NextUrlContainer</em> avec un attribut <em>next</em> suivi d&#8217;une bouillie de caractères en commentaire.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">NextUrlContainer = <span style="color: #008000;">type</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;NextUrlContainer&quot;</span>, <span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>, <span style="color: black;">&#123;</span><span style="color: #483d8b;">'__init__'</span>: <span style="color: black;">&#40;</span><span style="color: #ff7700;font-weight:bold;">lambda</span> s, n: <span style="color: #008000;">setattr</span><span style="color: black;">&#40;</span>s, <span style="color: #483d8b;">'next'</span>, n<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#125;</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># Y2NvcHlfcmVnCl9yZWNvbnN0cnVjdG9yCnAwCihjX19tYWluX18KTmV4dFVybENvbnRhaW5lcgpw MQpjX19idWlsdGluX18Kb2JqZWN0CnAyCk50cDMKUnA0CihkcDUKUyduZXh0JwpwNgpJMjA5NzM1 MQpzYi4=</span></pre></div></div>

<p>Avec un peu de recherche on découvre que la soi-disant bouillie n&#8217;est autre que du texte encodé en <a href="https://fr.wikipedia.org/wiki/Base64">base64</a>. Une fois décodé (il y a des utilitaires en ligne qui font ça très bien), on obtient quelque chose qui nous parle un peu plus (quoique).</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;">ccopy_reg
_reconstructor
p0
<span style="color: black;">&#40;</span>c__main__
NextUrlContainer
p1
c__builtin__
<span style="color: #008000;">object</span>
p2
Ntp3
Rp4
<span style="color: black;">&#40;</span>dp5
S<span style="color: #483d8b;">'next'</span>
p6
I2097351
sb.</pre></div></div>

<p>Encore un peu de recherche et je découvre que c&#8217;est un fameux <a href="http://sametmax.com/plist-pickle-hdf5-protocol-buffer-les-formats-binaires/">pickle</a>, on sort notre Python préféré.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># -*-coding:Utf-8 -*</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">base64</span>, <span style="color: #dc143c;">pickle</span>
&nbsp;
NextUrlContainer = <span style="color: #008000;">type</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;NextUrlContainer&quot;</span>, <span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>, <span style="color: black;">&#123;</span><span style="color: #483d8b;">'__init__'</span>: <span style="color: black;">&#40;</span><span style="color: #ff7700;font-weight:bold;">lambda</span> s, n: <span style="color: #008000;">setattr</span><span style="color: black;">&#40;</span>s, <span style="color: #483d8b;">'next'</span>, n<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#125;</span><span style="color: black;">&#41;</span>
&nbsp;
b64 = <span style="color: #483d8b;">&quot;Y2NvcHlfcmVnCl9yZWNvbnN0cnVjdG9yCnAwCihjX19tYWluX18KTmV4dFVybENvbnRhaW5lcgpw MQpjX19idWlsdGluX18Kb2JqZWN0CnAyCk50cDMKUnA0CihkcDUKUyduZXh0JwpwNgpJMjA5NzM1 MQpzYi4=&quot;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># on décode et on dépickle-ise</span>
obj = <span style="color: #dc143c;">pickle</span>.<span style="color: black;">loads</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">base64</span>.<span style="color: black;">urlsafe_b64decode</span><span style="color: black;">&#40;</span>b64<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">print</span> obj.<span style="color: black;">next</span></pre></div></div>

<p>Et on obtient un objet de type <em>NextUrlContainer</em> contenant l&#8217;id de la prochaine URL : <strong>2097351</strong>.<br />
En ce rendant sur <a href="http://game.sametmax.com/areyouhuman/2097351">http://game.sametmax.com/areyouhuman/2097351</a> on se retrouve avec de nouveau un pickle encodé en base64. Après en avoir fait deux URL à la main, on ressort Python pour automatiser tout ça.<br />
<br/></p>
<p>Notre script doit :</p>
<ul>
<li>
<p>Récupérer le contenu de la page http://game.sametmax.com/areyouhuman/:id. (j&#8217;utilise ici la librairie httplib)</p>
</li>
<li>
<p>Décoder le contenu. (base64)</p>
</li>
<li>
<p>Dépickle-iser (je ne connais pas le terme &#8220;officiel&#8221;). (pickle)</p>
</li>
<li>
<p>Récupérer le prochain id.</p>
</li>
<li>
<p>Recommencer à la première étape jusqu&#8217;à… la fin.</p>
</li>
</ul>
<p>Voilà le script utilisé. Il affiche chaque nouvel id et plante quand on arrive au bout.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># -*-coding:Utf-8 -*</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">httplib</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">base64</span>, <span style="color: #dc143c;">pickle</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># la classe donnée sur la page http://game.sametmax.com/areyouhuman</span>
NextUrlContainer = <span style="color: #008000;">type</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;NextUrlContainer&quot;</span>, <span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>, <span style="color: black;">&#123;</span><span style="color: #483d8b;">'__init__'</span>: <span style="color: black;">&#40;</span><span style="color: #ff7700;font-weight:bold;">lambda</span> s, n: <span style="color: #008000;">setattr</span><span style="color: black;">&#40;</span>s, <span style="color: #483d8b;">'next'</span>, n<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#125;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># initialisation de la connection</span>
connection = <span style="color: #dc143c;">httplib</span>.<span style="color: black;">HTTPConnection</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;game.sametmax.com:80&quot;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Fait une requête sur l'URL http://game.sametmax.com/areyouhuman/:id</span>
<span style="color: #808080; font-style: italic;"># Et retourne le contenu de la page</span>
<span style="color: #ff7700;font-weight:bold;">def</span> make_request<span style="color: black;">&#40;</span><span style="color: #008000;">id</span><span style="color: black;">&#41;</span>:
    url = <span style="color: #483d8b;">&quot;/areyouhuman/%i&quot;</span> <span style="color: #66cc66;">%</span> <span style="color: #008000;">id</span>
    connection.<span style="color: black;">request</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;GET&quot;</span>, url<span style="color: black;">&#41;</span>
    response = connection.<span style="color: black;">getresponse</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">return</span> response.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;"># id de départ</span>
<span style="color: #008000;">id</span> = <span style="color: #ff4500;">2097351</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># tant que ça plante pas ça suit les liens</span>
<span style="color: #ff7700;font-weight:bold;">while</span> <span style="color: #ff4500;">1</span>:
    <span style="color: #808080; font-style: italic;"># récupération du pickle en base64 contenant l'id de la prochain URL</span>
    response_crypt = make_request<span style="color: black;">&#40;</span><span style="color: #008000;">id</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># on décode et on dépickle-ise</span>
    obj = <span style="color: #dc143c;">pickle</span>.<span style="color: black;">loads</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">base64</span>.<span style="color: black;">urlsafe_b64decode</span><span style="color: black;">&#40;</span>response_crypt<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># on remplace l'id courant par le prochain afin de pouvoir recommencer</span>
    <span style="color: #008000;">id</span> = obj.<span style="color: black;">next</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #008000;">id</span></pre></div></div>

<p>On le lance et ça tourne un petit bout de temps avant d&#8217;en arriver au bout. (le serveur doit adorer)</p>
<pre>
    3245669
    2993679
    1050294
    .......
    9683898
    8147905
    9664723
    wololo.zip
    Traceback (most recent call last):
      File "1_requests.py", line 27, in <module>
        response_crypt = make_request(id)
      File "1_requests.py", line 14, in make_request
        URL = "/areyouhuman/%i" % id
    TypeError: %d format: a number is required, not str
</pre>
<p>On a donc notre prochaine destination : <a href="http://game.sametmax.com/wololo.zip">http://game.sametmax.com/wololo.zip</a></p>
<h2 id="wololo">Wololo</h2>
<p><a href="http://sametmax.com/ouverture-du-coffre-la-methode-simple-bourine-mais-efficace/wololo/" rel="attachment wp-att-6797"><img src="http://sametmax.com/wp-content/uploads/2013/07/wololo.jpg" alt="Petit strip humoristique en réference à AOE et ses prètres wololoteur" title="Wololo" width="600" height="405" class="size-full wp-image-6797" /></a></p>
<p>Pour pas me prendre la tête j&#8217;ai télécharger le .zip dans le même répertoire que mes scripts.</p>
<p>On commence par dézipper <em>wololo.zip</em>, on obtient <em>one_more_time_1.zip</em> que l&#8217;on dézippe, on obtient <em>one_more_time_2.zip</em> que l&#8217;on dézippe, on obtient <em>one_more_time_3.zip</em> que l&#8217;on dézippe, etc.</p>
<p>Bon par besoin de chercher très loin pour savoir quoi faire, l&#8217;algo est simple :</p>
<ul>
<li>
<p>On dézippe <em>wololo.zip</em> (zipfile)</p>
</li>
<li>
<p>Tant que ça marche</p>
</li>
<li>
<p>On dézippe le fichier venant d&#8217;être extrait</p>
</li>
</ul>
<p>Ce qui se traduit en python par :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># -*-coding:Utf-8 -*</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">zipfile</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># archive de départ</span>
archive_name = <span style="color: #483d8b;">&quot;wololo.zip&quot;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># tant qu’il y a quelque chose à dézipper, ça tourne</span>
<span style="color: #ff7700;font-weight:bold;">while</span> <span style="color: #ff4500;">1</span>:
    <span style="color: #808080; font-style: italic;"># ouverture de l'archive</span>
    archive = <span style="color: #dc143c;">zipfile</span>.<span style="color: black;">ZipFile</span><span style="color: black;">&#40;</span>archive_name, <span style="color: #483d8b;">'r'</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># récupération du nom du fichier contenu dans l'archive</span>
    file_to_extract = archive.<span style="color: black;">namelist</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#93;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># extraction</span>
    archive.<span style="color: black;">extract</span><span style="color: black;">&#40;</span>file_to_extract<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">print</span> file_to_extract
&nbsp;
    <span style="color: #808080; font-style: italic;"># le fichier tout fraichement extrait sera le prochain à être dézippé</span>
    <span style="color: #808080; font-style: italic;"># (ça plantera quand y'aura plus de .zip)</span>
    archive_name = file_to_extract</pre></div></div>

<p>On exécute</p>
<pre>
one_more_time_1.zip
one_more_time_2.zip
one_more_time_3.zip
...................
one_more_time_998.zip
one_more_time_999.zip
one_more_time_1000.zip
youdiditjonhy.txt
Traceback (most recent call last):
  File "2_zips.py", line 10, in <module>
    archive = zipfile.ZipFile(archive_name, 'r')
  File "/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/zipfile.py", line 712, in __init__
    self._GetContents()
  File "/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/zipfile.py", line 746, in _GetContents
    self._RealGetContents()
  File "/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/zipfile.py", line 761, in _RealGetContents
    raise BadZipfile, "File is not a zip file"
zipfile.BadZipfile: File is not a zip file
</pre>
<p>On se retrouve donc avec un nouveau petit fichier <strong>youdiditjonhy.txt</strong> contenant le texte</p>
<pre>api.json</pre>
<p>ainsi que 1000 fichiers zip … un petit <em>rm one_more_time</em>* dans son terminal (sur Windows débrouillez-vous) pour cleaner tout ça et on repart pour l&#8217;énigme suivante.</p>
<h2 id="api.json">api.json</h2>
<p>On se rend donc sur <a href="http://game.sametmax.com/api.json">http://game.sametmax.com/api.json</a>…</p>
<p>Et on se prend ça dans la tronche :</p>

<div class="wp_syntax"><div class="code"><pre class="json" style="font-family:monospace;">{&quot;\f&quot;: [&quot;.&quot;], &quot; &quot;: [&quot;.&quot;], &quot;$&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;(&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;,&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;0&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;4&quot;: [&quot;.&quot;], &quot;8&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;&lt;&quot;: [&quot;.&quot;], &quot;@&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;D&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;H&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;L&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;P&quot;: [&quot;.&quot;], &quot;T&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;X&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;\\&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;`&quot;: [&quot;.&quot;], &quot;d&quot;: [&quot;.&quot;], &quot;h&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;l&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;p&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;t&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;x&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;|&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;\u000b&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;#&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;'&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;+&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;/&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;3&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;7&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;;&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;?&quot;: [&quot;.&quot;], &quot;C&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;G&quot;: [&quot;.&quot;], &quot;K&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;O&quot;: [&quot;.&quot;], &quot;S&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;W&quot;: [&quot;.&quot;], &quot;[&quot;: [&quot;.&quot;], &quot;_&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;c&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;g&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;k&quot;: [&quot;.&quot;], &quot;o&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;s&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;w&quot;: [&quot;.&quot;], &quot;{&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;\n&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;\&quot;&quot;: [&quot;.&quot;], &quot;&amp;&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;*&quot;: [&quot;.&quot;], &quot;.&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;2&quot;: [&quot;.&quot;], &quot;6&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;:&quot;: [&quot;.&quot;], &quot;&gt;&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;B&quot;: [&quot;.&quot;], &quot;F&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;J&quot;: [&quot;.&quot;], &quot;N&quot;: [&quot;.&quot;], &quot;R&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;V&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;Z&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;^&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;b&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;f&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;j&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;n&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;r&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;v&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;z&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;~&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;\t&quot;: [&quot;.&quot;], &quot;\r&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;!&quot;: [&quot;.&quot;], &quot;%&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;)&quot;: [&quot;.&quot;], &quot;-&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;1&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;5&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;9&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;=&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;A&quot;: [&quot;.&quot;], &quot;E&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;I&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;M&quot;: [&quot;.&quot;], &quot;Q&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;U&quot;: [&quot;.&quot;], &quot;Y&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;]&quot;: [&quot;.&quot;], &quot;a&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;e&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;i&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;m&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;q&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;u&quot;: [&quot;.&quot;, &quot;.&quot;], &quot;y&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;], &quot;}&quot;: [&quot;.&quot;, &quot;.&quot;, &quot;.&quot;]}</pre></div></div>

<div id="attachment_6798" class="wp-caption aligncenter" style="width: 410px"><a href="http://sametmax.com/ouverture-du-coffre-la-methode-simple-bourine-mais-efficace/wtf/" rel="attachment wp-att-6798"><img src="http://sametmax.com/wp-content/uploads/2013/07/wtf.jpg" alt="Sir Patrick Stewart jurant à la vu de ce fichier json" title="Wtf" width="400" height="297" class="size-full wp-image-6798" /></a><p class="wp-caption-text">Même Sir Patrick Stewart semble contrarié par ce fichier !</p></div>
<p>Bon déjà on sait que c&#8217;est du <a href="http://sametmax.com/yaml-xml-json-csv-ini-quest-ce-que-cest-et-a-quoi-ca-sert/">JSON</a>, on se fait un nouveau script pour voir ce que donne ce json en Python :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># -*-coding:Utf-8 -*</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">httplib</span>
<span style="color: #ff7700;font-weight:bold;">import</span> json
&nbsp;
<span style="color: #808080; font-style: italic;"># on récupère le json</span>
connection = <span style="color: #dc143c;">httplib</span>.<span style="color: black;">HTTPConnection</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;game.sametmax.com:80&quot;</span><span style="color: black;">&#41;</span>
url = <span style="color: #483d8b;">&quot;/api.json&quot;</span>
connection.<span style="color: black;">request</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;GET&quot;</span>, url<span style="color: black;">&#41;</span>
response = connection.<span style="color: black;">getresponse</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># on transorme en python</span>
decoded = json.<span style="color: black;">loads</span><span style="color: black;">&#40;</span>response.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">print</span> decode</pre></div></div>

<p>Bon c&#8217;est pas beaucoup mieux, on à affaire à un dictionnaire avec pour clé un caractère Unicode avec une liste de &#8216;.&#8217; plus où moins longue associé. En mettant un peu en forme ça donne un truc du genre :</p>
<pre>
Y :  . . .
Z :  . . .
[ :  .
\ :  . .
] :  .
^ :  . .
_ :  . .
` :  .
a :  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
b :  . . .
</pre>
<p>Soit pas grand-chose d&#8217;exploitable, je modifie le script pour obtenir le nombre de points associé à chaque caractère :</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># -*-coding:Utf-8 -*</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">httplib</span>
<span style="color: #ff7700;font-weight:bold;">import</span> json
&nbsp;
<span style="color: #808080; font-style: italic;"># on récupère le json</span>
connection = <span style="color: #dc143c;">httplib</span>.<span style="color: black;">HTTPConnection</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;game.sametmax.com:80&quot;</span><span style="color: black;">&#41;</span>
url = <span style="color: #483d8b;">&quot;/api.json&quot;</span>
connection.<span style="color: black;">request</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;GET&quot;</span>, url<span style="color: black;">&#41;</span>
response = connection.<span style="color: black;">getresponse</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># on met ça en python</span>
decoded = json.<span style="color: black;">loads</span><span style="color: black;">&#40;</span>response.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># on passe le dico en liste pour pouvoir le trier</span>
items = decoded.<span style="color: black;">items</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
items.<span style="color: black;">sort</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">for</span> i <span style="color: #ff7700;font-weight:bold;">in</span> items:
    <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #483d8b;">&quot;%s : %s&quot;</span> <span style="color: #66cc66;">%</span> <span style="color: black;">&#40;</span>i<span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#93;</span>, <span style="color: #008000;">len</span><span style="color: black;">&#40;</span>i<span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span></pre></div></div>

<pre>
Z : 3
[ : 1
\ : 2
] : 1
^ : 2
_ : 2
` : 1
a : 50
b : 3
</pre>
<p>À partir de là je tente de convertir des mots en remplaçant les lettres par le nombre de &#8216;.&#8217; associé, par exemple &#8220;Max&#8221; =&gt; 1503. J&#8217;arrête vite mes conneries et me rend compte qu&#8217;une grosse partie des caractères n&#8217;est associé qu&#8217;a 1,2 ou 3 points et quelques autres sont à 50, 30, 60, étrange…</p>
<p>Je garde juste les plus grosses valeurs, les tris dans l&#8217;ordre croissant, soit : 10 20 &#8230; 80. En reprenant chaque clé associée, on obtient le mot <strong>gnitaehc</strong>, soit <strong>cheating</strong> à l&#8217;envers. Peu de chance que ce soit là par hasard. </p>
<p>On se rend sur <a href="http://game.sametmax.com/cheating">http://game.sametmax.com/cheating</a>, on arrive à la fin.</p>
<h2 id="ba">↑↑↓↓←→←→BA</h2>
<p>Retour sur la page d&#8217;accueil avec cette fois-ci le Konami code en message (↑↑↓↓←→←→BA). Pas de temps à perdre, on va sur <a href="http://game.sametmax.com/konami">http://game.sametmax.com/konami</a>.</p>
<h2 id="achievementunlocked">Achievement unlocked</h2>
<p>Et c&#8217;est là que ce termine la série d&#8217;énigmes ! Au final la difficulté était plutôt bien dosée, pas trop hard pour un débutant tout en offrant du challenge et du cassage de tête.</p>
<p>J’espère avoir été clair dans mes explications, si y’a des questions sur certains point allez-y, même si ce n&#8217;est pas moi je pense qu’il y’aura toujours quelqu’un pour vous éclairer.</p>
<p>Si vous avez utilisé d&#8217;autres techniques ou s’il y a des remarques sur mon code, allez-y. Dans les commentaires de l&#8217;article original, il y&#8217;a une solution &#8220;collaborative&#8221; similaire à la mienne (bon leurs codes est quand même un peu plus propre), y&#8217;a également Recher qui nous propose d&#8217;utiliser un éditeur hexadécimal pour l&#8217;énigme du zip.</p>
<p>Je suis assez amateur de ce genre de puzzle/challenge, si ça interesse des gens il y a quelques sites bien sympa pour se prendre la tête :</p>
<ul>
<li>
<p><a href="http://www.pythonchallenge.com/">http://www.pythonchallenge.com/</a> : qui est un grand classique, très orienté python, niveau énigme c&#8217;est vraiment dans la même veine que cette ouverture de coffre, pour ma part j&#8217;avais testé il y&#8217;a quelque temps et je m&#8217;étais assez vite retrouvé coincé… (par contre il ne faut pas s&#8217;arrêter à l&#8217;aspect graphique qui fait un peu saigner les yeux…)</p>
</li>
<li>
<p><a href="http://www.newbiecontest.org/">http://www.newbiecontest.org/</a> : ce site est beaucoup plus général en proposant des épreuves de crypto, hacking, prog, logique, crackme, etc. Et y&#8217;a largement de quoi péter des plombs. La partie programation est assez interessante pour se faire un peu de python. (par contre il est necessaire de s&#8217;inscrire)</p>
</li>
<li>
<p>Y&#8217;en a plein d&#8217;autre je suppose, mais je n&#8217;ai testé que ces deux là, si vous avez quelques bonnes adresses n’hésitez pas à partager.</p>
</li>
</ul>
<p>Sur ce, bravo à ceux qui ont tenté le jeu, bon voyage à Max et encore merci à nos deux taulier !</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=6789&amp;md5=da5cd4ed670922f6296380bd6ec49e67" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/ouverture-du-coffre-la-methode-simple-bourine-mais-efficace/feed/</wfw:commentRss>
		<slash:comments>15</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Fouverture-du-coffre-la-methode-simple-bourine-mais-efficace%2F&amp;language=en_GB&amp;category=text&amp;title=Ouverture+du+coffre+%3A+la+m%C3%A9thode+simple%2C+bourine%2C+mais+efficace&amp;description=Ceci+est+un+post+invit%C3%A9+de+MrAaaah+post%C3%A9+sous+licence+creative+common+3.0+unported.+Salut+%C3%A0+toutes+et+%C3%A0+tous+c%26%238217%3Best+MrAaaah%2C+je+suis+celui+qui+r%C3%A9ussi+%C3%A0+r%C3%A9soudre+le...&amp;tags=base64%2Cmeta%2Cpickle%2Cpython%2CUrlLib%2Czip%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2013/07/tumblrmjki.gif" length="938052" type="image/jpg" />	</item>
		<item>
		<title>Traduire du texte avec UrlLib, BeautifulSoup et Google Translation</title>
		<link>http://sametmax.com/traduire-du-texte-avec-urllib-beautifulsoup-et-google-translation/</link>
		<comments>http://sametmax.com/traduire-du-texte-avec-urllib-beautifulsoup-et-google-translation/#comments</comments>
		<pubDate>Wed, 15 Feb 2012 20:03:57 +0000</pubDate>
		<dc:creator>Max</dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[BeautifulSoup]]></category>
		<category><![CDATA[traduction]]></category>
		<category><![CDATA[UrlLib]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=152</guid>
		<description><![CDATA[Qui n'a  jamais voulu traduire un peu de texte automatiquement ? Des mots ou des phrase entières. 
On peut faire ça asser facilement avec UrlLib et BeautifulSoup en parsant les résultats de Google Translator.]]></description>
			<content:encoded><![CDATA[<p>Salut les hommes,</p>
<p>Qui n&#8217;a  jamais voulu traduire un peu de texte automatiquement ? Des mots ou des phrase entières. On peut faire ça assez facilement avec <a href="http://docs.python.org/library/urllib.html" target="_blank">UrlLib</a> et <a href="http://www.crummy.com/software/BeautifulSoup/bs3/documentation.html" target="_blank">BeautifulSoup</a>.</p>
<p>Ouvrez un fichier <em>test.py</em> et collez-y le code suivant. Il faut avoir installé BeautifullSoup auparavant (<code>easy_install BeautifulSoup</code> ou <code>pip install BeautifulSoup</code>)</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">urllib</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">urllib2</span>
<span style="color: #ff7700;font-weight:bold;">from</span> BeautifulSoup <span style="color: #ff7700;font-weight:bold;">import</span> BeautifulSoup
&nbsp;
<span style="color: #808080; font-style: italic;"># texte à traduire</span>
text = <span style="color: #483d8b;">'Respect my authority!'</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># on créé les headers</span>
headers = <span style="color: black;">&#123;</span> <span style="color: #483d8b;">'User-Agent'</span> : <span style="color: #483d8b;">'Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.1) Gecko/2008071615 Fedora/3.0.1-1.fc9 Firefox/3.0.1'</span>,
<span style="color: #483d8b;">'Referer'</span>: <span style="color: #483d8b;">'http://translate.google.com/'</span>
<span style="color: black;">&#125;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># la langue originale du texte à traduire</span>
lg_from = <span style="color: #483d8b;">'en'</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># la langue dans laquelle on veut traduire l'article</span>
lg_to = <span style="color: #483d8b;">'fr'</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Paramètres à passer en POST</span>
params = <span style="color: #dc143c;">urllib</span>.<span style="color: black;">urlencode</span><span style="color: black;">&#40;</span> <span style="color: black;">&#123;</span><span style="color: #483d8b;">'hl'</span>: <span style="color: #483d8b;">'fr'</span>,
<span style="color: #483d8b;">'ie'</span>: <span style="color: #483d8b;">'UTF8'</span>,
<span style="color: #483d8b;">'text'</span>: text.<span style="color: black;">encode</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'utf-8'</span><span style="color: black;">&#41;</span>,
<span style="color: #483d8b;">'sl'</span>: lg_from,
<span style="color: #483d8b;">'tl'</span>: lg_to<span style="color: black;">&#125;</span>
<span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># On formule la requête</span>
request = <span style="color: #dc143c;">urllib2</span>.<span style="color: black;">Request</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;http://translate.google.com/translate_t?&quot;</span> + <span style="color: #dc143c;">urllib</span>.<span style="color: black;">urlencode</span><span style="color: black;">&#40;</span><span style="color: black;">&#123;</span><span style="color: #483d8b;">'sl'</span>: lg_from, <span style="color: #483d8b;">'tl'</span>: lg_to<span style="color: black;">&#125;</span><span style="color: black;">&#41;</span>, <span style="color: #008000;">None</span>, headers<span style="color: black;">&#41;</span>
html = <span style="color: #dc143c;">urllib2</span>.<span style="color: black;">urlopen</span><span style="color: black;">&#40;</span>request, params<span style="color: black;">&#41;</span>.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># on récupère la traduction avec BeautifulSoup</span>
translated_soup = BeautifulSoup<span style="color: black;">&#40;</span>html<span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">print</span> translated_soup<span style="color: black;">&#40;</span><span style="color: #483d8b;">'span'</span>, <span style="color: #008000;">id</span>=<span style="color: #483d8b;">'result_box'</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#93;</span>.<span style="color: black;">text</span></pre></div></div>

<p>Exécutons le code&#8230;</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #007800;">$python</span> test.py
Respectez mon autorité<span style="color: #000000; font-weight: bold;">!</span></pre></div></div>

<p>Attention toutefois Google n&#8217;authorise pas l&#8217;automation de ce genre de tâche sans passer par son API (payante).</p>
 <p><a href="http://sametmax.com/?flattrss_redirect&amp;id=152&amp;md5=478baf476cdd27f9aa36f2ee947fbf75" title="Flattr" target="_blank"><img src="http://sametmax.com/wp-content/plugins/flattr/img/flattr-badge-large.png" alt="flattr this!"/></a></p>]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/traduire-du-texte-avec-urllib-beautifulsoup-et-google-translation/feed/</wfw:commentRss>
		<slash:comments>1</slash:comments>
		<atom:link rel="payment" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=sam_et_max&amp;popout=1&amp;url=http%3A%2F%2Fsametmax.com%2Ftraduire-du-texte-avec-urllib-beautifulsoup-et-google-translation%2F&amp;language=en_GB&amp;category=text&amp;title=Traduire+du+texte+avec+UrlLib%2C+BeautifulSoup+et+Google+Translation&amp;description=Salut+les+hommes%2C+Qui+n%26%238217%3Ba+%C2%A0jamais+voulu+traduire+un+peu+de+texte+automatiquement+%3F+Des+mots+ou+des+phrase+enti%C3%A8res.+On+peut+faire+%C3%A7a+assez+facilement+avec+UrlLib+et+BeautifulSoup....&amp;tags=BeautifulSoup%2Ctraduction%2CUrlLib%2Cblog" type="text/html" />
<enclosure url="http://sametmax.com/wp-content/uploads/2012/02/google-translate.jpg" length="29803" type="image/jpg" />	</item>
	</channel>
</rss>
