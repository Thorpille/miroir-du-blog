<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
		>
<channel>
	<title>Comments on: Importer des données, retour d&#8217;expérience</title>
	<atom:link href="http://sametmax.com/importer-des-donnees-retour-dexperience/feed/" rel="self" type="application/rss+xml" />
	<link>http://sametmax.com/importer-des-donnees-retour-dexperience/</link>
	<description>Deux développeurs en vadrouille qui se sortent les doigts du code</description>
	<lastBuildDate>Wed, 05 Feb 2014 12:15:31 +0000</lastBuildDate>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.3.1</generator>
	<item>
		<title>By: Sam</title>
		<link>http://sametmax.com/importer-des-donnees-retour-dexperience/#comment-18830</link>
		<dc:creator>Sam</dc:creator>
		<pubDate>Wed, 22 Jan 2014 18:57:55 +0000</pubDate>
		<guid isPermaLink="false">http://sametmax.com/?p=8772#comment-18830</guid>
		<description>Idée noire de franquin ?</description>
		<content:encoded><![CDATA[<p>Idée noire de franquin ?</p>
]]></content:encoded>
	</item>
	<item>
		<title>By: Réchèr</title>
		<link>http://sametmax.com/importer-des-donnees-retour-dexperience/#comment-18819</link>
		<dc:creator>Réchèr</dc:creator>
		<pubDate>Wed, 22 Jan 2014 12:07:05 +0000</pubDate>
		<guid isPermaLink="false">http://sametmax.com/?p=8772#comment-18819</guid>
		<description>Si un jour vous faites un article sur l&#039;idem&lt;strong&gt;potence&lt;/strong&gt;, voici une image sympa qui pourrait illustrer le propos. (surtout la dernière case).

&lt;a href=&quot;http://3.bp.blogspot.com/-BRTDh6M-WxM/URzAwbrIh0I/AAAAAAAACIA/91HsYg-04S0/s1600/franquin-idees-noires.guillotine.jpg&quot; rel=&quot;nofollow&quot;&gt;http://3.bp.blogspot.com/-BRTDh6M-WxM/URzAwbrIh0I/AAAAAAAACIA/91HsYg-04S0/s1600/franquin-idees-noires.guillotine.jpg&lt;/a&gt;</description>
		<content:encoded><![CDATA[<p>Si un jour vous faites un article sur l&#8217;idem<strong>potence</strong>, voici une image sympa qui pourrait illustrer le propos. (surtout la dernière case).</p>
<p><a href="http://3.bp.blogspot.com/-BRTDh6M-WxM/URzAwbrIh0I/AAAAAAAACIA/91HsYg-04S0/s1600/franquin-idees-noires.guillotine.jpg" rel="nofollow">http://3.bp.blogspot.com/-BRTDh6M-WxM/URzAwbrIh0I/AAAAAAAACIA/91HsYg-04S0/s1600/franquin-idees-noires.guillotine.jpg</a></p>
]]></content:encoded>
	</item>
	<item>
		<title>By: mentat</title>
		<link>http://sametmax.com/importer-des-donnees-retour-dexperience/#comment-18656</link>
		<dc:creator>mentat</dc:creator>
		<pubDate>Sat, 18 Jan 2014 11:19:22 +0000</pubDate>
		<guid isPermaLink="false">http://sametmax.com/?p=8772#comment-18656</guid>
		<description>D&#039;accord avec TOUS les points cités.
J&#039;ajouterais que j&#039;utilise des générateurs que j&#039;enchaine :
on lit une ligne &#124; on traite/nettoie les données &#124; on l&#039;insère

Comme un pipe sous un shell unix
On décompose bien les traitements comme cela. Les tests peuvent être enchainés et ajouter/enlever très facilement.

Et les performances sont top</description>
		<content:encoded><![CDATA[<p>D&#8217;accord avec TOUS les points cités.<br />
J&#8217;ajouterais que j&#8217;utilise des générateurs que j&#8217;enchaine :<br />
on lit une ligne | on traite/nettoie les données | on l&#8217;insère</p>
<p>Comme un pipe sous un shell unix<br />
On décompose bien les traitements comme cela. Les tests peuvent être enchainés et ajouter/enlever très facilement.</p>
<p>Et les performances sont top</p>
]]></content:encoded>
	</item>
	<item>
		<title>By: Sam</title>
		<link>http://sametmax.com/importer-des-donnees-retour-dexperience/#comment-18643</link>
		<dc:creator>Sam</dc:creator>
		<pubDate>Fri, 17 Jan 2014 14:39:07 +0000</pubDate>
		<guid isPermaLink="false">http://sametmax.com/?p=8772#comment-18643</guid>
		<description>C&#039;est vrai, mais il faut faire attention à ce que le code d&#039;import ne soit pas exécuté dans la même VM qu&#039;un autre projet, sinon les exceptions seront toutes logguées. Un tips très utile cela dit.</description>
		<content:encoded><![CDATA[<p>C&#8217;est vrai, mais il faut faire attention à ce que le code d&#8217;import ne soit pas exécuté dans la même VM qu&#8217;un autre projet, sinon les exceptions seront toutes logguées. Un tips très utile cela dit.</p>
]]></content:encoded>
	</item>
	<item>
		<title>By: Maxime L.</title>
		<link>http://sametmax.com/importer-des-donnees-retour-dexperience/#comment-18641</link>
		<dc:creator>Maxime L.</dc:creator>
		<pubDate>Fri, 17 Jan 2014 14:11:30 +0000</pubDate>
		<guid isPermaLink="false">http://sametmax.com/?p=8772#comment-18641</guid>
		<description>Si je peux apporter ma pierre à l&#039;édifice... En référence à ce paragraphe : 
&lt;blockquote&gt;Mettez aussi un gros try / except générique qui loggue toute exception, pour pouvoir faire un debug post mortem. Idéalement, faites le dumper locals() et envoyez-vous un mail d’alerte. Vous ne voulez pas que le script ne tourne pas pendant une journée sans que vous le sachiez.&lt;/blockquote&gt;

Pour la gestion des exceptions, je changerai carrément le hook de base de Python.  

&lt;pre lang=&quot;python&quot;&gt;
import sys

def myexcepthook(type, value, tb):
    import traceback
    from email.mime.text import MIMEText
    from subprocess import Popen, PIPE
    tbtext = &#039;&#039;.join(traceback.format_exception(type, value, tb))
    msg = MIMEText(&quot;There was a problem with your program:\n\n&quot; + tbtext)
    msg[&quot;From&quot;] = &quot;root+importer@domain.com&quot;
    msg[&quot;To&quot;] = &quot;admin@domain.com&quot;
    msg[&quot;Subject&quot;] = &quot;[Sam&amp;Max Importer] Crash report (Exception raised)&quot;
    p = Popen([&quot;/usr/sbin/sendmail&quot;, &quot;-t&quot;], stdin=PIPE)
    p.communicate(msg.as_string())


    reload()  # relaunch the importer if possible

sys.excepthook = myexcepthook
&lt;/pre&gt;

Ainsi, un mail est envoyé dès qu&#039;une exception n&#039;est pas géré dans le code (donc ça équivaut à un gros try/except), il exécute cette fonction. C&#039;est plus propre et plus maintenable à mon goût :-)

&lt;a href=&quot;http://stackoverflow.com/a/20829384/1433392&quot; rel=&quot;nofollow&quot;&gt;Référence StackOverflow de la réponse qui m&#039;a inspiré&lt;/a&gt;</description>
		<content:encoded><![CDATA[<p>Si je peux apporter ma pierre à l&#8217;édifice&#8230; En référence à ce paragraphe : </p>
<blockquote><p>Mettez aussi un gros try / except générique qui loggue toute exception, pour pouvoir faire un debug post mortem. Idéalement, faites le dumper locals() et envoyez-vous un mail d’alerte. Vous ne voulez pas que le script ne tourne pas pendant une journée sans que vous le sachiez.</p></blockquote>
<p>Pour la gestion des exceptions, je changerai carrément le hook de base de Python.</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">sys</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> myexcepthook<span style="color: black;">&#40;</span><span style="color: #008000;">type</span>, value, tb<span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">traceback</span>
    <span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">email</span>.<span style="color: black;">mime</span>.<span style="color: black;">text</span> <span style="color: #ff7700;font-weight:bold;">import</span> MIMEText
    <span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">subprocess</span> <span style="color: #ff7700;font-weight:bold;">import</span> Popen, PIPE
    tbtext = <span style="color: #483d8b;">''</span>.<span style="color: black;">join</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">traceback</span>.<span style="color: black;">format_exception</span><span style="color: black;">&#40;</span><span style="color: #008000;">type</span>, value, tb<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
    msg = MIMEText<span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;There was a problem with your program:<span style="color: #000099; font-weight: bold;">\n</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> + tbtext<span style="color: black;">&#41;</span>
    msg<span style="color: black;">&#91;</span><span style="color: #483d8b;">&quot;From&quot;</span><span style="color: black;">&#93;</span> = <span style="color: #483d8b;">&quot;root+importer@domain.com&quot;</span>
    msg<span style="color: black;">&#91;</span><span style="color: #483d8b;">&quot;To&quot;</span><span style="color: black;">&#93;</span> = <span style="color: #483d8b;">&quot;admin@domain.com&quot;</span>
    msg<span style="color: black;">&#91;</span><span style="color: #483d8b;">&quot;Subject&quot;</span><span style="color: black;">&#93;</span> = <span style="color: #483d8b;">&quot;[Sam&amp;amp;Max Importer] Crash report (Exception raised)&quot;</span>
    p = Popen<span style="color: black;">&#40;</span><span style="color: black;">&#91;</span><span style="color: #483d8b;">&quot;/usr/sbin/sendmail&quot;</span>, <span style="color: #483d8b;">&quot;-t&quot;</span><span style="color: black;">&#93;</span>, stdin=PIPE<span style="color: black;">&#41;</span>
    p.<span style="color: black;">communicate</span><span style="color: black;">&#40;</span>msg.<span style="color: black;">as_string</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #008000;">reload</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>  <span style="color: #808080; font-style: italic;"># relaunch the importer if possible</span>
&nbsp;
<span style="color: #dc143c;">sys</span>.<span style="color: black;">excepthook</span> = myexcepthook</pre></div></div>

<p>Ainsi, un mail est envoyé dès qu&#8217;une exception n&#8217;est pas géré dans le code (donc ça équivaut à un gros try/except), il exécute cette fonction. C&#8217;est plus propre et plus maintenable à mon goût :-)</p>
<p><a href="http://stackoverflow.com/a/20829384/1433392" rel="nofollow">Référence StackOverflow de la réponse qui m&#8217;a inspiré</a></p>
]]></content:encoded>
	</item>
	<item>
		<title>By: Recher</title>
		<link>http://sametmax.com/importer-des-donnees-retour-dexperience/#comment-18638</link>
		<dc:creator>Recher</dc:creator>
		<pubDate>Fri, 17 Jan 2014 10:53:59 +0000</pubDate>
		<guid isPermaLink="false">http://sametmax.com/?p=8772#comment-18638</guid>
		<description>Pour les références externes, on a parfois besoin de faire une &quot;memoization&quot; / &quot;lazy evaluation&quot; (je ne sais pas quel serait le terme exact).

Exemple : on doit lire plusieurs milliards de ligne de données, dont l&#039;un des champs est une valeur numérique : &quot;id_position_sexuelle&quot; (plusieurs lignes peuvent avoir la même valeur). Pour connaître le nom de la position correspondante, on doit interroger un serveur externe. Mais ce serveur est vilain, il ne donne qu&#039;un seul nom à la fois, à partir de l&#039;id qu&#039;on lui envoie, et il ne peut pas donner le nombre total de position existante. On ne peut donc pas pré-récupérer tout les noms de positions pour les mettre en cache.

Dans ce cas, à chaque fois qu&#039;on trouve un id inconnu dans les données à lire, on interroge le serveur externe, et on enregistre le nom dans un fichier en local. Plus tard, si on retombe sur le même id, pas besoin de réinterroger le serveur.</description>
		<content:encoded><![CDATA[<p>Pour les références externes, on a parfois besoin de faire une &#8220;memoization&#8221; / &#8220;lazy evaluation&#8221; (je ne sais pas quel serait le terme exact).</p>
<p>Exemple : on doit lire plusieurs milliards de ligne de données, dont l&#8217;un des champs est une valeur numérique : &#8220;id_position_sexuelle&#8221; (plusieurs lignes peuvent avoir la même valeur). Pour connaître le nom de la position correspondante, on doit interroger un serveur externe. Mais ce serveur est vilain, il ne donne qu&#8217;un seul nom à la fois, à partir de l&#8217;id qu&#8217;on lui envoie, et il ne peut pas donner le nombre total de position existante. On ne peut donc pas pré-récupérer tout les noms de positions pour les mettre en cache.</p>
<p>Dans ce cas, à chaque fois qu&#8217;on trouve un id inconnu dans les données à lire, on interroge le serveur externe, et on enregistre le nom dans un fichier en local. Plus tard, si on retombe sur le même id, pas besoin de réinterroger le serveur.</p>
]]></content:encoded>
	</item>
	<item>
		<title>By: Luigi</title>
		<link>http://sametmax.com/importer-des-donnees-retour-dexperience/#comment-18637</link>
		<dc:creator>Luigi</dc:creator>
		<pubDate>Fri, 17 Jan 2014 07:14:11 +0000</pubDate>
		<guid isPermaLink="false">http://sametmax.com/?p=8772#comment-18637</guid>
		<description>Très pertinent, comme d&#039;habitude.</description>
		<content:encoded><![CDATA[<p>Très pertinent, comme d&#8217;habitude.</p>
]]></content:encoded>
	</item>
	<item>
		<title>By: Stéphane</title>
		<link>http://sametmax.com/importer-des-donnees-retour-dexperience/#comment-18634</link>
		<dc:creator>Stéphane</dc:creator>
		<pubDate>Thu, 16 Jan 2014 23:44:13 +0000</pubDate>
		<guid isPermaLink="false">http://sametmax.com/?p=8772#comment-18634</guid>
		<description>&lt;span class=&quot;merci&quot;&gt;&lt;/span&gt;Les remarques de maître Capello :

Ellispis -&gt; Ellipsis

dans la mauvais langue -&gt; dans la mauvaise langue

si on peut processer la donnée -&gt; si on peut traiter la donnée (?)

LEUR système n’escape pas -&gt; LEUR système ne protège pas

une query de plus -&gt; une requête supplémentaire

ajoutez les indexes -&gt; ajoutez les index</description>
		<content:encoded><![CDATA[<p><span class="merci"></span>Les remarques de maître Capello :</p>
<p>Ellispis -&gt; Ellipsis</p>
<p>dans la mauvais langue -&gt; dans la mauvaise langue</p>
<p>si on peut processer la donnée -&gt; si on peut traiter la donnée (?)</p>
<p>LEUR système n’escape pas -&gt; LEUR système ne protège pas</p>
<p>une query de plus -&gt; une requête supplémentaire</p>
<p>ajoutez les indexes -&gt; ajoutez les index</p>
]]></content:encoded>
	</item>
	<item>
		<title>By: bobby</title>
		<link>http://sametmax.com/importer-des-donnees-retour-dexperience/#comment-18632</link>
		<dc:creator>bobby</dc:creator>
		<pubDate>Thu, 16 Jan 2014 21:45:22 +0000</pubDate>
		<guid isPermaLink="false">http://sametmax.com/?p=8772#comment-18632</guid>
		<description>En gros, on fait un gros MapReduce...</description>
		<content:encoded><![CDATA[<p>En gros, on fait un gros MapReduce&#8230;</p>
]]></content:encoded>
	</item>
	<item>
		<title>By: Fred</title>
		<link>http://sametmax.com/importer-des-donnees-retour-dexperience/#comment-18630</link>
		<dc:creator>Fred</dc:creator>
		<pubDate>Thu, 16 Jan 2014 19:24:47 +0000</pubDate>
		<guid isPermaLink="false">http://sametmax.com/?p=8772#comment-18630</guid>
		<description>Moi, pour l&#039;import, c&#039;est super facile
&lt;pre lang=&quot;python&quot;&gt;def import():
    try:
        ... (open... read... insert into...)... # Bref ici tout le code d&#039;import
    except:
        pass
    print(&quot;Import terminé, tout est ok&quot;
# import()&lt;/pre&gt;</description>
		<content:encoded><![CDATA[<p>Moi, pour l&#8217;import, c&#8217;est super facile</p>

<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #ff7700;font-weight:bold;">import</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">try</span>:
        ... <span style="color: black;">&#40;</span><span style="color: #008000;">open</span>... <span style="color: black;">read</span>... <span style="color: black;">insert</span> into...<span style="color: black;">&#41;</span>... <span style="color: #808080; font-style: italic;"># Bref ici tout le code d'import</span>
    <span style="color: #ff7700;font-weight:bold;">except</span>:
        <span style="color: #ff7700;font-weight:bold;">pass</span>
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Import terminé, tout est ok&quot;</span>
<span style="color: #808080; font-style: italic;"># import()</span></pre></div></div>

]]></content:encoded>
	</item>
</channel>
</rss>
